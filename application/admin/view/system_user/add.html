<extend name="@admin:layout"/>
<block name="content">
    <div class="form-horizontal">
        <input type="hidden" value="{$info.id|default=''}" name="id"/>

        <div class="form-group">
            <label class="col-sm-2 control-label required">角色组</label>
            <div class="col-sm-9">
                <div id="treeGroupIds"
                     data-verify-required="true"
                     data-verify-msg="请选择角色组"
                     data-toggle="busy-tree"
                     data-url="{:url('group_tree_data?user_id=' . ($info['id'] ?? 0))}"
                     data-checkbox="true"
                     data-checkbox-relation="false"
                     data-icons="false"
                     data-name="group_ids[]"></div>
                <span class="help-block">为该用户指定一个合适的角色，支持多选</span>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">默认角色组</label>
            <div class="col-sm-9">
                <select class="form-control" name="default_group_id">
                    <option value="0">自动</option>
                </select>
                <span class="help-block">用户登录后将默认打开该角色组的默认菜单，不指定则获取最后一个选中的角色组</span>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label required">用户名</label>
            <div class="col-sm-9">
                <eq name="url.action" value="edit">
                    <div class="input-group">
                        <input type="text" class="form-control" name="username" value="{$info.username|default=''}" placeholder="请输入用户名"/>
                        <div class="input-group-btn">
                            <a class="btn btn-secondary" data-toggle="busy-modal" data-size="sm" data-ok="修改密码" data-url="{:url('password?id=' . $info['id'])}">修改密码</a>
                        </div>
                    </div>
                    <else/>
                    <input type="text" class="form-control" name="username" value="{$info.username|default=''}" placeholder="请输入用户名" required/>
                </eq>
                <span class="help-block">设置登录用户名，中文、英文、数字、下划线，不要有特殊字符，且不能和已有的用户名重复</span>
            </div>
        </div>

        <eq name="url.action" value="add">
            <div class="form-group">
                <label class="col-sm-2 control-label required">登录密码</label>
                <div class="col-sm-9">
                    <div class="input-group">
                        <input type="password" class="form-control" name="password" placeholder="请输入登录密码" required minlength="6" maxlength="20"/>
                        <div class="input-group-addon"><i class="fa fa-lock width-20 text-center"></i></div>
                    </div>
                    <span class="help-block">设置登录密码，至少<code>6</code>位，最多<code>20</code>位</span>
                </div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label required">确认密码</label>
                <div class="col-sm-9">
                    <div class="input-group">
                        <input type="password" class="form-control" name="confirm_password" required data-rule-equalTo="[name='password']" placeholder="请再次输入登录密码" data-msg-equalTo="两次输入的密码不一致"/>
                        <div class="input-group-addon"><i class="fa fa-lock width-20 text-center"></i></div>
                    </div>
                    <span class="help-block">再次输入登录密码，以确认密码正确性</span>
                </div>
            </div>
        </eq>

        <div class="form-group">
            <label class="col-sm-2 control-label">手机号</label>
            <div class="col-sm-9">
                <div class="input-group">
                    <input type="text" class="form-control" name="phone" value="{$info.phone|default=''}" placeholder="请输入手机号"/>
                    <div class="input-group-addon"><i class="fa fa-mobile width-20 text-center"></i></div>
                </div>
                <span class="help-block">设置手机号，设置后可以通过手机号登录</span>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">邮箱</label>
            <div class="col-sm-9">
                <div class="input-group">
                    <input type="email" class="form-control" name="email" value="{$info.email|default=''}" data-rule-required="false" placeholder="请输入邮箱" data-rule-email="true"/>
                    <div class="input-group-addon"><i class="fa fa-envelope-o width-20 text-center"></i></div>
                </div>
                <span class="help-block">设置邮箱，设置后可以通过邮箱地址登录</span>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">QQ号码</label>
            <div class="col-sm-9">
                <input type="text" class="form-control" name="qq" value="{$info.qq|default=''}" minlength="5" maxlength="13" placeholder="请输入QQ号" data-rule-number="true"/>
            </div>
        </div>

        <div class="form-group no-margin-bottom">
            <label class="col-sm-2 control-label">是否启用</label>
            <div class="col-sm-9">
                <div class="radio">
                    <input name="checked" <?=is_disabled($info['system'])?> type="radio" value="1" <?=is_checked(($info['checked'] ?? 0) == 1)?> data-toggle="busy-radio" title="启用"/>
                    <input name="checked" <?=is_disabled($info['system'])?> type="radio" value="0" <?=is_checked(($info['checked'] ?? 0) == 0)?> data-toggle="busy-radio" title="禁用"/>
                </div>
                <span class="help-block">禁用后该账户将无法登录管理系统</span>
            </div>
        </div>
    </div>
</block>
<block name="foot">
    <script>
        busyAdmin.data.defaultGroupId = '{$info.default_group_id|default=0}';
        busyAdmin.ready(function () {
            var $tree          = $('#treeGroupIds');
            var $defaultGroup  = $('[name="default_group_id"]');
            var defaultOptions = $defaultGroup.html();
            $tree.on(
                busyAdmin.e.treeReady + ' ' +
                busyAdmin.e.treeSelectNode + ' ' +
                busyAdmin.e.treeSelectAll + ' ' +
                busyAdmin.e.treeDeSelectNode + ' ' +
                busyAdmin.e.treeDeSelectAll,
                function (e, api) {
                    var options = defaultOptions;
                    api.get_selected(true).map(function (item) {
                        var selected = item.id == busyAdmin.data.defaultGroupId ? ' selected' : '';
                        options += '<option value="' + item.id + '"'+ selected +'>' + item.text + '</option>';
                    });
                    $defaultGroup.html(options);
                }
            )
        });
    </script>
</block>