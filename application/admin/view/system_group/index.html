<extend name="@admin:layout"/>
<block name="content">
    <div data-toggle="busy-table"
         data-search="@"
         data-show-columns="true"
         data-show-print="true"
         data-show-refresh="true"
         data-show-export-way="true"
         data-export-filename="{$system.page_title}-%s"
         data-toolbar="@"
         data-route="true"
         data-url="__URL__"
         data-fixed-columns="true"
         data-fixed-right-number="1"
         data-fixed-number="3"
         data-tree-lazy="true"
         data-tree-show-field="name"
         data-state="__ROUTE__"
         data-tree-state="true"
         data-pagination="false"
         data-bordered="true"
         data-height="true">

        <!--search-->
        <template data-template="search">
            <div data-toggle="busy-search-bar"
                 data-url="__URL__"
                 data-accurate-show="true"
                 data-fields="name:角色名称,id:角色ID">
            </div>
        </template>

        <!--toolbar-->
        <template data-template="toolbar" class="hide">
            <ba:access value="add">
                <a class="btn btn-success"
                   data-toggle="busy-modal"
                   data-url="{:url('add')}"
                   data-ok="添加角色"
                   data-form-on-success="@table.reload|@modal.close">
                    <i class="fa fa-plus"></i>
                    添加
                </a>
            </ba:access>
            <ba:access value="delete">
                <a class="btn btn-danger"
                   data-url="{:url('delete')}"
                   data-confirm="确认要删除选中的%s个角色组吗？"
                   data-checked="true"
                   data-disabled="true"
                   data-method="post"
                   data-on-success="@table.reload">
                    <i class="fa fa-trash"></i>
                    删除
                </a>
            </ba:access>
            <ba:access value="sort">
                <a class="btn btn-default"
                   data-url="{:url('sort')}"
                   data-confirm="确认要排序吗？"
                   data-method="post"
                   data-field="id,sort"
                   data-on-success="@table.reload">
                    <i class="fa fa-sort"></i>
                    排序
                </a>
            </ba:access>
        </template>

        <!--table-->
        <table class="table table-bordered table-striped table-hover">
            <thead class="thead-light">
                <tr>
                    <th class="text-center"
                        data-checkbox="true"
                        data-print-ignore="true"
                        data-tableexport-display="false"
                        data-formatter="busyAdmin.data.checkboxState"></th>

                    <ba:access value="sort">
                        <th class="text-center"
                            width="80"
                            data-field="sort"
                            data-title="排序"
                            data-formatter="@">
                            <script type="text/html">
                                <ba-if value="is_print">
                                    {{value}}
                                    <ba-else></ba-else>
                                    <input type="text" class="form-control input-xs text-center" value="{{value}}" data-bind="int"/>
                                </ba-if>
                            </script>
                        </th>
                    </ba:access>

                    <th class="text-center"
                        width="60"
                        data-field="id"
                        data-show-overflow="true"
                        data-title="ID"></th>

                    <th class="text-center"
                        data-min-width="300"
                        data-field="name"
                        data-title="角色名称"
                        data-halign="center"
                        data-align="left"
                        data-show-overflow="true"
                        data-formatter="@">
                        <script type="text/html">
                            {{value}}

                            <ba-if value="item.system">
                                <kbd>系统角色</kbd>
                            </ba-if>
                        </script>
                    </th>

                    <ba:access value="change_status">
                        <th class="text-center"
                            width="80"
                            data-field="status"
                            data-title="状态"
                            data-formatter="@">
                            <script type="text/html">
                                <ba-if value="is_print">
                                    {{value ? '启用' : '禁用'}}
                                    <ba-else></ba-else>
                                    <ba-if value="!item.system">
                                        <input type="checkbox"
                                               class="switch input-xs primary"
                                               data-toggle="busy-checkbox"
                                               data-url="{:url('change_status?id=')}{{item.id}}"
                                               title="启用,禁用"
                                               {{value ? 'checked': ''}}/>
                                        <ba-else/>
                                        -
                                    </ba-if>
                                </ba-if>
                            </script>
                        </th>
                    </ba:access>

                    <th class="text-center"
                        width="100"
                        data-field="default_menu_name"
                        data-show-overflow="true"
                        data-title="默认菜单"></th>

                    <th class="text-center"
                        width="125"
                        data-title="操作"
                        data-print-ignore="true"
                        data-tableexport-display="false"
                        data-formatter="@">

                        <script type="text/html">
                            <ba:access value="add">
                                <a class="btn btn-default btn-xs"
                                   data-toggle="busy-modal"
                                   data-url="{:url('add?id=')}{{item.id}}"
                                   data-ok="添加角色"
                                   data-form-on-success="@table.reload|@modal.close">
                                    <i class="fa fa-plus"></i>
                                    添加
                                </a>
                            </ba:access>
                            <ba:access value="edit">
                                <a class="btn btn-success btn-xs"
                                   href="{:url('edit?id=')}{{item.id}}"
                                   data-toggle="busy-modal"
                                   data-ok="修改角色"
                                   data-form-on-success="@table.reload|@modal.close"><i class="fa fa-pencil"></i></a>
                            </ba:access>
                            <ba:access value="delete">
                                <ba-if value="!item.system">
                                    <a class="btn btn-danger btn-xs"
                                       href="{:url('delete?id=')}{{item.id}}"
                                       data-toggle="busy-request"
                                       data-confirm="确认要删除该角色吗？"
                                       data-on-success="@table.reload"><i class="fa fa-trash"></i></a>
                                </ba-if>
                            </ba:access>
                        </script>
                    </th>
                </tr>
            </thead>
        </table>
    </div>
</block>
<block name="foot">
    <script>
        busyAdmin.data.checkboxState = function (value, item, index) {
            if (item.system) {
                return {disabled : true}
            }

            return value;
        };
    </script>
</block>