<extend name="@admin:layout"/>
<block name="content">
    <div class="panel panel-default">
        <include file="system_manager/nav"/>
        <div class="panel-body">
            <ul class="nav nav-pills">
                <foreach name="disks" item="vo">
                    <li class="{$vo.type == $disk ? 'active' : ''}" data-type="{$vo.type}">
                        <a href="#">{$vo.name}</a>
                    </li>
                </foreach>
            </ul>

            <div class="space"></div>

            <div id="imageStyleTable"
                 data-toggle="busy-table"
                 data-toolbar="@"
                 data-pagination="false"
                 data-show-refresh="true"
                 data-bordered="true"
                 data-fixed-right-number="1"
                 data-fixed-number="2"
                 data-route="true"
                 data-url="__URL__">

                <!--toolbar-->
                <template data-template="toolbar">
                    <div id="image_style_toolbar">
                        <ba:access value="image_style_add">
                            <a class="btn btn-success"
                               data-toggle="busy-modal"
                               data-url="{:url('image_style_add')}"
                               data-ok="添加图片样式"
                               data-params="addParams"
                               data-size="lg"
                               data-form-on-success="@table.reload|@modal.close">
                                <i class="fa fa-plus"></i>
                                添加
                            </a>
                        </ba:access>

                        <ba:access value="image_style_delete">
                            <a class="btn btn-danger"
                               data-url="{:url('image_style_delete')}"
                               data-confirm="确认要删除选中的%s个图片样式吗？"
                               data-checked="true"
                               data-disabled="true"
                               data-params="deleteParams"
                               data-method="post"
                               data-on-success="@table.reload">
                                <i class="fa fa-trash"></i>
                                删除
                            </a>
                        </ba:access>
                    </div>
                </template>

                <!--table-->
                <table class="table table-hover table-striped">
                    <thead class="thead-light">
                        <tr>
                            <th class="text-center"
                                data-checkbox="true"></th>

                            <th data-field="id"
                                data-title="样式名"
                                data-align="left"
                                width="100"
                                data-show-overflow="true"
                                data-formatter="@">
                                <script type="text/html">
                                    <span class="badge badge-primary">{{value}}</span>
                                </script>
                            </th>

                            <th data-field="rule"
                                data-min-width="300"
                                data-title="样式"
                                data-align="left"
                                data-show-overflow="true">
                            </th>

                            <th data-title="操作"
                                data-align="center"
                                data-formatter="@"
                                width="110">
                                <script type="text/html">
                                    <a class="btn btn-default btn-xs"
                                       target="_blank"
                                       href="{:url('image_style_preview')}?disk={{item.disk}}&id={{item.id}}">预览</a>

                                    <ba:access value="image_style_edit">
                                        <a class="btn btn-success btn-xs"
                                           href="{:url('image_style_edit')}?disk={{item.disk}}&id={{item.id}}"
                                           data-toggle="busy-modal"
                                           data-size="lg"
                                           data-ok="修改图片样式"
                                           data-form-on-success="@table.reload|@modal.close"><i class="fa fa-pencil"></i></a>
                                    </ba:access>
                                    <ba:access value="image_style_delete">
                                        <a class="btn btn-danger btn-xs"
                                           href="{:url('image_style_delete')}?disk={{item.disk}}&id={{item.id}}"
                                           data-toggle="busy-request"
                                           data-confirm="确认要删除该图片样式吗？"
                                           data-on-success="@table.reload"><i class="fa fa-trash"></i></a>
                                    </ba:access>
                                </script>
                            </th>
                        </tr>
                    </thead>
                </table>
            </div>

            <div class="space-15"></div>
            <div class="text-gray">
                说明：创建合理的 <span class="badge">图片样式</span> 可以有效的节省
                <span class="badge">服务器存储空间</span> 及
                <span class="badge">带宽</span>
            </div>
        </div>
    </div>
</block>
<block name="foot">
    <script>
        busyAdmin.ready(function () {
            var $table = $('#imageStyleTable');
            var $nav   = $('.nav-pills');
            var disk   = '{$disk}';

            // 设置NAV的高亮状态
            var setNavActive = function (type) {
                disk = type;
                $nav.find('li').removeClass('active');
                $nav.find('[data-type="' + (type || '') + '"]').addClass('active');
            };

            // 监听table通过URL恢复
            // 设置侧边栏的高亮状态
            $table.on(busyAdmin.e.tableResumeUrl, function (e, params) {
                setNavActive(params.disk || '{$disk}');
            });

            // 检测侧边栏点击并按类型请求数据
            // 注意：$contentSide 事件必须要使用命名空间监听，否则会导致事件重复
            $nav.off('click.fileTable').on('click.fileTable', 'li', function (e) {
                e.preventDefault();

                var type = $(this).data('type');
                $table.baTable('reset', {disk : type});
                setNavActive(type);

                return false;
            });

            busyAdmin.data.addParams = function () {
                return {disk : disk};
            };
            
            busyAdmin.data.deleteParams = function (params) {
                params.disk = disk;
                
                return params;
            }
        });
    </script>
</block>