<extend name="@admin:layout"/>
<block name="content">
    <div data-toggle="busy-table"
         data-state="__ROUTE__"
         data-search="@"
         data-show-columns="true"
         data-show-print="true"
         data-show-refresh="true"
         data-show-export-way="true"
         data-export-filename="{$system.page_title}-%s"
         data-toolbar="@"
         data-route="true"
         data-url="__URL__"
         data-bordered="true"
         data-fixed-columns="true"
         data-fixed-right-number="1"
         data-fixed-number="2"
         data-height="true">
        
        <!--search-->
        <template data-template="search">
            <div data-toggle="busy-search-bar"
                 data-url="__URL__"
                 data-accurate-show="true"
                 data-fields="name:配置名称,type:配置标识">
            </div>
        </template>

        <!--toolbar-->
        <template data-template="toolbar">
            <a class="btn btn-success"
               data-toggle="busy-modal"
               data-url="{:url('add')}"
               data-ok="添加配置"
               data-form-on-success="@table.reload|@modal.close">
                <i class="fa fa-plus"></i>
                添加
            </a>
            <a class="btn btn-danger"
               data-url="{:url('delete')}"
               data-confirm="确认要删除选中的%s个配置吗？"
               data-checked="true"
               data-disabled="true"
               data-method="post"
               data-on-success="@table.reload">
                <i class="fa fa-trash"></i>
                删除
            </a>
        </template>

        <!--table-->
        <table class="table table-striped table-hover">
            <thead class="thead-light">
                <tr>
                    <th data-checkbox="true"
                        data-print-ignore="true"
                        data-tableexport-display="false"
                        data-formatter="busyAdmin.data.checkboxState"></th>

                    <th width="60"
                        data-show-overflow="true"
                        data-field="id"
                        data-title="ID"></th>

                    <th data-min-width="200"
                        data-field="name"
                        data-title="配置名称"
                        data-show-overflow="true"
                        data-tableexport-selector="span"
                        data-formatter="@">
                        <script type="text/html">
                            <span>{{value}}</span>
                            
                            <ba-if value="item.system">
                                <kbd>系统配置</kbd>
                            </ba-if>
                        </script>
                    </th>

                    <th width="120"
                        data-field="type"
                        data-title="配置标识"
                        data-show-overflow="true"
                        data-formatter="@">
                        <script type="text/html">
                            <span class="badge badge-primary">{{value}}</span>
                        </script>
                    </th>

                    <th class="text-center"
                        width="80"
                        data-title="操作"
                        data-print-ignore="true"
                        data-tableexport-display="false"
                        data-formatter="@">
                        <script type="text/html">
                            <a class="btn btn-success btn-xs"
                               href="{:url('edit?id=')}{{item.id}}"
                               data-toggle="busy-modal"
                               data-ok="修改配置"
                               data-form-on-success="@table.reload|@modal.close"><i class="fa fa-pencil"></i></a>

                            <ba-if value="!item.system">
                                <a class="btn btn-danger btn-xs"
                                   href="{:url('delete?id=')}{{item.id}}"
                                   data-toggle="busy-request"
                                   data-confirm="确认要删除该配置吗？"
                                   data-on-success="@table.reload"><i class="fa fa-trash"></i></a>
                            </ba-if>
                        </script>
                    </th>
                </tr>
            </thead>
        </table>
    </div>
</block>
<block name="foot">
    <script>
        busyAdmin.data.checkboxState = function (value, item, index) {
            if (item.system) {
                return {disabled : true}
            }

            return value;
        };
    </script>
</block>