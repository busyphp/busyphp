<extend name="@admin:layout"/>
<block name="content">
    <div id="searchBar"
         data-toggle="busy-search-bar"
         data-url="{$url.self}"
         data-accurate-show="true"
         data-fields="name:配置名称,type:配置标识">
    </div>

    <table class="table table-bordered table-striped table-hover"
           data-toggle="busy-table"
           data-state="__ROUTE__"
           data-search="#searchBar"
           data-show-columns="true"
           data-show-print="true"
           data-show-refresh="true"
           data-show-export="true"
           data-show-fullscreen="true"
           data-toolbar="#tableToolbar"
           data-route="true"
           data-url="{$url.self}"
           data-click-to-select="true"
           data-fixed-columns="true"
           data-fixed-right-number="1"
           data-fixed-number="2"
           data-height="true">
        <thead>
            <tr>
                <th class="text-center" width="40" data-checkbox="true" data-print-ignore="true" data-formatter="busyAdmin.data.checkboxState"></th>
                <th class="text-center" width="60" data-field="id" data-title="ID" data-searchable="false"></th>
                <th class="text-center" data-field="name" data-title="配置名称" data-halign="center" data-align="left" data-formatter="@">
                    <script type="text/html">
                        {{value}}
                        {{if item.system}}
                        <kbd>系统配置</kbd>
                        {{/if}}
                    </script>
                </th>
                <th class="text-center" width="120" data-field="type" data-title="配置标识" data-align="center" data-formatter="@">
                    <script type="text/html">
                        <span class="badge badge-primary">{{value}}</span>
                    </script>
                </th>
                <th class="text-center" width="60" data-title="操作" data-print-ignore="true" data-formatter="@" data-click-to-select="false">
                    <script type="text/html">
                        <a class="btn btn-success btn-xs"
                           href="{:url('edit?id=')}{{item.id}}"
                           data-toggle="busy-modal"
                           data-ok="修改配置"
                           data-form-on-success="@table.reload"><i class="fa fa-pencil"></i></a>

                        {{if !item.system}}
                        <a class="btn btn-danger btn-xs"
                           href="{:url('delete?id=')}{{item.id}}"
                           data-toggle="busy-request"
                           data-confirm="确认要删除该配置吗？"
                           data-on-success="@table.reload"><i class="fa fa-trash"></i></a>
                        {{/if}}
                    </script>
                </th>
            </tr>
        </thead>
    </table>

    <div class="hide">
        <div id="tableToolbar">
            <a class="btn btn-success"
               data-toggle="busy-modal"
               data-url="{:url('add')}"
               data-ok="添加配置"
               data-form-on-success="@table.reload">
                <i class="fa fa-plus"></i>
                添加
            </a>
            <a class="btn btn-danger"
               data-url="{:url('delete')}"
               data-confirm="确认要删除选中的%s个配置吗？"
               data-checked="true"
               data-disabled="true"
               data-method="post"
               data-on-success="@table.reload">
                <i class="fa fa-trash"></i>
                删除
            </a>
        </div>
    </div>
</block>
<block name="foot">
    <script>
        busyAdmin.data.checkboxState = function (value, item, index) {
            if (item.system) {
                return {disabled : true}
            }

            return value;
        };
    </script>
</block>