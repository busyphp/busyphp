<extend name="@admin:layout"/>
<block name="head"></block>
<block name="content">
    <div data-toggle="busy-table"
         data-height="true"
         data-show-columns="true"
         data-show-refresh="true"
         data-show-print="true"
         data-export-filename="{$system.page_title}-%s"
         data-state="__ROUTE__"
         data-tree-show-field="name"
         data-tree-state="true"
         data-parent-field="{$parent_field}"
         data-parent-root="{$parent_root}"
         data-id-field="{$id_field}"
         data-pagination="false"
         data-toolbar="@"
         data-url="__URL__"
         data-bordered="true"
         data-route="true">

        <!--toolbar-->
        <template data-template="toolbar">
            <a class="btn btn-success"
               data-toggle="busy-modal"
               data-size="lg"
               data-ok="添加菜单"
               data-url="{:url('add')}"
               data-form-on-success="@table.reload|@app.loadInfo|@modal.close">
                <i class="fa fa-plus"></i>
                添加
            </a>

            <a class="btn btn-danger"
               data-url="{:url('delete')}"
               data-confirm="确认要删除选中的%s个菜单吗？"
               data-checked="true"
               data-disabled="true"
               data-method="post"
               data-on-success="@table.reload">
                <i class="fa fa-trash"></i>
                删除
            </a>

            <a class="btn btn-default"
               data-url="{:url('sort')}"
               data-field="id,sort"
               data-method="post"
               data-on-success="@table.reload|@app.loadInfo"
               data-confirm="确认要排序吗？">
                <i class="fa fa-sort"></i>
                排序
            </a>
        </template>

        <!--table-->
        <table class="table table-striped table-bordered table-hover">
            <thead class="thead-light">
                <tr>
                    <th data-checkbox="true"
                        data-print-ignore="true"
                        data-tableexport-display="false"
                        data-formatter="busyAdmin.data.checkboxState"></th>

                    <th width="80"
                        data-align="center"
                        data-field="sort"
                        data-title="排序"
                        data-tableexport-selector="input"
                        data-formatter="@">
                        <script type="text/html">
                            <ba-if value="is_print || item.annotation">
                                {{value}}
                                <ba-else/>
                                <input type="text" class="form-control input-xs text-center" data-bind="" value="{{value}}"/>
                            </ba-if>
                        </script>
                    </th>

                    <th width="60"
                        data-align="center"
                        data-field="id"
                        data-show-overflow="true"
                        data-formatter="@"
                        data-fixed="true"
                        data-title="ID">
                        <script type="text/html">
                            <ba-if value="item.annotation">
                                -
                                <ba-else/>
                                {{value}}
                            </ba-if>
                        </script>
                    </th>

                    <th width="50"
                        data-align="center"
                        data-field="icon"
                        data-print-ignore="true"
                        data-tableexport-display="false"
                        data-title="图标"
                        data-formatter="@">
                        <script type="text/html">
                            <i class="{{value || 'icon-placeholder'}}"></i>
                        </script>
                    </th>

                    <th data-align="left"
                        data-halign="center"
                        data-field="name"
                        data-title="菜单名称"
                        data-formatter="@"
                        data-min-width="300">
                        <script type="text/html">
                            {{value}}
                        </script>
                    </th>

                    <th data-align="center"
                        data-field="path"
                        data-title="菜单路径"
                        data-formatter="@"
                        data-width="150"
                        data-tableexport-selector="input">
                        <script type="text/html">
                            <ba-if value="is_print">
                                {{value}}
                                <ba-else/>
                                <div class="input-group input-group-xs">
                                    <input type="text" readonly class="form-control min-width-100" value="{{value}}"/>
                                    <div class="input-group-btn">
                                        <a class="btn btn-secondary" data-toggle="busy-copy" data-content="{{value}}"><i class="fa fa-copy"></i></a>
                                    </div>
                                </div>
                            </ba-if>
                        </script>
                    </th>

                    <th width="100"
                        data-align="center"
                        data-field="disabled"
                        data-title="状态"
                        data-formatter="@">
                        <script type="text/html">
                            <ba-if value="!item.operate_disable || is_print">
                                <ba-if value="value">
                                    <b class="text-danger">禁用</b>
                                    <ba-else/>
                                    <b class="text-success">正常</b>
                                </ba-if>
                                <ba-else/>
                                <input class="switch input-xs success"
                                       type="checkbox"
                                       data-url="{:url('set_attr')}"
                                       data-on-success="false"
                                       data-params='{"id":"{{item.id}}","type":"disabled"}'
                                       data-toggle="busy-checkbox"
                                       title="启用,禁用"
                                       {{value ?'':'checked'}} />
                            </ba-if>
                        </script>
                    </th>

                    <th width="100"
                        data-align="center"
                        data-field="hide"
                        data-title="节点类型"
                        data-formatter="@">
                        <script type="text/html">
                            <ba-if value="item.system">
                                <ba-if value="value">
                                    <span class="badge badge-success badge-pill">&nbsp;权限&nbsp;</span>
                                    <ba-else/>
                                    <span class="badge badge-primary badge-pill">&nbsp;菜单&nbsp;</span>
                                </ba-if>
                                <ba-else/>
                                <ba-if value="is_print">
                                    {{value ?'权限':'菜单'}}
                                    <ba-else/>
                                    <input class="switch input-xs primary"
                                           type="checkbox"
                                           data-url="{:url('set_attr')}"
                                           data-on-success="false"
                                           data-params='{"id":"{{item.id}}","type":"hide"}'
                                           data-toggle="busy-checkbox"
                                           title="菜单,权限"
                                           {{value ?'':'checked'}} />
                                </ba-if>
                            </ba-if>
                        </script>
                    </th>

                    <th width="100"
                        data-align="center"
                        data-title="操作"
                        data-print-ignore="true"
                        data-tableexport-display="false"
                        data-fixed-right="true"
                        data-formatter="@">
                        <script type="text/html">
                            <ba-if value="item.annotation">
                                
                                <a class="btn btn-default btn-xs {{item.hide ? 'disabled':''}}"
                                   data-url="{:url('add?hash=')}{{item.hash}}"
                                   data-toggle="busy-modal"
                                   data-size="lg"
                                   data-ok="添加菜单"
                                   data-form-on-success="@table.reload|@app.loadInfo|@modal.close"
                                   {{item.hide ? 'disabled':''}} > <i class="fa fa-plus"></i> </a>

                                <a class="btn btn-success btn-xs"
                                   data-url="{:url('edit?hash=')}{{item.hash}}"
                                   data-toggle="busy-modal"
                                   data-size="lg"
                                   data-ok="修改菜单"
                                   data-form-on-success="@table.reload|@app.loadInfo|@modal.close">
                                    <i class="fa fa-pencil"></i>
                                </a>
                                
                                <ba-else/>
                                
                                <a class="btn btn-default btn-xs {{item.hide ? 'disabled':''}}"
                                   data-url="{:url('add?id=')}{{item.id}}"
                                   data-toggle="busy-modal"
                                   data-size="lg"
                                   data-ok="添加菜单"
                                   data-form-on-success="@table.reload|@app.loadInfo|@modal.close"
                                   {{item.hide ? 'disabled':''}} > <i class="fa fa-plus"></i> </a>

                                <a class="btn btn-success btn-xs"
                                   data-url="{:url('edit?id=')}{{item.id}}"
                                   data-toggle="busy-modal"
                                   data-size="lg"
                                   data-ok="修改菜单"
                                   data-form-on-success="@table.reload|@app.loadInfo|@modal.close">
                                    <i class="fa fa-pencil"></i>
                                </a>
                                
                            </ba-if>

                            <a class="btn btn-danger btn-xs {{item.annotation ? 'disabled':''}}"
                               data-url="{:url('delete?id=')}{{item.id}}"
                               data-toggle="busy-request"
                               data-confirm="确认要删除该菜单吗？"
                               data-on-success="@table.reload|@app.loadInfo"
                               {{item.annotation ? 'disabled':''}} ><i class="fa fa-trash"></i></a>
                        </script>
                    </th>
                </tr>
            </thead>
        </table>
    </div>
</block>
<block name="foot">
    <script>
        busyAdmin.data.checkboxState = function (value, item, index) {
            if (item.annotation) {
                return {disabled : true}
            }

            return value;
        };
    </script>
</block>