<extend name="@admin:layout"/>
<block name="content">
    <?php
    
    use BusyPHP\app\admin\model\system\menu\SystemMenu;
    
    ?>
    <div class="form-horizontal">
        <input type="hidden" name="id" value="{$info.id|default=''}"/>
        <div class="form-group">
            <label class="col-sm-2 control-label">上级菜单</label>
            <div class="col-sm-9">
                <select class="form-control font-tabs" name="parent_path">
                    <option value="">顶级菜单</option>
                    {$parent_options}
                </select>
                <span class="help-block">选择上级菜单或顶级菜单</span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label required">菜单名称</label>
            <div class="col-sm-9">
                <div class="input-group">
                    <input class="form-control" name="name" value="{$info.name|default=''}" placeholder="请输入菜单名称" required/>
                    <div class="input-group-addon no-border-left">
                        <i class="{$info.icon|default='icon-placeholder'}" id="menuIconShow"></i>
                    </div>
                    <div class="input-group-btn">
                        <input type="hidden" name="icon" id="menuIconInput" value="{$info.icon|default=''}"/>
                        <a class="btn btn-secondary" data-toggle="busy-icon-picker" data-target="#menuIconInput,#menuIconShow">选择图标</a>
                    </div>
                </div>
                <span class="help-block">设置菜单名称，如：<code>文章列表</code>。对于未隐藏的菜单建议一定要选择一个图标</span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label required">菜单链接</label>
            <div class="col-sm-9">
                <input class="form-control" name="path" placeholder="请输入菜单链接" required data-toggle="busy-autocomplete" data-model="<?=SystemMenu::getClass();?>" data-text-field="path" value="{$info.path|default=''}"/>
                <span class="help-block">设置菜单链接，如：<code>user/index</code>，外部链接必须填写<code>https://</code>或<code>http://</code>前缀</span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">附加参数</label>
            <div class="col-sm-9">
                <input class="form-control" name="params" placeholder="请输入附加参数" value="{$info.params|default=''}"/>
                <span class="help-block">设置菜单链接附加参数名，系统将通过<code>$_GET</code>方法在关键功能位置进行补齐。如：<code>id,user_id</code></span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">打开方式</label>
            <div class="col-sm-9">
                <div class="radio">
                    <foreach name="target_list" key="vo" item="name">
                        <input type="radio" name="target" value="{$vo}" <?=is_checked($info['target'] == $vo)?> data-toggle="busy-radio" title="{$name}"/>
                    </foreach>
                </div>
                <span class="help-block">设置点击菜单时的页面打开方式</span>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">其它设置</label>
            <div class="col-sm-9">
                <div class="radio no-padding">
                    <input type="checkbox" class="switch" name="hide" value="1" <?=is_checked(!$info['hide'])?> data-toggle="busy-checkbox" title="显示,隐藏"/>
                    <input type="checkbox" class="switch success" name="disabled" value="1" <?=is_checked(!$info['disabled'])?> data-toggle="busy-checkbox" title="启用,禁用"/>
                </div>
                <span class="help-block"><code>隐藏</code>的菜单不在菜单栏显示，但会做为权限节点调用。<br/><code>禁用</code>后菜单将无法正常使用。</span>
            </div>
        </div>
        <eq name="url.action" value="add">
            <div class="form-group no-margin-bottom" id="autoBox">
                <label class="col-sm-2 control-label">自动创建</label>
                <div class="col-sm-9">
                    <div class="checkbox-group">
                        <input type="checkbox" class="pill" name="auto[]" value="add" data-toggle="busy-checkbox" title="添加"/>
                        <input type="checkbox" class="pill" name="auto[]" value="edit" data-toggle="busy-checkbox" title="修改"/>
                        <input type="checkbox" class="pill" name="auto[]" value="delete" data-toggle="busy-checkbox" title="删除"/>
                        <input type="checkbox" class="pill" name="auto[]" value="detail" data-toggle="busy-checkbox" title="查看"/>
                        <input type="checkbox" class="pill" name="auto[]" value="sort" data-toggle="busy-checkbox" title="排序"/>
                        <input type="checkbox" class="pill" name="auto[]" value="export" data-toggle="busy-checkbox" title="导出"/>
                        <input type="checkbox" class="pill" name="auto[]" value="import" data-toggle="busy-checkbox" title="导入"/>
                    </div>
                    <span class="help-block">勾选自动创建的菜单，将为本次新增的菜单创建子菜单</span>
                </div>
            </div>
            <div class="form-group no-margin-bottom hide">
                <label class="col-sm-2 control-label">名称后缀</label>
                <div class="col-sm-9">
                    <input class="form-control" name="auto_suffix" placeholder="请输入名称后缀"/>
                    <span class="help-block">设置自动创建菜单的名称后缀，如：<code>文章</code>，自动创建后将生成<code>添加文章</code>、<code>修改文章</code></span>
                </div>
            </div>
        </eq>
        <div class="form-group no-margin-bottom" id="topPath">
            <label class="col-sm-2 control-label">访问链接</label>
            <div class="col-sm-9">
                <input class="form-control" name="top_path" placeholder="请输入访问链接" data-toggle="busy-autocomplete" data-model="<?=SystemMenu::getClass();?>" data-text-field="path" value="{$info.top_path|default=''}"/>
                <span class="help-block">设置顶级菜单访问链接，设置后点击顶级菜单将默认访问到该链接中</span>
            </div>
        </div>
    </div>
</block>
<block name="foot">
    <script>
        busyAdmin.ready(function () {
            var $parentPath    = $('[name="parent_path"]');
            var $autoBox       = $('#autoBox');
            var $autoSuffixBox = $('[name="auto_suffix"]').closest('.form-group');
            var $autoCheckbox  = $('[name*=auto]').not('[name="auto_suffix"]');
            var $topPath       = $('#topPath');
            $autoCheckbox.on('change', function () {
                var checked = false;
                $autoCheckbox.each(function () {
                    if ($(this).prop('checked')) {
                        checked = true;
                    }
                });

                $autoBox.toggleClass('no-margin-bottom', !checked);
                $autoSuffixBox.toggleClass('hide', !checked);
                $(window).trigger('resize');
            });

            $parentPath.on('change', function () {
                if (!$(this).val()) {
                    $autoBox.hide();
                    $topPath.show();
                } else {
                    $autoBox.show();
                    $topPath.hide();
                }
            }).trigger('change');
        });
    </script>
</block>