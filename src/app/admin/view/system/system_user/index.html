<extend name="@admin:layout"/>
<block name="content">
    <div id="searchBar"
         data-toggle="busy-search-bar"
         data-url="{$url.self}"
         data-accurate-show="true"
         data-fields="username:用户名,email:邮箱,phone:手机号,qq:QQ号码,id:用户ID">
        <script type="text/html" data-search-id="left">
            <div class="form-group">
                <div class="input-group">
                    <div class="input-group-addon">状态</div>
                    <select class="form-control" name="status">
                        <option value="0">不限</option>
                        <option value="1">正常</option>
                        <option value="2">禁用</option>
                        <option value="3">临时禁用</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <div class="input-group">
                    <div class="input-group-addon">角色</div>
                    <select class="form-control" name="group_id">
                        <option value="0">不限</option>
                        {$group_options}
                    </select>
                </div>
            </div>
        </script>
    </div>


    <table class="table table-bordered table-striped table-hover"
           data-toggle="busy-table"
           data-state="{$url.controller}{$url.action}"
           data-search="#searchBar"
           data-show-columns="true"
           data-show-print="true"
           data-show-refresh="true"
           data-show-export="true"
           data-show-fullscreen="true"
           data-toolbar="#tableToolbar"
           data-route="true"
           data-url="{$url.self}"
           data-click-to-select="true"
           data-fixed-columns="true"
           data-fixed-right-number="1"
           data-fixed-number="2"
           data-height="true">
        <thead>
            <tr>
                <th class="text-center" width="40" data-checkbox="true" data-formatter="busyAdmin.data.checkboxState"></th>
                <th class="text-center" width="60" data-field="id" data-searchable="false">ID</th>
                <th class="text-center" data-field="username" data-halign="center" data-align="left" data-formatter="@">账号</th>
                <th class="text-center" width="120" data-field="phone" data-align="center">手机号</th>
                <th class="text-center" width="120" data-field="email" data-align="center">邮箱</th>
                <th class="text-center" width="120" data-field="group_names" data-align="center">所属角色</th>
                <th class="text-center" width="80" data-field="checked" data-align="center" data-formatter="@">状态</th>
                <th class="text-center" width="150" data-field="format_create_time" data-align="center" data-sortable="true">创建时间</th>
                <th class="text-center" width="150" data-field="format_last_time" data-align="center" data-sortable="true">最后登录时间</th>
                <th class="text-center" width="60" data-field="operate" data-formatter="@" data-click-to-select="false">
                    操作
                </th>
            </tr>
        </thead>
    </table>


    <div class="hide">
        <div id="tableToolbar">
            <ba:access value="add">
                 <a class="btn btn-success"
                    data-toggle="busy-modal"
                    data-url="{:url('add')}"
                    data-ok="添加管理员"
                    data-form-on-success="@table.reload">
                    <i class="fa fa-plus"></i>
                    添加
                </a>
            </ba:access>

            <ba:access value="delete">
                <a class="btn btn-danger"
                   data-url="{:url('delete')}"
                   data-confirm="确认要删除选中的%s个管理员吗？"
                   data-checked="true"
                   data-disabled="true"
                   data-method="post"
                   data-on-success="@table.reload">
                    <i class="fa fa-trash"></i>
                    删除
                </a>
            </ba:access>
        </div>
    </div>


    <script type="text/html" id="username">
        <a href="#" data-user-id="{{item.id}}" data-title="管理员资料" data-toggle="busy-admin-detail">{{value}}</a>
        
        {{if item.system}}
        <kbd>系统管理员</kbd>
        {{/if}}
        {{if item.is_temp_lock}}
        <div class="text-danger size-12">已临时锁定至{{item.format_error_release}}后自动解锁 <a class="badge badge-success" data-url="{:url('unlock?id=')}{{item.id}}" data-toggle="busy-request" data-confirm="确认要解锁该账户的临时锁定状态吗？" data-on-success="@table.reload">现在解锁</a></div>
        {{/if}}
    </script>

    <script type="text/html" id="checked">
        <div class="min-width-70">
            <input type="checkbox" class="switch input-xs primary" data-toggle="busy-checkbox" data-url="{:url('change_checked?id=')}{{item.id}}" title="正常,禁用" {{value ? 'checked': ''}}/>
        </div>
    </script>

    <script type="text/html" id="operate">
        <ba:access value="edit">
            <a class="btn btn-success btn-xs"
               href="{:url('edit?id=')}{{item.id}}"
               data-toggle="busy-modal"
               data-ok="修改管理员"
               data-form-on-success="@table.reload"><i class="fa fa-pencil"></i></a>
        </ba:access>
        <ba:access value="delete">
        {{if !item.system}}
        <a class="btn btn-danger btn-xs"
           href="{:url('delete?id=')}{{item.id}}"
           data-toggle="busy-request"
           data-confirm="确认要删除该管理员吗？"
           data-on-success="@table.reload"><i class="fa fa-trash"></i></a>
        {{/if}}
        </ba:access>
    </script>
</block>
<block name="foot">
    <script>
        busyAdmin.data.checkboxState = function (value, item, index) {
            if (item.system) {
                return {disabled : true}
            }

            return value;
        };
    </script>
</block>