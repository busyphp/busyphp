"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(e){function l(e){return e.checkedClass=e.checkedClass||"btn-primary",e.defaultClass=e.defaultClass||"btn-default",e}var c,d=!1;function t(){var e=this;e.lib={},e.e={},e.plugins={},e.linkClickIgnore=[],e.formSubmitIgnore=[],e.autoInitList=[],e.helper=null,e.app=null,e.route=null,e.request=null,e.response=null,e.dialog=null,e.require=requirejs,e.requireQueue=function(e,r){!function t(a,n){var e,i;a.length?("object"===(void 0===(e=a.shift())?"undefined":_typeof(e))&&(i=e.exports,e=e.module),require([e],function(e){i&&("function"==typeof i?i(e):window[i]=e),n.push(e),t(a,n)})):r.apply(null,n)}(e,[])},e.define=define,e.locale={},e.config={root:"/",moduleRoot:"/",version:"1.0.0",configs:{}},e.data={},e.sugars={},e.requireShims={},e.requirePaths={},e.defaultZIndex=1e4}t.prototype={autoInit:function(e,t,a){this.autoInitList.push({name:e,selector:t,callback:a})},regSugar:function(e,t){this.sugars[e]=t},dispatchSugar:function(r,e,o,s,l){if("string"==typeof e&&e){var c=this,d="",u=/\((.*?)\)/gm;return e.split("|@").map(function(e){var t,a,n,i;(e=e.trim())&&(0===e.indexOf("@")&&(e=e.substring(1)),0!==e.indexOf(":")?((e.match(u)||[]).map(function(e){t=$.baStrToVar(e.slice(1).slice(0,-1))}),i=(e=e.replace(u,"")).indexOf("."),a=e,0<i&&(a=e.substring(0,i),n=e.substring(i+1)||void 0),i=c.sugars[a],a&&"function"==typeof i&&i.call(r,n,t,{api:o,args:s,event:l})):d=e.substring(1))}),d}},ee:function(e,t){return"ba:"+t+"-"+e.replace(/([A-Z])/g,"_$1").toLowerCase().replace(/_/g,"-").toLowerCase()},mod:function(e,t,a){return this.lib[e]=e,this.requirePaths[e]=t,a&&(this.requireShims[e]=a),this},init:function(e){var n=this;n.config=e||{},r=busyAdmin,e=r.moduleRoot(),r.root(),c.mod("jquery","jquery/jquery.min").mod("pace","pace/pace.min").mod("bootstrap","bootstrap/js/bootstrap.min").mod("layer","layer/layer.min",["css!"+e+"layer/theme/default/layer"]).mod("moment","moment/moment.min").mod("marked","marked/marked.min").mod("clipboard","clipboard/clipboard.min").mod("md5","md5/md5.min").mod("sticky","sticky/jquery.sticky.min").mod("jqueryUi","jquery-ui/jquery-ui.min").mod("ELEMENT","element-ui/index",["css!element-ui/index",c.config.debug?"vue/vue":"vue/vue.min"]).mod("toastr","toastr/toastr.min",["css!"+e+"toastr/toastr.min"]).mod("highlight","hijs/highlight.min",{deps:["css!hijs/css.min"],exports:"hljs"}).mod("colorPicker","bootstrap-colorpicker/js/bootstrap-colorpicker.min",["css!"+e+"bootstrap-colorpicker/css/bootstrap-colorpicker.min"]).mod("tree","tree/jstree.min",["css!"+e+"tree/themes/default/style.min"]).mod("uploadConfig",r.getConfig("upload",{}).configUrl).mod("webUploader","webuploader/webuploader.min",["css!"+e+"webuploader/webuploader"]).mod("videojs","video-js/video.min",["css!video-js/video.min"]).mod("APlayer","aplayer/APlayer.min",["css!"+e+"aplayer/APlayer.min"]).mod("hls","hls/hls.min").mod("imageViewer","image-viewer/viewer.min",["css!image-viewer/viewer.min"]).mod("sortable","sortable/sortable.min").mod("dragtable","dragtable/jquery-dragtable.min",["css!"+e+"dragtable/dragtable.min","jqueryUi"]).mod("bootstrapTable","bootstrap-table/bootstrap-table.min",["css!bootstrap-table/bootstrap-table.min"]).mod("bootstrapTableReorderColumns","bootstrap-table/reorder-columns/bootstrap-table-reorder-columns.min",["dragtable"]).mod("bootstrapTableReorderRows","bootstrap-table/reorder-rows/bootstrap-table-reorder-rows.min",["css!bootstrap-table/reorder-rows/bootstrap-table-reorder-rows.min","bootstrap-table/reorder-rows/jquery.tablednd.min"]).mod("bootstrapTableStickyHeader","bootstrap-table/sticky-header/bootstrap-table-sticky-header.min",["css!bootstrap-table/sticky-header/bootstrap-table-sticky-header.min"]).mod("bootstrapTablePrint","bootstrap-table/print/bootstrap-table-print.min").mod("bootstrapTableFixedColumns","bootstrap-table/fixed-columns/bootstrap-table-fixed-columns.min",["css!bootstrap-table/fixed-columns/bootstrap-table-fixed-columns.min"]).mod("bootstrapTableFilterControl","bootstrap-table/filter-control/bootstrap-table-filter-control.min",["css!bootstrap-table/filter-control/bootstrap-table-filter-control.min"]).mod("bootstrapTableExport","bootstrap-table/export/bootstrap-table-export.min",["bootstrap-table/export/tableExport.min"]).mod("xlsx","xlsx/xlsx.min").mod("ueditor","ueditor/ueditor.all.min",[r.getConfig("editor",{}).ueConfigUrl]).mod("zeroClipboard","ueditor/third-party/zeroclipboard/ZeroClipboard.min").mod("ckEditor5Classic","ckeditor/ckeditor5-build-classic/ckeditor").mod("select2","select2/select2.min",["css!"+e+"select2/select2.min","css!"+e+"select2/select2-ba.min"]).mod("pinyin","pinyin/js").mod("autocomplete","autocomplete/auto-complete.min",["css!"+e+"autocomplete/auto-complete.min"]).mod("artTemplate","art-template/template-web").mod("treeTable","tree-table/jquery.treetable.min").mod("validate","validate/jquery.validate.min").mod("socketio","socketio/socket.io.min").mod("gwm","gwm/gwm").mod("sparkMd5","spark-md5/spark-md5.min").mod("cryptoJs","crypto-js/crypto-js.min").mod("fxParser","fxparser/fxparser.min").mod("echarts","echarts/echarts.min").mod("echartsGl","echarts-gl/echarts-gl.min").mod("ionRangeSlider","ion-range-slider/ion.rangeSlider.min",["css!ion-range-slider/ion.rangeSlider.min"]).mod("bootstrapStarRatingCore","bootstrap-star-rating/js/star-rating.min",["css!bootstrap-star-rating/css/star-rating.min"]).mod("bootstrapStarRating","bootstrap-star-rating/themes/krajee-svg/theme.min",["bootstrapStarRatingCore","css!bootstrap-star-rating/themes/krajee-svg/theme.min"]).mod("fullcalendar","fullcalendar/locales-all.min",[e+"fullcalendar/main.min.js","css!"+e+"fullcalendar/main.min"]).mod("print","print/print.min",["css!"+e+"print/print.min"]).mod("html2canvas","html2canvas/html2canvas.min").mod("jspdf","pdf/jspdf.umd.min").mod("json","require/json.min").mod("depend","require/depend.min").mod("font","require/font.min").mod("goog","require/goog.min").mod("i18n","require/i18n.min").mod("image","require/image.min").mod("mdown","require/mdown.min").mod("noext","require/noext.min").mod("propertyParser","require/propertyParser.min").mod("text","require/text.min"),requirejs.config({baseUrl:e,urlArgs:"v="+r.config.version,waitSeconds:0,map:{"*":{css:"require/css"}},paths:c.requirePaths,shim:c.requireShims});for(var t=["modal","audio","audioViewer","autocomplete","catalog","changeVerify","checkboxRadio","checkedAll","colorPicker","copy","datePicker","editor","filePicker","form","validate","high","iconPicker","imageViewer","markdown","request","searchBar","selectPicker","shuttle","table","tree","upload","video","videoViewer","dialog","random","linkagePicker","rangeSlider","rate","calendar","print","consoleLog","template","tabs","vue","elementUi","appNotice","appWatermark"],a=[],i=0;i<t.length;i++)a.push("./ba/plug/"+t[i]);var r=n.config.requires||[];"string"==typeof r&&r?a.push(r):r.forEach(function(e){a.push(e)});var o=["pace","jquery","bootstrap"];["helper","route","request","response"].forEach(function(e){o.push("./ba/app/"+e)});var s=[];return n.config.vue&&(s.push(n.lib.vue),n.config.elementUi&&s.push(n.lib.ELEMENT)),s.push("./ba/app"),n.requireQueue(o,function(){d||(d=!0,busyAdmin.helper.extends($.fn.button.Constructor.prototype,{toggle:function(){var e=!0,t=this.$element.closest('[data-toggle^="button"]'),a=l(t.data()),n=a.checkedClass,a=a.defaultClass;t.length?(t=this.$element.find("input")).prop("disabled")||("radio"==t.prop("type")?(t.prop("checked")&&(e=!1),this.$element.siblings().removeClass(n).addClass(a),this.$element.removeClass(a).addClass(n)):"checkbox"==t.prop("type")&&(t.prop("checked")!==this.$element.hasClass(n)&&(e=!1),this.$element.toggleClass(n),this.$element.hasClass(n)?this.$element.removeClass(a).addClass(n):this.$element.removeClass(n).addClass(a)),t.prop("checked",this.$element.hasClass(n)),e&&t.baTriggerEvent("change")):(this.$element.attr("aria-pressed",!this.$element.hasClass(n)),this.$element.toggleClass(n))}})),function(){c.lib.vue="vue",c.lib.elementUi=c.lib.ELEMENT;var a=c.helper,n={};["beforeCreate","created","beforeMount","mounted","beforeUpdate","updated","beforeDestroy","destroyed"].forEach(function(e){var t=c.ee(e,"vue");c.e[a.camel("vue_"+e)]=t,n[e]=function(){a.execCallback(this,null,this,[],$(document),$.Event(t,{vue:this,$vue:$(this.$el)}))}}),c.define(c.lib.vue,[c.config.debug?"vue/vue":"vue/vue.min"],function(e){return e.mixin(n),window.Vue=e,window._BaVue=e})}(),n.require(a,function(){n.requireQueue(s,function(e,t,a){n.config.elementUi&&(window._BaElementUI=t,window._BaVue.use(t)),n.app.start()})})}),this},root:function(){return this.config.root||"/"},moduleRoot:function(){return this.config.moduleRoot||"/"},skinRoot:function(){return this.config.skinRoot||"/"},cssRoot:function(){return this.config.cssRoot||"/"},jsRoot:function(){return this.config.jsRoot||"/"},imagesRoot:function(){return this.config.imagesRoot||"/"},getConfig:function(e,t){return this.config.configs[e]||t},ready:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]&&arguments[2],n={};"function"==typeof e?n.callback=e:("string"==typeof e&&(e=[e]),n.callback=t,n.modules=e||[],n.queue=a);function i(e){e.modules?e.queue?r.requireQueue(e.modules,e.callback):r.require(e.modules,e.callback):e.callback()}var r=this;if(r.readyed)i(n);else{if(r._readyCallbacks=r._readyCallbacks||[],r._readyCallbacks.push(n),void 0!==r._readyIntervalId)return this;r._readyIntervalId=setInterval(function(){if(r.app&&r.app.isInit){r.readyed=!0,clearInterval(r._readyIntervalId),delete r._readyIntervalId;for(var e=0;e<r._readyCallbacks.length;e++)i(r._readyCallbacks[e]);r._readyCallbacks=[]}},1)}return this},zIndex:function(e){return this.defaultZIndex+=e||1,this.defaultZIndex}},e.busyAdmin=c=new t,e.ba=c,define("busyAdmin",function(){return c}),busyAdmin.autoInit("bsToolTip",'[data-toggle="tooltip"],[busy-tooltip]',function(){this.tooltip()}),busyAdmin.autoInit("bsPopover",'[data-toggle="popover"],[busy-popover]',function(){this.popover()}),busyAdmin.autoInit("bsButton",'[data-toggle^="button"]',function(){this.find("input").filter(function(){var e=$(this),t=e.closest(".btn"),a=l(t.closest('[data-toggle^="button"]').data()),n=a.checkedClass,a=a.defaultClass;e.prop("disabled")&&t.addClass("disabled").prop("disabled",!0),e.prop("checked")?(t.removeClass(a).addClass(n),e.trigger({type:"click",target:this})):t.removeClass(n).addClass(a)})});var a="app",e="route";c.e={appReady:c.ee("ready",a),appBeforeDestroy:c.ee("before-destroy",a),appReadies:c.ee("readies",a),appReqBefore:c.ee("req-before",a),appReqComplete:c.ee("req-complete",a),appReqError:c.ee("req-error",a),appReqSuccess:c.ee("req-success",a),appRenderBefore:c.ee("render-before",a),appRenderSuccess:c.ee("render-success",a),appComplete:c.ee("complete",a),appPluginReady:c.ee("plugin-ready",a),appLoginSucceed:c.ee("login-succeed",a),appLoginOuted:c.ee("login-outed",a),appClearCache:c.ee("clear-cache",a),routeBeforeLeave:c.ee("before-leave",e),routePopState:c.ee("pop-state",e),routeNoDispatch:c.ee("no-dispatch",e)}}(window),define("./ba/app",["busyAdmin","jquery","bootstrap"],function(p,f){"use strict";var h=p.helper;function a(e,t){return e.find('[data-busy-id="'+t+'"]')}function m(e,t){return e.filter('[data-busy-id="'+t+'"]').add(e.find('[data-busy-id="'+t+'"]'))}function g(e,t){return e.filter(t).add(e.find(t))}function v(e){return f.parseHTML(e,document,true)}var n=function e(t){var a=this;a.$li=f('<li><a href="javascript:void(0)"><i class="'+t+'"></i><span class="badge badge-danger badge-pill hide">0</span></a></li>');a.$a=a.$li.find("a");a.$badge=a.$li.find(".badge")};n.prototype={toggle:function e(t){this.$li.toggleClass("active",t)},remove:function e(){this.$li.remove()},setBadge:function e(t){if(t>0)this.$badge.removeClass("hide").text(t>=100?"99+":t);else this.$badge.addClass("hide")},insertBefore:function e(t){this.$li.insertBefore(t)},insertAfter:function e(t){this.$li.insertAfter(t)}};var i=function e(t){var a=this;a.time=0;a.title=document.title;a.tip=t||"【您有新消息】";a.event="mouseover.noticefactionmsg"};i.prototype={show:function e(){var t=this;var a=t.title.replace(t.tip,"");if(!t.showing){t.showing=true;f(window).on(t.event,function(){t.clear()})}clearTimeout(t.timer);t.timer=setTimeout(function(){t.time++;t.show();if(t.time%2==0)document.title=t.tip+a;else document.title=t.title},300)},clear:function e(){var t=this;t.showing=false;clearTimeout(t.timer);document.title=t.title;f(window).off(t.event)}};var r=null,o=function e(t){if(!r)r=new Audio;this.src=t};o.prototype={play:function e(){var t=this;if(!t.src)return;try{r.pause();r.currentTime=0;r.src=t.src;r.play()}catch(e){}},stop:function e(){try{r.pause()}catch(e){}}};var s=0,l=function e(t){this.options=t;this.id=s++};l.prototype={connect:function e(){var a=this;if(a.connected)return;try{var t=a.options.url;var n=h.parseURL(document.URL).protocol.toLowerCase()==="https";t=t.substring(t.indexOf("://")+3,t.length);a.ws=new WebSocket((n?"wss://":"ws://")+t);a.ws.onopen=function(e){a.connected=true;a.closed=false;a.trigger("connected",e);clearInterval(a.pingTimer);if(a.options.pingInterval>0)a.pingTimer=setInterval(function(){if(a.options.pingData)a.send(a.options.pingData,true);else a.sendEvent("ping")},a.options.pingInterval)};a.ws.onmessage=function(e){a.trigger("message",e);try{var t=JSON.parse(e.data)||{};a.trigger("message-"+t.event,t.data)}catch(e){}};a.ws.onclose=function(e){a.trigger("close",e);a.connected=false;a.reconnect()};a.ws.onerror=function(e){a.trigger("error",e);a.connected=false;a.reconnect()}}catch(e){console.warn(e);a.trigger("fail",e)}},trigger:function e(t,a){f(document).trigger(t+".ba-ws-"+this.id,a)},on:function e(t,n,a){var i=this;var r=f(document);var o=t+".ba-ws-"+i.id;var s=function e(t,a){typeof n==="function"&&n.call(i,a)};if(a)r.one(o,s);else r.on(o,s)},off:function e(t){f(document).off((t||"")+".ba-ws-"+this.id)},once:function e(t,a){this.on(t,a,true)},onMessage:function e(t,a,n){this.on("message-"+t,a,n)},offMessage:function e(t){this.off("message-"+t)},onceMessage:function e(t,a){this.onMessage(t,a,true)},send:function e(t,a){if(this.ws)this.ws.send(a?t:JSON.stringify(t))},sendEvent:function e(t,a){this.send({event:t,data:f.baIsEmpty(a)?{}:a})},reconnect:function e(){var t=this;clearTimeout(t.reconnectTimer);t.reconnectTimer=setTimeout(function(){if(t.closed)return;t.connect()},t.options.reconnectDelay||3e3)},close:function e(){var t=this;t.connected=false;t.closed=true;if(t.ws){t.ws.close();t.ws=null}clearTimeout(t.reconnectTimer);clearTimeout(t.pingTimer)}};var c=function e(){var t=this;t.$doc=f(document);t.$win=f(window);t.inIframe=window.self!=window.top};c.prototype={start:function e(){var t=this;t.options=f.extend({},c.DEFAULTS,p.getConfig("app")||{});t._initResponse();t._initSinglePage();t.$doc.ready(f.proxy(t.init,t))},init:function e(){var n=this;if(n.isInit)return;n.isInit=true;n._wsClient=new l({url:n.options.wsUrl,pingInterval:n.options.wsPingInterval,pingData:n.options.wsPingData,reconnectDelay:n.options.wsReconnectDelay});if(n.options.wsEnable)setTimeout(function(){n._wsClient.connect()});n.$head=f(document.head);n.$body=f(document.body);n.$app=a(n.$body,"app");n._initApp();h.onDomChange(document.body,function(){p.autoInitList.map(function(e){var t="ba-"+e.name+"AutoInitialized";var a=f(e.selector).filter(function(){var e=f(this);if(e.data(t))return false;e.data(t,true);return true});if(a.length)e.callback.call(a)})},true);document.addEventListener("error",function(e){if(e.target.tagName==="IMG"){var t=f(e.target);var a=t.data();if(a.baImagePlaceholderInitialized)return;t.data("baImagePlaceholderInitialized",true);if(a.placeholder)e.target.src=a.placeholder;else if(a.avatar)e.target.src=n.options.avatarPlaceholder;else e.target.src=n.options.imagePlaceholder}},true);window.addEventListener("beforeunload",function(e){n.trigger(p.e.appBeforeDestroy,[false,e])},false);n._vueMaps={};n.$doc.on(p.e.vueMounted,function(e){n._vueMaps[e.vue._uid]=e.vue});Pace.on("start",function(){if(!n.isFrame)return;clearTimeout(n._paceStartTimer);n._paceStartTimer=setTimeout(function(){n.$barRefreshIcon.addClass("ba-anim-rotate")})});Pace.on("done",function(){if(!n.isFrame)return;clearTimeout(n._paceStopTimer);n._paceStopTimer=setTimeout(function(){n.$barRefreshIcon.removeClass("ba-anim-rotate")})});n.$win.on("resize",function(){clearTimeout(n._resizeTimer);n._resizeTimer=setTimeout(function(){n._computeMenu()},50)})},closeSideNav:function e(){var t=this;if(!t.isMobileSize())return;t.$frame.removeClass("ba-nav-open");t._changeBarControlIcon(true);t.triggerResize()},openSideNav:function e(){var t=this;if(!t.isMobileSize())return;t.$frame.addClass("ba-nav-open");t._changeBarControlIcon(false);t.scrollToNav();t.triggerResize()},setToMiniNav:function e(t){var a=this;if(a.isMobileSize()||a.isMiniNav())return;a.$app.addClass("ba-mini-nav");a.$left.removeClass("ba-left-open");a._changeBarControlIcon(true);a.triggerResize();a.$left.baOnTransEnd(true,function(){a.triggerResize()});clearTimeout(a._onceMiniNavTimer);a._onceMiniNavTimer=setTimeout(function(){a._onceMiniNav=t},1e3)},setToDefaultNav:function e(){var t=this;if(t.isMobileSize()||!t.isMiniNav())return;t.$app.removeClass("ba-mini-nav");t.$left.removeClass("ba-left-open");t._changeBarControlIcon(false);t.scrollToNav();t.triggerResize();t.$left.baOnTransEnd(true,function(){t.triggerResize()})},triggerResize:function e(){this.$win&&this.$win.trigger("resize")},_changeBarControlIcon:function e(t){var a=this;if(t)a.$barControlIcon.removeClass("bicon-menu-close").addClass("bicon-menu-open");else a.$barControlIcon.removeClass("bicon-menu-open").addClass("bicon-menu-close")},isMobileSize:function e(){return this.$win&&this.$win.width()<=767},_saveNavState:function e(t,a){var n=this;if(n.options.navSingleHold)return;var i=n._getNavState();i[t]=a;localStorage.setItem(this.cacheKey("app.nav"),JSON.stringify(i))},_getNavState:function e(){return JSON.parse(localStorage.getItem(this.cacheKey("app.nav"))||"{}")},_saveScrollState:function e(t){var a=JSON.parse(sessionStorage.getItem("ba.app.scroll")||"{}")||{};var n=Object.keys(a);while(n.length>this.options.scrollCacheLength)delete a[n.shift()];a[document.URL]=t;sessionStorage.setItem(this.cacheKey("app.scroll"),JSON.stringify(a))},_getScrollState:function e(){var t=JSON.parse(sessionStorage.getItem(this.cacheKey("app.scroll"))||"{}")||{};return t[document.URL]||0},_initSinglePage:function e(){var l=this;l.$doc.on(p.e.appBeforeDestroy,function(){l._saveScrollState(l.$win.scrollTop())}).on(p.e.routeBeforeLeave,function(){if(l._byClick){l._saveScrollState(l.$win.scrollTop());f("body,html").animate({scrollTop:0})}}).on(p.e.appComplete,function(e){if(l._byClick){l._byClick=false;return}var t=l._getScrollState();var a=window.location.hash;if(a){var n=decodeURIComponent(a.slice(1));var i=document.getElementById(n)||document.getElementsByName(n)[0];if(i)t=f(i).offset().top}if(typeof t=="number"&&t>0)l.$win.scrollTop(t)}).on(p.e.appRenderBefore,function(e){var t=[];for(var a in l._vueMaps){var n=l._vueMaps[a];if(n._isBeingDestroyed||n._isDestroyed){t.push(a);return}n.$destroy();t.push(a)}t.forEach(function(e){delete l._vueMaps[e]})}).on("submit","form:not([data-toggle])",function(e){var t=f(this);var a=(t.attr("method")||"").trim().toLowerCase();var n=(t.attr("action")||"").trim();if(a==="post")return true;var i=p.formSubmitIgnore||[];for(var r=0;r<i.length;r++){var o=i[r];if(typeof o==="function"&&o.call(this,e))return}if(!n)n=document.URL;p.route.show(h.parseURL(n).path+"?"+t.serialize());return false}).on("click","a:not([data-toggle])",function(e){var t=p.linkClickIgnore||[];var a=f(this);var n=a.data();if(e.isDefaultPrevented())return;for(var i=0;i<t.length;i++){var r=t[i];if(typeof r==="function"&&r.call(this,e))return}var o=a.attr("href")||"";if(!o||o==="#"||0===o.toLowerCase().indexOf("javascript:"))return;var s=p.route.clickHandler(e,false);if(s!==false){l._byClick=true;p.route.show(s);return false}});p.route.base(p.root());p.route("*",function(o,i){if(l._singleTask){l._singleTask.abort();l._singleTask=null}if(o.init)return;l.closeSideNav();if(o.hash&&0===o.hash.indexOf("frames!")){l.setNavActive(o.hash.substr(7),"resumeFrames");return}l.$contentMask.addClass("active");l._singleTask=p.request(p.root()+h.ltrim(o.path,"/")).parse("html").cache(false).addHeader("Busy-Admin-Plugin","SinglePage").addHeader("X-Requested-With","HTML").pending(false).before(function(e,t){if(false===h.execCallback(l,null,document,[e,t],l.$doc,p.e.appReqBefore,true,false))return false}).complete(function(e,t,a){l._singleTask=null;l.$contentMask.removeClass("active");if(false===h.execCallback(l,null,document,[e,t,a],l.$doc,p.e.appReqComplete,true,false))return false}).error(function(e,t,a){if(false===h.execCallback(l,null,document,[e,t,a],l.$doc,p.e.appReqError,true,false))return false;var n=f('<div class="iframe-content"/>');var i=f('<iframe src="about:blank"/>');n.html(i);l._renderSinglePage({content:n},o.path);var r=i.contents()[0];r.open();r.write(a.responseText||e.message);r.close();document.title=r.title}).success(function(t,a,n){l.responseToHtml(t,function(e){i();if(false===h.execCallback(l,null,document,[t,a,n],l.$doc,p.e.appReqSuccess,true,false))return false;l._renderSinglePage(l.extractContainer(e,true),o.path)});return false}).exec()});p.route({click:false});l._oncePluginReadyEvent()},_oncePluginReadyEvent:function e(){var i=this;var r=p.e.appPluginReady+".busy.single";var o=[];i.$doc.off(r).on(r,function(e,t,a,n){o.push({element:t,name:a,target:n});clearTimeout(i._pluginReadyTimer);i._pluginReadyTimer=setTimeout(function(){i.$doc.off(r);i.trigger(p.e.appComplete,[o])},500)})},_renderSinglePage:function e(t,a){var n=this;var i=n.getPath(a);var r=[t,a,i];if(false===h.execCallback(n,null,document,r,n.$doc,p.e.appRenderBefore,true,false))return;var o=f.contains(n.$contentBody,document.activeElement);if(o)try{document.activeElement.blur()}catch(e){}n._oncePluginReadyEvent();p.data={};document.title=t.title||"";n.$contentIframes.removeClass("active");n.$contentBody.removeClass("hide");if(t.init){n.$app.html(t.init);n._initApp();if(n.isFrame)n.setNavActive(i,"renderPage")}else{if(!n.options.multiPage)n.$contentHeader.html(t.contentHeader||"");n.$contentSide.html(t.contentSide||"");n.initContentSide();n.$contentBody.html(t.content||"").append(t.trace||"");n.setNavActive(i,"renderPage")}var s=n.$contentBody.find("input[autofocus],textarea[autofocus]").last()[0];if(s&&document.activeElement!==s)s.focus();n.trigger(p.e.appRenderSuccess,r);h.triggerPluginReady(n.$doc,n)},initContentSide:function e(){var t=this;if(t.$contentSide.children().length>0)t.$content.addClass("ba--show-side");else t.$content.removeClass("ba--show-side")},getPath:function e(t){t=t||document.URL;if(-1===t.indexOf("://"))t="/"+h.ltrim(t,"/");var a=p.root();var n=h.parseURL(t);var i=0===n.pathNoSuffix.indexOf(a)?n.pathNoSuffix.substring(a.length):n.pathNoSuffix;return h.snake(h.ltrim(i,"/"))},setNavActive:function e(t,a){var n=this;if(n.isMiniNav()&&n._onceMiniNav)n.setToDefaultNav();n._onceMiniNav=false;var i=n.$nav.find('[data-path="'+t+'"]');if(i.length===0)i=n.$nav.find('[data-hide-path="'+t+'"]').parent();if(i.length>0){i.trigger(f.Event("click",{triggerFrom:a||"setNavActive"}));n.scrollToNav();return}else n.$nav.find(".active").removeClass("active");if(n.data)n.$headerMenu.find('[data-path="'+n.data.menu_default+'"]').trigger("click")},scrollToNav:function e(){var t=this;var a=t.$nav.find(".is-action.active");if(!a.length)return;var n=a.offset().top-t.$nav.offset().top+t.$nav.scrollTop();var i=(t.$nav.height()-a.height())/2;t.$nav.stop().animate({scrollTop:n-i})},_initApp:function e(){var d=this;d.currentPath=d.getPath(document.URL);d.$frame=a(d.$app,"frame");d.$loader=a(d.$app,"loader").data("show",true);d.$header=a(d.$app,"header");d.$headerLeft=a(d.$header,"header-left");d.$headerRight=a(d.$header,"header-right");d.$headerMenu=a(d.$headerRight,"menu");d.$headerBarLeft=a(d.$headerRight,"bar-left");d.$headerBarRight=a(d.$headerRight,"bar-right");d.$left=a(d.$app,"left");d.$nav=a(d.$app,"nav");d.$navChild=a(d.$app,"nav-child");d.$content=a(d.$app,"content");d.$contentHeader=a(d.$app,"content-header");d.$contentSide=a(d.$app,"content-side");d.$contentSideClose=a(d.$app,"content-side-close");d.$contentSideMask=a(d.$app,"content-side-mask");d.$contentBody=a(d.$app,"content-body");d.$contentIframes=a(d.$app,"content-iframes");d.$contentMask=a(d.$app,"content-mask");d.$barUsername=a(d.$headerRight,"bar-username");d.$barUserDropdowns=a(d.$headerRight,"bar-user-dropdowns");d.$barFullscreen=a(d.$headerRight,"bar-fullscreen");d.$barFullscreenWrap=d.$barFullscreen.parent("li");d.$barFullscreenIcon=d.$barFullscreen.find("i");d.$barRefresh=a(d.$headerRight,"bar-refresh");d.$barRefreshWrap=d.$barRefresh.parent("li");d.$barRefreshIcon=d.$barRefresh.find("i");d.$barControl=a(d.$headerRight,"bar-control");d.$barControlWrap=d.$barControl.parent("li");d.$barControlIcon=d.$barControl.find("i");d.isFrame=d.$contentBody.length>0&&!d.$contentBody.hasClass("ba-page");d.$body.toggleClass("ba-page-root",!d.isFrame);if(!d.isFrame){if(d.inIframe&&!d.options.multiPage){var t=a(d.$app,"content-header");if(t.is("script")&&window.top.busyAdmin.app){window.top.busyAdmin.app.$contentHeader.html(t.html());window.top.document.title=document.title}}if(!d.inIframe&&d.options.login&&!d.isLogin()){d.loadInfo();d.trigger(p.e.appReady);return}d.hideLoader();d.trigger(p.e.appReady);d.trigger(p.e.appReadies);return}d.initContentSide();d.$contentHeader.on("click","a",function(){var e=f(this);var t=e.attr("href")||"";var a=-1!==t.indexOf("://")?t:d.getPath(t);var n=d.$nav.find('[data-path="'+a+'"]');if(0===(n.attr("target")||"").indexOf("ba_iframe_")){d.setNavActive(a,"resumeFrames");return false}});d.$nav.on("click","a",function(e){var t=f(this);var a=t.hasClass("is-action");var n=t.hasClass("is-top");var i=t.parent("li");var r=t.find("> .nav-arrow");var o=t.next("ul");if(a){d.$nav.find(".active").removeClass("active");t.addClass("active");t.parents("ul").each(function(){var e=f(this).prev("a");e.parent("li").addClass("active");if(e.length&&!e.hasClass("open"))e.trigger("click")});d.$headerMenu.find('[data-id="'+t.parents("li").last().data("id")+'"]').trigger(f.Event("click",{_byNav:true}));d.closeSideNav();var s=d._handleIframe(t,e,false);if(n)d.$app.addClass("ba-hide-nav");else d.$app.removeClass("ba-hide-nav");return s}else{e.preventDefault();var l=t.data("path");var c=t.hasClass("open");if(c){if(e.triggerFrom==="resumeNav")return false;o.hide();r.removeClass("fa-rotate-180");t.removeClass("open");t.parents("li").each(function(){if(f(this).find("> a").hasClass("open"))return true;f(this).removeClass("opened")});d._saveNavState(l,false)}else{if(d.options.navSingleHold&&e.triggerFrom!=="resumeNav")if(d.isMobileSize())i.parent("ul").find("> li > a.open").trigger("click");else i.parent("ul").find("> li:not(.ba-nav-li-1) > a.open").trigger("click");o.show();r.addClass("fa-rotate-180");t.addClass("open");t.parents("li").each(function(){if(!f(this).find("> a").hasClass("open"))return true;f(this).addClass("opened")});e.triggerFrom!=="resumeNav"&&d._saveNavState(l,true)}}return false}).on("mouseenter",function(){if(d.isMiniNav()){clearTimeout(d._navHoverTimer);d._navHoverTimer=setTimeout(function(){d.$left.addClass("ba-left-open")},100)}}).on("mouseleave",function(){if(d.isMiniNav()){clearTimeout(d._navHoverTimer);d._navHoverTimer=setTimeout(function(){d.$left.removeClass("ba-left-open")},100)}});d.$contentMask.on("click",function(){d.closeSideNav()});d.$barFullscreen.on("click",function(){d.isFullscreen()?d.exitFullscreen():d.requestFullscreen()});d.$barRefresh.on("click",function(){p.route.reload()});d.$barControl.on("click",function(){if(!d.isMobileSize())if(d.isMiniNav())d.setToDefaultNav();else d.setToMiniNav();else if(d.sideIsOpen())d.closeSideNav();else d.openSideNav()});d.$contentSideClose.on("click",function(){d.$content.toggleClass("ba--force-side")});d.$contentSideMask.on("click",function(){d.$contentSideClose.trigger("click")});d.$contentSide.on("click","[data-close]",function(){d.$contentSideClose.trigger("click")});if(d.options.multiPage){d.tabList=[];d.$multiTabsRow=f('<div class="row"/>');d.$multiTabs=f('<ul class="nav nav-tabs"/>').append('<li class="active"><a href="'+p.root()+'">首页</a></li>');d.$contentHeader.html(d.$multiTabs)}if(!d.isLogin()){d.loadInfo();d.trigger(p.e.appReady)}else{d.trigger(p.e.appReady);d._renderFrame()}},_handleIframe:function e(t,a,n){var i=this;var r=t.attr("target")||"";var o=t.attr("href")||"";if(0===r.indexOf("ba_iframe_")&&o){i.$contentIframes.find(".active").removeClass("active");var s=f('<iframe id="'+r+'" src="'+o+'"/>');var l=-1!==o.indexOf("://");i.$contentIframes.find("#"+r).remove();i.$contentIframes.append(s);s.addClass("active");i.$contentIframes.addClass("active");i.$contentBody.addClass("hide");if(l&&!i.options.multiPage){var c='<ul class="breadcrumb"><li><i class="fa fa-home"></i> <a href="'+p.root()+'">首页</a></li>';var d;if(n){d=t.find("> span").text();c+='<li><a href="'+t.attr("href")+'">'+d+"</a></li>"}else{d=t.find("> .nav-name").text();f(t.parents("li").get().reverse()).each(function(){var e=f(this);var t=e.find("> a");var a=t.find("> .nav-name").text();c+="<li>";if(t.hasClass("is-action"))c+='<a href="'+t.attr("href")+'">'+a+"</a>";else c+="<span>"+a+"</span>";c+="</li>"})}c+="</ul>";document.title=d+i.options.pageTitleSuffix;i.$contentHeader.html(c)}if(a.triggerFrom!=="resumeFrames"){var u=o;if(!l)u=i.getPath(o);p.route.show(p.root()+"#frames!"+u,null,false)}return false}return true},loadInfo:function e(){var i=this;i._abortLoadInfo();i._loadInfoTask=p.request(i.options.url).addHeader("Busy-Admin-Plugin","AppInfo").pending(false).error(function(){return false}).success(function(e,t,a){var n=e.result||{};i.data=n;i.username=n.username;i.userId=n.user_id;i._renderFrame();return false}).exec()},_abortLoadInfo:function e(){var t=this;if(t._loadInfoTask){t._loadInfoTask.abort();t._loadInfoTask=null}},_renderFrame:function e(){var t=this;var a=t.data;t.$barUsername.text(t.username);var n=a.menu_list||[];t._renderMenu(n);t._renderNav(n);t._renderUserDropdowns(a.user_dropdowns||[]);if(!n.length)t.$app.addClass("ba-hide-nav");var i=t.options.navSingleHold?{}:t._getNavState()||{};for(var r in i){if(!i[r])continue;t.$nav.find('[data-path="'+r+'"]').not(".open").trigger(f.Event("click",{triggerFrom:"resumeNav"}))}var o=h.parseURL(document.URL);if(o.hash&&0===o.hash.indexOf("frames!"))t.setNavActive(o.hash.substring(7),"resumeFrames");else t.setNavActive(t.getPath(document.URL),"loadInfo");if(t.options.navMode)t.setToMiniNav();else t.setToDefaultNav();t.trigger(p.e.appReadies);t.hideLoader()},showLoader:function e(){var t=this.$loader;if(t.data("show"))return;t.data("show",true).fadeIn()},hideLoader:function e(){var t=this.$loader;if(!t.data("show"))return;t.data("show",false).fadeOut()},isMiniNav:function e(){return this.$app&&this.$app.hasClass("ba-mini-nav")},sideIsOpen:function e(){return this.$frame.hasClass("ba-nav-open")},_parseResult:function e(t){if(typeof t==="string")try{t=JSON.parse(t)}catch(e){console.error("解析数据失败",e);return{message:"解析数据失败",status:false,code:0,result:{},url:""}}t.status=t.code===1;if(t.hasOwnProperty("traces")){var a;if(this.type!=="POST")a=h.parseURL(this.url).params;else a=h.parseURL("?"+this.data).params}return t},_initResponse:function e(){var t=this;p.response.bindCode(t.options.needLoginCode,function(e){p.dialog.tipError(e.message);p.route.show(e.url);return false});p.response.setParse(function(e){return t._parseResult(e)})},_renderMenu:function e(t){var s=this;var a="";t.map(function(e){var t=s._parseNavItem(e);a+='<li class="'+(e.path===s.data.menu_default&&!s.currentPath?"active":"")+'"><a href="'+t.url+'" data-id="'+e.id+'" data-path="'+t.path+'" target="'+t.target+'" class="'+(e.child.length>0?"":"is-top")+'"><i class="'+e.icon+'"></i> <span>'+e.name+"</span></a></li>"});s.$headerMenuNav=f('<ul class="nav navbar-nav"/>').html(a);s.$headerMenuLeft=f('<a class="left-arrow" href="javascript:void(0)"/>').append('<i class="fa fa-angle-double-left" />').hide();s.$headerMenuRight=f('<a class="right-arrow" href="javascript:void(0)"/>').append('<i class="fa fa-angle-double-right" />').hide();s.$headerMenuScroll=f('<div class="nav-scroll"/>').append(s.$headerMenuLeft).append(s.$headerMenuNav).append(s.$headerMenuRight);s.$headerMenu.html(s.$headerMenuScroll);s.$headerMenuNav.on("click","a",function(e){var t=f(this);var a=t.data("id");var n=t.closest("li");s.$headerMenuNav.find("li.active").removeClass("active");n.addClass("active");s.$nav.find("> ul > li").addClass("hide");s.$nav.find('[data-id="'+a+'"]').removeClass("hide");var i=s.$headerMenuScroll.outerWidth(false);var r=n.position().left;s.$headerMenuScroll.stop().animate({scrollLeft:r-i/2+n.outerWidth(true)/2});if(e._byNav)return false;var o="ba-hide-nav";if(t.hasClass("is-top")){if(!s.$app.hasClass(o)){s.$app.addClass(o);s.triggerResize()}}else if(s.$app.hasClass(o)){s.$app.removeClass(o);s.triggerResize()}return s._handleIframe(t,e,true)});s.$headerMenuLeft.on("click",function(){if(f(this).hasClass("disabled"))return;var e=s.$headerMenuScroll[0].clientWidth/2;s.$headerMenuScroll.stop().animate({scrollLeft:s.$headerMenuScroll.scrollLeft()-e})});s.$headerMenuRight.on("click",function(){if(f(this).hasClass("disabled"))return;var e=s.$headerMenuScroll[0].clientWidth/2;s.$headerMenuScroll.stop().animate({scrollLeft:s.$headerMenuScroll.scrollLeft()+e})});s.$headerMenuScroll.on("scroll",function(){var t=this;var a=f(this);clearTimeout(s._headerMenuScrollTimer);s._headerMenuScrollTimer=setTimeout(function(){var e=a.scrollLeft();if(e<=0)s.$headerMenuLeft.addClass("disabled");else s.$headerMenuLeft.removeClass("disabled");if(e+t.clientWidth>=t.scrollWidth)s.$headerMenuRight.addClass("disabled");else s.$headerMenuRight.removeClass("disabled")},20)});s._menuReady=true;s._computeMenu()},_computeMenu:function e(){var t=this;if(!t.isFrame||!t._menuReady)return;var a=t.$win.width();var n=t.$headerLeft.outerWidth(false);var i=Math.abs(h.float(t.$headerLeft.css("margin-left").replace("px","")));var r=Math.abs(h.float(t.$headerLeft.css("margin-right").replace("px","")));n=n+i+r;var o=t.$headerBarLeft.outerWidth(false);var s=Math.abs(h.float(t.$headerBarLeft.css("margin-left").replace("px","")));var l=Math.abs(h.float(t.$headerBarLeft.css("margin-right").replace("px","")));o=o+s+l;var c=t.$headerBarRight.outerWidth(false);var d=Math.abs(h.float(t.$headerBarRight.css("margin-left").replace("px","")));var u=Math.abs(h.float(t.$headerBarRight.css("margin-right").replace("px","")));c=c+d+u;var p=a-o-c-n;var f=t.$headerMenuNav.outerWidth(true);if(f>p){t.$headerMenuLeft.show();t.$headerMenuRight.show();t.$headerMenuScroll.addClass("show-scroll")}else{t.$headerMenuLeft.hide();t.$headerMenuRight.hide();t.$headerMenuScroll.removeClass("show-scroll")}t.$headerMenu.css("max-width",p+"px");t.$headerMenuScroll.trigger("scroll")},_renderUserDropdowns:function e(t){var a=this;var i="";t.map(function(e){if(e.type==="divider")i+='<li class="divider"></li>';else{var t=e.attr||{};var a="";for(var n in t)a+=n+"='"+t[n]+"' ";i+='<li><a href="'+(e.href||"javascript:void(0);")+'"'+a+'><i class="'+(e.icon||"")+'"></i> '+(e.text||"")+"</a></li>"}});a.$barUserDropdowns.html(i)},_renderNav:function e(t,s){s=s||1;var l=this;var c='<ul class="ba-nav-ul-'+s+'">';t.map(function(e){var t=e.child||[];var a=l._parseNavItem(e);var n=t.length>0;var i=["ba-nav-li-"+s];var r=[];var o="";if(s==1){if(l.data.menu_default!==e.path)i.push("hide");r.push("is-top")}r.push(n?"has-child":"is-action");if(e.path===l.currentPath)r.push("active");(e.hides||[]).map(function(e){o+='<abbr data-hide-path="'+h.snake(e.path)+'" class="hide"></abbr>'});c+='<li class="'+i.join(" ")+'" data-id="'+e.id+'">';c+='<a class="'+r.join(" ")+'" data-path="'+a.path+'" href="'+a.url+'" target="'+a.target+'"><i class="nav-arrow fa fa-angle-down"></i> <i class="nav-icon '+e.icon+'"></i> <span class="nav-name">'+e.name+"</span>"+o+"</a>";if(n)c+=l._renderNav(t,s+1);c+="</li>"});c+="</ul>";if(s>1)return c;else{l.$nav.html(c);l.$nav.css({marginRight:-h.getScrollbarWidth()+"px"})}},_parseNavItem:function e(t){var a=-1===t.url.indexOf("://")?p.root()+h.ltrim(t.url,"/"):t.url;var n=t.target;var i=h.snake(t.path);if(n==="_blank")return{url:a,target:n};if(!t.url||(t.child||[]).length>0)a="javascript:void(0)";if(t.top_url&&!t.parent_path)a=p.root()+h.ltrim(t.top_url,"/");if(n==="iframe")n="ba_iframe_"+t.id;return{url:a,target:n,path:i}},getContentFrame:function e(){var t=this;var a=t.$contentBody;var n=h.float(a.css("paddingTop").replace("px",""));var i=h.float(a.css("paddingBottom").replace("px",""));var r=h.float(a.css("paddingLeft").replace("px",""));var o=h.float(a.css("paddingRight").replace("px",""));var s=a.offset();var l=t.$win.height()-s.top-n-i;var c=a.outerWidth(true)-r-o;return{target:a,height:l,width:c,top:s.top-(t.isMobileSize()&&t.$contentHeader.length>0?t.$contentHeader.outerHeight():0),left:s.left,paddingLeft:r,paddingRight:o,paddingTop:n,paddingBottom:i}},isInContent:function e(t){return t.closest('[data-busy-id="'+this.$contentBody.attr("data-busy-id")+'"]').length>0},extractContainer:function e(t,a){var n=this;var i={};var r=f(v(t.match(/<body[^>]*>([\s\S.]*)<\/body>/i)[0]));var o=t.match(/<head[^>]*>([\s\S.]*)<\/head>/i);var s=o!=null?f(v(o[0])):r;var l=t.match(/<script.*?id="think_trace_console_script">([\s\S.]*)<\/script>/i)||[];if(r.length===0)return i;var c=m(r,"content-body");if(a)if(!c.hasClass("ba-page")){if(!n.isFrame){i.init=m(r,"app").first().children();i.frame=true}}else if(n.isFrame){i.init=m(r,"app").first().children();i.frame=false}var d=g(s,"title").last();i.title=f.trim(d.text()||"");i.appTitle=f.trim(d.data("title")||"");var u=r.find("title").last();if(u.length)i.appTitle=f.trim(u.text()||"");i.content=c.first().children();i.contentHeader=m(r,"content-header").first().children();i.contentSide=m(r,"content-side").first().children();i.trace=l[0]||"";if(i.content.length>0){i.content=i.content.not(function(){return f(this).is("title")});i.content.find("title").remove()}return i},responseToHtml:function e(t,a,n){var i=this;try{p.response.parse(i._parseResult(JSON.parse(t.result)),null,function(e,t){var a="返回内容异常";p.dialog.tipError(a);console.warn("返回内容不是HTML格式，请检查服务端代码");typeof n==="function"&&n.call(i,a)},function(e,t){p.dialog.tipError(e.message);typeof n==="function"&&n.call(i,e.message)})}catch(e){a.call(i,t.result)}},requestFullscreen:function e(){var t=document.documentElement;var a=t.requestFullScreen||t.webkitRequestFullScreen||t.mozRequestFullScreen||t.msRequestFullScreen;if(a){a.call(t);this._changeFullState(true)}else if(typeof window.ActiveXObject!=="undefined"){var n=new ActiveXObject("WScript.Shell");if(n!=null){n.SendKeys("{F11}");this._changeFullState(true)}}},exitFullscreen:function e(){var t=document;var a=t.cancelFullScreen||t.webkitCancelFullScreen||t.mozCancelFullScreen||t.exitFullScreen;if(a){a.call(t);this._changeFullState(false)}else if(typeof window.ActiveXObject!=="undefined"){var n=new ActiveXObject("WScript.Shell");if(n!=null){n.SendKeys("{F11}");this._changeFullState(false)}}},isFullscreen:function e(){return this.$barFullscreenWrap.hasClass("active")},_changeFullState:function e(t){if(t){this.$barFullscreenWrap.addClass("active");this.$barFullscreenIcon.removeClass("bicon-full-screen").addClass("bicon-shrink-screen")}else{this.$barFullscreenWrap.removeClass("active");this.$barFullscreenIcon.addClass("bicon-full-screen").removeClass("bicon-shrink-screen")}},getUserId:function e(){return this.getData().user_id||f.cookie(this.options.cookieUserIdKey)||0},cacheKey:function e(t){return"ba."+this.getUserId()+"."+t},getUsername:function e(){return this.getData().username||f.cookie(this.options.cookieUsernameKey)||""},getUserInfo:function e(){return this.getData().user||{}},getData:function e(){return this.data||{}},getUseData:function e(){return this.getData().data||{}},trigger:function e(t,a){h.execCallback(this,null,document,a||[],this.$doc,t);return this},on:function e(t,a){this.$doc.on(t,a);return this},once:function e(t,a){this.$doc.one(t,a);return this},off:function e(t){this.$doc.off(t);return this},outLogin:function e(t){var a=this;a.data=null;a.options.login=false;a._abortLoadInfo();a.trigger(p.e.appLoginOuted,[t]);p.route.show(t.url)},loginSuccess:function e(t){var a=this;a.options.login=true;a.trigger(p.e.appLoginSucceed,[t]);p.route.show(t.url)},isLogin:function e(){return this.data!=null},clearCache:function e(){var t=this;var a=t.cacheKey("");for(var n in localStorage)if(0===n.indexOf(a))localStorage.removeItem(n);for(n in sessionStorage)if(0===n.indexOf(a))sessionStorage.removeItem(n);t.trigger(p.e.appClearCache)},reload:function e(){self.location.reload()},createBarButton:function e(t){return new n(t)},startTitleFlicker:function e(t){this.stopTitleFlicker();this._titleFlicker=new i(t);this._titleFlicker.show()},stopTitleFlicker:function e(){if(this._titleFlicker)this._titleFlicker.clear()},playBell:function e(t){this.pauseBell();this._bell=new o(t||this.options.bell);this._bell.play()},pauseBell:function e(){if(this._bell)this._bell.stop()},notification:function e(a){var t=this;var n=this;var i=function e(){if(a.flicker===false)return;t.startTitleFlicker(typeof a.flicker==="boolean"?"":a.flicker)};var r=function e(){if(a.bell===false)return;t.playBell(typeof a.bell==="boolean"?"":a.bell)};var o=function e(){p.dialog.notifyInfo(a.title,a.desc,{onclick:function e(){typeof a.onClick==="function"&&a.onClick();n.stopTitleFlicker();n.pauseBell()},onShown:a.onShow,onCloseClick:a.onClose});i();r()};if(window.Notification&&Notification.permission!=="denied")Notification.requestPermission().then(function(e){if(e=="granted"){var t=new Notification(a.title,{body:a.desc,icon:a.icon,id:a.id});i();r();t.onclick=function(){window.focus();typeof a.onClick==="function"&&a.onClick();n.stopTitleFlicker();n.pauseBell();t.close()};t.onshow=a.onShow;t.onerror=a.onError;t.onclose=a.onClose}else o()}).catch(function(){o()});else o()},ws:function e(t){if(t)return new l(t);return this._wsClient}},c.DEFAULTS={navSingleHold:false,navMode:false,imagePlaceholder:"",avatarPlaceholder:"",multiPage:false,scrollCacheLength:50,url:"",pageTitleSuffix:"",needLoginCode:3020001,bell:"",cookieUserIdKey:"admin_user_id",cookieUsernameKey:"admin_username",wsEnable:false,wsUrl:"",wsPingInterval:3e3,wsPingData:null,wsReconnectDelay:3e3},p.app=new c,p.regSugar("app",function(e,t,a){if(!e)return;p.app[e](t)})}),function(e){define("./ba/app/helper",["busyAdmin","jquery"],e)}(function(busyAdmin,$){function DomChange(){this.timeout=0,this.timer=null}DomChange.prototype={on:function(e,t,a){var n=this;return(e=e||document)instanceof $&&(e=e[0]),n.node=e,n.onCall=t,window.MutationObserver?(n.observer=new MutationObserver(function(e){(e[0].addedNodes.length||e[0].removedNodes.length)&&n._do()}),n.observer.observe(n.node,{subtree:!0,childList:!0})):window.addEventListener&&n.node.addEventListener("DOMNodeInserted",n._do,!1),void 0!==a&&!a||$(function(){t()}),n},off:function(){window.MutationObserver?this.observer.disconnect():window.addEventListener&&this.node.removeEventListener("DOMNodeInserted",this._do,!1)},_do:function(){var e=this;clearTimeout(e.timer),e.timer=setTimeout(function(){e.onCall()},e.timeout)}},busyAdmin.helper={parseURL:function(e){var o=document.createElement("a");o.href=e;var t=o.pathname.replace(/^([^\/])/,"/$1"),a=t.lastIndexOf("."),n="",i=t;return-1!==a&&(n=t.substring(a+1),i=t.substring(0,a)),{source:e,protocol:o.protocol.replace(":",""),host:o.hostname,port:o.port,query:o.search,params:function(){for(var e,t,a={},n=o.search.replace(/^\?/,"").split("&"),i=n.length,r=0;r<i;r++)n[r]&&(t=n[r].split("="),e=decodeURIComponent(t[0]),t=decodeURIComponent(t[1]),a.hasOwnProperty(e)?($.isArray(a[e])||(a[e]=[a[e]]),a[e].push(t)):a[e]=t);return a}(),filename:(o.pathname.match(/\/([^\/?#]+)$/i)||[,""])[1],hash:o.hash.replace("#",""),path:t,pathNoSuffix:i,extension:n,relative:(o.href.match(/tps?:\/\/[^\/]+(.+)/)||[,""])[1],segments:o.pathname.replace(/^\//,"").split("/")}},checkURL:function(e){return!(0===(e=e||"").indexOf("javascript:")||0===e.indexOf("#"))},getObjectValue:function(e,t,a,n){if(!e.hasOwnProperty(t))return a;t=e[t];return!0!==n||("string"==typeof a&&(t=t.trim()),t)?t:a},onDomChange:function(e,t,a){return(new DomChange).on(e,t,a)},onPopState:function(e){window.history&&window.history.pushState&&$(window).on("popstate",e)},parseData:function(a,e,t){e="string"==typeof e?[e]:e,t="string"==typeof t?[t]:t||[];var n,i={};for(n in a)t.map(function(e){0===n.indexOf(e)&&(i[n]=a[n])}),e.map(function(e){var t=e.length;0!==n.indexOf(e)||0!=((t=n.slice(t)).slice(0,1).toLowerCase()+t.slice(1)).length&&(i[t.slice(0,1).toLowerCase()+t.slice(1)]=a[n])});return i},uuid:function(){for(var e=[],t="0123456789abcdef",a=0;a<36;a++)e[a]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},htmlToEscape:function(e){return null==e?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;").replace(/`/g,"&#x60;")},escapeToHtml:function(e){return null==e?"":e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&#x60;/g,"`")},execCallback:function(e,t,a,n,i,r,o,s,l){var c=["true","false"];"string"==typeof t&&(0===(t=t.trim()).indexOf("@")&&(t=busyAdmin.dispatchSugar(a,t,e,n,r?"string"==typeof r?r:r.type:"")),-1===c.indexOf(t)&&(0!==t.indexOf("!")||0<(u=(t=t.substring(1,t.length)).substring(0,t.lastIndexOf("."))).length&&(a=busyAdmin.helper.scope(u)||a),0<t.length&&(t=busyAdmin.helper.scope(t))));var d=null;if(i&&i.length&&0<i.length){var u,e=[];if($.isArray(i)&&(u=i.shift(),e=i,i=u),e.map(function(e){e.triggerHandler(r,n)}),d=i.triggerHandler(r,n),null===o)return d;if(o)if(l){if((void 0===d?"undefined":_typeof(d))===s)return d}else if(s===d)return d}return"function"==typeof t?(n=n||[],a=a||this,t.apply(a,n)):"string"==typeof t&&-1!==c.indexOf(t)?$.baStrToVar(t):d},base64Encode:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64Decode:function(e){return decodeURIComponent(escape(window.atob(e)))},int:function(e){return e=parseInt(e),isNaN(e)?0:e},float:function(e){return e=parseFloat(e),isNaN(e)?0:e},getElementBySelector:function(e){e=$(e);return 0<e.length&&"SCRIPT"===e[0].tagName&&(e=$(e.html())),e},camel:function(e){return e.replace(/[_-](\w)/g,function(e,t){return t.toUpperCase()})},snake:function(e,t){return t=t||"_",(e=e.replace(/[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]+/g,"",e)).replace(/((?:[\0-\t\x0B\f\x0E-\u2027\u202A-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]))(?=[A-Z])/g,"$1"+t).toLowerCase()},sprintf:function(){for(var e=arguments,t=e[0],a=1;a<e.length;a++)var n=arguments[a],t=t.replace("%s",n);return t},urlPreviewHandler:function(e){switch(e.url.substring(e.url.lastIndexOf(".")+1).trim().toLowerCase()){case"jpeg":case"png":case"gif":case"jpg":case"webp":case"bmp":case"ico":"function"==typeof e.image&&e.image();break;case"mp4":case"webm":case"ogv":"function"==typeof e.video&&e.video();break;case"mp3":"function"==typeof e.audio&&e.audio();break;default:"function"==typeof e.file&&e.file()}},arrayRemoveByIndex:function(e,t){return 0===(e=e||[]).length||t<0?e:e.slice(0,n).concat(e.slice(n+1,e.length))},triggerPluginReady:function(e,t,a,n){n&&busyAdmin.helper.execCallback(t,(t.options||{})[a||"onInitialized"],e[0],[],e,n),$(document).triggerHandler(busyAdmin.e.appPluginReady,[e,t])},extends:function(e,t){var a,n={};for(a in t)n[a]=e[a];return $.extend(e,t),n},override:function(e,t,a,n){t=e[t];if("function"==typeof t)return t.apply(a,Array.isArray(n)?n:Array.prototype.slice.call(n));throw t},scope:function scope(name,defaults){if("string"!=typeof name)return name;if(0===name.indexOf("!"))return name.substring(1);if(!/^[a-z0-9$._]+$/i.test(name))return name;if(-1===name.indexOf("."))return busyAdmin.data[name]||window[name]||defaults;var arr=name.split(".");name=arr.shift();for(var value=busyAdmin.data[name]||window[name]||{},len=arr.length,createCode=function(e,t,a){return"("+e+"."+t+" || "+a+")"},code="",i=0,val,def;i<len;i++){0==i&&(code="value"),code=createCode(code,arr.shift(),i+1==len?"defaults":"{}")}try{return eval(code)}catch(e){return defaults}},getScrollbarWidth:function(){var e=document.createElement("div"),t=document.createElement("div");e.style.overflow="scroll",document.body.appendChild(e),e.appendChild(t);t=e.offsetWidth-t.offsetWidth;return document.body.removeChild(e),t},ltrim:function(e,t){return t=t||"s",e.replace(RegExp("(^"+t+"*)","g"),"")},rtrim:function(e,t){return t=t||"s",e.replace(RegExp("("+t+"*$)","g"),"")},random:function(e,t){e=e||32;for(var a=(t=t||"ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678").length,n="",i=0;i<e;i++)n+=t.charAt(Math.floor(Math.random()*a));return n},listToTree:function(e,t,a,n,i){t=t||"id",a=a||"child",n=n||"parent",i=i||"";for(var r=[],o={},s=0,l=(e=e||[]).length;s<l;s++){var c=e[s],d=c[t];d&&(o[d]?c[a]=o[d]:c[a]=o[d]=[],c[n]&&c[n]!=i?(o[d=c[n]]||(o[d]=[]),o[d].push(c)):r.push(c))}return r},pluginFn:function(e,o,s,l,c,d){var u,p;return(l=Array.prototype.slice.call(l)).shift(),p="object"===(void 0===s?"undefined":_typeof(s))&&!0===l[0]||!0===s,e.each(function(){var t=$(this),e=t.data(o.KEY);if(!e||p)try{e&&!e._pluginFnDestroyed&&("function"==typeof e.destroy&&e.destroy(),delete e._pluginFnDestroyed),t.data(o.KEY,e=new o(this,"object"===(void 0===s?"undefined":_typeof(s))&&s))}catch(e){throw t.data(o.KEY,e),e}if("string"==typeof s){if("function"==typeof c)u=c.call(e,t);else if(e[s])"destroy"===s&&(e._pluginFnDestroyed=!0)===l[0]&&t.removeData(o.KEY),u=e[s].apply(e,l);else if(c){$.isArray(c)||(c=[c]);for(var a=c.length,n=0;n<a;n++){var i,r=c[n];if("function"==typeof r&&(r=(i=r(s)).name,s=i.method),e[r]&&e[r][s]){u=e[r][s].apply(e[r],l);break}}}}else"function"==typeof d&&d.call(e)}),"string"==typeof s?u:e},pluginAttrs:function(e){return'[data-toggle="busy-'+e+'"],[busy-'+e+"]"},pluginKey:function(e){return"ba-"+e},pluginCall:function(e,t,a,n,i){var r=a.data(e.KEY);return r&&r instanceof e?"string"==typeof n?a[t].apply(a,Array.prototype.slice.call(i)):r:null},initArt:function(e){var d;e._busyInit||(e._busyInit=!0,d=e.defaults.rules[1],e.defaults.rules.push({test:/<ba-([a-z]+)\s*value=['"]+(.*?)['"]+\s*(\/?)>(<\/ba-(else|elseif|set)>)*|<ba-([a-z]+)\s*\/>(<\/ba-else>)*|<\/ba-([a-z]+)>/,use:function(e,t,a,n,i,r,o,s,l){if(t&&void 0!==a)switch(t){case"if":a="if ("+a+") {";break;case"elseif":a="} else if ("+a+") {";break;case"else":a="} else {";break;case"each":var c=d._split(this.getEsTokens(a));a="$each("+(c[0]||"$data")+", function("+(c[1]||"$value")+", "+(c[2]||"$index")+") {"}else if(o)switch(o){case"set":a="var "+a;break;case"else":a="} else {"}else if(l)switch(l){case"if":a="}";break;case"each":a="})";break;case"else":a="} else {"}return{code:a,output:!1}}}))},encodeUnicode:function(e){for(var t=e.split(""),a="",n=0;n<t.length;n++){var i=Number(t[n].charCodeAt(0)).toString(16);a+="\\u"+(i=String("0000").substring(i.length,4)+i)}return a},decodeUnicode:function(e){for(var t=e.split("\\u"),a=t[0],n=1;n<t.length;n++){var i=t[n];a+=String.fromCharCode(parseInt("0x"+i.substring(0,4))),4<i.length&&(a+=i.substring(4,i.length))}return a},checkCardNoProvince:function(e){e=(e+="").substring(0,2);return!(!/^[1-9][0-9]/.test(e)||!{11:"北京",12:"天津",13:"河北",14:"山西",15:"内蒙古",21:"辽宁",22:"吉林",23:"黑龙江 ",31:"上海",32:"江苏",33:"浙江",34:"安徽",35:"福建",36:"江西",37:"山东",41:"河南",42:"湖北 ",43:"湖南",44:"广东",45:"广西",46:"海南",50:"重庆",51:"四川",52:"贵州",53:"云南",54:"西藏 ",61:"陕西",62:"甘肃",63:"青海",64:"宁夏",65:"新疆",71:"台湾",81:"香港",82:"澳门"}[e])},checkCardNoDate:function(e){18===(e+="").length&&(e=e.substring(6,14));if(/^(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)$/.test(e)){var t=e.substring(0,4),a=e.substring(4,6),e=e.substring(6,8),e=new Date(t+"-"+a+"-"+e);if(e&&e.getMonth()==parseInt(a)-1)return!0}return!1},checkCardNo:function(e){if(e+="",!busyAdmin.helper.checkCardNoProvince(e))return!1;if(!busyAdmin.helper.checkCardNoDate(e))return!1;if(/^[\d]{17}[0-9|x|X]{1}$/.test(e)){for(var t=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],a=e.slice(0,17),n=e.slice(17,18),n=isNaN(parseInt(n))?n.toLowerCase():parseInt(n),i=0,r=0;r<17;r++)i+=parseInt(a.charAt(r))*t[r];e=[1,0,"X",9,8,7,6,5,4,3,2];if(("string"==typeof e[i%11]?"x":e[i%11])===n)return!0}return!1}},$.fn.baOnTransEnd=function(e,t){return this[e?"one":"on"]("webkitTransitionEnd msTransitionend oTransitionEnd otransitionend mozTransitionend transitionend",t),this},$.fn.baOnAnimEnd=function(e,t){return this[e?"one":"on"]("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",t),this},$.fn.baFormVal=function(e,t){var a,n=$(this);for(a in e=t?(e=e||document.URL,busyAdmin.helper.parseURL(e).params):e||{}){var i=e[a],r=n.find('[name="'+a+'"]');if(0<r.length)switch((r.attr("type")||"").toLowerCase()){case"checkbox":case"radio":r.each(function(){$(this).prop("checked",$(this).val()==i).trigger("change")});break;default:r.val(i).trigger("change")}else n.append('<input type="hidden" name="'+a+'" value="'+i+'"/>')}return this};var TriggerEvent=function(e,t,a){var n=document.createEvent("HTMLEvents");return n.eventName=t,n.params=a,n.initEvent(t,!0,!0),!e.dispatchEvent(n)},jo,ko,qo;function lo(e){return qo.raw?e:encodeURIComponent(e)}function po(e,t){e=qo.raw?e:function(e){0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return e=decodeURIComponent(e.replace(ko," ")),qo.json?JSON.parse(e):e}catch(e){}}(e);return jo.isFunction(t)?t(e):e}jQuery.Event.prototype.getBaTriggerParams=function(){return(this.originalEvent||{}).params},$.fn.baTriggerEvent=function(e,t){return this.each(function(){TriggerEvent(this,e,t)}),this},$.baIsEmpty=function(e){return null==e},$.baStrToVar=function(e){if("string"==typeof e)try{e="true"===e||"false"!==e&&("null"===e?null:+e+""===e?+e:/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/.test(e)?JSON.parse(e):e)}catch(e){}else e=void 0;return e},$.fn.getUrl=function(){var e=this.is("form")?this.attr("action"):this.attr("href");return $.baIsEmpty(e)||"#"===e||0===e.toLowerCase().indexOf("javascript:")?"":e},$.fn.baData=function(e){if(this.length){for(var t,a,n="busy-"+e,i=n+"-",r=i.length,o=this[0].attributes,s=o.length,l={};s--;)o[s]&&((t=o[s].name)!==n?0===t.indexOf(i)&&""!==(t=$.camelCase(t.substring(r)))&&(l[t]=$.baStrToVar(o[s].value),a=!0):a=!0);if(a)return l}return this.data()},jo=jQuery,ko=/\+/g,qo=jo.cookie=function(e,t,a){var n,i;if(void 0!==t&&!jo.isFunction(t))return"number"==typeof(a=jo.extend({},qo.defaults,a)).expires&&(i=a.expires,(n=a.expires=new Date).setTime(+n+864e5*i)),document.cookie=[lo(e),"=",(i=t,lo(qo.json?JSON.stringify(i):String(i))),a.expires?"; expires="+a.expires.toUTCString():"",a.path?"; path="+a.path:"",a.domain?"; domain="+a.domain:"",a.secure?"; secure":""].join("");for(var r=e?void 0:{},o=document.cookie?document.cookie.split("; "):[],s=0,l=o.length;s<l;s++){var c=o[s].split("="),d=(d=c.shift(),qo.raw?d:decodeURIComponent(d)),c=c.join("=");if(e&&e===d){r=po(c,t);break}e||void 0===(c=po(c))||(r[d]=c)}return r},qo.defaults={},jo.removeCookie=function(e,t){return void 0!==jo.cookie(e)&&(jo.cookie(e,"",jo.extend({},t,{expires:-1})),!jo.cookie(e))}}),define("./ba/app/request",["busyAdmin","jquery"],function(h,m){var g=function e(t,a){this.config={method:e.options.method,cache:e.options.cache,pendingStatus:e.options.pendingStatus,pendingMessage:e.options.pendingMessage,before:null,complete:null,success:null,error:null,progress:null,parse:e.options.parse,parseExec:"",ajaxOptions:{},url:document.URL,params:[],headers:{}};if((typeof t==="undefined"?"undefined":_typeof(t))==="object")this.config.ajaxOptions=t||{};else if(typeof t==="string"||typeof t==="function"){this.url(t);this.config.ajaxOptions=a||{}}this.paramElements=[];this.ajax=null};g.options={root:"",contentType:"application/x-www-form-urlencoded",method:"get",cache:false,params:{},headers:{},parse:"",pendingStatus:true,pendingMessage:"请稍候...",ajaxOptions:{},beforeCallback:m.noop,completeCallback:m.noop,successCallback:function e(t){h.dialog.tipSuccess(t.message||"success")},errorCallback:function e(t){h.dialog.tipError(t.message||"error")},progressCallback:m.noop},g.prototype={pending:function e(t,a){if(typeof t==="string"&&t.length){a=t;t=true}this.config.pendingStatus=t;if(a)this.config.pendingMessage=a;return this},cache:function e(t){this.config.cache=t;return this},url:function e(t){this.config.url=t;return this},post:function e(t){return this.method(t?"post":"get")},method:function e(t){this.config.method=t;return this},headers:function e(t){if(typeof t==="function")t=t();this.config.headers=t||{};return this},addHeader:function e(t,a){this.config.headers[t]=a;return this},params:function e(t){var a=this;a.config.params=[];if(typeof t==="function"&&!(t instanceof jQuery))t=t();if(t instanceof jQuery)a.config.params=t.serializeArray();else if(m.isArray(t))a.config.params=t;else if((typeof t==="undefined"?"undefined":_typeof(t))==="object"&&t!==null)for(var n in t){var i=t[n];if(m.isArray(i))i.map(function(e){a.config.params.push({name:-1!==n.indexOf("[")?n:n+"[]",value:e})});else a.config.params.push({name:n,value:i})}else if(typeof t==="string"&&t!==""){var r=h.helper.parseURL("?"+t).params||{};for(var n in r){var i=r[n];if(m.isArray(i))i.map(function(e){a.config.params.push({name:-1!==n.indexOf("[")?n:n+"[]",value:e})});else a.config.params.push({name:n,value:i})}}return this},addParam:function e(t,a,n){if(a instanceof jQuery)this.paramElements.push({name:t,value:a,filename:n});else this.config.params.push({name:t,value:a,filename:n});return this},clear:function e(){this.config.headers={};this.config.params=[];this.paramElements=[];return this},parse:function e(t,a){this.config.parse=t;this.config.parseExec=a;return this},before:function e(t){this.config.before=t;return this},complete:function e(t){this.config.complete=t;return this},success:function e(t){this.config.success=t;return this},error:function e(t){this.config.error=t;return this},progress:function e(t){this.config.progress=t;return this},exec:function e(){var r=this;var n=null;var o=m("<form />");this.paramElements.map(function(e){var t=e.value;var a=e.name||false;a=a?a:t.attr("name");if(t.length===0)return true;if(t[0].tagName==="INPUT"&&t.attr("type").toUpperCase()==="FILE"){var n=t[0].files;if(n.length>0)if(t.attr("multiple"))for(var i=0;i<n.length;i++)r.config.params.push({name:a,value:n[i]});else r.config.params.push({name:a,value:n[0],filename:e.filename})}else{t.attr("name",a);o.append(t.clone())}});o.serializeArray().map(function(e){r.config.params.push(e)});var t=g.options.params;for(var a in t)r.config.params.push({name:a,value:t[a]});var i=false;r.config.params.map(function(e){if(e.value instanceof File)i=true});if(!r.config.cache){r.config.headers["Cache-Control"]="no-cache";r.config.headers["If-Modified-Since"]="0"}var s=typeof r.config.url==="function"?r.config.url():r.config.url;if(typeof s!=="string"||s==="")s=document.URL;var l=m.extend({},m.extend({},{contentType:g.options.contentType,url:g.options.root+s,headers:m.extend({},r.config.headers,g.options.headers),type:r.config.method,dataType:r.config.parse?r.config.parse:"text",jsonpCallback:r.config.parseExec},g.options.ajaxOptions),r.config.ajaxOptions||{});if(i){l.cache=false;l.type="post";l.contentType=false;l.processData=false;var c=new FormData;r.config.params.map(function(e){if(e.filename)c.append(e.name,e.value,e.filename);else c.append(e.name,e.value)});l.data=c}else l.data=r.config.params;var d=function e(){n!==null&&n.close()};var u=function e(t,a,n){var i=r.config.complete;if(typeof i==="function"&&false===i.call(r,t,a,n))return false};var p=function e(t,a,n){var i=r.config.success;if(typeof i==="function"&&false===i.call(r,t,a,n))return;g.options.successCallback.call(r,t,a,n)};var f=function e(t,a,n){var i=r.config.error;if(typeof i==="function"&&false===i.call(r,t,a,n))return;g.options.errorCallback.call(r,t,a,n)};l.beforeSend=function(e,t){var a=r.config.before;if(typeof a==="function"&&false===a.call(r,e,t))return;if(r.config.pendingStatus)n=h.dialog.pending(r.config.pendingMessage)};l.success=function(e,t,a){d();if(!r.config.parse){this.xhr=a;h.response.parse(e,this,function(e,t){p(e,t,a)},function(e,t){f(e,t,a)},function(e,t){return u(e,t,a)})}else{var n=h.response.result;n.status=true;n.result=e;var i=h.response.type.success;if(false!==u(n,i,a))p(n,i,a)}};l.error=function(e,t,a){d();if(t==="abort")return;var n=t==="parsererror"?h.response.type.parse:h.response.type.http;var i=h.response.result;i.status=false;i.message=e.status+" "+a;if(false!==u(i,n,e))f(i,n,e)};l.xhr=function(){var e=m.ajaxSettings.xhr();if(e.upload)e.upload.addEventListener("progress",function(e){var t=r.config.progress;if(typeof t==="function")t.call(r,e)},false);return e};r.ajax=m.ajax(l);return r.ajax}},h.request=function(e,t){return new g(e,t)},h.request.setOptions=function(e,t){if(typeof e==="string")g.options[e]=t;else g.options=m.extend(g.options,e)}}),define("./ba/app/response",["busyAdmin","jquery"],function(e,f){var h=function e(){this.parseCallback=null;this.bindCodeList={}};h.result={status:false,message:"",url:"",code:0,result:{}},h.type={success:0,http:1,parse:2,logic:3},h.prototype={parse:function e(t,a,n,i,r){n=typeof n==="function"?n:f.noop;i=typeof i==="function"?i:f.noop;r=typeof r==="function"?r:f.noop;var o;var s=h.result;s.status=false;if(typeof t==="string"||!t)if(typeof this.parseCallback==="function")o=this.parseCallback.call(a,t)||{};else{t=f.trim(t);if("{"!==t.charAt(0)||"}"!==t.charAt(t.length-1)){s.message="返回数据解析异常";if(false!==r(s,h.type.parse))i(s,h.type.parse);return}try{o=JSON.parse(t)}catch(e){s.message="解析数据异常: "+e;if(false!==r(s,h.type.parse))i(s,h.type.parse);return}}else o=t;var l=[];["status","code","message","url","result"].map(function(e){if(!o.hasOwnProperty(e))l.push(e)});if(l.length>0){s.message="返回的参数中必须包含键: "+l.join(",");if(false!==r(s,h.type.parse))i(s,h.type.parse);return}var c=this.bindCodeList[o.code]||[];var d=c.length;for(var u=d-1;u>=0;u--){var p=c[u].callback||null;if(typeof p==="function"&&false===p(o))return}if(false===r(o,o.status?h.type.success:h.type.logic))return;if(o.status)n(o,h.type.success);else i(o,h.type.logic)},setParse:function e(t){this.parseCallback=t;return this},bindCode:function e(t,a){this.bindCodeList[t]=this.bindCodeList[t]||[];this.bindCodeList[t].push({callback:a});return this}},e.response=new h,e.response.result=h.result,e.response.type=h.type}),define("./ba/app/route",["busyAdmin","jquery"],function(l,c){"use strict";var d=Array.isArray||function(e){return Object.prototype.toString.call(e)=="[object Array]"},r=b,e=o,t=i,a=s,n=v,y=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^()])+)\\))?|\\(((?:\\\\.|[^()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function o(e){var t=[];var a=0;var n=0;var i="";var r;while((r=y.exec(e))!=null){var o=r[0];var s=r[1];var l=r.index;i+=e.slice(n,l);n=l+o.length;if(s){i+=s[1];continue}if(i){t.push(i);i=""}var c=r[2];var d=r[3];var u=r[4];var p=r[5];var f=r[6];var h=r[7];var m=f==="+"||f==="*";var g=f==="?"||f==="*";var v=c||"/";var b=u||p||(h?".*":"[^"+v+"]+?");t.push({name:d||a++,prefix:c||"",delimiter:v,optional:g,repeat:m,pattern:$(b)})}if(n<e.length)i+=e.substr(n);if(i)t.push(i);return t}function i(e){return s(o(e))}function s(l){var c=new Array(l.length);for(var e=0;e<l.length;e++)if(_typeof(l[e])==="object")c[e]=new RegExp("^"+l[e].pattern+"$");return function(e){var t="";var a=e||{};for(var n=0;n<l.length;n++){var i=l[n];if(typeof i==="string"){t+=i;continue}var r=a[i.name];var o;if(r==null)if(i.optional)continue;else throw new TypeError('Expected "'+i.name+'" to be defined');if(d(r)){if(!i.repeat)throw new TypeError('Expected "'+i.name+'" to not repeat, but received "'+r+'"');if(r.length===0)if(i.optional)continue;else throw new TypeError('Expected "'+i.name+'" to not be empty');for(var s=0;s<r.length;s++){o=encodeURIComponent(r[s]);if(!c[n].test(o))throw new TypeError('Expected all "'+i.name+'" to match "'+i.pattern+'", but received "'+o+'"');t+=(s===0?i.prefix:i.delimiter)+o}continue}o=encodeURIComponent(r);if(!c[n].test(o))throw new TypeError('Expected "'+i.name+'" to match "'+i.pattern+'", but received "'+o+'"');t+=i.prefix+o}return t}}function u(e){return e.replace(/([.+*?=^!:${}()[\]|\/])/g,"\\$1")}function $(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function p(e,t){e.keys=t;return e}function f(e){return e.sensitive?"":"i"}function h(e,t){var a=e.source.match(/\((?!\?)/g);if(a)for(var n=0;n<a.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:false,repeat:false,pattern:null});return p(e,t)}function m(e,t,a){var n=[];for(var i=0;i<e.length;i++)n.push(b(e[i],t,a).source);var r=new RegExp("(?:"+n.join("|")+")",f(a));return p(r,t)}function g(e,t,a){var n=o(e);var i=v(n,a);for(var r=0;r<n.length;r++)if(typeof n[r]!=="string")t.push(n[r]);return p(i,t)}function v(e,t){t=t||{};var a=t.strict;var n=t.end!==false;var i="";var r=e[e.length-1];var o=typeof r==="string"&&/\/$/.test(r);for(var s=0;s<e.length;s++){var l=e[s];if(typeof l==="string")i+=u(l);else{var c=u(l.prefix);var d=l.pattern;if(l.repeat)d+="(?:"+c+d+")*";if(l.optional)if(c)d="(?:"+c+"("+d+"))?";else d="("+d+")?";else d=c+"("+d+")";i+=d}}if(!a)i=(o?i.slice(0,-2):i)+"(?:\\/(?=$))?";if(n)i+="$";else i+=a&&o?"":"(?=\\/|$)";return new RegExp("^"+i,f(t))}function b(e,t,a){t=t||[];if(!d(t)){a=t;t=[]}else if(!a)a={};if(e instanceof RegExp)return h(e,t,a);if(d(e))return m(e,t,a);return g(e,t,a)}r.parse=e,r.compile=t,r.tokensToFunction=a,r.tokensToRegExp=n;var w="undefined"!==typeof document,x="undefined"!==typeof window,k="undefined"!==typeof history,C=typeof process!=="undefined",S=w&&document.ontouchstart?"touchstart":"click",_=x&&!!(window.history.location||window.location);function T(){this.callbacks=[];this.exits=[];this.current="";this.len=0;this._decodeURLComponents=true;this._base="";this._strict=false;this._running=false;this._hashbang=false;this.clickHandler=this.clickHandler.bind(this);this._onpopstate=this._onpopstate.bind(this)}function E(){var a=new T;function e(){return D.apply(a,arguments)}e.callbacks=a.callbacks;e.exits=a.exits;e.base=a.base.bind(a);e.strict=a.strict.bind(a);e.start=a.start.bind(a);e.stop=a.stop.bind(a);e.show=a.show.bind(a);e.back=a.back.bind(a);e.redirect=a.redirect.bind(a);e.replace=a.replace.bind(a);e.dispatch=a.dispatch.bind(a);e.exit=a.exit.bind(a);e.configure=a.configure.bind(a);e.sameOrigin=a.sameOrigin.bind(a);e.clickHandler=a.clickHandler.bind(a);e.reload=a.reload.bind(a);e.create=E;Object.defineProperty(e,"len",{get:function e(){return a.len},set:function e(t){a.len=t}});Object.defineProperty(e,"current",{get:function e(){return a.current},set:function e(t){a.current=t}});e.Context=R;e.Route=F;return e}function D(e,t){if("function"===typeof e)return D.call(this,"*",e);if("function"===typeof t){var a=new F(e,null,this);for(var n=1;n<arguments.length;++n)this.callbacks.push(a.middleware(arguments[n]))}else if("string"===typeof e)this["string"===typeof t?"redirect":"show"](e,t);else this.start(e)}function I(e){if(e.handled)return;var t;var a=this;var n=a._window;if(a._hashbang)t=_&&this._getBase()+n.location.hash.replace("#/","");else t=_&&n.location.pathname+n.location.search;if(t===e.canonicalPath)return;a.stop();e.handled=false;_&&(n.location.href=e.canonicalPath)}function P(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function R(e,t,a){var n=this.page=a||D;var i=n._window;var r=n._hashbang;var o=n._getBase();if("/"===e[0]&&0!==e.indexOf(o))e=o+(r?"#/":"")+e;var s=e.indexOf("?");this.canonicalPath=e;var l=new RegExp("^"+P(o));this.path=e.replace(l,"")||"/";if(r)this.path=this.path.replace("#/","")||"/";this.title=w&&i.document.title;this.state=t||{};this.state.path=e;this.querystring=~s?n._decodeURLEncodedURIComponent(e.slice(s+1)):"";this.pathname=n._decodeURLEncodedURIComponent(~s?e.slice(0,s):e);this.params={};this.hash="";if(!r){if(!~this.path.indexOf("#"))return;var c=this.path.split("#");this.path=this.pathname=c[0];this.hash=n._decodeURLEncodedURIComponent(c[1])||"";this.querystring=this.querystring.split("#")[0]}}function F(e,t,a){var n=this.page=a||A;var i=t||{};i.strict=i.strict||n._strict;this.path=e==="*"?"(.*)":e;this.method="GET";this.regexp=r(this.path,this.keys=[],i)}T.prototype={configure:function e(t){var a=t||{};this._window=a.window||x&&window;this._decodeURLComponents=a.decodeURLComponents!==false;this._popstate=a.popstate!==false&&x;this._click=a.click!==false&&w;this._hashbang=!!a.hashbang;var n=this._window;if(this._popstate)n.addEventListener("popstate",this._onpopstate,false);else if(x)n.removeEventListener("popstate",this._onpopstate,false);if(this._click)n.document.addEventListener(S,this.clickHandler,false);else if(w)n.document.removeEventListener(S,this.clickHandler,false);if(this._hashbang&&x&&!k)n.addEventListener("hashchange",this._onpopstate,false);else if(x)n.removeEventListener("hashchange",this._onpopstate,false)},base:function e(t){if(0===arguments.length)return this._base;this._base=t},_getBase:function e(){var t=this._base;if(t)return t;var a=x&&this._window&&this._window.location;if(x&&this._hashbang&&a&&a.protocol==="file:")t=a.pathname;return t},strict:function e(t){if(0===arguments.length)return this._strict;this._strict=t},start:function e(t){var a=t||{};this.configure(a);if(false===a.dispatch)return;this._running=true;var n;if(_){var i=this._window;var r=i.location;if(this._hashbang&&~r.hash.indexOf("#/"))n=r.hash.substr(2)+r.search;else if(this._hashbang)n=r.search+r.hash;else n=r.pathname+r.search+r.hash}if(n===l.helper.rtrim(this._base,"/"))n=this._base;this.replace(n,null,true,a.dispatch)},stop:function e(){if(!this._running)return;this.current="";this.len=0;this._running=false;var t=this._window;this._click&&t.document.removeEventListener(S,this.clickHandler,false);x&&t.removeEventListener("popstate",this._onpopstate,false);x&&t.removeEventListener("hashchange",this._onpopstate,false)},show:function e(t,a,n,i){var r=this._toURL(t);t=r.pathname+r.search+r.hash;var o=new R(t,a,this);var s=this.prevContext;this.prevContext=o;this.current=o.path;if(false!==n)this.dispatch(o,s);if(false!==o.handled&&false!==i)o.pushState();return o},back:function e(t,a){var n=this;if(this.len>0){var i=this._window;k&&i.history.back();this.len--}else if(t)setTimeout(function(){n.show(t,a)});else setTimeout(function(){n.show(n._getBase(),a)})},redirect:function e(t,a){var n=this;if("string"===typeof t&&"string"===typeof a){var i=n._toURL(t);D.call(this,i.pathname+i.search+i.hash,function(e){setTimeout(function(){n.replace(a)},0)})}if("string"===typeof t&&"undefined"===typeof a)setTimeout(function(){n.replace(t)},0)},replace:function e(t,a,n,i){var r=this._toURL(t);t=r.pathname+r.search+r.hash;var o=new R(t,a,this);var s=this.prevContext;this.prevContext=o;this.current=o.path;o.init=n;o.save();if(false!==i)this.dispatch(o,s);return o},dispatch:function e(t,a){var n=0,i=0,r=this;if(false===l.helper.execCallback(r,null,document,[r,t,a],c(document),l.e.routeBeforeLeave,true,false))return;function o(){var e=r.exits[i++];if(!e)return s();e(a,o)}function s(){var e=r.callbacks[n++];if(t.path!==r.current){t.handled=false;return}if(!e)return I.call(r,t);e(t,s)}if(a)o();else s()},exit:function e(t,a){if(typeof t==="function")return this.exit("*",t);var n=new F(t,null,this);for(var i=1;i<arguments.length;++i)this.exits.push(n.middleware(arguments[i]))},clickHandler:function e(t,a){if(1!==this._which(t))return false;if(t.metaKey||t.ctrlKey||t.shiftKey)return false;if(t.defaultPrevented)return false;var n=t.target;var i=t.path||(t.composedPath?t.composedPath():null);if(i)for(var r=0;r<i.length;r++){if(!i[r].nodeName)continue;if(i[r].nodeName.toUpperCase()!=="A")continue;if(!i[r].href)continue;n=i[r];break}while(n&&"A"!==n.nodeName.toUpperCase())n=n.parentNode;if(!n||"A"!==n.nodeName.toUpperCase())return false;var o=_typeof(n.href)==="object"&&n.href.constructor.name==="SVGAnimatedString";if(n.hasAttribute("download")||n.getAttribute("rel")==="external")return false;var s=n.getAttribute("href");if(!this._hashbang&&this._samePath(n)&&(n.hash||"#"===s))return false;if(s&&s.indexOf("mailto:")>-1)return false;if(o?n.target.baseVal:n.target)return false;if(!o&&!this.sameOrigin(n.href))return false;var l=o?n.href.baseVal:n.pathname+n.search+(n.hash||"");l=l[0]!=="/"?"/"+l:l;if(C&&l.match(/^\/[a-zA-Z]:\//))l=l.replace(/^\/[a-zA-Z]:\//,"/");var c=l;var d=this._getBase();if(l.indexOf(d)===0)l=l.substr(d.length);if(this._hashbang)l=l.replace("#/","");if(d&&c===l&&(!_||this._window.location.protocol!=="file:"))return false;t.preventDefault();a!==false&&this.show(c);return c},_onpopstate:function(){var o=false;if(!x)return function(){};if(w&&document.readyState==="complete")o=true;else window.addEventListener("load",function(){setTimeout(function(){o=true},0)});return function e(t){if(!o)return;var a=this;if(false===l.helper.execCallback(a,null,document,[this,t],c(document),l.e.routePopState,true,false))return;if(t.state){var n=t.state.path;var i=t.state.popStateDispatch;a.replace(n,t.state,undefined,i);if(i===false)l.helper.execCallback(a,null,document,[this,t],c(document),l.e.routeNoDispatch)}else if(_){var r=a._window.location;a.show(r.pathname+r.search+r.hash,undefined,undefined,false)}}}(),_which:function e(t){t=t||x&&this._window.event;return null==t.which?t.button:t.which},_toURL:function e(t){var a=this._window;if(typeof URL==="function"&&_)return new URL(t,a.location.toString());else if(w){var n=a.document.createElement("a");n.href=t;return n}},sameOrigin:function e(t){if(!t||!_)return false;var a=this._toURL(t);var n=this._window;var i=n.location;return i.protocol===a.protocol&&i.hostname===a.hostname&&(i.port===a.port||i.port===""&&(a.port==80||a.port==443))},_samePath:function e(t){if(!_)return false;var a=this._window;var n=a.location;return t.pathname===n.pathname&&t.search===n.search},_decodeURLEncodedURIComponent:function e(t){if(typeof t!=="string")return t;return this._decodeURLComponents?decodeURIComponent(t.replace(/\+/g," ")):t},reload:function e(){var t=this._window.location;var a=t.pathname+t.search+t.hash;this.replace(a)}},R.prototype={pushState:function e(){var t=this.page;var a=t._window;var n=t._hashbang;t.len++;if(k)a.history.pushState(this.state,this.title,n&&this.path!=="/"?"#/"+this.path:this.canonicalPath)},save:function e(){var t=this.page;if(k)t._window.history.replaceState(this.state,this.title,t._hashbang&&this.path!=="/"?"#/"+this.path:this.canonicalPath)}},F.prototype={middleware:function e(a){var n=this;return function(e,t){if(n.match(e.path,e.params)){e.routePath=n.path;return a(e,t)}t()}},match:function e(t,a){var n=this.keys,i=t.indexOf("?"),r=~i?t.slice(0,i):t,o=this.regexp.exec(decodeURIComponent(r));if(!o)return false;delete a[0];for(var s=1,l=o.length;s<l;++s){var c=n[s-1];var d=this.page._decodeURLEncodedURIComponent(o[s]);if(d!==undefined||!hasOwnProperty.call(a,c.name))a[c.name]=d}return true}};var A=E(),B=A,M;return B.default=A,l.route=B,l.regSugar("route",function(e,t,a){var n=l.e,n=[n.requestSuccess,n.requestError,n.requestComplete,n.formSuccess,n.formError,n.formComplete];-1!==["redirect","jump","go"].indexOf(e=e||"reload")&&(e="show"),t||-1===n.indexOf(e)||(t=(a.args[0]||{}).url||""),"show"!==e||t||(t=B.base()),B[e](t)}),B}),define("./ba/plug/audioViewer",["busyAdmin","jquery"],function(r,o){var s="audio-viewer",l=r.helper,e=l.pluginKey(s);r.e.audioViewerInitialized=r.ee("initialized",s);var t=function e(t,a){var n=this;n.element=t;n.$element=o(t);n.options=o.extend(true,{},e.DEFAULTS,n.$element.baData(s)||{},a||{});var i=n.options;n.$element.baModal({show:false,className:"ba-audio-viewer-dialog",content:'<audio src="'+i.src+'"></audio>',footer:false,title:i.title||"预览音频",ok:false,cancel:"关闭",type:"page",onReady:function e(t){n.$audio=t.$dialogBody.find("audio");n.$audio.baAudio({autoplay:i.autoplay,type:i.type,poster:i.poster,artist:i.artist}).baAudio("ready",function(){n.audio=this;t.resetView()})}},true);l.triggerPluginReady(n.$element,n,"",r.e.audioViewerInitialized)};function a(e){return l.pluginFn(this,t,e,arguments,"audio",function(){this.options.show&&this.show()})}return t.prototype={show:function(){this.$element.baModal("show")},hide:function(){this.$element.baModal("hide")},getAudio:function(){return this.audio},destroy:function(){this.audio=null}},t.KEY=e,t.DEFAULTS={show:!0,title:"",src:"",type:"",poster:"",artist:"",autoplay:!0},o.fn.baAudioViewer=a,o.fn.baAudioViewer.Constructor=t,r.plugins.AudioViewer=t,o("body").on("click."+e,l.pluginAttrs(s),function(e){a.call(o(this))}),t}),define("./ba/plug/audio",["busyAdmin","jquery"],function(o,s){var l,c="audio",d="abort,canplay,canplaythrough,durationchange,emptied,ended,error,loadeddata,loadedmetadata,loadstart,mozaudioavailable,pause,play,playing,progress,ratechange,seeked,seeking,stalled,suspend,timeupdate,volumechange,waiting,listshow,listhide,listadd,listremove,listswitch,listclear,noticeshow,noticehide,destroy,lrcshow,lrchide".split(","),u=o.helper,p=o.e,f=o.ee,h=s.baIsEmpty,e=u.pluginKey(c);s.map(d,function(e){p[u.camel("audio_"+e)]=f(e,c)}),p.audioInitialized=f("initialized",c);var t=function e(t,a){var n=this;n.element=t;n.$element=s(t);n.options=s.extend(true,{},e.DEFAULTS,n.$element.baData(c)||{},a||{});n.destroyed=false;n.ready(n._init)};function a(e){return o.helper.pluginFn(this,t,e,arguments,"api")}return t.prototype={ready:function(a){var n=this;l&&Hls?a.call(n):requirejs([o.lib.APlayer,o.lib.hls],function(e,t){window.Hls=t,l=e,a.call(n)})},_init:function(){var a=this,n=a.options,i=a.$element,r=a.element,e=s.proxy(a.destroy,a);s(document).one(p.appRenderBefore,e);var t=i.closestBaModal();t&&t.$element.one(p.modalHided,e),i.wrap('<div class="ba-audio" />'),a.$wrap=i.parent(),a.$player=s("<div />"),a.$wrap.append(a.$player),"audio"===r.tagName.toLowerCase()&&(a.isAudio=!0,i.find("source").each(function(){var e=s(this),t=e.attr("src"),e=e.attr("type");if(t)return n.src=n.src||t,n.type=n.type||e,!1}),h(n.autoplay)&&(n.autoplay=!!r.hasAttribute("autoplay")||null),h(n.muted)&&(n.muted=!!r.hasAttribute("muted")||null),h(n.loop)&&(n.loop=r.hasAttribute("loop")?"all":null),h(n.preload)&&(n.preload=r.getAttribute("preload"))),n.src=n.src||i.attr("src")||"",n.type=n.type||i.attr("type")||"",n.title=n.title||i.attr("title")||"",n.loop=n.loop||"all",n.preload=n.preload||"auto";e="boolean";_typeof(n.autoplay)!==e&&(n.autoplay=!1),_typeof(n.muted)!==e&&(n.muted=!1);e=n.audio||[];n.src&&e.unshift({name:n.title,url:n.src,cover:n.poster,lrc:n.lrc}),e.map(function(e){e.artist=e.artist||"未知艺人",e.name=e.name||u.parseURL(e.url).filename||"未知音乐",e.cover=e.cover||o.imagesRoot()+"audio-cover.png?v="+o.config.version,e.type=e.type||"auto"}),a.api=new l({container:a.$player[0],fixed:n.fixed,mini:n.mini,autoplay:n.autoplay,loop:n.loop,order:n.order,preload:n.preload,audio:e,mutex:n.mutex,lrcType:n.lrcType,listFolded:n.listFolded,listMaxHeight:n.listMaxHeight,storageName:n.storageName,volume:n.muted?0:s.isNumeric(n.volume)?n.volume:.7}),d.map(function(t){a.api.on(t,function(){"play"===t?a.playing=!0:"pause"===t&&(a.playing=!1);var e=Array.prototype.slice.call(arguments);e.shift(),e.unshift(a.api),u.execCallback(a,n[u.camel("on_"+t)],r,e,i,f(t,c))})}),u.triggerPluginReady(i,a,"",p.audioInitialized)},getApi:function(){return this.api},destroy:function(){var e=this;e.api&&(e.playing&&e.api.pause(),e.api.destroy(),e.api=null),e.$wrap.after(e.$element),e.$wrap.remove(),e.playing=!1}},t.KEY=e,t.DEFAULTS={src:"",type:"",poster:"",artist:"",lrc:"",title:"",audio:[],muted:null,autoplay:null,loop:null,preload:null,volume:null,fixed:!1,mini:!1,order:"list",mutex:!0,lrcType:0,listFolded:!1,listMaxHeight:null,storageName:"ba.audio.state"},s.fn.baAudio=a,s.fn.baAudio.Constructor=t,o.plugins.Audio=t,o.autoInit(c,u.pluginAttrs(c),function(){a.call(this)}),t}),define("./ba/plug/autocomplete",["busyAdmin","jquery"],function(s,l){var r=s.e,c=s.helper,o="autocomplete",e=c.pluginKey(o),t=function e(t,a){var n=this;n.element=t;n.$element=l(t);n.options=l.extend(true,{},e.DEFAULTS,n.$element.baData(o),a||{});n.ready(n._init)};function a(e){return c.pluginFn(this,t,e,arguments,"api")}return t.prototype={ready:function(e){var t=this;window.autoComplete?e.call(t):requirejs([s.lib.autocomplete],function(){e.call(t)})},_init:function(){var n=this,o=n.options,e=l.proxy(n.destroy,n);l(document).one(r.appRenderBefore,e);var t=n.$element.closestBaModal();t&&(t.$element.one(r.modalHide,e),o.container||(o.container=t.$container[0])),n.api=new window.autoComplete({container:o.container||document.body,selector:n.element,delay:o.delay,minChars:o.searchMin,menuClass:"ba-autocomplete",onSelect:function(e,t,a){c.execCallback(n,o.onSelect,n.element,[t,l(a)],n.$element,r.autocompleteSelect)},source:function(e,r){if(o.url||o.model)n._abort(),n.task=s.request(o.model?s.getConfig("autocomplete").url:"function"==typeof o.url?o.url():o.url).method(o.method).addHeader("Busy-Admin-Plugin","Autocomplete").params({model:o.model,extend:o.modelExtend?1:0,text_field:o.modelTextField||"",order:o.modelOrder||"",limit:o.modelLimit,word:e}).pending(!1).success(function(e,t,a){var n=[];return l.each(e.result.results||[],function(){var e=(this.text||"").trim();e&&n.push(e)}),r(n),!1}).error(function(e,t,a){return!1}).exec();else{var t=o.list||[],a=[];for(i=0;i<t.length;i++)-1!==t[i].toLowerCase().indexOf(e)&&a.push(t[i]);r(a)}}}),c.triggerPluginReady(n.$element,n,"",r.autocompleteInitialized)},_abort:function(){this.task&&(this.task.abort(),this.task=null)},destroy:function(){this._abort(),this.api&&(this.api.destroy(),this.api=null)}},t.KEY=e,t.DEFAULTS={container:null,list:[],searchMin:1,method:"get",url:!1,delay:250,model:"",modelExtend:!1,modelTextField:"",modelOrder:"",modelLimit:20},l.fn.baAutocomplete=a,l.fn.baAutocomplete.Constructor=t,s.plugins.Autocomplete=t,r.autocompleteInitialized=s.ee("initialized",o),r.autocompleteSelect=s.ee("select",o),s.autoInit(o,c.pluginAttrs(o),function(){a.call(this)}),t}),define("./ba/plug/calendar",["busyAdmin","jquery"],function(a,i){var n=false,r=a.helper,o="calendar",e=r.pluginKey(o);a.e.calendarInitialized=a.ee("initialized",o);var s=function e(t,a){var n=this;n.element=t;n.$element=i(t);n.options=i.extend(true,{},e.DEFAULTS,n.$element.baData(o)||{},a||{});n.ready(n._init)};function t(e){return r.pluginFn(this,s,e,arguments,"api")}return s.prototype={ready:function(e){var t=this;n?e.call(t):requirejs([a.lib.fullcalendar],function(){n=!0,e.call(t)})},_init:function(){var e=this;e.$element.addClass("ba-calendar");var t=e.options;t.themeSystem="bootstrap",t.locale="zh-cn","string"!=typeof t.headerToolbar&&t.headerToolbar||(t.headerToolbar&&s.TOOLBARS.hasOwnProperty(t.headerToolbar)||(t.headerToolbar="default"),t.headerToolbar=s.TOOLBARS[t.headerToolbar]),e.api=new FullCalendar.Calendar(e.element,t),e.api.render(),r.triggerPluginReady(e.$element,e,"",a.e.calendarInitialized)},getApi:function(){return this.api},destroy:function(){this.$element.removeClass("ba-calendar"),this.api&&(this.api.destroy(),this.api=null)}},s.KEY=e,s.DEFAULTS={headerToolbar:"default",selectable:!0,initialView:"dayGridMonth",locale:"zh-cn"},s.TOOLBARS={default:{left:"prev,next today",center:"title",right:"dayGridMonth,timeGridWeek,timeGridDay,listWeek"},mini:{left:"prev,next",center:"title",right:"today"}},i.fn.baCalendar=t,i.fn.baCalendar.Constructor=s,a.plugins.Calendar=s,a.autoInit(o,r.pluginAttrs(o),function(){t.call(this)}),s}),define("./ba/plug/catalog",["busyAdmin","jquery","bootstrap"],function(r,s,e){"use strict";var n=false,l=r.helper,i="catalog",t=l.pluginKey(i);r.e.catalogInitialized=r.ee("initialized",i);var a=function e(t,a){this.$element=s(t);this.options=s.extend(true,{},e.DEFAULTS,this.$element.baData(i)||{},a||{});this.scrollSelector=null;this.ready(this._init)};function o(e){return l.pluginFn(this,a,e,arguments)}return a.prototype={ready:function(t){var a=this;n?t.call(a):requirejs([r.lib.sticky],function(e){n=!0,t.call(a)})},_init:function(){var n=this;n.id=l.uuid();var e=n.$element,i=n.options;i.container&&(e=s(i.container)),e.find(n.getId()).remove(),e.append(n.create()),i.scroll&&(n.scrollSelector=i.scroll,!0===i.scroll&&(n.scrollSelector=document.body),s(n.scrollSelector).scrollspy({target:this.getId(),offset:this.options.top})),i.sticky&&s(n.scrollSelector).is("body")&&s(n.getId()).sticky({topSpacing:this.options.top||0,bottomSpacing:this.options.bottom||0}),e.find(".nav a").on("click",function(e){e.preventDefault();var t=s(this).attr("href");if(0!==t.indexOf("#"))return!0;var a=s(t),e=s(n.scrollSelector),t=a.position().top;return e.is("body")&&(e=s("body,html"),t=a.offset().top),n.isScrollPending=!0,e.animate({scrollTop:t-(i.top||0)},function(){n.isScrollPending=!1}),!1}),s(document).one(r.e.appRenderBefore,s.proxy(n.destroy,n)),l.triggerPluginReady(n.$element,n,"",r.e.catalogInitialized)},create:function(){var e=this.$element.find("h1,h2,h3,h4,h5,h6"),r=[],o=this.options;e.each(function(e){var t=s(this);if(o.filterSelector&&0<t.closest(o.filterSelector).length)return!0;var a=this.tagName.charAt(1),n=(t.attr("id")||"").trim(),i=t.text().trim();if(!i)return!0;n=(n=l.base64Encode(i+":"+a+"_"+e)).replace(/[=\/+]/g,""),t.attr("id",n),r.push({name:i,id:n,level:a})});var t=function e(t){var a='<ul class="nav">';return s.each(t,function(){a+='<li><a href="#'+this.id+'">'+this.name+"</a>"+(this.children?e(this.children):"")+"</li>"}),a+="</ul>"}(this.toTree(r)),e="";return o.title&&(e='<div class="panel-heading ba-catalog-title">'+o.title+"</div>"),'<div class="panel panel-default ba-catalog" id="'+this.id+'">'+e+t+"</div>"},toTree:function(e){var t=[];return function e(t,a){var n=a.shift();for(t.push(n);0<a.length;){if(!n)return;var i=function(e,t){if(e){for(var a=-e.level,n=[],i=0,r=t.length;i<r;i++){var o=t[i];if(!(-o.level<a))break;n.push(o)}return 0<n.length&&t.splice(0,n.length),n}}(n,a,n.level);0!=i.length?(n.children=[],e(n.children,i)):(n=a.shift())&&t.push(n)}}(t,e),t},getId:function(){return"#"+this.id},destroy:function(){var e=this.options;e.scroll&&s(this.scrollSelector).removeData("bs.scrollspy"),e.sticky&&s(this.getId()).unstick()}},a.KEY=t,a.DEFAULTS={title:"目录",container:null,scroll:null,sticky:!1,top:0,bottom:0,filterSelector:null},s.fn.baCatalog=o,s.fn.baCatalog.Constructor=a,r.plugins.Catalog=a,r.autoInit(i,l.pluginAttrs(i),function(){o.call(this)}),a}),define("./ba/plug/changeVerify",["busyAdmin","jquery"],function(e,n){"use strict";var t=e.helper,i="change-verify",a=t.pluginKey(i),r=function e(t,a){this.$element=n(t);this.options=n.extend(true,{},e.DEFAULTS,this.$element.baData(i)||{},a||{});this.source=this.$element.attr("src")};function o(e){return t.pluginFn(this,r,e,arguments,null,function(){this.options.change&&this.change()})}return r.prototype={change:function(){var e=this.source;-1===e.indexOf("?")?e+="?":e+="&",this.$element.attr("src",e+"__rand__t="+Math.random())},destroy:function(){}},r.KEY=a,r.DEFAULTS={change:!0},n.fn.baChangeVerify=o,n.fn.baChangeVerify.Constructor=r,e.plugins.ChangeVerify=r,n("body").on("click."+a,t.pluginAttrs(i),function(e){o.call(n(this))}),r}),define("./ba/plug/checkboxRadio",["busyAdmin","jquery"],function(s,l){var c=s.helper,e=c.pluginKey("checkbox-radio");s.e.checkboxRadioInitialized=s.ee("initialized","checkbox-radio");var t=function e(t,a){var n=this;n.element=t;n.$element=l(t);if(n.element.tagName.toLowerCase()!=="input")return;var i=n.elementType=(n.$element.attr("type")||"").toLowerCase();if(i!=="checkbox"&&i!=="radio")return;n.isRadio=i==="radio";n.options=l.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n._init()};function a(e){return c.pluginFn(this,t,e,arguments)}return t.prototype={_init:function(){var n=this,i=n.$element,r=n.options,e=n.elementType;r.title||(r.title=i.attr("title")||""),n.$icon=l('<i class="bicon" />'),n.$text=l("<span />"),n.$label=l("<label />").append(n.$icon).append(n.$text).on("click",function(){i.trigger("click")});var a=[],t="";l.each((i.attr("class")||"").split(" "),function(e,t){(t=t.trim()).length&&a.push(t)}),-1===a.indexOf("pill")&&-1===a.indexOf("switch")?(a.push("default"),t="default"):-1!==a.indexOf("pill")?t="pill":-1!==a.indexOf("switch")&&(t="switch");var o=i.closest("."+e+"-group");0<o.length&&o.addClass(t),n.$template=l('<div class="ba-'+e+" "+a.join(" ")+'"/>'),n.$template.append(n.$label),n.isSwitch=i.hasClass("switch"),n.switchOn="",n.switchOff="",n.isSwitch?(e=r.title||"",l.isArray(e)||-1===e.indexOf(",")||(e=e.split(",")),l.isArray(e)&&(n.switchOn=e[0]||r.locale.on,n.switchOff=e[1]||r.locale.off),n.$text.html(i.prop("checked")?n.switchOn:n.switchOff)):r.title?(n.$text.html(r.title),n.$template.removeClass("untitled")):(n.$text.addClass("hide"),n.$template.addClass("untitled")),n.requestOptions={},r.url&&(l.extend(!0,n.requestOptions,r),n.requestOptions.headers=l.extend({},n.requestOptions.headers||{},{"Busy-Admin-Plugin":n.isRadio?"Radio":"Checkbox"}),n.requestOptions.params=n.requestOptions.params||{},i.on(s.e.requestError,function(){i.prop("checked",!l(this).prop("checked")).baTriggerEvent("change",{__checkboxRadioNoRequest:!0})})),i.after(n.$template),n.$template.prepend(i),i.on("change",function(e){n._decorate();var t=this.hasAttribute("value"),a=l(this);r.url&&!(e.getBaTriggerParams()||{}).__checkboxRadioNoRequest&&(n.requestOptions.params.status=i.prop("checked")?1:0,n.requestOptions.params.value=t?a.val():"",i.baRequest(n.requestOptions,!0))}),n._decorate(),c.triggerPluginReady(i,n,"",s.e.checkboxRadioInitialized)},_decorate:function(){var e=this,t=e.$element.prop("checked");e.isSwitch&&e.$text.html(t?e.switchOn:e.switchOff)},destroy:function(){this.$template.after(this.$element),this.$template.remove()}},t.INDEX=0,t.KEY=e,t.DEFAULTS={title:"",url:void 0,locale:l.extend({},{on:"开启",off:"关闭"},((s.locale||{}).plugin||{}).checkboxRadio||{})},l.fn.baCheckboxRadio=a,l.fn.baCheckboxRadio.Constructor=t,s.plugins.CheckboxRadio=t,s.autoInit("checkboxRadio",[c.pluginAttrs("checkbox"),c.pluginAttrs("radio")].join(","),function(){a.call(this)}),t}),define("./ba/plug/checkedAll",["busyAdmin","jquery"],function(e,u){"use strict";var t=e.helper.pluginAttrs("checked-all").replace(/\[/g,"input[");u("body").on("change.ba-checked-all",t,function(e){var t=u(this);var a=t.prop("checked");var n=t.attr("data-parent");var i=t.attr("data-child");if(i&&(e.getBaTriggerParams()||{}).__CheckedAllChildNoChange!==true)u("input"+i).not(":disabled").prop("checked",a).baTriggerEvent("change");if(n){var r=true;var o=0;var s=0;var l=u("input"+n);var c=l.data()||{};var d=l.attr("data-child");if(!d)return;u("input"+c.child).each(function(){var e=u(this);if(e.prop("disabled"))return true;var t=e.prop("checked");if(!t&&!this.indeterminate)r=false;if(t)o++;if(this.indeterminate)s++});if(o===0&&s===0){l.each(function(){this.indeterminate=false;u(this).removeClass("indeterminate")});l.prop("checked",false)}else if(!r||s!==0){l.each(function(){this.indeterminate=true;u(this).addClass("indeterminate")});l.prop("checked",false)}else{l.each(function(){this.indeterminate=false;u(this).removeClass("indeterminate")});l.prop("checked",true)}l.baTriggerEvent("change",{__CheckedAllChildNoChange:true})}}),e.autoInit("checkedAll",t,function(){var a="ba.checked-all.api";var n=[];var i=[];u(this).each(function(){var e=u(this);if(e.data(a))return true;e.data(a,true);var t=e.data()||{};if(t.parent&&e.prop("checked")&&-1===n.indexOf(t.parent)){e.baTriggerEvent("change",{__CheckedAllChildNoChange:true});n.push(t.parent)}if(t.child&&e.prop("checked")&&-1===i.indexOf(t.child)){e.baTriggerEvent("change");i.push(t.child)}})})}),define("./ba/plug/colorPicker",["busyAdmin","jquery"],function(s,l){"use strict";var c=s.helper,d=s.e,u=s.ee,p="color-picker",a=false,i=c.pluginKey(p),e="create,showPicker,hidePicker,changeColor,disable,enable".split(",");d.colorPickerInitialized=u("initialized",p),d.colorPickerClear=u("clear",p),e.map(function(e){d[c.camel(p+"_"+e)]=u(e,p)});var t=function e(t,a){var n=this;n.$element=l(t);n.options=l.extend(true,{},e.DEFAULTS,n.$element.baData(p)||{},a||{});n.$form=n.$element.closest("form");n.api=null;n.index=e.INDEX++;n.formStatus=n.$element.baFormStatus(n).render();n.defaultValue=n.options.color;n.resetEvent="reset."+i+n.index;n.$form.on(n.resetEvent,function(){setTimeout(function(){n.setValue(n.defaultValue)},1)});n.ready(n._init)};function n(e){return c.pluginFn(this,t,e,arguments)}return t.INDEX=0,t.prototype={ready:function(e){var t=this;a?e.call(t):requirejs([s.lib.colorPicker],function(){a=!0,e.call(t)})},_init:function(){var i=this,r=i.$element,o=i.options;o.hexNumberSignPrefix=o.hexPrefix,o.colorSelectors=o.selectors,o.customClass="ba-color-picker"+(o.className||""),o.inline&&(o.container=!0),o.sliders={saturation:{maxLeft:150,maxTop:150},hue:{maxTop:150},alpha:{maxTop:150}};var e=l.proxy(i.destroy,i);l(document).one(d.appRenderBefore,e);var t=r.closestBaModal();t&&t.$element.one(d.modalHide,e),o.template='<div class="colorpicker dropdown-menu">    <div class="colorpicker-saturation"><i><b></b></i></div>    <div class="colorpicker-hue"><i></i></div>    <div class="colorpicker-alpha"><i></i></div>    <div class="colorpicker-color"><div></div></div>    <div class="colorpicker-selectors clearfix"></div>    <div class="colorpicker-operate"><button class="btn btn-default btn-xs" type="button">清空</button></div></div>',i.api=r.colorpicker(o).data("colorpicker"),r.on("create showPicker hidePicker changeColor disable enable destroy",function(e){var t,a=[i],n=i.api;"changeColor"===e.type?(a=[i,n.color],n.hasInput()&&n.input.baTriggerEvent("input")):"create"===e.type&&(t=n.picker.find(".colorpicker-operate"),n.hasInput()?(i.defaultValue=i.defaultValue||n.input.val().trim(),t.removeClass("hide"),t.find("button").on("mousedown",function(e){e.preventDefault()}).on("click",function(e){i.setValue(),n.input.blur(),c.execCallback(i,o.onClear,i.element,[],r,d.colorPickerClear),n.hide()})):t.addClass("hide"),s.app.triggerResize(),i.formStatus.rendered()),c.execCallback(i,o[c.camel("on_"+e.type)],i.element,a,r,u(e.type,p))}),c.triggerPluginReady(r,i,"",d.colorPickerInitialized)},setValue:function(e){this.api&&(this.api.setValue(e||"transparent"),!e&&this.api.hasInput()&&this.api.input.val(""))},destroy:function(){var e=this;e.api&&(e.api.destroy(),e.api=null),e.$form.off(e.resetEvent)}},t.KEY=i,t.DEFAULTS={format:"hex",color:!1,component:".add-on, .input-group-addon",input:"input",hexPrefix:!0,inline:!1,container:!1,align:"left",selectors:null,className:""},l.fn.baColorPicker=n,l.fn.baColorPicker.Constructor=t,s.plugins.ColorPicker=t,s.autoInit(p,c.pluginAttrs(p),function(){n.call(this)}),t}),define("./ba/plug/consoleLog",["busyAdmin","jquery"],function(e,r){"use strict";var o=e.helper,t=e.ee,s=e.e,i="console-log",a=o.pluginKey(i);s.consoleLogInitialized=t("initialized",i),s.consoleLogOk=t("ok",i),s.consoleLogCancel=t("cancel",i),s.consoleLogHide=t("hide",i);var l=function e(t,a){var n=this;n.element=t;n.$element=r(t);n.options=r.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n.disabled=false;n._init()};function n(e){return o.pluginFn(this,l,e,arguments,null,function(){this.options.show&&this.show()})}return l.prototype={_init:function(){var n=this,e=n.options,t=e.locale,a=n.$element,i=n.element;!r.baIsEmpty(e.title)&&""!==e.title||(e.title=a.attr("title")||""),""===e.title&&(e.title=t.title),r(document).one(s.appRenderBefore,function(){n.destroy()}),a.baModal({show:!1,content:l.TEMPLATE,className:"ba-console-log-dialog",padding:0,title:e.title,ok:!1!==e.ok&&(e.ok||t.ok),cancel:e.cancel||t.cancel,type:"page",onReady:function(e){var t=e.$container;n.$progress=t.find(".progress").hide(),n.$progressBar=t.find(".progress-bar"),n.$text=t.find(".ba--text"),n.$content=t.find(".ba--content"),n.$title=t.find(".ba--title"),n.$loader=t.find(".ba-loader"),n.$refreshBtn=r('<button type="button" class="btn btn-outline-secondary"><i class="fa fa-refresh"></i></button>'),n.$wrapBtn=r('<button type="button" class="btn btn-outline-secondary"><i class="fa fa-text-height"></i></button>'),n.$ok=e.$okBtn,n.$content.on("mouseover",function(){n.mouse=!0}).on("mouseout",function(){n.mouse=!1}).on("scroll",function(e){clearTimeout(n.scrollTimer),n.scrollTimer=setTimeout(function(){n.disabled=n.$text.height()>n.$content.scrollTop()+n.$content.height()},10)}),n.load(!0),e.$dialogFooter.prepend(r('<div class="btn-group"/>').append(n.$refreshBtn).append(n.$wrapBtn)),n.$refreshBtn.on("click.ba",function(){n.refresh()});var a=n.$wrapBtn;a.on("click.ba",function(){var e=a.find("i").removeClass("fa-text-width fa-text-height");a.removeClass("btn-outline-secondary btn-primary"),n.$text.hasClass("ba--wrap")?(a.addClass("btn-outline-secondary"),e.addClass("fa-text-height"),n.$text.removeClass("ba--wrap")):(a.addClass("btn-primary"),e.addClass("fa-text-width"),n.$text.addClass("ba--wrap"))})},onOk:function(){e.okUrl&&(e.okBlank?window.open(e.okUrl):self.location.href=e.okUrl),o.execCallback(n,e.onOk,i,[n.result],a,s.consoleLogOk)},onCancel:function(){o.execCallback(n,e.onCancel,i,[],a,s.consoleLogCancel)},onHide:function(){o.execCallback(n,e.onHide,i,[],a,s.consoleLogHide),n.destroy()}},!0),o.triggerPluginReady(a,n,"",s.consoleLogInitialized)},load:function(r){var o=this;r&&(o.$loader.show(),o.$ok.prop("disabled",!0).addClass("disabled")),o.task=e.request(e.getConfig("consoleLog").url).addHeader("Busy-Admin-Plugin","ConsoleLog").params({id:o.options.id}).pending(!1).complete(function(){o.$loader.hide()}).success(function(e){var t=o.result=e.result,a=2==t.type||3==t.type;o.setTitle(t.message,t.level),t.progress?(o.$progress.show(),e=t.percentage,e=Math.max(e,0),e=Math.min(e,100),o.$progressBar.toggleClass("no-transition",100<=e).addClass("progress-bar-striped active").css("width",e+"%").text(e.toFixed(2)+"%"),a&&o.$progressBar.removeClass("progress-bar-striped active")):o.$progress.hide(),o.resetView(),r&&o.$text.empty();var n="",i=0;return t.list.map(function(e){var t;e.back.map(function(e){o.remove(e)}),!1!==e.percentage?(i=Math.min(e.percentage,100),4==(t=(i=Math.max(i,0)).toFixed(2)).length?t="00"+t:5==t.length&&(t="0"+t),n="[ "+t+"% ] "):100<=i&&(n=""),o.append(e.id,e.message.replace(/\n/g,"<br />"),e.level,n)}),o.toBottom(),a?(clearTimeout(o.timer),2==t.type&&o.$ok.prop("disabled",!1).removeClass("disabled")):o._countdown(),!1}).error(function(e){return r&&o.$text.empty(),4010001===e.code?o.append("",e.message,"record"):(o._countdown(),o.append("",e.message,"error"),o.setTitle(e.message,"error"),o.toBottom(),o.resetView()),!1}).exec()},show:function(){this.$element.baModal("show")},close:function(){this.$element.baModal("close")},setTitle:function(e,t){this.$element.baModal("setTitle",this.options.title+'<small><span class="ba--'+t+'">'+e+"</span></small>")},resetView:function(){this.$element.baModal("resetView")},append:function(e,t,a,n){this.$text&&((e=e||"")&&(this.remove(e),e="console_log_"+e),t=t.replace(/<([a-z]+)>(.*?)<\/([a-z]+)>/gi,'<span class="ba--$1">$2</span>'),this.$text.append('<div id="'+e+'">'+(n||"")+'<span class="ba--line ba--'+(a||"record")+'">'+t+"</span></div>"))},remove:function(e){this.$text&&this.$text.find("#console_log_"+e).remove()},toBottom:function(){this.$content&&!this.disabled&&this.$content.scrollTop(this.$text.height())},refresh:function(){this._clear(),this.load(!0)},_countdown:function(){var e=this;clearTimeout(e.timer),e.timer=setTimeout(function(){e.load()},50)},_clear:function(){var e=this;e.result=null,e.disabled=!1,clearTimeout(e.timer),clearTimeout(e.scrollTimer),e.task&&(e.task.abort(),e.task=null)},destroy:function(){this._clear()}},l.TEMPLATE='<div class="ba-console-log"><div class="progress"><div class="progress-bar progress-bar-success" style="width: 0">0%</div></div><div class="ba--content"><div class="ba--text"></div></div></div><div class="ba-loader ba-loader-inline"><div></div></div>',l.KEY=a,l.DEFAULTS={title:null,ok:null,okUrl:null,okBlank:!1,cancel:null,onOk:null,onCancel:null,onHide:null,show:!0,locale:r.extend({},{title:"执行日志",ok:"完成",cancel:"关闭"},((e.locale||{}).plugin||{}).consoleLog||{})},r.fn.baConsoleLog=n,r.fn.baConsoleLog.Constructor=l,e.plugins.ConsoleLog=l,e.regSugar(i,function(e,t,a){(e="show"===e?"":e)?r(this).baConsoleLog(e,t):(t||-1===[s.requestSuccess,s.formSuccess].indexOf(a.event)||(a=((a.args[0]||{}).result||{}).console_log||!1)&&(t={id:a.id,okUrl:a.operate_url||null,okBlank:a.operate_blank||!1},a.operate_name&&(t.ok=a.operate_name)),r(this).baConsoleLog("object"===(void 0===t?"undefined":_typeof(t))?t:{},!0))}),r("body").on("click."+a,o.pluginAttrs(i),function(){n.call(r(this))}),l}),define("./ba/plug/copy",["busyAdmin","jquery"],function(o,s){var l=null,c=o.helper,d=o.e,e=o.ee,i="copy",t=c.pluginKey(i),a=function e(t,a){var n=this;n.element=t;n.$element=s(t);n.options=s.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n.ready(n._init)};function n(e){return c.pluginFn(this,a,e,arguments,"api")}return a.prototype={ready:function(t){var a=this;l?t.call(a):requirejs([o.lib.clipboard],function(e){l=e,t.call(a)})},_init:function(){var a=this,n=a.options,i=a.$element,r=a.element,e={action:function(){return n.action||"copy"},text:function(e){var t="",e=s(e);return n.content?t=n.content:n.target&&(t=!0===n.target?a.getText(e):a.getText(s(n.target))),"html"===n.onDecode?t=c.escapeToHtml(t):"string"==typeof(e=c.execCallback(a,n.onDecode,r,[t],i,d.copyDecode,!0,"string",!0))&&(t=e),t}};n.target&&!0!==n.target&&(e.target=function(e){return s(n.target)[0]}),a.api=new l(r,e),a.api.on("success",function(e){e.clearSelection(),"cut"===n.action&&n.target&&(!0===n.target?i:s(n.target)).val(""),!1!==c.execCallback(a,n.onSuccess,r,[],i,d.copySuccess,!0,!1)&&o.dialog.toast("cut"===n.action?n.locale.cutSuccess:n.locale.copySuccess)}),a.api.on("error",function(){!1!==c.execCallback(a,n.onError,r,[],i,d.copyError,!0,!1)&&o.dialog.toast("cut"===n.action?n.locale.cutError:n.locale.copyError)}),c.triggerPluginReady(i,a,"",d.copyInitialized)},getApi:function(){return this.api},getText:function(e){e=e.is(":text")?e.val():e.html();return e},destroy:function(){this.api&&this.api.destroy()}},a.KEY=t,a.DEFAULTS={target:null,onDecode:null,onSuccess:null,onError:null,locale:s.extend({copySuccess:"复制成功",copyError:"复制失败",cutSuccess:"剪切成功",cutError:"剪切失败"},((o.locale||{}).plugin||{}).copy||{})},s.fn.baCopy=n,s.fn.baCopy.Constructor=a,o.plugins.Copy=a,d.copyInitialized=e("initialized",i),d.copySuccess=e("success",i),d.copyError=e("error",i),d.copyDecode=e("decode",i),o.autoInit(i,c.pluginAttrs(i),function(){n.call(this)}),a}),define("./ba/plug/datePicker",["busyAdmin","jquery"],function(n,U){"use strict";var q,Y=n.helper,H=Y.sprintf,e=n.ee,V=n.e,r="date-picker",i=Y.pluginKey(r),W=function e(t){return t+"."+i},t=function e(t,a,n){var i=this;i.parentEl="body";i.element=U(t);i.minDate=false;i.maxDate=false;i.maxSpan=false;i.singleDatePicker=false;i.showDropdowns=true;i.showWeekNumbers=false;i.showISOWeekNumbers=false;i.showCustomRangeLabel=true;i.timePicker=false;i.timePicker24Hour=true;i.timePickerIncrement=1;i.timePickerSeconds=true;i.timePickerMinute=true;i.linkedCalendars=false;i.autoUpdateInput=false;i.alwaysShowCalendars=false;i.pickerType="date";i.ranges={};i.moveTimer=null;i.valueTarget=null;i.hideClearBtn=false;i.force=false;i.sourceContent="";i.startTarget=null;i.endTarget=null;i.callback=typeof n==="function"?n:U.noop;i.isShowing=false;i.leftCalendar={};i.rightCalendar={};i.opens="right";if(i.element.hasClass("pull-right"))i.opens="left";i.drops="down";if(i.element.hasClass("dropup"))i.drops="up";i.buttonClasses="btn btn-sm";i.applyButtonClasses="btn-primary";i.nowButtonClasses="btn-default";i.clearButtonClasses="btn-default";i.options=U.extend(true,{},e.DEFAULTS,i.element.baData(r)||{},a||{});i.locale=i.options.locale;i.ready(i._init)};function a(e){return Y.pluginFn(this,t,e,arguments,[],function(){this.ready(this.show)})}t.prototype={constructor:t,ready:function e(t){var a=this;if(q)t.call(a);else requirejs([n.lib.moment],function(e){q=e;t.call(a)})},_init:function e(){var t=this;var a=t.options;var n=t.locale;var i=t.element;t.startDate=t.getInitStartDate();t.endDate=t.getInitEndDate();t.minYear=q().subtract(100,"year").format("YYYY");t.maxYear=q().add(100,"year").format("YYYY");n.firstDay=q.localeData().firstDayOfWeek();if(a.format){n.format=a.format;var r="date";var o=a.format;var s=o.indexOf("Y")!==-1;var l=o.indexOf("M")!==-1;var c=o.indexOf("D")!==-1;var d=o.indexOf("H")!==-1;var u=o.indexOf("m")!==-1;var p=o.indexOf("s")!==-1;var f=true;var h=true;if(s&&l&&c){if(d||u||p)r="datetime"}else if(s&&l)r="month";else if(s)r="year";else if(d||u||p)r="time";if(!u){f=false;h=false}else if(!p)h=false;a.pickerType=r;a.timePickerSeconds=h;a.timePickerMinute=f}if(a.range){a.singleDatePicker=false;if(a.range!==true)n.separator=a.range;if(typeof a.ranges!=="string"&&a.ranges!==false)if(a.pickerType==="year"){var m=q().startOf("year");var g=m.clone().subtract(1,"year");a.ranges={};a.ranges[n.thisYear]=[m,m];a.ranges[n.lastYear]=[g,g];a.ranges[H(n.lastNYear,"2")]=[g,m];a.ranges[H(n.lastNYear,"3")]=[g.clone().subtract(2,"year"),m];a.ranges[H(n.lastNYear,"6")]=[g.clone().subtract(5,"year"),m]}else if(a.pickerType==="month"){var v=q().startOf("month");var b=v.clone().subtract(1,"month");a.ranges={};a.ranges[n.thisMonth]=[v,v];a.ranges[n.lastMonth]=[b,b];a.ranges[H(n.lastNMonth,"2")]=[b.clone(),v];a.ranges[H(n.lastNMonth,"3")]=[b.clone().subtract(2,"month"),v];a.ranges[H(n.lastNMonth,"6")]=[b.clone().subtract(5,"month"),v]}else if(a.pickerType==="time"){a.ranges={};a.ranges[n.todayToNow]=[q().startOf("days"),q()];a.ranges[H(n.lastNHours,"1")]=[q().subtract(1,"hours"),q()];a.ranges[H(n.lastNHours,"2")]=[q().subtract(2,"hours"),q()];a.ranges[H(n.lastNHours,"3")]=[q().subtract(3,"hours"),q()];a.ranges[H(n.lastNHours,"6")]=[q().subtract(6,"hours"),q()];a.ranges[H(n.lastNHours,"12")]=[q().subtract(12,"hours"),q()];a.ranges[n.forenoon]=[q().startOf("days"),q().startOf("days").add(12,"hours")];a.ranges[n.afternoon]=[q().startOf("days").add(12,"hours"),q().endOf("days")];a.ranges[n.allDay]=[q().startOf("days"),q().endOf("days")]}else{a.ranges={};a.ranges[n.today]=[q().startOf("days"),q().endOf("days")];a.ranges[n.yesterday]=[q().startOf("days").subtract(1,"days"),q().endOf("days").subtract(1,"days")];a.ranges[H(n.lastNDay,"7")]=[q().startOf("days").subtract(6,"days"),q().endOf("days")];a.ranges[H(n.lastNDay,"30")]=[q().startOf("days").subtract(29,"days"),q().endOf("days")];a.ranges[n.thisMonth]=[q().startOf("month"),q().endOf("month")];a.ranges[n.lastMonth]=[q().subtract(1,"month").startOf("month"),q().subtract(1,"month").endOf("month")]}else if(a.ranges!==false)a.ranges=window[a.ranges]||false;if(typeof a.span==="string"&&a.span){var y=(a.span||"").split(",");for(var $=0;$<y.length;$++)y[$]=y[$].trim();var w=Y.int((y[0]||"0").trim());var x=Y.int((y[1]||"0").trim());var k=Y.int((y[2]||"0").trim());var C=Y.int((y[3]||"0").trim());var $=Y.int((y[4]||"0").trim());var S=Y.int((y[5]||"0").trim());a.span={};if(w>0)a.span.year=w-1;if(x>0)a.span.month=x-1;if(k>0)a.span.days=k-1;if(C>0)a.span.hours=C-1;if($>0)a.span.minute=$-1;if(S>0)a.span.secoud=S-1}}else a.singleDatePicker=true;if(typeof a.template!=="string"&&!(a.template instanceof U))a.template='<div class="ba-date-picker">    <div class="ranges"></div>    <div class="drp-calendar left">        <div class="calendar-table"></div>        <div class="calendar-time"></div>    </div>    <div class="drp-calendar right">        <div class="calendar-table"></div>        <div class="calendar-time"></div>    </div>    <div class="drp-buttons">        <span class="drp-selected"></span>        <div class="btn-group">            <button class="clearBtn" type="button"></button>            <button class="nowBtn" type="button"></button>            <button class="applyBtn" disabled="disabled" type="button"></button>        </div>    </div>    <div class="arrow"></div></div>';var _=U.proxy(t.destroy,t);U(document).one(V.appRenderBefore,_);var T=i.closestBaModal();if(T){T.$element.one(V.modalHide,_);if(!a.parentEl)a.parentEl=T.$container}t.parentEl=a.parentEl&&U(a.parentEl).length?U(a.parentEl):U(t.parentEl);t.container=U(a.template).appendTo(t.parentEl);var E=t.container.addClass(n.direction);t.$arrow=E.find(".arrow");if(typeof a.valueTarget==="string")t.valueTarget=a.valueTarget;if(typeof a.startDate==="string")t.startDate=q(a.startDate,n.format);if(typeof a.endDate==="string")t.endDate=q(a.endDate,n.format);if(typeof a.minDate==="string")t.minDate=q(a.minDate,n.format);if(typeof a.maxDate==="string")t.maxDate=q(a.maxDate,n.format);if(_typeof(a.startDate)==="object")t.startDate=q(a.startDate);if(_typeof(a.endDate)==="object")t.endDate=q(a.endDate);if(_typeof(a.minDate)==="object")t.minDate=q(a.minDate);if(_typeof(a.maxDate)==="object")t.maxDate=q(a.maxDate);if(t.minDate&&t.startDate.isBefore(t.minDate))t.startDate=t.minDate.clone();if(t.maxDate&&t.endDate.isAfter(t.maxDate))t.endDate=t.maxDate.clone();if(typeof a.applyButtonClasses==="string")t.applyButtonClasses=a.applyButtonClasses;if(typeof a.applyClass==="string")t.applyButtonClasses=a.applyClass;if(typeof a.nowButtonClasses==="string")t.nowButtonClasses=a.nowButtonClasses;if(typeof a.nowClass==="string")t.nowButtonClasses=a.nowClass;if(typeof a.clearButtonClasses==="string")t.clearButtonClasses=a.clearButtonClasses;if(typeof a.clearClass==="string")t.nowButtonClasses=a.clearClass;if(_typeof(a.span)==="object")t.maxSpan=a.span;if(typeof a.opens==="string")t.opens=a.opens;if(typeof a.drops==="string")t.drops=a.drops;if(typeof a.showWeekNumbers==="boolean")t.showWeekNumbers=a.showWeekNumbers;if(typeof a.showISOWeekNumbers==="boolean")t.showISOWeekNumbers=a.showISOWeekNumbers;if(typeof a.buttonClasses==="string")t.buttonClasses=a.buttonClasses;if(_typeof(a.buttonClasses)==="object")t.buttonClasses=a.buttonClasses.join(" ");if(typeof a.showDropdowns==="boolean")t.showDropdowns=a.showDropdowns;if(typeof a.minYear==="number")t.minYear=a.minYear;if(typeof a.maxYear==="number")t.maxYear=a.maxYear;if(typeof a.custom==="boolean")t.showCustomRangeLabel=a.custom;if(typeof a.singleDatePicker==="boolean"){t.singleDatePicker=a.singleDatePicker;if(t.singleDatePicker)t.endDate=t.startDate.clone()}if(typeof a.timePicker==="boolean")t.timePicker=a.timePicker;if(typeof a.timePickerMinute==="boolean")t.timePickerMinute=a.timePickerMinute;if(typeof a.timePickerSeconds==="boolean")t.timePickerSeconds=a.timePickerSeconds;if(typeof a.timePickerIncrement==="number")t.timePickerIncrement=a.timePickerIncrement;if(typeof a.timePicker24Hour==="boolean")t.timePicker24Hour=a.timePicker24Hour;if(typeof a.input==="boolean")t.autoUpdateInput=a.input;if(typeof a.link==="boolean")t.linkedCalendars=a.link;if(typeof a.isInvalidDate==="function")t.isInvalidDate=a.isInvalidDate;if(typeof a.isCustomDate==="function")t.isCustomDate=a.isCustomDate;if(typeof a.alwaysShowCalendars==="boolean")t.alwaysShowCalendars=a.alwaysShowCalendars;if(typeof a.clear==="boolean")t.hideClearBtn=!a.clear;if(typeof a.force==="boolean"){t.force=a.force;t.sourceContent=i.html()}if(n.firstDay!=0){var D=n.firstDay;while(D>0){n.daysOfWeek.push(n.daysOfWeek.shift());D--}}var I,P,R;if(typeof a.startDate==="undefined"&&typeof a.endDate==="undefined")if(U(i).is(":text")){var F=U(i).val();var A=F.split(n.separator);I=P=null;if(A.length==2){I=q(A[0],n.format);P=q(A[1],n.format)}else if(t.singleDatePicker&&F!==""){I=q(F,n.format);P=q(F,n.format)}if(I!==null&&P!==null){t.setStartDate(I);t.setEndDate(P)}}if(typeof a.startTarget==="string"){t.startTarget=a.startTarget;a.ranges=false}if(typeof a.endTarget==="string")t.endTarget=a.endTarget;if(_typeof(a.ranges)==="object"){var B="day";if(t.timePicker&&t.timePickerMinute&&t.timePickerSeconds)B="second";else if(t.timePicker&&t.timePickerMinute)B="minute";else if(t.timePicker)B="hours";else if(t.pickerType==="month"||t.pickerType==="year")B=t.pickerType;for(R in a.ranges){if(typeof a.ranges[R][0]==="string")I=q(a.ranges[R][0],n.format);else I=q(a.ranges[R][0]);if(typeof a.ranges[R][1]==="string")P=q(a.ranges[R][1],n.format);else P=q(a.ranges[R][1]);if(t.minDate&&I.isBefore(t.minDate))I=t.minDate.clone();var M=t.maxDate;if(t.maxSpan&&M){if(I.clone().add(t.maxSpan).isAfter(M))M=I.clone().add(t.maxSpan)}else if(t.maxSpan)M=I.clone().add(t.maxSpan);if(M&&P.isAfter(M,B))continue;if(t.minDate&&P.isBefore(t.minDate,B)||M&&I.isAfter(M,B))continue;var L=document.createElement("textarea");L.innerHTML=R;var z=L.value;t.ranges[z]=[I,P]}var O="<ul>";for(R in t.ranges)O+='<li data-range-key="'+R+'">'+R+"</li>";if(t.showCustomRangeLabel)O+='<li data-range-key="'+n.customRangeLabel+'">'+n.customRangeLabel+"</li>";if(!t.hideClearBtn)O+='<li data-range-key="'+n.clearLabel+'">'+n.clearLabel+"</li>";O+="</ul>";E.find(".ranges").prepend(O)}if(typeof a.pickerType==="string"&&a.pickerType.length){t.pickerType=a.pickerType;if(a.pickerType==="datetime"||a.pickerType==="time")t.timePicker=true}if(!t.timePicker){t.startDate=t.startDate.startOf("day");t.endDate=t.endDate.endOf("day");E.find(".calendar-time").hide()}if(_typeof(a.ranges)==="object")E.addClass("show-ranges");if(t.singleDatePicker){E.addClass("single");E.find(".drp-calendar.left").addClass("single");E.find(".drp-calendar.left").show();E.find(".drp-calendar.right").hide()}if(typeof a.ranges==="undefined"&&!t.singleDatePicker||t.alwaysShowCalendars)E.addClass("show-calendar");E.addClass("opens"+t.opens);E.find(".applyBtn, .nowBtn, .clearBtn").addClass(t.buttonClasses);if(t.applyButtonClasses.length)E.find(".applyBtn").addClass(t.applyButtonClasses);if(t.nowButtonClasses.length)E.find(".nowBtn").addClass(t.nowButtonClasses);if(t.clearButtonClasses.length)E.find(".clearBtn").addClass(t.clearButtonClasses);E.find(".applyBtn").html(n.applyLabel);E.find(".nowBtn").html(n.nowLabel);E.find(".clearBtn").html(n.clearLabel);if(t.autoUpdateInput||t.hideClearBtn)E.find(".clearBtn").remove();var N=W("click");E.find(".drp-calendar").on(N,".prev",U.proxy(t.clickPrev,t)).on(N,".next",U.proxy(t.clickNext,t)).on(N,"td.available,span.col-xs-4.available",U.proxy(t.clickDate,t)).on(W("mouseenter"),"td.available,span.col-xs-4.available",U.proxy(t.hoverDate,t)).on(N,"span.year-select",U.proxy(t.showYearView,t)).on(N,"span.month-select",U.proxy(t.showMonthView,t)).on(W("change"),"select.hourselect,select.minuteselect,select.secondselect,select.ampmselect",U.proxy(t.timeChanged,t)).on(N,"span.available.time-picker-item",U.proxy(t.timeChanged,t));E.find(".ranges").on(N,"li",U.proxy(t.clickRange,t));E.find(".drp-buttons").on(N,"button.applyBtn",U.proxy(t.clickApply,t)).on(N,"button.clearBtn",U.proxy(t.clickClear,t)).on(N,"button.nowBtn",U.proxy(t.clickNow,t));if(i.is(":text")||i.is("button")){var j={};j[N]=U.proxy(t.show,t);j[W("focus")]=U.proxy(t.show,t);j[W("keyup")]=U.proxy(t.elementChanged,t);j[W("keydown")]=U.proxy(t.keydown,t);i.on(j)}else{i.on(N,U.proxy(t.toggle,t));i.on(W("keydown"),U.proxy(t.toggle,t))}i.data("ba.date.picker",t);t.updateElement()},getTopWrap:function e(t){return t.parents(".drp-calendar")},isLeft:function e(t){return t.hasClass("left")},isYearPicker:function e(t){return t.closest(".table-year-view").length>0},isMonthPicker:function e(t){return t.closest(".table-month-view").length>0},isAvailable:function e(t){return t.hasClass("available")},setStartDate:function e(t){var a=this;if(typeof t==="string")a.startDate=q(t,a.locale.format);if((typeof t==="undefined"?"undefined":_typeof(t))==="object")a.startDate=q(t);if(!a.timePicker)a.startDate=a.startDate.startOf("day");if(a.timePicker&&a.timePickerIncrement)a.startDate.minute(Math.round(a.startDate.minute()/a.timePickerIncrement)*a.timePickerIncrement);if(a.minDate&&a.startDate.isBefore(a.minDate)){a.startDate=a.minDate.clone();if(a.timePicker&&a.timePickerIncrement)a.startDate.minute(Math.round(a.startDate.minute()/a.timePickerIncrement)*a.timePickerIncrement)}if(a.maxDate&&a.startDate.isAfter(a.maxDate)){a.startDate=a.maxDate.clone();if(a.timePicker&&a.timePickerIncrement)a.startDate.minute(Math.floor(a.startDate.minute()/a.timePickerIncrement)*a.timePickerIncrement)}if(!a.isShowing)a.updateElement();a.updateMonthsInView()},setEndDate:function e(t){var a=this;if(typeof t==="string")a.endDate=q(t,a.locale.format);if((typeof t==="undefined"?"undefined":_typeof(t))==="object")a.endDate=q(t);if(!a.timePicker)a.endDate=a.endDate.endOf("day");if(a.timePicker&&a.timePickerIncrement)a.endDate.minute(Math.round(a.endDate.minute()/a.timePickerIncrement)*a.timePickerIncrement);if(a.endDate.isBefore(a.startDate))a.endDate=a.startDate.clone();if(a.maxDate&&a.endDate.isAfter(a.maxDate))a.endDate=a.maxDate.clone();if(a.maxSpan&&a.startDate.clone().add(a.maxSpan).isBefore(a.endDate))a.endDate=a.startDate.clone().add(a.maxSpan);a.previousRightTime=a.endDate.clone();a.container.find(".drp-selected").html(a.startDate.format(a.locale.format)+a.locale.separator+a.endDate.format(a.locale.format));if(!a.isShowing)a.updateElement();a.updateMonthsInView()},isInvalidDate:function e(){return false},isCustomDate:function e(){return false},updateView:function e(){var t=this;if(t.timePicker)if(!t.endDate)t.container.find(".right .calendar-time select").prop("disabled",true).addClass("disabled");else t.container.find(".right .calendar-time select").prop("disabled",false).removeClass("disabled");if(t.endDate)t.container.find(".drp-selected").html(t.startDate.format(t.locale.format)+t.locale.separator+t.endDate.format(t.locale.format));t.updateMonthsInView();t.updateCalendars();t.updateFormInputs();if(t.timePicker){t.renderTimePicker("left");t.renderTimePicker("right")}},updateMonthsInView:function e(){var t=this;if(t.pickerType==="year"||t.pickerType==="month"){if(t.endDate){if(!t.singleDatePicker&&t.leftCalendar.month&&t.rightCalendar.month&&(t.startDate.year()==t.leftCalendar.month.year()||t.startDate.year()==t.rightCalendar.month.year())&&(t.endDate.year()==t.leftCalendar.month.year()||t.endDate.year()==t.rightCalendar.month.year()))return;t.leftCalendar.month=t.startDate.clone().startOf("year");if(!t.linkedCalendars&&t.endDate.year()!=t.startDate.year())t.rightCalendar.month=t.endDate.clone().startOf("year");else t.rightCalendar.month=t.startDate.clone().startOf("year").add(1,"year")}else if(t.leftCalendar.month.year()!=t.startDate.year()&&t.rightCalendar.month.year()!=t.startDate.year()){t.leftCalendar.month=t.startDate.clone().startOf("year");t.rightCalendar.month=t.startDate.clone().startOf("year").add(1,"year")}if(t.maxDate&&t.linkedCalendars&&!t.singleDatePicker&&t.rightCalendar.year()>t.maxDate.year()){t.rightCalendar.month=t.maxDate.clone().startOf("year");t.leftCalendar.month=t.maxDate.clone().startOf("year").subtract(1,"year")}return}if(t.endDate){if(!t.singleDatePicker&&t.leftCalendar.month&&t.rightCalendar.month&&(t.startDate.format("YYYY-MM")==t.leftCalendar.month.format("YYYY-MM")||t.startDate.format("YYYY-MM")==t.rightCalendar.month.format("YYYY-MM"))&&(t.endDate.format("YYYY-MM")==t.leftCalendar.month.format("YYYY-MM")||t.endDate.format("YYYY-MM")==t.rightCalendar.month.format("YYYY-MM")))return;t.leftCalendar.month=t.startDate.clone().date(2);if(!t.linkedCalendars&&(t.endDate.month()!=t.startDate.month()||t.endDate.year()!=t.startDate.year()))t.rightCalendar.month=t.endDate.clone().date(2);else t.rightCalendar.month=t.startDate.clone().date(2).add(1,"month")}else if(t.leftCalendar.month.format("YYYY-MM")!=t.startDate.format("YYYY-MM")&&t.rightCalendar.month.format("YYYY-MM")!=t.startDate.format("YYYY-MM")){t.leftCalendar.month=t.startDate.clone().date(2);t.rightCalendar.month=t.startDate.clone().date(2).add(1,"month")}if(t.maxDate&&t.linkedCalendars&&!t.singleDatePicker&&t.rightCalendar.month>t.maxDate){t.rightCalendar.month=t.maxDate.clone().date(2);t.leftCalendar.month=t.maxDate.clone().date(2).subtract(1,"month")}},updateCalendars:function e(){var t=this;if(t.timePicker){var a,n,i;if(t.endDate){a=parseInt(t.container.find(".left .hourselect").val(),10);n=parseInt(t.container.find(".left .minuteselect").val(),10);if(isNaN(n))n=parseInt(t.container.find(".left .minuteselect option:last").val(),10);i=t.timePickerSeconds?parseInt(t.container.find(".left .secondselect").val(),10):0;if(!t.timePicker24Hour){var r=t.container.find(".left .ampmselect").val();if(r==="PM"&&a<12)a+=12;if(r==="AM"&&a===12)a=0}}else{a=parseInt(t.container.find(".right .hourselect").val(),10);n=parseInt(t.container.find(".right .minuteselect").val(),10);if(isNaN(n))n=parseInt(t.container.find(".right .minuteselect option:last").val(),10);i=t.timePickerSeconds?parseInt(t.container.find(".right .secondselect").val(),10):0;if(!t.timePicker24Hour){var r=t.container.find(".right .ampmselect").val();if(r==="PM"&&a<12)a+=12;if(r==="AM"&&a===12)a=0}}t.leftCalendar.month.hour(a).minute(n).second(i);t.rightCalendar.month.hour(a).minute(n).second(i)}t.renderCalendar("left");t.renderCalendar("right");if(t.pickerType==="year"){t.renderYearOrMonth(true,true);t.renderYearOrMonth(false,true)}else if(t.pickerType==="month"){t.renderYearOrMonth(true,false);t.renderYearOrMonth(false,false)}t.container.find(".ranges li").removeClass("active");if(t.endDate==null)return;t.calculateChosenLabel()},renderCalendar:function e(t){var a=this;var n=t=="left"?a.leftCalendar:a.rightCalendar;var i=n.month.month();var r=n.month.year();var o=n.month.hour();var s=n.month.minute();var l=n.month.second();var c=q([r,i]).daysInMonth();var d=q([r,i,1]);var u=q([r,i,c]);var p=q(d).subtract(1,"month").month();var f=q(d).subtract(1,"month").year();var h=q([f,p]).daysInMonth();var m=d.day();var g=[];g.firstDay=d;g.lastDay=u;for(var v=0;v<6;v++)g[v]=[];var b=h-m+a.locale.firstDay+1;if(b>h)b-=7;if(m==a.locale.firstDay)b=h-6;var y=q([f,p,b,12,s,l]);var $,w;for(var v=0,$=0,w=0;v<42;v++,$++,y=q(y).add(24,"hour")){if(v>0&&$%7===0){$=0;w++}g[w][$]=y.clone().hour(o).minute(s).second(l);y.hour(12);if(a.minDate&&g[w][$].format("YYYY-MM-DD")==a.minDate.format("YYYY-MM-DD")&&g[w][$].isBefore(a.minDate)&&t=="left")g[w][$]=a.minDate.clone();if(a.maxDate&&g[w][$].format("YYYY-MM-DD")==a.maxDate.format("YYYY-MM-DD")&&g[w][$].isAfter(a.maxDate)&&t=="right")g[w][$]=a.maxDate.clone()}if(t=="left")a.leftCalendar.calendar=g;else a.rightCalendar.calendar=g;var x=t=="left"?a.minDate:a.startDate;var k=a.maxDate;var C='<table class="table-condensed">';C+="<thead>";C+="<tr>";if(a.showWeekNumbers||a.showISOWeekNumbers)C+="<th></th>";if((!x||x.isBefore(g.firstDay))&&(!a.linkedCalendars||t=="left"))C+='<th class="prev available"><span></span></th>';else C+="<th></th>";var S=g[1][1].format("YYYY"+a.locale.yearName)+" "+a.locale.monthNames[g[1][1].month()];if(a.showDropdowns)S='<span class="year-select">'+g[1][1].format("YYYY"+a.locale.yearName)+'</span><span class="month-select">'+a.locale.monthNames[g[1][1].month()]+"</span>";C+='<th colspan="5" class="month">'+S+"</th>";if((!k||k.isAfter(g.lastDay))&&(!a.linkedCalendars||t=="right"||a.singleDatePicker))C+='<th class="next available"><span></span></th>';else C+="<th></th>";C+="</tr>";C+='<tr class="week-bar">';if(a.showWeekNumbers||a.showISOWeekNumbers)C+='<th class="week">'+a.locale.weekLabel+"</th>";U.each(a.locale.daysOfWeek,function(e,t){C+="<th>"+t+"</th>"});C+="</tr>";C+="</thead>";C+="<tbody>";if(a.endDate==null&&a.maxSpan){var _=a.startDate.clone().add(a.maxSpan).endOf("day");if(!k||_.isBefore(k))k=_}for(var w=0;w<6;w++){C+="<tr>";if(a.showWeekNumbers)C+='<td class="week">'+g[w][0].week()+"</td>";else if(a.showISOWeekNumbers)C+='<td class="week">'+g[w][0].isoWeek()+"</td>";for(var $=0;$<7;$++){var T=[];if(g[w][$].isSame(new Date,"day"))T.push("today");if(g[w][$].isoWeekday()>5)T.push("weekend");if(g[w][$].month()!=g[1][1].month())T.push("off","ends");if(a.minDate&&g[w][$].isBefore(a.minDate,"day"))T.push("off","disabled");if(k&&g[w][$].isAfter(k,"day"))T.push("off","disabled");if(a.isInvalidDate(g[w][$]))T.push("off","disabled");if(g[w][$].format("YYYY-MM-DD")==a.startDate.format("YYYY-MM-DD"))T.push("active","start-date");if(a.endDate!=null&&g[w][$].format("YYYY-MM-DD")==a.endDate.format("YYYY-MM-DD"))T.push("active","end-date");if(a.endDate!=null&&g[w][$]>a.startDate&&g[w][$]<a.endDate)T.push("in-range");var E=a.isCustomDate(g[w][$]);if(E!==false)if(typeof E==="string")T.push(E);else Array.prototype.push.apply(T,E);var D="",I=false;for(var v=0;v<T.length;v++){D+=T[v]+" ";if(T[v]=="disabled")I=true}if(!I)D+="available";C+='<td class="'+D.replace(/^\s+|\s+$/g,"")+'" data-date="'+g[w][$].date()+'" data-title="'+"r"+w+"c"+$+'">'+g[w][$].date()+"</td>"}C+="</tr>"}C+="</tbody>";C+="</table>";a.container.find(".drp-calendar."+t+" .calendar-table").html(C)},renderTimePicker:function e(t){var a=this;if(t=="right"&&!a.endDate)return;var n,i,r=a.maxDate;if(a.maxSpan&&(!a.maxDate||a.startDate.clone().add(a.maxSpan).isBefore(a.maxDate)))r=a.startDate.clone().add(a.maxSpan);if(t=="left"){n=a.startDate.clone();i=a.minDate}else if(t=="right"){n=a.endDate.clone();i=a.startDate;var o=a.container.find(".drp-calendar.right .calendar-time");if(o.html()!=""){n.hour(!isNaN(n.hour())?n.hour():o.find(".hourselect option:selected").val());n.minute(!isNaN(n.minute())?n.minute():o.find(".minuteselect option:selected").val());n.second(!isNaN(n.second())?n.second():o.find(".secondselect option:selected").val());if(!a.timePicker24Hour){var s=o.find(".ampmselect option:selected").val();if(s==="PM"&&n.hour()<12)n.hour(n.hour()+12);if(s==="AM"&&n.hour()===12)n.hour(0)}}if(n.isBefore(a.startDate))n=a.startDate.clone();if(r&&n.isAfter(r))n=r.clone()}var l=["show-hour"];var c='<div class="time-picker time-picker-hour"><div class="time-picker-title">'+a.locale.hourName+'</div><div class="time-picker-list">';var d='<select class="hourselect">';var u=a.timePicker24Hour?0:1;var p=a.timePicker24Hour?23:12;for(var f=u;f<=p;f++){var h=f;if(!a.timePicker24Hour)h=n.hour()>=12?f==12?12:f+12:f==12?0:f;var m=n.clone().hour(h);var g=false;if(i&&m.minute(59).isBefore(i))g=true;if(r&&m.minute(0).isAfter(r))g=true;var v=f<10?"0"+f:f;if(h==n.hour()&&!g){d+='<option value="'+f+'" selected="selected">'+v+"</option>";c+='<span data-value="'+f+'" class="time-picker-item available active">'+v+"</span>"}else if(g){d+='<option value="'+f+'" disabled="disabled" class="disabled">'+v+"</option>";c+='<span data-value="'+f+'" disabled="disabled" class="time-picker-item disabled">'+v+"</span>"}else{d+='<option value="'+f+'">'+v+"</option>";c+='<span data-value="'+f+'" class="time-picker-item available">'+v+"</span>"}}d+="</select> ";c+="</div></div>";d+=': <select class="minuteselect" '+(a.timePickerMinute?"":" disabled")+">";var b='<div class="time-picker time-picker-minute"><div class="time-picker-title">'+a.locale.minuteName+'</div><div class="time-picker-list">';for(var f=0;f<60;f+=a.timePickerIncrement){var y=f<10?"0"+f:f;var m=n.clone().minute(f);var g=false;if(i&&m.second(59).isBefore(i))g=true;if(r&&m.second(0).isAfter(r))g=true;if(n.minute()==f&&!g){d+='<option value="'+f+'" selected="selected">'+y+"</option>";b+='<span data-value="'+f+'" class="time-picker-item available active">'+y+"</span>"}else if(g){d+='<option value="'+f+'" disabled="disabled" class="disabled">'+y+"</option>";b+='<span data-value="'+f+'" disabled="disabled" class="time-picker-item disabled">'+y+"</span>"}else{d+='<option value="'+f+'">'+y+"</option>";b+='<span data-value="'+f+'" class="time-picker-item available">'+y+"</span>"}}d+="</select> ";b+="</div></div>";c+=a.timePickerMinute?b:"";if(a.timePickerMinute)l.push("show-minute");if(a.timePickerSeconds){l.push("show-second");d+=': <select class="secondselect">';c+='<div class="time-picker time-picker-second"><div class="time-picker-title">'+a.locale.secondName+'</div><div class="time-picker-list">';for(var f=0;f<60;f++){var y=f<10?"0"+f:f;var m=n.clone().second(f);var g=false;if(i&&m.isBefore(i))g=true;if(r&&m.isAfter(r))g=true;if(n.second()==f&&!g){d+='<option value="'+f+'" selected="selected">'+y+"</option>";c+='<span data-value="'+f+'" class="time-picker-item available active">'+y+"</span>"}else if(g){d+='<option value="'+f+'" disabled="disabled" class="disabled">'+y+"</option>";c+='<span data-value="'+f+'" disabled="disabled" class="time-picker-item disabled">'+y+"</span>"}else{d+='<option value="'+f+'">'+y+"</option>";c+='<span data-value="'+f+'" class="time-picker-item available">'+y+"</span>"}}d+="</select> ";c+="</div></div>"}if(!a.timePicker24Hour){l.push("show-amp");c+='<div class="time-picker time-picker-amp"><div class="time-picker-title">A/PM</div><div class="time-picker-list">';d+='<select class="ampmselect">';var $="";var w="";var x=" available";var k=" available";if(i&&n.clone().hour(12).minute(0).second(0).isBefore(i)){$=' disabled="disabled" class="disabled"';x=" disabled"}if(r&&n.clone().hour(0).minute(0).second(0).isAfter(r)){w=' disabled="disabled" class="disabled"';k=" disabled"}if(n.hour()>=12){c+='<span data-value="AM" class="time-picker-item'+x+'"'+x+">"+a.locale.am+"</span>";c+='<span data-value="PM" class="time-picker-item active'+k+'"'+k+">"+a.locale.pm+"</span>";d+='<option value="AM"'+$+">"+a.locale.am+'</option><option value="PM" selected="selected"'+w+">"+a.locale.pm+"</option>"}else{c+='<span data-value="AM" class="time-picker-item active'+x+'"'+x+">"+a.locale.am+"</span>";c+='<span data-value="PM" class="time-picker-item'+k+'"'+k+">"+a.locale.pm+"</span>";d+='<option value="AM" selected="selected"'+$+">"+a.locale.am+'</option><option value="PM"'+w+">"+a.locale.pm+"</option>"}d+="</select>";c+="</div></div>"}var C=a.container.find(".drp-calendar."+t+" .calendar-time");C.html(d);if(a.pickerType==="time"){C.hide();var S=a.singleDatePicker?a.locale.timeChoose:t=="left"?a.locale.timeStartChoose:a.locale.timeEndChoose;var _=a.container.find(".drp-calendar."+t+" .calendar-table");_.find(".select-box").remove();_.append('<div class="select-box"><table class="table-time-view '+l.join(" ")+'"><thead><tr><th>'+S+"</th></tr></thead><tbody><tr><td>"+c+"</td></tr></tbody></table></div>");a.container.find(".time-picker-item.active").each(function(){var e=U(this);var t=e.closest(".time-picker-list");var a=e.offset().top-t.offset().top+t.scrollTop();var n=(t.height()-e.height())/2;if(a>n)t.animate({scrollTop:a-n},0)})}},updateFormInputs:function e(){var t=this;if(t.singleDatePicker||t.endDate&&(t.startDate.isBefore(t.endDate)||t.startDate.isSame(t.endDate)))t.container.find("button.applyBtn").prop("disabled",false);else t.container.find("button.applyBtn").prop("disabled",true)},move:function e(){var t;var a;var n={top:0,left:0};var i=this;var r=i.drops;var o=U(window).width();if(!i.parentEl.is("body")){n={top:i.parentEl.offset().top-i.parentEl.scrollTop(),left:i.parentEl.offset().left-i.parentEl.scrollLeft()};o=i.parentEl[0].clientWidth+i.parentEl.offset().left}a=i.container.outerHeight();switch(r){case"auto":t=i.element.offset().top+i.element.outerHeight()-n.top;if(t+a>=i.parentEl[0].scrollHeight&&i.element.offset().top>a){t=i.element.offset().top-a-n.top;r="up"}break;case"up":t=i.element.offset().top-a-n.top;break;default:t=i.element.offset().top+i.element.outerHeight()-n.top;break}i.container.css({top:0,left:0,right:"auto"});var s=i.container.outerWidth();i.container.toggleClass("drop-up",r=="up");if(i.opens=="left"){var l=o-i.element.offset().left-i.element.outerWidth();if(s+l>U(window).width())i.container.css({top:t,right:"auto",left:9});else i.container.css({top:t,right:l,left:"auto"});i.$arrow.css({marginLeft:i.element.offset().left})}else if(i.opens=="center"){var c=i.element.offset().left-n.left+i.element.outerWidth()/2-s/2;if(c<0)i.container.css({top:t,right:"auto",left:9});else if(c+s>U(window).width())i.container.css({top:t,left:"auto",right:0});else i.container.css({top:t,left:c,right:"auto"})}else{var c=i.element.offset().left-n.left;if(c+s>U(window).width())i.container.css({top:t,left:"auto",right:0});else i.container.css({top:t,left:c,right:"auto"});i.$arrow.css({left:i.element.offset().left-i.container.offset().left})}clearTimeout(i.moveTimer);i.moveTimer=setTimeout(function(){if(a!=i.container.outerHeight())i.move()})},show:function e(t){var a=this;if(a.isShowing)return;a._outsideClickProxy=U.proxy(function(e){a.outsideClick(e)},a);U(document).on(W("mousedown"),a._outsideClickProxy).on(W("touchend"),a._outsideClickProxy).on(W("click"),"[data-toggle=dropdown]",a._outsideClickProxy).on(W("focusin"),a._outsideClickProxy);U(window).on(W("resize"),U.proxy(function(e){this.move(e)},a));a.oldStartDate=a.startDate.clone();a.oldEndDate=a.endDate.clone();a.previousRightTime=a.endDate.clone();a.elementChanged();a.container.show();a.move();if(a.pickerType==="time")a.container.find(".drp-calendar.left .hourselect").trigger("change");Y.execCallback(a,a.options.onShow,a.element[0],[a],a.element,V.datePickerShow);a.isShowing=true},hide:function e(t){var a=this;if(!a.isShowing)return;if(!a.endDate){a.startDate=a.oldStartDate.clone();a.endDate=a.oldEndDate.clone()}if(!a.startDate.isSame(a.oldStartDate)||!a.endDate.isSame(a.oldEndDate))a.callback(a.startDate.clone(),a.endDate.clone(),a.chosenLabel);a.updateElement();U(document).off("."+i);U(window).off("."+i);a.container.hide();Y.execCallback(a,a.options.onHide,a.element[0],[a],a.element,V.datePickerHide);a.isShowing=false;a.leftCalendar.viewYear=false;a.rightCalendar.viewYear=false},toggle:function e(t){var a=this;if(a.isShowing)a.hide();else a.show()},outsideClick:function e(t){var a=this;var n=U(t.target);if(t.type=="focusin"||n.closest(a.element).length||n.closest(a.container).length||n.closest(".calendar-table").length)return;Y.execCallback(a,a.options.onOutsideClick,a.element[0],[a],a.element,V.datePickerOutsideClick);a.hide()},showCalendars:function e(){var t=this;t.container.addClass("show-calendar");t.move();Y.execCallback(t,t.options.onShowCalendar,t.element[0],[t],t.element,V.datePickerShowCalendar)},hideCalendars:function e(){var t=this;t.container.removeClass("show-calendar");Y.execCallback(t,t.options.onHideCalendar,t.element[0],[t],t.element,V.datePickerHideCalendar)},clickRange:function e(t){var a=t.target.getAttribute("data-range-key");var n=this;n.chosenLabel=a;if(a==n.locale.customRangeLabel)n.showCalendars();else if(a==n.locale.clearLabel)n.clickClear(t);else{var i=n.ranges[a];n.startDate=i[0];n.endDate=i[1];if(!n.timePicker){n.startDate.startOf("day");n.endDate.endOf("day")}if(!n.alwaysShowCalendars)n.hideCalendars();n.clickApply()}},clickPrev:function e(t){var a=U(t.target);var n=this;var i=n.getTopWrap(a);var r=n.isLeft(i);var o=n.pickerType==="year";var s=n.pickerType==="month";if(n.isYearPicker(a)){if(r)n.leftCalendar.viewYear.subtract(15,"year");else{n.rightCalendar.viewYear.subtract(15,"year");if(n.linkedCalendars&&o)n.leftCalendar.viewYear.subtract(15,"year")}if(!o){n.renderYearOrMonth(r,true);return}}else if(n.isMonthPicker(a)){if(r)n.leftCalendar.viewYear.subtract(1,"year");else{n.rightCalendar.viewYear.subtract(1,"year");if(n.linkedCalendars&&s)n.leftCalendar.viewYear.subtract(1,"year")}if(!s){n.renderYearOrMonth(r,false);return}}else if(r){n.leftCalendar.month.subtract(1,"month");if(n.linkedCalendars)n.rightCalendar.month.subtract(1,"month")}else n.rightCalendar.month.subtract(1,"month");n.updateCalendars()},clickNext:function e(t){var a=U(t.target);var n=this;var i=n.getTopWrap(a);var r=n.isLeft(i);var o=n.pickerType==="year";var s=n.pickerType==="month";if(n.isYearPicker(a)){if(r)n.leftCalendar.viewYear.add(15,"year");else{n.rightCalendar.viewYear.add(15,"year");if(n.linkedCalendars&&o)n.leftCalendar.viewYear.add(15,"year")}if(!o){n.renderYearOrMonth(r,true);return}}else if(n.isMonthPicker(a)){if(r)n.leftCalendar.viewYear.add(1,"year");else{n.rightCalendar.viewYear.add(1,"year");if(n.linkedCalendars&&s)n.leftCalendar.viewYear.add(1,"year")}if(!s){n.renderYearOrMonth(r,false);return}}else if(r)n.leftCalendar.month.add(1,"month");else{n.rightCalendar.month.add(1,"month");if(n.linkedCalendars)n.leftCalendar.month.add(1,"month")}n.updateCalendars()},hoverDate:function e(t){var a=U(t.target);var l=this;if(!l.isAvailable(a))return;var n=l.getTopWrap(a);var i=l.isLeft(n);if(l.isYearPicker(a)||l.isMonthPicker(a)){if(l.pickerType==="year"){var r=l.startDate.year();var o=a.data("year");if(!l.endDate)l.container.find(".table-year-view .col-xs-4").each(function(e,t){var a=U(t);var n=a.data("year");if(n>=r&&n<=o)a.addClass("in-range");else a.removeClass("in-range")})}else if(l.pickerType==="month"){var s=q([a.data("year"),a.data("month")]);if(!l.endDate)l.container.find(".table-month-view .col-xs-4").each(function(e,t){var a=U(t);var n=q([a.data("year"),a.data("month")]);if(n.isSameOrAfter(l.startDate,"month")&&n.isSameOrBefore(s))a.addClass("in-range");else a.removeClass("in-range")})}return}var c=a.attr("data-title");var d=c.substr(1,1);var u=c.substr(3,1);var p=i?l.leftCalendar.calendar[d][u]:l.rightCalendar.calendar[d][u];var f=l.leftCalendar;var h=l.rightCalendar;var m=l.startDate;if(!l.endDate)l.container.find(".drp-calendar tbody td").each(function(e,t){var a=U(t);if(a.hasClass("week"))return;var n=a.attr("data-title");var i=n.substr(1,1);var r=n.substr(3,1);var o=l.getTopWrap(a);var s=l.isLeft(o)?f.calendar[i][r]:h.calendar[i][r];if(s.isAfter(m)&&s.isBefore(p)||s.isSame(p,"day"))a.addClass("in-range");else a.removeClass("in-range")})},clickDate:function e(t){var a=U(t.target);var n=this;if(!n.isAvailable(a))return;if(n.isYearPicker(a)||n.isMonthPicker(a))if(n.pickerType==="year"||n.pickerType==="month")n.setSelectedDate(q([a.data("year"),a.data("month")]));else n.monthOrYearChanged(t);else{var i=n.getTopWrap(a);var r=a.attr("data-title");var o=r.substr(1,1);var s=r.substr(3,1);if(a.hasClass("active")&&n.singleDatePicker)n.clickApply();else n.setSelectedDate(n.isLeft(i)?n.leftCalendar.calendar[o][s]:n.rightCalendar.calendar[o][s])}t.stopPropagation()},setSelectedDate:function e(t){var a=this;if(a.endDate||t.isBefore(a.startDate,"day")){if(a.timePicker){var n=parseInt(a.container.find(".left .hourselect").val(),10);if(!a.timePicker24Hour){var i=a.container.find(".left .ampmselect").val();if(i==="PM"&&n<12)n+=12;if(i==="AM"&&n===12)n=0}var r=parseInt(a.container.find(".left .minuteselect").val(),10);if(isNaN(r))r=parseInt(a.container.find(".left .minuteselect option:last").val(),10);var o=a.timePickerSeconds?parseInt(a.container.find(".left .secondselect").val(),10):0;t=t.clone().hour(n).minute(r).second(o)}a.endDate=null;a.setStartDate(t.clone())}else if(!a.endDate&&t.isBefore(a.startDate))a.setEndDate(a.startDate.clone());else{if(a.timePicker){var n=parseInt(a.container.find(".right .hourselect").val(),10);if(!a.timePicker24Hour){var i=a.container.find(".right .ampmselect").val();if(i==="PM"&&n<12)n+=12;if(i==="AM"&&n===12)n=0}var r=parseInt(a.container.find(".right .minuteselect").val(),10);if(isNaN(r))r=parseInt(a.container.find(".right .minuteselect option:last").val(),10);var o=a.timePickerSeconds?parseInt(a.container.find(".right .secondselect").val(),10):0;t=t.clone().hour(n).minute(r).second(o)}a.setEndDate(t.clone());if(!a.timePicker){a.calculateChosenLabel();a.clickApply()}}if(a.singleDatePicker){a.setEndDate(a.startDate);if(!a.timePicker)a.clickApply()}a.updateView()},calculateChosenLabel:function e(){var t=true;var a=0;var n=this;for(var i in n.ranges){if(n.timePicker){var r=n.timePickerSeconds?"YYYY-MM-DD HH:mm:ss":"YYYY-MM-DD HH:mm";if(n.startDate.format(r)==n.ranges[i][0].format(r)&&n.endDate.format(r)==n.ranges[i][1].format(r)){t=false;n.chosenLabel=n.container.find(".ranges li:eq("+a+")").addClass("active").attr("data-range-key");break}}else if(n.startDate.format("YYYY-MM-DD")==n.ranges[i][0].format("YYYY-MM-DD")&&n.endDate.format("YYYY-MM-DD")==n.ranges[i][1].format("YYYY-MM-DD")){t=false;n.chosenLabel=n.container.find(".ranges li:eq("+a+")").addClass("active").attr("data-range-key");break}a++}if(t){if(n.showCustomRangeLabel)n.chosenLabel=n.container.find('.ranges li[data-range-key="'+n.locale.customRangeLabel+'"]').addClass("active").attr("data-range-key");else n.chosenLabel=null;n.showCalendars()}},clickApply:function e(t){var a=this;a.updateElement(true);Y.execCallback(a,a.options.onApply,a.element[0],[a],a.element,V.datePickerApply);a.hide();if(a.endTarget){var n=U(a.endTarget);if(n.is(":text"))n.val("").trigger(W("focus"));else n.html("").trigger(W("click"))}},clickCancel:function e(t){var a=this;a.startDate=a.oldStartDate;a.endDate=a.oldEndDate;Y.execCallback(a,a.options.onCancel,a.element[0],[a],a.element,V.datePickerCancel);a.hide()},clickNow:function e(t){var a=this;a.startDate=a.getInitStartDate();a.endDate=a.getInitEndDate();a.clickApply()},clickClear:function e(t){var a=this;a.triggerElementChange(a.force?a.sourceContent:"");Y.execCallback(a,a.options.onClear,a.element[0],[a],a.element,V.datePickerClear);a.hide()},monthOrYearChanged:function e(t){var a=U(t.target);var n=this;var i=n.isLeft(n.getTopWrap(a));var r=parseInt(a.data("month"),10);var o=parseInt(a.data("year"));if(!i)if(o<n.startDate.year()||o==n.startDate.year()&&r<n.startDate.month()){r=n.startDate.month();o=n.startDate.year()}if(n.minDate)if(o<n.minDate.year()||o==n.minDate.year()&&r<n.minDate.month()){r=n.minDate.month();o=n.minDate.year()}if(n.maxDate)if(o>n.maxDate.year()||o==n.maxDate.year()&&r>n.maxDate.month()){r=n.maxDate.month();o=n.maxDate.year()}if(i){n.leftCalendar.month.month(r).year(o);if(n.linkedCalendars)n.rightCalendar.month=n.leftCalendar.month.clone().add(1,"month")}else{n.rightCalendar.month.month(r).year(o);if(n.linkedCalendars)n.leftCalendar.month=n.rightCalendar.month.clone().subtract(1,"month")}n.updateCalendars()},updateRightViewYear:function e(t){var a=this;a.rightCalendar.viewYear=a.leftCalendar.viewYear.clone().add(t,"year")},showYearView:function e(t){var a=this;a.renderYearOrMonth(a.isLeft(a.getTopWrap(U(t.target))),true)},renderYearOrMonth:function e(t,a){var n=this;var i=n.container.find((t?".left ":".right ")+".calendar-table");var r=t?n.leftCalendar:n.rightCalendar;var o=n.pickerType==="year"||n.pickerType==="month";var s=o?n.minDate:t?n.minDate:n.startDate;var l=n.maxDate;if(o)if(n.endDate==null&&n.maxSpan){var c=n.startDate.clone().add(n.maxSpan).endOf(n.pickerType);if(!l||c.isBefore(l))l=c}var d=l&&l.year()||n.maxYear;var u=s&&s.year()||n.minYear;var p=r.month.year();var f=r.month.month();var h=p==u;var m=p==d;var g=!t&&n.linkedCalendars&&o&&!n.singleDatePicker;var v=t&&n.linkedCalendars&&o&&!n.singleDatePicker;var b='<div class="select-box">    <table class="table-condensed table-'+(a?"year":"month")+'-view">        <thead>            <tr>                '+(g?"<th></th>":'<th class="prev"><span></span></th>')+'                <th class="month">_name_</th>                '+(v?"<th></th>":'<th class="next"><span></span></th>')+'            </tr>         </thead>        <tbody><tr><td colspan="3">_list_</td></tr></tbody>    </table></div>';var y=null;if(r.viewYear)y=r.viewYear.clone();if(!y)y=r.month.clone();var $=y.year();var w="";var x="";if(a){var k=$-7;var C=$+7;for(var S=k;S<=C;S++){var _=[];if(S>=u&&S<=d)_.push("available");else _.push("disabled");if(n.pickerType==="year"){if(S==n.startDate.year())_.push("start-date","active");if(n.endDate!=null&&S==n.endDate.year())_.push("end-date","active");if(n.endDate!=null&&S>=n.startDate.year()&&S<=n.endDate.year())_.push("in-range")}else if(S==p)_.push("active");w+='<span data-year="'+S+'" data-month="'+f+'" class="col-xs-4 '+_.join(" ")+'">'+S+n.locale.yearName+"</span>"}x=k+n.locale.yearName+" - "+C+n.locale.yearName}else{var T=y.clone().startOf("year");for(var E=0;E<12;E++){var _=[];if((!h||s&&T.isSameOrAfter(s,"month"))&&(!m||l&&T.isSameOrBefore(l,"month")))_.push("available");else _.push("disabled");if(n.pickerType==="month"){if(T.isSame(n.startDate,"month"))_.push("start-date","active");if(n.endDate!=null&&T.isSame(n.endDate,"month"))_.push("end-date","active");if(n.endDate!=null&&T.isSameOrAfter(n.startDate,"month")&&T.isSameOrBefore(n.endDate,"month"))_.push("in-range")}else if(T.isSame(r.month,"month"))_.push("active");w+='<span data-year="'+$+'" data-month="'+E+'" class="col-xs-4 '+_.join(" ")+'">'+n.locale.monthNames[E]+"</span>";T.add(1,"month")}x=$+n.locale.yearName}b=b.replace("_list_",w);b=b.replace("_name_",x);i.find(".select-box").remove();i.append(b);if(t)n.leftCalendar.viewYear=y;else n.rightCalendar.viewYear=y},showMonthView:function e(t){this.renderYearOrMonth(U(t.target).closest(".drp-calendar").hasClass("left"),false)},timeChanged:function e(t){var a=U(t.target);var n=this;var i=n.getTopWrap(a);var r=n.isLeft(i);var o=i.find(".hourselect");var s=i.find(".minuteselect");var l=i.find(".secondselect");var c=i.find(".ampmselect");if(a.parents(".time-picker-hour").length>0){o.val(a.data("value")).trigger("change");return}else if(a.parents(".time-picker-minute").length>0){s.val(a.data("value")).trigger("change");return}else if(a.parents(".time-picker-second").length>0){l.val(a.data("value")).trigger("change");return}else if(a.parents(".time-picker-amp").length>0){c.val(a.data("value")).trigger("change");return}var d=parseInt(o.val(),10);var u=parseInt(s.val(),10);if(isNaN(u))u=parseInt(s.find("option:last").val(),10);var p=n.timePickerSeconds?parseInt(l.val(),10):0;if(!n.timePicker24Hour){var f=c.val();if(f==="PM"&&d<12)d+=12;if(f==="AM"&&d===12)d=0}if(r){var h=n.startDate.clone();h.hour(d);h.minute(u);h.second(p);n.setStartDate(h);if(n.singleDatePicker)n.endDate=n.startDate.clone();else if(n.endDate&&n.endDate.format("YYYY-MM-DD")==h.format("YYYY-MM-DD")&&n.endDate.isBefore(h))n.setEndDate(h.clone())}else if(n.endDate){var m=n.endDate.clone();m.hour(d);m.minute(u);m.second(p);n.setEndDate(m)}n.updateCalendars();n.updateFormInputs();n.renderTimePicker("left");n.renderTimePicker("right")},parseValue:function e(t){if(t.length<=0)return false;var a=this;var n=t.split(a.locale.separator);var i=null;var r=null;if(n.length===2){i=q(n[0],a.locale.format);r=q(n[1],a.locale.format)}if(a.singleDatePicker||i===null||r===null){i=q(t,a.locale.format);r=i}if(i.isValid()&&r.isValid())return[i,r];return false},elementChanged:function e(){var t=this;if(t.startTarget){var a=U(t.startTarget);var n;if(a.is(":text"))n=a.val().trim();else n=a.html().trim();var i=a.data("ba.date.picker");var r=t.parseValue(n);if(false!==r)if(t.singleDatePicker)t.minDate=r[0];else t.minDate=r[1];if(i)t.maxDate=i.maxDate}var o=t.parseValue(t.getValue());if(false!==o){t.setStartDate(o[0]);t.setEndDate(o[1]);t.updateView();return}t.setStartDate(t.getInitStartDate());t.setEndDate(t.getInitEndDate());t.updateView()},getInitStartDate:function e(){return q()},getInitEndDate:function e(){return q().endOf("days")},keydown:function e(t){if(t.keyCode===9||t.keyCode===13)this.hide();if(t.keyCode===27){t.preventDefault();t.stopPropagation();this.hide()}},updateElement:function e(t){var a=this;if(a.autoUpdateInput||t===true){var n=a.startDate.format(a.locale.format);if(!a.singleDatePicker)n+=a.locale.separator+a.endDate.format(a.locale.format);var i=a.getValue();if(n!==i)a.triggerElementChange(n)}},getValue:function e(){var t="";var a=this.element;if(a.is(":text"))t=a.val().trim();else if(this.force)t=a.html().trim();else t=(a.data("value")||"").trim();return t},triggerElementChange:function e(t){t=t===undefined?false:t;var a=this;var n=a.element;if(n.is(":text")){if(t!==false)n.val(t);n.baTriggerEvent("input").baTriggerEvent("change")}else{if(t!==false)if(this.force)n.html(t);else n.data("value",t);Y.execCallback(a,a.options.onChange,n[0],[a],n,V.datePickerChange)}if(a.valueTarget)U(a.valueTarget).each(function(){var e=U(this);if(e.is(":text")){if(t!==false)e.val(t);e.baTriggerEvent("input").baTriggerEvent("change")}else{if(t!==false)e.html(t);Y.execCallback(a,a.options.onChange,this,[a],e,V.datePickerChange)}})},destroy:function e(){this.container.remove();this.element.off(".ba-date-picker")}},t.KEY=i,t.DEFAULTS={format:"",range:null,startDate:undefined,endDate:undefined,minDate:false,maxDate:false,force:null,valueTarget:null,clear:true,applyClass:null,nowClass:null,clearClass:null,span:null,drops:"auto",opens:"right",input:false,link:false,custom:null,ranges:undefined,endTarget:null,startTarget:null,locale:U.extend({direction:"ltr",format:"YYYY-MM-DD",separator:" - ",applyLabel:"确定",nowLabel:"现在",clearLabel:"清空",weekLabel:"W",customRangeLabel:"自定义",daysOfWeek:["日","一","二","三","四","五","六"],monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],yearName:"年",yearChoose:"请选择年份",monthChoose:"请选择月份",timeChoose:"请选择时间",timeStartChoose:"选择开始时间",timeEndChoose:"选择结束时间",secondName:"秒",hourName:"时",minuteName:"分",am:"上午",pm:"下午",thisYear:"今年",lastYear:"去年",lastNYear:"最近%s年",thisMonth:"本月",lastMonth:"上个月",lastNMonth:"最近%s个月",todayToNow:"今天到现在",lastNHours:"最近%s小时",forenoon:"上午",afternoon:"上午",allDay:"整天",lastNDay:"最近%s天",today:"今天",yesterday:"昨天"},((n.locale||{}).plugin||{}).datePicker||{})},U.fn.baDatePicker=a,U.fn.baDatePicker.Constructor=t,n.plugins.DatePicker=t,V.datePickerShow=e("show",r),V.datePickerHide=e("hide",r),V.datePickerOutsideClick=e("outside-click",r),V.datePickerShowCalendar=e("show-calendar",r),V.datePickerHideCalendar=e("hide-calendar",r),V.datePickerApply=e("apply",r),V.datePickerCancel=e("cancel",r),V.datePickerClear=e("clear",r),V.datePickerChange=e("change",r);var o=Y.pluginAttrs(r);return U("body").on("focus."+i,o,function(){(U(this).is(":text")||U(this).is("button"))&&a.call(U(this))}).on("click."+i,o,function(){U(this).is(":text")||U(this).is("button")||a.call(U(this))}),t}),define("./ba/plug/dialog",["busyAdmin","jquery","layer"],function(h,m){var i,g=h.helper,f=function e(t){m(document).one(h.e.appRenderBefore,function(){layer.close(t())})},v=function e(t){return Array.prototype.slice.call(t)},b=g.extends(layer.Constructor.pt,{vessel:function e(t,s){var a=this;var l=a.config;var n=l.success;var i=l.yes;var r=l.cancel;var o=l.end;var c=l.min;var d=l.full;var u=l.restore;var p=l.moveEnd;l.success=function(){typeof n==="function"&&n.apply(a,v(arguments))};l.yes=function(){typeof i==="function"&&i.apply(a,v(arguments))};l.cancel=function(){typeof r==="function"&&r.apply(a,v(arguments))};l.end=function(){typeof o==="function"&&o.apply(a,v(arguments))};l.min=function(){typeof c==="function"&&c.apply(a,v(arguments))};l.full=function(){typeof d==="function"&&d.apply(a,v(arguments))};l.restore=function(){typeof u==="function"&&u.apply(a,v(arguments))};l.moveEnd=function(){typeof p==="function"&&p.apply(a,v(arguments))};l.zIndex=h.defaultZIndex;var f=function e(t,a,n){h.defaultZIndex=l.zIndex;var i=m(t[1]);var r=i.find(".layui-layer-btn");var o=r.find("a[class*=layui-layer-btn]");o.each(function(){var e=m(this);if(e.hasClass("layui-layer-btn0"))e.addClass("btn btn-primary");else e.addClass("btn btn-default")});t[1]=i[0].outerHTML;s(t,a,n)};g.override(b,"vessel",a,[t,f]);return a}});layer.ready=function(e){e()},layer.config({anim:0,isOutAnim:false}),layer.area=function(e,t,a){layer.style(e,{width:t,height:a})},layer.width=function(e,t){layer.style(e,{width:t})},layer.height=function(e,t){layer.style(e,{height:t})};var t=function e(t){t=(t||"").trim();var n=this;n.message=t;n.messageElement=null;n.layer=null;f(function(){return n.index});n.index=layer.open({type:1,resize:false,title:false,closeBtn:false,btn:false,area:"auto",skin:"ba-pending"+(n.message.length?"":" ba-pending-empty"),content:'<div class="ba-pending-icon"></div><div class="ba-pending-message">'+n.message+"</div>",success:function e(t,a){n.messageElement=t.find(".ba-pending-message");n.layer=this}})};t.prototype={update:function e(t){t=(t||"").trim();var a=this;if(a.layer===null)return a;if(t.length>0){a.layer.layero.removeClass("ba-pending-empty");a.messageElement.html(t)}else a.layer.layero.addClass("ba-pending-empty");if(a.message!==t){a.message=t;a.layer.offset()}return a},close:function e(){var t=this;if(t.index!==null){layer.close(t.index);t.index=null}}};var n=function e(t,a,n){var i={};if(typeof a==="function")n=a;else if(m.isArray(a)){var r=a[0]||500;var o=a[1]||500;r=typeof r==="number"?r+"px":r;o=typeof o==="number"?o+"px":o;i.area=[r,o]}else i=a||{};if(m.isArray(t)){i.title=t[0];i.content=t[1]}else i.content=t;var s=this;var l=i.success||null;s.data=null;s.layerApi=null;i.success=function(e,t){var a=e.find("iframe");var n=a[0].contentWindow;s.layerApi=this;n.layer=window.layer;n.busyAdmin.dialog=window.busyAdmin.dialog;i.title=i.title||"";if(i.title.length===0){layer.title(a[0].contentWindow.document.title,t);this.offset()}if(typeof n.busyAdmin.dialogIframeReady==="function"){n.busyAdmin.dialogIframeReady.call(s,t);s.update()}typeof l==="function"&&l.call(s,e,t,a)};i.end=function(){typeof n==="function"&&n(s.data)};i.type=2;i.skin="ba-dialog";f(function(){return s.index});s.index=layer.open(i)};n.prototype={setData:function e(t){this.data=t;return this},setTitle:function e(t){layer.title(t,this.index);return this},setSize:function e(t,a){layer.style(this.index,{width:t,height:a});return this},setWidth:function e(t){layer.style(this.index,{width:t});return this},setHeight:function e(t){layer.style(this.index,{height:t});return this},update:function e(){if(this.layerApi!==null)this.layerApi.offset();return this},getLayerApi:function e(){return this.layerApi},close:function e(){layer.close(this.index)},getIndex:function e(){return this.index}};var r=function e(t){var a=this;a.options=m.extend({},{closeButton:true,timeOut:2500},t||{});a.options.toastClass="toast ba-notify";a.ready()};r.prototype={ready:function e(t){var a=this;if(i)typeof t==="function"&&t.call(a);else requirejs([h.lib.toastr],function(e){i=e;typeof t==="function"&&t.call(a)});return this}};var y=function e(t){var a=this;a.index=t;a.shown=true;a.end=null;var n=layer.Constructor.container.end[a.index];layer.Constructor.container.end[a.index]=function(){a.shown=false;typeof n==="function"&&n.apply(this,v(arguments));typeof a.end==="function"&&a.apply(this,v(arguments))}};y.prototype={close:function e(){layer.close(this.index)},onEnd:function e(t){this.end=t;return this},getIndex:function e(){return this.index},isShown:function e(){return this.shown}};var a=function e(){};return a.prototype={alert:function(e,t,a){var n,i={},r=this;return"function"==typeof t?(a=t,i.icon=0):"object"!==(void 0===t?"undefined":_typeof(t))?i.icon=this.parseIcon(t,0):(i=t).icon=this.parseIcon(i.hasOwnProperty("icon")?i.icon:"w",0),i.closeBtn=!1,i.resize=!1,i.skin="ba-dialog",f(function(){return n}),new y(n=layer.alert(e,m.extend({},{btn:["确定"]},i),function(e,t){"function"==typeof a&&!1===a.call(r,e,this,t)||layer.close(e)}))},alertSuccess:function(e,t){return this.alert(e,"success",t)},alertError:function(e,t){return this.alert(e,"error",t)},confirm:function(e,t,a,n){var i,r={},o=this;return"function"==typeof t?(n=a,a=t,r.icon=this.parseIcon(3)):"object"!==(void 0===t?"undefined":_typeof(t))?r.icon=this.parseIcon(t,3):(r=t).icon=this.parseIcon(r.hasOwnProperty("icon")?r.icon:3,3),r.closeBtn=!1,r.resize=!1,r.skin="ba-dialog",f(function(){return i}),new y(i=layer.confirm(e,m.extend({},{btn:["确认","取消"],title:"确认提示"},r),function(e,t){"function"==typeof a&&!1===a.call(o,e,this,t)||layer.close(e)},function(e,t){return("function"!=typeof n||!1!==n.call(o,e,this,t))&&void layer.close(e)}))},prompt:function(e,t,a,i,n){var r,o={},s=this;"function"==typeof a?(n=i,i=a,o.formType=0):"object"!==(void 0===a?"undefined":_typeof(a))?o.formType=a:o=a,o.placeholder=o.placeholder||e,o.value=t;var l,c=o.success||null;o.success=function(e,t){(l=e.find(".form-control")).val(o.value||"").focus(),"function"==typeof c&&c.call(this,e,t)},o.cancel=function(e,t){if("function"==typeof n&&!1===n.call(s,e,this,t))return!1;layer.close(e)},o.btn2="select"===o.formType&&0<o.rows?function(){return l.find(":selected").prop("selected",!1),s.toast("已清空"),!1}:o.cancel,o.yes=function(e,t){var a=l.val();if("number"==o.formType){var n=g.float(a);if(0<o.maxlength&&n>o.maxlength)return s.toast("最大不能超过"+o.maxlength),l.focus(),!1;if(0<o.minlength&&n<o.minlength)return s.toast("不能小于"+o.minlength),l.focus(),!1}else if("select"==o.formType){if(o.rows){if(a=m.isArray(a)?a:[],0<o.maxlength&&a.length>o.maxlength)return s.toast("最多允许选择"+o.maxlength+"项"),l.focus(),!1;if(0<o.minlength&&a.length<o.minlength)return s.toast("至少需要选择"+o.minlength+"项"),l.focus(),!1}else if(0<o.minlength&&""===a)return s.toast("请选择"),l.focus(),!1}else{if(a=a.trim(),0<o.maxlength&&a.length>o.maxlength)return s.toast("最多允许输入"+o.maxlength+"个字符"),l.focus(),!1;if(0<o.minlength&&a.length<o.minlength)return s.toast("至少需要输入"+o.minlength+"个字符"),l.focus(),!1}if("function"==typeof i&&!1===i.call(s,l.val(),e,this,l,t))return!1;layer.close(e)};var d="";o.area&&(d='style="width: '+(t=o.area)[0]+"; height: "+t[1]+';"',delete o.area);var u="";switch(o.formType){case"textarea":u='<textarea class="form-control"'+d+' placeholder="'+(o.placeholder||e)+'" rows="'+(o.rows||2)+'"></textarea>';break;case"select":var p=o.selectOptions;m.isArray(o.selectOptions)&&(p="",o.selectOptions.map(function(e){"object"!==(void 0===e?"undefined":_typeof(e))?p+='<option value="'+e+'">'+e+"</option>":p+='<option value="'+e.value+'">'+e.name+"</option>"})),u='<select class="form-control" '+(o.rows?'multiple size="'+o.rows+'"':"")+">"+p+"</select>",o.rows&&(u+='<div class="space-10"></div><div class="text-gray text-center size-12">请按<code>CTRL+鼠标左键</code> 或 <code>拖拽鼠标</code>多选</div>');break;default:u='<input type="'+(o.formType||"text")+'" placeholder="'+(o.placeholder||e)+'" '+(o.numberStep?' step="'+o.numberStep+'"':"")+' class="form-control">'}return f(function(){return r}),new y(r=layer.open(m.extend({type:1,title:e,skin:"layui-layer-prompt ba-dialog",btn:["确认",0<o.rows?"清空":"取消"],content:u,maxWidth:m(window).width(),resize:!1},o)))},toast:function(e,t,a){var n={};return"function"==typeof t?a=t:"object"!==(void 0===t?"undefined":_typeof(t))?n.time=t?2500:1500:n=t,-1!==n.icon&&n.icon?n.skin="layui-layer-msg ba-dialog":n.skin="layui-layer-hui layui-layer-msg ba-dialog",new y(layer.msg(e,m.extend({},{time:1500},n),a))},toastSuccess:function(e,t){return this.toast(e,{shade:.1,shadeClose:!0,icon:1},t)},toastError:function(e,t){return this.toast(e,{shade:.1,shadeClose:!0,icon:2},t)},tipSuccess:function(e){"notify"==h.getConfig("app").operateTipStyle?h.dialog.notifySuccess(e):h.dialog.toastSuccess(e)},tipError:function(e){"notify"==h.getConfig("app").operateTipStyle?h.dialog.notifyError(e):h.dialog.toastError(e)},pending:function(e){return new t(e)},iframe:function(e,t,a){return new n(e,t,a)},parseIcon:function(e,t){if("string"!=typeof e)return null===e?-1:e||t;switch(e.trim().toLowerCase()){case"success":case"s":case"y":case"yes":return 1;case"e":case"error":case"n":case"no":return 2;case"a":case"ask":case"q":case"question":return 3;case"l":case"lock":return 4;case"f":case"frown":return 5;case"sm":case"smile":return 6;case"w":case"warn":case"warning":default:return 0}}},m.map(["Success","Warning","Info","Error"],function(e){var n=e.toLowerCase();r.prototype[n]=function(e,t){return i.options=this.options,i[n](e,t),this},a.prototype["notify"+e]=function(e,t,a){return a=a||{},"object"==(void 0===t?"undefined":_typeof(t))?(a=t,t=e,e=void 0):"function"==typeof t?(a.onHidden=t,t=void 0):"function"==typeof a&&(a={onHidden:a}),new r(a||{}).ready(function(){this[n](t,e)})}}),h.dialog=new a,h.dialogIframeReady=null,a}),define("./ba/plug/editor",["busyAdmin","jquery"],function(u,p){var f,r,o={ck5:"ck5"},h=u.helper,m=u.e,s="editor",l=h.pluginKey(s);m.editorInitialized=u.ee("initialized",s);var g=function e(t,a){this.loader=t;this.options=a};g.prototype={upload:function e(){var t=this;return t.loader.file.then(function(e){return new Promise(function(n,i){t.request=u.request(r.url).params({class_type:t.options.imageClass,class_value:t.options.classValue}).addParam("upload",e).pending(false).progress(function(e){if(e.lengthComputable){t.loader.uploadTotal=e.total;t.loader.uploaded=e.loaded}}).success(function(e,t,a){n({default:e.result.file_url});return false}).error(function(e,t,a){i(e.message)}).exec()})})},abort:function e(){if(this.request)this.request.abort()}};var i="editor.ck5",v=function e(t,a){var n=b();n[t]=a;localStorage.setItem(u.app.cacheKey(i),JSON.stringify(n))},b=function e(t){var a=JSON.parse(localStorage.getItem(u.app.cacheKey(i))||"{}");if(!t)return a;return a[t]},y=function e(t,a){var n=this,i;n.element=t;n.$element=p(t);n.index=e.INDEX++;i=n.options=p.extend(true,{},e.DEFAULTS,n.$element.baData(s),a||{});n.formStatus=n.$element.baFormStatus(n).render();n.resetEvent="reset."+l+n.index;n.$form=n.$element.closest("form");n.$form.on(n.resetEvent,function(){n.setContent(n.defaultValue)});if(n.$element.is(":input")){n.defaultValue=n.$element.val();var r=n.$element.attr("placeholder");if(r)i.placeholder=r;var o=n.$element.attr("name");if(o)i.name=o}else n.defaultValue=n.$element.html();if(i.toolbar&&typeof i.toolbar==="string")i.toolbar=p.map(i.toolbar.split(","),function(e){e=e.trim();if(e)return e;return null});n.ready(n._init)};function e(e){return h.pluginFn(this,y,e,arguments,"api")}return y.prototype={ready:function(n){var i=this,e=window.UEDITOR_CONFIG&&i.options.type!=o.ck5,t=f&&i.options.type==o.ck5;e||t?n.call(i):i.options.type===o.ck5?(t=(t=u.requirePaths[u.lib.ckEditor5Classic].split("/"))[0]+"/"+t[1]+"/translations/"+i.options.locale,requirejs([u.lib.ckEditor5Classic,t,u.lib.uploadConfig],function(e,t,a){f=e,window.CKClassicEditor=e,r=a,n.call(i)})):requirejs([u.lib.ueditor,u.lib.zeroClipboard],function(e,t){window.ZeroClipboard=t,window.UEDITOR_CONFIG.UEDITOR_HOME_URL=u.moduleRoot()+"ueditor/",UE.Editor.prototype.placeholder=function(e){p(this.document.body).attr("data-placeholder",e)},n.call(i)})},_init:function(){var e=this,t=e.options,a=p.proxy(e.destroy,e);p(document).one(m.appRenderBefore,a),e.modal=e.$element.closestBaModal(),e.modal&&e.modal.$element.one(m.modalHide,a),t.type===o.ck5?e._initCkEditor():e._initUEditor()},_initCkEditor:function(){var a=this,n=a.options,e=p.extend(!0,{},y.CKEDITOR_TYPES[n.mode||"small"]||{});!1===n.mode&&(e={}),n.toolbar&&(e.toolbar=n.toolbar),e.toolbar&&p.isArray(e.toolbar)&&(e.toolbar={items:e.toolbar,shouldNotGroupWhenFull:!0});for(var t=[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"}],i=1;i<7;i++)t.push({model:"heading"+i,view:"h"+i,title:"Heading "+i,class:"ck-heading_heading"+i});function r(){return a.ckEditor?(a.$ckEl||(a.$ckEl=p(a.ckEditor.ui.view.element)),a.$ckEl):p([])}var o,s,l,c={language:n.locale,removePlugins:["Title","Markdown"],heading:{options:t},image:{toolbar:["imageTextAlternative","toggleImageCaption","|","imageStyle:inline","imageStyle:wrapText","imageStyle:breakText","imageStyle:side","|","resizeImage"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells","tableProperties","tableCellProperties","toggleTableCaption"]}},d=!0;n.autoSave&&(l="string"==typeof n.autoSave?n.autoSave:null,s=o=null,l=l||(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_"),l+="_drafts",c.autosave={save:function(a){return o||(o=p('<div class="alert alert-info alert-sm ck-alert-auto-save-tip">本地保存成功</div>').hide(),r().find(".ck-editor__main").append(o)),new Promise(function(e,t){if(!d)return d=!0,void e();v(l,a.getData()),o.fadeIn(),clearTimeout(s),s=setTimeout(function(){o.fadeOut()},1500),e()})}}),u.formSubmitIgnore.push(function(e){return p(this).hasClass("ck")}),u.linkClickIgnore.push(function(e){return p(this).hasClass("ck-link_selected")}),a.$element.on(m.validateErrorPlacement,function(e,t){return r().after(t),!1}),f.create(a.element,p.extend({},p.extend({},c,n.options||{}),e)).then(function(e){var t;a.ckEditor=e,a.api=e,u.app.triggerResize(),a.formStatus.rendered(),e.model.document.on("change:data",function(){a.$element.val(a.ckEditor.getData()).baTriggerEvent("input").baTriggerEvent("change")}),e.plugins.get("FileRepository").createUploadAdapter=function(e){return new g(e,n)},u.app.isInContent(a.$element)&&(t=u.app.getContentFrame(),e.ui.viewportOffset={top:t.top,right:0,bottom:0,left:0}),e.isReadOnly=a.$element.prop("disabled"),n.autoSave&&l&&(d=!1,e.setData(b(l)||"")),h.triggerPluginReady(a.$element,a,"",m.editorInitialized)}).catch(function(e){console.error(e)})},_initUEditor:function(){var e=this,t=e.$element;e.elementId=t.attr("id")||"",e.editorId=e.elementId+"__baEditor_"+e.index,t.removeAttr("class",""),t.attr("id",e.editorId);var a=e.options,n=p.extend(!0,{},y.UEDITOR_TYPES[a.mode||"small"]||{});!1===a.mode&&(n={}),a.toolbar&&(n.toolbars=[a.toolbar]);var i={};p.extend(!0,i,{charset:"utf-8",wordCount:a.showCount,enableAutoSave:a.autoSave,autoSaveKey:a.autoSave&&"string"==typeof a.autoSave?a.autoSave:null,zIndex:p.isNumeric(a.zindex)?a.zindex:u.zIndex(),catchRemoteImageEnable:a.catchRemoteImage,autoHeightEnabled:a.autoHeight,elementPathEnabled:a.elementPath,whitList:a.whitList,lang:a.locale,xssFilterRules:!0,inputXssFilter:!0,outputXssFilter:!0,insertorderedlist:{decimal:"","decimal-leading-zero":"01,02,03...","lower-alpha":"","upper-alpha":"","lower-roman":"","upper-roman":"","cjk-ideographic":"一,二,三..."},insertunorderedlist:{circle:"",disc:"",square:""},showImageOnlineManager:a.imageManager,showAttachmentOnlineManage:a.fileManager,showVideoOnlineManage:a.videoManager,allowVideoUpload:a.videoUpload,autoFloatEnabled:a.stickyToolbar,topOffset:"auto"===a.stickyTopOffset?0:a.stickyTopOffset,toolbarTopOffset:"auto"===a.stickyTopOffset?0:a.stickyTopOffset,textarea:a.name,initialFrameHeight:100,imageClass:a.imageClass,videoClass:a.videoClass,fileClass:a.fileClass,classValue:a.classValue,useImageExtensions:!p.baIsEmpty(a.imageExtensions),useImageMimetypes:!p.baIsEmpty(a.imageMimetypes),useImageMaxSize:!p.baIsEmpty(a.imageMaxSize),useVideoExtensions:!p.baIsEmpty(a.videoExtensions),useVideoMimetypes:!p.baIsEmpty(a.videoMimetypes),useVideoMaxSize:!p.baIsEmpty(a.videoMaxSize),useFileExtensions:!p.baIsEmpty(a.fileExtensions),useFileMimetypes:!p.baIsEmpty(a.fileMimetypes),useFileMaxSize:!p.baIsEmpty(a.fileMaxSize),preferencesKey:function(){return u.app.cacheKey("editor.ue")}},a.options||{},n),"auto"===a.stickyTopOffset&&u.app.isInContent(t)&&(s=u.app.getContentFrame(),i.topOffset=s.top,i.toolbarTopOffset=s.top);var r=window.UEDITOR_CONFIG,o=r.uploadCategory,n=function(t,e){i[t]=[],p.map(a[e].split(","),function(e){e="."+e.toLocaleLowerCase();-1!==r[t].indexOf(e)&&i[t].push(e)})},s=o[a.imageClass]||null;s&&(p.baIsEmpty(a.imageExtensions)&&(a.imageExtensions=s.allow_extensions.join(",")),p.baIsEmpty(a.imageMimetypes)&&(a.imageMimetypes=s.allow_mimetypes.join(",")),p.isNumeric(a.imageMaxSize)||(a.imageMaxSize=s.max_size)),a.imageExtensions&&n("imageAllowFiles","imageExtensions"),a.imageMimetypes&&(i.imageMimetypes=a.imageMimetypes),p.isNumeric(a.imageMaxSize)&&(i.imageMaxSize=a.imageMaxSize);s=o[a.videoClass]||null;s&&(p.baIsEmpty(a.videoExtensions)&&(a.videoExtensions=s.allow_extensions.join(",")),p.baIsEmpty(a.videoMimetypes)&&(a.videoMimetypes=s.allow_mimetypes.join(",")),p.isNumeric(a.videoMaxSize)||(a.videoMaxSize=s.max_size)),a.videoExtensions&&n("videoAllowFiles","videoExtensions"),a.videoMimetypes&&(i.videoMimetypes=a.videoMimetypes),p.isNumeric(a.videoMaxSize)&&(i.videoMaxSize=a.videoMaxSize);o=o[a.fileClass]||null;o&&(p.baIsEmpty(a.fileExtensions)&&(a.fileExtensions=o.allow_extensions.join(",")),p.baIsEmpty(a.fileMimetypes)&&(a.fileMimetypes=o.allow_mimetypes.join(",")),p.isNumeric(a.fileMaxSize)||(a.fileMaxSize=o.max_size)),a.fileExtensions&&n("fileAllowFiles","fileExtensions"),a.fileMimetypes&&(i.fileMimetypes=a.fileMimetypes),p.isNumeric(a.fileMaxSize)&&(i.fileMaxSize=a.fileMaxSize),e.modal&&(-1!=(n=(o=i.toolbars[0]||[]).indexOf("fullscreen"))&&o.splice(n,1),i.toolbars=[o]),t.css("width","100%");function l(){p(c.document.body).toggleClass("no-has-contents",!c.hasContents())}var c=e.api=e.ueditor=UE.getEditor(e.editorId,i);t.on(m.validateErrorPlacement,function(e,t){return p("#"+c.key).after(t),!1}),c.on("beforefullscreenchange",function(e,t){this.options.topOffset=t?0:i.topOffset}),c.on("fullscreenchanged",function(e,t){p(this.container).toggleClass("edui-fullscreen",t)}),c.addListener("contentchange",function(){t.val(this.getContent("html")).baTriggerEvent("input").baTriggerEvent("change"),l()}),c.addListener("blur",function(){t.trigger("blur")}),c.addListener("focus",function(){t.trigger("focus")}),c.ready(function(){t.attr("id",e.elementId),c.execCommand("serverparam",{class_file_type:a.fileClass,class_image_type:a.imageClass,class_video_type:a.videoClass,class_value:a.classValue}),c.getOpt("enableAutoSave")&&(c.getContent()||c.execCommand("drafts")),t.prop("disabled")&&c.setDisabled(),p(c.document.head).append("<style>body.no-has-contents::before { content: attr(data-placeholder); position: absolute; pointer-events: none; cursor: text; color: #707070; } </style>"),c.placeholder(e.options.placeholder),l(),u.app.triggerResize(),e.formStatus.rendered(),h.triggerPluginReady(e.$element,e,"",m.editorInitialized)})},_api:function(e,t){return this.options.type!==o.ck5?this.ueditor?"function"==typeof e&&e.call(this):null:this.ckEditor?"function"==typeof t&&t.call(this):null},getApi:function(){return this.api},getContent:function(t){return this._api(function(){var e=this.ueditor;switch(t){case"html":return e.getContent();case"text":return e.getContentTxt();default:return e.getPlainTxt()}},function(){return this.ckEditor.getData()})},setContent:function(e){this._api(function(){this.ueditor.setContent(e+"")},function(){this.ckEditor.setData(e+"")})},append:function(e){this._api(function(){this.ueditor.setContent(e+"",!0)},function(){this.ckEditor.setData(this.ckEditor.getData()+e+"")})},hasContent:function(){return this._api(function(){return this.ueditor.hasContents()},function(){return 0<this.ckEditor.getData().length})},setFocus:function(e){this._api(function(){e?this.ueditor.focus():this.ueditor.blur()},function(){e&&this.ckEditor.focus()})},setDisabled:function(e){this._api(function(){e?this.ueditor.setDisabled():this.ueditor.setEnabled()},function(){this.ckEditor.isReadOnly=e})},setPlaceholder:function(e){this.options.placeholder=e,this._api(function(){this.ueditor.placeholder(e)},function(){this.ckEditor.config.set("placeholder",e),this.ckEditor.ui._initPlaceholder()})},exec:function(e){var t=Array.prototype.slice.call(arguments);return this._api(function(){return this.ueditor.execCommand.apply(this.ueditor,t)},function(){return this.ckEditor.execute.apply(this.ckEditor,t)})},destroy:function(){this.$form.off(this.resetEvent),this._api(function(){UE.delEditor(this.editorId),p("#edui_fixedlayer").remove(),this.ueditor=null},function(){this.ckEditor.destroy().catch(),this.ckEditor=null}),this.api=null}},y.DEFAULTS={type:"ue",name:"content",placeholder:"",classValue:"",imageClass:"",imageExtensions:null,imageMimetypes:null,imageMaxSize:null,videoClass:"",videoExtensions:null,videoMimetypes:null,videoMaxSize:null,fileClass:"",fileExtensions:null,fileMimetypes:null,fileMaxSize:null,imageManager:!0,videoManager:!0,fileManager:!0,showCount:!1,autoSave:!1,zindex:null,catchRemoteImage:!0,videoUpload:!1,autoHeight:!1,elementPath:!1,stickyToolbar:!1,stickyTopOffset:"auto",toolbar:null,mode:"",whitList:{a:["target","href","title","class","style"],abbr:["title","class","style"],address:["class","style"],area:["shape","coords","href","alt"],article:[],aside:[],audio:["autoplay","controls","loop","preload","src","class","style"],b:["class","style"],bdi:["dir"],bdo:["dir"],big:[],blockquote:["cite","class","style"],br:[],caption:["class","style"],center:[],cite:[],code:["class","style"],col:["align","valign","span","width","class","style"],colgroup:["align","valign","span","width","class","style"],dd:["class","style"],del:["datetime"],details:["open"],div:["class","style"],dl:["class","style"],dt:["class","style"],em:["class","style"],font:["color","size","face"],footer:[],h1:["class","style"],h2:["class","style"],h3:["class","style"],h4:["class","style"],h5:["class","style"],h6:["class","style"],header:[],hr:[],i:["class","style"],img:["src","alt","title","width","height","id","_src","loadingclass","class","data-latex"],ins:["datetime"],li:["class","style"],mark:[],nav:[],ol:["class","style"],p:["class","style"],pre:["class","style"],s:[],section:[],small:[],span:["class","style"],sub:["class","style"],sup:["class","style"],strong:["class","style"],table:["width","border","align","valign","class","style"],tbody:["align","valign","class","style"],td:["width","rowspan","colspan","align","valign","class","style"],tfoot:["align","valign","class","style"],th:["width","rowspan","colspan","align","valign","class","style"],thead:["align","valign","class","style"],tr:["rowspan","align","valign","class","style"],tt:[],u:[],ul:["class","style"],video:["autoplay","controls","loop","preload","src","height","width","class","style"]},locale:"zh-cn"},y.INDEX=0,y.UEDITOR_TYPES={default:{toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","selectall","cleardoc","|","rowspacingtop","rowspacingbottom","lineheight","|","paragraph","fontfamily","fontsize","|","directionalityltr","directionalityrtl","indent","|","justifyleft","justifycenter","justifyright","justifyjustify","|","touppercase","tolowercase","|","link","unlink","anchor","|","imagenone","imageleft","imageright","imagecenter","|","simpleupload","insertimage","attachment","insertvideo","scrawl","|","wordimage","insertcode","pagebreak","map","horizontal","date","time","spechars","|","inserttable","deletetable","insertparagraphbeforetable","insertrow","deleterow","insertcol","deletecol","mergecells","mergeright","mergedown","splittocells","splittorows","splittocols","|","print","preview","searchreplace"]]},small:{toolbars:[["fullscreen","source","|","undo","redo","|","bold","italic","underline","fontborder","strikethrough","superscript","subscript","removeformat","formatmatch","autotypeset","blockquote","pasteplain","|","forecolor","backcolor","insertorderedlist","insertunorderedlist","|","paragraph","fontsize","|","indent","justifyleft","justifycenter","justifyright","justifyjustify","|","link","unlink","anchor","|","simpleupload","insertimage","scrawl","|","horizontal","spechars","|","inserttable","deletetable","|","print","preview","searchreplace"]]},text:{toolbars:[["source","undo","redo","|","bold","italic","underline","removeformat","formatmatch","autotypeset","forecolor","link","unlink"]],enableContextMenu:!1,pasteplain:!0,filterTxtRules:function(){function e(e){e.tagName="p",e.setAttr("style",""),e.setAttr("class","")}return{"-":"script style object iframe embed input select textarea",p:{$:{}},a:{$:{href:"",target:"",title:""}},br:{$:{}},div:{$:{}},li:{$:{}},caption:e,th:e,tr:e,h1:e,h2:e,h3:e,h4:e,h5:e,h6:e,td:function(e){e.innerText()&&e.parentNode.insertAfter(UE.uNode.createText(" &nbsp; &nbsp;"),e),e.parentNode.removeChild(e,e.innerText())}}}()}},y.KEY=l,y.CKEDITOR_TYPES={default:{toolbar:["sourceEditing","|","undo","redo","|","heading","|","bold","italic","underline","strikethrough","link","superscript","subscript","removeFormat","|","fontColor","fontBackgroundColor","highlight","numberedList","bulletedList","todoList","|","fontFamily","fontSize","|","outdent","indent","|","alignment","|","blockQuote","uploadImage","insertTable","|","pageBreak","horizontalLine","codeBlock","specialCharacters","selectAll","findAndReplace"]},small:{toolbar:["sourceEditing","|","undo","redo","|","heading","|","bold","italic","underline","strikethrough","link","|","fontColor","fontBackgroundColor","bulletedList","numberedList","alignment","outdent","indent","|","blockQuote","uploadImage","insertTable","|","horizontalLine","specialCharacters","findAndReplace"]},text:{toolbar:["undo","redo","|","bold","italic","underline","strikethrough","link"]}},p.fn.baEditor=e,p.fn.baEditor.Constructor=y,u.plugins.Editor=y,u.autoInit(s,h.pluginAttrs(s),function(){e.call(this)}),y}),define("./ba/plug/elementUi",["busyAdmin","jquery"],function(i,r){var t=i.helper,e=i.e,o="element-ui",a=t.pluginKey(o),n=false,s=function e(t){if(n)return;n=true;l.ELEMENT=t;i.plugins.Vue.Vue.use(t)},l=function e(t,a){var n=this;n.element=t;n.$element=r(t);n.options=r.extend(true,{},i.plugins.Vue.DEFAULTS,n.$element.baData(o)||{},a||{});n.ready(n._init)};function c(e){return t.pluginFn(this,l,e,arguments,"api")}return l.prototype={ready:function(t){var a=this;window._BaElementUI&&(l.ELEMENT=window._BaElementUI,n=!0),n?t.call(a):i.plugins.Vue.ready(function(){i.require([i.lib.elementUi],function(e){s(e),t.call(a)})})},_init:function(){this.api=this.$element.baVue(this.options).data(i.plugins.Vue.KEY)}},l.ELEMENT=null,l.KEY=a,r.fn.baElementUI=c,r.fn.baElementUI.Constructor=l,i.plugins.ElementUI=l,i.autoInit(o,t.pluginAttrs(o),function(){c.call(r(this))}),l}),define("./ba/plug/filePicker",["busyAdmin","jquery"],function(n,i){var r=null,e=undefined,t=n.helper,o="file-picker",a=t.pluginKey(o),s=function e(t,a){var n=this;n.element=t;n.$element=i(t);n.options=i.extend(true,{},e.DEFAULTS,n.$element.baData(o)||{},a||{});n.ready(n._init)};function l(e){return n.helper.pluginFn(this,s,e,arguments,[],function(){this.options.show&&this.ready(this.show)})}return s.prototype={ready:function(t){var a=this;r?_typeof(t.call(a)):requirejs([n.lib.uploadConfig],function(e){r=e,_typeof(t.call(a))})},_init:function(){var e=this.options;this.$element.baModal({show:!1,keyboard:!1,title:e.title,zindex:e.zindex,type:"page",size:"lg",className:"ba-file-picker",url:r.picker,picker:this},!0)},show:function(){this.$element.baModal("show")},destroy:function(){}},s.LOCALE={delete:"删除",confirm:"确定",cancel:"取消",clear:"清空",search:"搜索",reset:"重置",upload:"上传",uploadSuccess:"上传成功",placeholder:"请输入关键词",currentInfo:"当前信息",allCategory:"所有分类",allFile:"全部文件",noData:"暂无相关文件",noExtensionsData:"暂无 <code>%s</code> 格式的文件",noSelect:"空",selected:"已选",pleaseSelectFile:"请选择文件",maxSelectAllowed:"最多允许选择%s个文件",pleaseSelectDelete:"请选择要删除的文件",confirmDeleteSelect:"确认要删除选中的%s个文件吗？",confirmDelete:"确认要删除选文件%s吗？"},s.KEY=a,s.DEFAULTS={show:!0,title:"",classType:"",classValue:"",maxSize:e,mimetypes:e,extensions:e,count:9,success:i.noop,zindex:"auto",locale:i.extend(s.LOCALE,((n.locale||{}).plugin||{}).filePicker||{})},i.fn.baFilePicker=l,i.fn.baFilePicker.Constructor=s,n.plugins.FilePicker=s,n.e.filePickerSuccess=n.ee("success",o),i("body").on("click."+a,t.pluginAttrs(o),function(e){l.call(i(this))}),s}),define("./ba/plug/form",["busyAdmin","jquery"],function(s,l){"use strict";var c=s.helper,e=s.ee,d=s.e,i="form",u=c.pluginKey(i);d.formInitialized=e("initialized",i),d.formCheck=e("check",i),d.formBefore=e("before",i),d.formComplete=e("complete",i),d.formSuccess=e("success",i),d.formError=e("error",i),d.formWaiting=e("waiting",i),d.formDisabled=e("disabled",i),d.formEnabled=e("enabled",i),d.formChildRender=e("child-render",i),d.formChildRendered=e("child-rendered",i),d.formChildRun=e("child-run",i),d.formChildRan=e("child-ran",i);var p=function e(t){return Array.prototype.slice.call(t)},f=function e(t,a){var n=this;n.element=t;n.$element=l(t);n.options=l.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n.renderChilds=[];n.runChilds=[];n.disabled=false;n._init()};function t(e){return c.pluginFn(this,f,e,arguments)}f.prototype={_init:function e(){var n=this;var t=n.$element;var a=n.options;if(!a.action)a.action=t.attr("action")||"";if(!a.action)a.action=document.URL;if(!a.method)a.method=t.attr("method")||"";if(!a.method)a.method=f.DEFAULTS.method;if(a.validate){var i=c.parseData(a,"validate");i.onSubmit=function(){n.submit();return false};t.baValidate(i)}else t.on("submit."+u,function(){n.submit();return false});t.on(d.formChildRun+"."+u,function(e,t,a){n.runChilds.push(t);n.setDisabled(true)}).on(d.formChildRan+"."+u,function(e,t,a){n._waitChildRan()}).on(d.formChildRender+"."+u,function(e,t,a){n.renderChilds.push(t);n.setDisabled(true)}).on(d.formChildRendered+"."+u,function(e,t,a){n._waitChildRendered()});var r=l.proxy(n.destroy,n);l(document).one(d.appRenderBefore,r);var o=n.$element.closestBaModal();if(o)o.$element.one(d.modalHide,r);c.triggerPluginReady(t,n,"",d.formInitialized)},_waitChildRendered:function e(){var a=this;clearTimeout(a._waitChildRenderedTimeId);a._waitChildRenderedTimeId=setTimeout(function(){for(var e=0;e<a.renderChilds.length;e++){var t=a.renderChilds[e];if(t&&t.data(d.formChildRendered)!==true){a._waitChildRendered();return}}a.setDisabled(false)},100)},_waitChildRan:function e(){var a=this;clearTimeout(a._waitChildRanTimeId);a._waitChildRanTimeId=setTimeout(function(){for(var e=0;e<a.runChilds.length;e++){var t=a.runChilds[e];if(t&&t.data(d.formChildRan)!==true){a._waitChildRan();return}}a.setDisabled(false)},100)},setDisabled:function e(t){var a=this;if(!a.$buttons)a.$buttons=a.$element.find(":submit,:reset");if(a.disabled&&t){c.execCallback(a,a.options.onWaiting,a.element,[],a.$element,d.formWaiting);return}a.$buttons.prop("disabled",t).toggleClass("disabled",t);a.disabled=t;c.execCallback(a,a.options[t?"onDisabled":"onEnabled"],a.element,[],a.$element,t?d.formDisabled:d.formEnabled)},submit:function e(){var t=this;var a=t.options;var n=t.$element;if(t.disabled){s.dialog.toast("请稍后在提交");return}if(a.validate&&!n.baValidate("valid"))return;if(false===c.execCallback(t,a.onCheck,t.element,[],n,d.formCheck,true,false))return;var i=a.confirm;if(i){if(t.dialog&&t.dialog.isShown())return;t.dialog=s.dialog.confirm(i,function(){t.request()})}else t.request()},request:function e(){var n=this;var i=n.options;var r=n.$element;var o=n.element;if(n.pending)return null;n._abort();n.pending=true;n.task=s.request(i.action).pending(i.pending,i.pendingMessage).method(i.method).params(r).before(function(e,t){return false!==c.execCallback(n,i.onBefore,o,p(arguments),r,d.formBefore,true,false)}).complete(function(e,t,a){n.pending=false;return false!==c.execCallback(n,i.onComplete,o,p(arguments),r,d.formComplete,true,false)}).success(function(e,t,a){if(false===c.execCallback(n,i.onSuccess,o,p(arguments),r,d.formSuccess,true,false))return false;if(i.onSuccess===false)return false;s.dialog.tipSuccess(e.message);return false}).error(function(e,t,a){if(false===c.execCallback(n,i.onError,o,p(arguments),r,d.formError,true,false))return false;if(i.onError===false)return false;s.dialog.tipError(e.message);return false}).exec();return n.task},reset:function e(){this.element.reset();this.$element.trigger("reset")},_abort:function e(){var t=this;if(t.task){t.task.abort();t.task=null}},destroy:function e(){var t=this;t.$element.off("."+u);t._abort();t.renderChilds=[];t.runChilds=[];t.disabled=false;clearTimeout(t._waitChildRenderedTimeId);clearTimeout(t._waitChildRanTimeId)}},f.KEY=u,f.DEFAULTS={confirm:"",pending:true,pendingMessage:"",method:"post",action:"",validate:true,onCheck:l.noop,onBefore:l.noop,onSuccess:l.noop,onError:l.noop,onComplete:l.noop};var a=function e(t,a){this.elem=t;this.$form=this.elem.closest("form");this.plugin=a};return a.prototype={render:function(){var e=this;return e.$form.length&&(e.elem.data(d.formChildRendered,!1),e.$form.triggerHandler(d.formChildRender,[e.elem,e.plugin])),e},rendered:function(){var e=this;return e.$form.length&&(e.elem.data(d.formChildRendered,!0),e.$form.triggerHandler(d.formChildRendered,[e.elem,e.plugin])),e},run:function(){var e=this;return e.$form.length&&(e.elem.data(d.formChildRan,!1),e.$form.triggerHandler(d.formChildRun,[e.elem,e.plugin])),e},ran:function(){var e=this;return e.$form.length&&(e.elem.data(d.formChildRan,!0),e.$form.triggerHandler(d.formChildRan,[e.elem,e.plugin])),e}},l.fn.baFormStatus=function(e){return new a(this,e)},l.fn.baForm=t,l.fn.baForm.Constructor=f,s.plugins.Form=f,s.regSugar(i,function(e,t,a){var n;e&&(n=l(this),a.api instanceof s.plugins.Modal&&(n=a.api.$form),(n=n.data(f.KEY))instanceof f&&n[e](t))}),s.autoInit(i,c.pluginAttrs(i),function(){t.call(this)}),f}),define("./ba/plug/high",["busyAdmin","jquery"],function(n,i){"use strict";var s=null,l=n.helper,r="high-code",e=l.pluginKey(r);n.e.highCodeInitialized=n.ee("initialized",r);var c=function e(t,a){var n=this;n.$element=i(t);n.$wrap=null;n.options=i.extend(true,{},e.DEFAULTS,n.$element.baData(r)||{},a||{});n.ready(n._init)};function t(e){return l.pluginFn(this,c,e,arguments)}return c.prototype={ready:function(t){var a=this;s?t.call(a):requirejs([n.lib.highlight],function(e){s=e,t.call(a)})},_init:function(){var e=this,t=e.options,a=e.$element;e.$wrap=i(c.parse(a.html(),t.type,"",t.locale.copy)),a.hide().after(e.$wrap),l.triggerPluginReady(a,e,"",n.e.HighCodeInitialized)},reload:function(){this.$wrap&&this.$wrap.remove(),this._init()},destroy:function(){}},c.KEY=e,c.DEFAULTS={type:"auto",locale:i.extend({copy:"复制"},((n.locale||{}).plugin||{}).highCode||{})},c.highlight=null,c.parse=function(e,t,a,n){var i;null===s&&(s=c.highlight);var r="",o=l.uuid();return e=(e||"").trim(),"string"==typeof t&&t&&"auto"!==t?(i=s.highlight(t,e).value,r=t):(t="code",i=s.highlightAuto(e).value),'<div class="ba-high-code '+(a||"")+'"><div class="ba-high-code-title"><a href="javascript:void(0)" class="pull-right" data-toggle="busy-copy" data-target="#'+o+'" data-on-decode="html">'+(n||"复制")+"</a>"+t+'</div><pre><code class="hljs '+r+'">'+(i="<ol><li>"+i.replace(/\n/g,"</li><li>")+"</li></ol>")+'</code></pre><script type="text/plain" id="'+o+'">'+l.htmlToEscape(e)+"<\/script></div>"},i.fn.baHighCode=t,i.fn.baHighCode.Constructor=c,n.plugins.High=c,n.autoInit(r,l.pluginAttrs(r),function(){t.call(this)}),c}),define("./ba/plug/iconPicker",["busyAdmin","jquery"],function(e,p){"use strict";var f,h=e.helper,t=e.ee,m=e.e,i="icon-picker",r=h.pluginKey(i),a=function e(t,a){var n=this;n.element=t;n.$element=p(t);n.index=e.INDEX++;n.options=p.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n.defaultValue=n._getValue();n.resetEvent="reset."+r+n.index;n.$form=n.$element.closest("form");n.$form.on(n.resetEvent,function(){n.setValue(n.defaultValue)});n.ready(n._init)};function n(e){return h.pluginFn(this,a,e,arguments,null,function(){this.options.show&&this.show()})}return a.prototype={ready:function(t){var a=this;f?t.call(a):requirejs(["bicon/busy-icon-data"],function(e){f=e,t.call(a)})},_init:function(){var a,i=this,e=i.options,t=e.locale,r=i.$element,n="",o="",s=0;for(a in f){var l=f[a],c=0===s?" active":"",d="__ba_icon_tab"+s;n+='<li class="'+c+'"><a href="#'+d+'" data-toggle="tab">'+l.name+' <span class="badge badge-primary">'+l.list.length+"</span></a></li>",o+='<div class="tab-pane'+c+'" id="'+d+'"><ul>',l.list.map(function(e){var t=a+" "+a+"-"+e;o+='<li><span class="keyword hide">'+e+'</span><a href="javascript:void(0);" icon="'+t+'"><i class="'+t+'"></i><span>'+e+"</span></a></li>"}),o+="</ul></div>",s++}var u=p('<div class="ba--content"><ul class="nav nav-lines nav-justified">'+n+'</ul><div class="form-horizontal"><input type="text" class="form-control" placeholder="'+t.search+'"/></div><div class="tab-content">'+o+"</div></div>");r.baModal({show:!1,type:"page",content:u,title:t.title,className:"ba-icon-picker",cancel:t.clear,onCancel:function(){i.setValue(""),r.baModal("close"),h.execCallback(i,e.onClear,i.element,[],r,m.iconPickerClear)},padding:0,onShown:function(e){var t=i.$content=e.$dialogBody.find(".ba--content");t.on("click","[icon]",function(){var e=p(this).attr("icon");i.setValue(e),r.baModal("close")}),t.on("input",".form-control",function(){var e=p(this).val().trim();e?(t.find(".keyword:contains("+e+")").parent().show(),t.find(".keyword:not(:contains("+e+"))").parent().hide()):t.find(".keyword").parent().show()}),t.find(".active[icon]").removeClass("active");var a=t.find('[icon="'+i._getValue()+'"]').addClass("active"),n=a.closest(".tab-pane").attr("id");n&&(e=a.closest(".tab-content"),t.find('[href="#'+n+'"]').trigger("click"),e.scrollTop(a.offset().top-e.offset().top+e.scrollTop()))}},!0)},_getValue:function(){var t;return this.$element.is(":input")&&(t=this.$element.val().trim()),!t&&this.options.target&&p(this.options.target).each(function(){var e=p(this);if(t=e.is(":input")?e.val().trim():e.attr("class"))return!1}),t||""},setValue:function(t){var e=this.$element,a=this.options;e.is(":input")&&e.val(t).baTriggerEvent("input").baTriggerEvent("change"),a.target&&p(a.target).each(function(){var e=p(this);e.is(":input")?e.val(t).baTriggerEvent("input").baTriggerEvent("change"):e.removeAttr("class").addClass(t||"icon-placeholder")}),h.execCallback(this,a.onSelect,this.element,[t],e,m.iconPickerSelect)},show:function(){var e=this;e.ready(function(){e.$element.baModal("show")})},destroy:function(){this.$form.off(this.resetEvent)}},a.INDEX=0,a.KEY=r,a.DEFAULTS={show:!0,target:null,locale:p.extend({},{title:"图标选择器",clear:"清空",search:"搜索图标"},((e.locale||{}).plugin||{}).iconPicker||{})},p.fn.baIconPicker=n,p.fn.baIconPicker.Constructor=a,e.plugins.IconPicker=a,m.iconPickerSelect=t("select",i),m.iconPickerClear=t("clear",i),p("body").on("focus."+r,':input[data-toggle="busy-'+i+'"],:input[busy-'+i+"]",function(){n.call(p(this))}).on("click."+r,'[data-toggle="busy-'+i+'"]:not(:input),[busy-'+i+"]:not(:input)",function(e){n.call(p(this))}),a}),define("./ba/plug/imageViewer",["busyAdmin","jquery"],function(r,o){var s=r.helper,l=r.e,i="image-viewer",c=s.pluginKey(i),t=function e(t,a){var n=this;n.element=t;n.isSingle=false;n.$element=o(t);n.$img=null;n.options=o.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n.api=null;n.$body=o("body");n.ready(n._init)};function e(e){return s.pluginFn(this,t,e,arguments,"api",function(){if(!this.options.clickHandler&&this.options.src)this.show()})}return t.prototype={ready:function(e){var t=this;o.fn.viewer?e.call(t):requirejs([r.lib.imageViewer],function(){e.call(t)})},_init:function(){var t=this,a=t.options,e=t.$element,n=o.proxy(t.destroy,t);o(document).one(l.appRenderBefore,n);var i=e.closestBaModal();i&&i.$element.one(l.modalHided,n),a.button=a.showClose,a.navbar=a.thumbs,a.url="data-src",a.zIndex=r.zIndex(),a.hidden=function(){t._clear()},a.filter=s.scope(a.filter),a.filter||(a.hasClass?a.filter=function(e){return o(e).hasClass(a.hasClass)}:e.closestBaTableEl().length&&(a.filter=function(e){return o(e).elInBaTable()})),a.src?(t.isSingle=!0,t.$img=o('<img data-src="'+a.src+'" style="display: none;" alt="'+a.alt+'"/>'),e.append(t.$img),a.clickHandler&&e.off("click."+c).on("click."+c,function(e){return e.preventDefault(),t.show(),!1})):t.isSingle="img"===t.element.tagName.toLowerCase(),t.isSingle?(a.navbar=!1,"boolean"==typeof a.control?a.toolbar=a.control:a.toolbar=!1):"boolean"==typeof a.control?a.toolbar=a.control:a.toolbar=!0,e.viewer(a),t.api=e.data("viewer"),s.triggerPluginReady(e,t,"",l.imageViewerInitialized)},show:function(e){this.ready(function(){this.$element.viewer("view",e||0)})},hide:function(){this.ready(function(){this.$element.viewer("hide")})},update:function(e){var t=this;t.ready(function(){t.options=o.extend({},t.options,e||{}),t.options.src&&t.$img.attr("src",t.options.src).attr("alt",t.options.alt),t.api&&(t.api.update(),t._clear())})},_clear:function(){var e=this.api;e&&e.ready&&(e.ready=!1,e.viewer.parentNode.removeChild(e.viewer))},destroy:function(){var e=this;e.$img&&(e.$img.remove(),e.$img=null),e.api&&(e.api.destroy(),e.api=null),e.options.src&&e.options.clickHandler&&e.$element.off("click."+c)}},t.KEY=c,t.DEFAULTS={clickHandler:!0,backdrop:!0,showClose:!0,fullscreen:!0,keyboard:!0,loading:!0,loop:!0,movable:!0,rotatable:!0,scalable:!0,title:!0,alt:"",control:void 0,transition:!1,zoomable:!0,thumbs:!0,src:"",filter:null,hasClass:null},o.fn.baImageViewer=e,o.fn.baImageViewer.Constructor=t,r.plugins.ImageViewer=t,l.imageViewerInitialized=r.ee("initialized",i),r.autoInit(i,s.pluginAttrs(i),function(){e.call(this)}),t}),define("./ba/plug/linkagePicker",["busyAdmin","jquery","bootstrap"],function(o,p){var s=o.helper,e=o.ee,l=o.e,i="linkage-picker",n=p("body"),c=p(window),t=s.pluginKey(i),a=function e(t,a){var n=this;n.showing=false;n.uuid=n.getUID("linkage_picker");n.wrapId="__ba_"+n.uuid;n.selectData=[];n.selectIndex=[];n.pickerData=[];n.$value=p(t);n.$form=n.$value.closest("form");n.formStatus=n.$value.baFormStatus(n).render();n.placeholder=n.$value.attr("placeholder")||"请选择";n.$wrap=p('<div class="ba-linkage-picker">    <div class="ba--container">        <input type="text" readonly class="form-control ba--input"/>        <i class="fa fa-angle-down ba--caret"></i>        <i class="bicon bicon-close-o ba--clear"></i>        <i class="fa fa-spinner fa-spin ba--spinner"></i>    </div></div>');n.$wrap.insertAfter(n.$value);n.$wrap.prepend(n.$value);n.$caret=n.$wrap.find(".ba--caret");n.$clear=n.$wrap.find(".ba--clear");n.$loading=n.$wrap.find(".ba--spinner");n.$input=n.$wrap.find(".ba--input").addClass(n.$value.attr("class")||"").attr("placeholder",n.placeholder);n.$value.addClass("input-hidden");n.init("linkagePicker",n.$wrap[0],a);n.values=[];var i=n.options;n.$value.val().trim().split(i.idSpace).map(function(e){var t=e.trim();if(t!=="")n.values.push(t)});n.$content=n.tip().find(".popover-content");n.childField=i.childField||"child";n.idField=i.idField||"id";n.nameField=i.nameField||"name";n.parentField=i.parentField||"parent";n.disabledField=i.disabledField||"disabled";n.parentRoot=i.parentRoot||"";n.initEvent();n.setList(i.list);if(n.values.length>0&&(i.model||i.url)){n.$wrap.addClass("ba--loading");n.$input.attr("placeholder",i.locale.loading);n.request(function(e){if(!e){n.$input.attr("placeholder",n.placeholder);n.$wrap.removeClass("ba--loading")}else n.initDefault(false);n.formStatus.rendered();s.execCallback(n,i.onReady,t,[],n.$value,l.linkagePickerReady)})}else{n.initDefault(false);n.formStatus.rendered();s.execCallback(n,i.onReady,t,[],n.$value,l.linkagePickerReady)}n.setDisabled(n.$value.prop("disabled"));var r=p.proxy(n.destroy,n);p(document).one(l.appRenderBefore,r);var o=n.$value.closestBaModal();if(o)o.$element.one(l.modalHide,r);s.triggerPluginReady(n.$value,n,"",l.linkagePickerInitialized)};a.prototype=p.extend({},p.fn.popover.Constructor.prototype,{initEvent:function e(){var r=this;var t=r.options;if(!t.strict&&!t.multiple)r.$content.on("click","label",function(e){var t=p(this).closest("li");r.handleClick(t);if(t.hasClass("disabled"))return;r.selectComplete()});r.$content.on("click","li",function(e){if(e.target.tagName==="LABEL")return;if(r.handleClick(p(this)))r.selectComplete()});r.$form.on("reset."+r.uuid,function(){setTimeout(function(){r.initDefault(true)},1)});n.on("click."+r.uuid,function(e){var t=p(e.target);if(t.closest(r.tip()).length||t.closest(r.$element).length||t.closest(r.$wrap).length)return;if(r.showing)r.hide()});c.on("resize."+r.uuid,function(){if(r.showing)r.autoPosition()});var a=r.$value;if(t.clear){r.$wrap.addClass("ba--has-clear");r.$clear.on("click",function(e){e.preventDefault();r.selectData=[];r.selectIndex=[];r.setValue(true);r.$wrap.removeClass("ba--has-value");if(r.showing)r.hide();s.execCallback(r,t.onClear,a[0],[r],a,l.linkagePickerClear)})}r.$wrap.on("click",function(e){var t=p(this);if(p(e.target).closest(r.$clear).length||t.hasClass("ba--loading")||t.hasClass("disabled")||r.showing)return;if(t.hasClass("focus")){r.hide();return}r.show()}).on("shown.bs.linkagePicker",function(){r.selectIndex.map(function(e,t){var a=r.$content.find(".ba--wrap-"+t);var n=a.find("li.active");if(n.length>0){var i=(a.outerHeight(true)-n.outerHeight(true))/2;a.scrollTop(n.offset().top-(a.offset().top+i)+a.scrollTop())}});s.execCallback(r,t.onShown,a[0],[r],a,l.linkagePickerShown)}).on("show.bs.linkagePicker",function(){r.showing=true;r.$wrap.addClass("focus");s.execCallback(r,t.onShow,a[0],[r],a,l.linkagePickerShow)}).on("hide.bs.linkagePicker",function(){r.$wrap.removeClass("focus");r.showing=false;s.execCallback(r,t.onHide,a[0],[r],a,l.linkagePickerHide)}).on("hidden.bs.linkagePicker",function(){s.execCallback(r,t.onHided,a[0],[r],a,l.linkagePickerHided)});a.on(l.validateErrorPlacement,function(e,t){r.$wrap.after(t);return false})},getDefaults:function e(){return p.extend({},a.DEFAULTS,{trigger:"manual",template:'<div class="popover ba-linkage-picker-popover" role="tooltip"><div class="arrow"></div><div class="popover-content"></div></div>',placement:"autobottom",viewport:"body"})},getOptions:function e(t){var a=this;t=p.extend({},a.getDefaults(),a.$value.baData(i),t);if(!t.container){var n=a.$value.closest(".modal");if(n.length)t.container=n;else t.container="body"}if(t.delay&&typeof t.delay=="number")t.delay={show:t.delay,hide:t.delay};return t},getCalculatedOffset:function e(t,a,n,i){if(t=="bottom")return{top:a.top+a.height,left:a.left};else return{top:a.top-i,left:a.left}},autoPosition:function e(){var t=this;var a=t.tip();var n="bottom";var i=t.getPosition();var r=a[0].offsetWidth;var o=a[0].offsetHeight;var s=t.getPosition(t.$viewport);if(i.bottom+o>s.bottom)n="top";a.removeClass("top bottom").addClass(n);t.applyPlacement(t.getCalculatedOffset(n,i,r,o),n)},replaceArrow:function e(t,a,n){this.arrow().css("left",this.$wrap.offset().left-this.tip().offset().left+45+"px")},hasContent:function e(){return true},setContent:function e(){var i=this;var t=i.options;var r=i.$content;var a=function e(){var n=i.selectIndex.length;if(n>0){r.html("");i.selectIndex.map(function(e,t){var a=i.createPicker(i.pickerData[t],t,e);r.find(".ba--wrap-"+t).remove();r.append(a);if(!i.options.strict&&!i.options.multiple&&t===n-1)a.find("li.active").find("input").prop("checked",true)})}else if(i.pickerData.length)r.html(i.createPicker(i.pickerData[0],0,-1));else r.html('<div style="width: '+(i.$wrap.width()-2)+'px" class="ba--empty">'+t.emptyText+"</div>")};if((t.model||t.url)&&!t.list.length){var n=p('<div style="width: '+(i.$wrap.width()-2)+'px" class="ba--loading"><i class="fa fa-spinner fa-spin"></i> <span>'+t.locale.loading+"</span></div>");r.html(n);i.request(function(e){if(!e)n.remove();else{i.initDefault();a()}});return}a()},request:function e(n){var i=this;var t=i.options;var a={model:t.model,extend:t.modelExtend?1:0,id_field:t.modelIdField||"",name_field:t.modelNameField||"",parent_field:t.modelParentField||"",disabled_field:t.modelDisabledField||"",order:t.modelOrder||""};var r=s.scope(t.params);if(typeof r==="function")r=r.call(i,a);a=p.extend(true,{},r||{},a);i._abort();i.task=o.request(t.model?o.getConfig("linkagePicker").url:t.url).method(t.method).addHeader("Busy-Admin-Plugin","LinkagePicker").pending(false).params(a).complete(function(e,t,a){n(false)}).error(function(e,t,a){return false}).success(function(e,t,a){i.setList(e.result.data);n(true);return false}).exec()},_abort:function e(){if(this.task){this.task.abort();this.task=null}},setList:function e(t){t=t||[];if(!t.length)return;var a=this;if(t.length>0&&(t[0]||{}).hasOwnProperty(a.childField))a.options.list=t;else a.options.list=s.listToTree(t,a.idField,a.childField,a.parentField,a.parentRoot)},createPicker:function e(t,o,s){var l=this;var c="";var d=l.options.strict;var u=l.options.multiple;t.map(function(e,t){var a=e[l.childField]||[];var n="";var i=e[l.disabledField]?" disabled":"";var r=l.uuid+"_"+o+"_"+t;if(!d||u)if(u)n='<div class="ba--checkbox"><input '+i+' type="checkbox" id="__checkbox_'+r+'"/><label class="bicon" for="__checkbox_'+r+'"></label></div>';else n='<div class="ba--radio"><input '+i+' type="radio" id="__radio_'+r+'" name="__radio_'+l.uuid+'"/><label class="bicon" for="__radio_'+r+'"></label></div>';else n='<div class="ba--check"><i class="bicon bicon-check"></i></div>';c+="<li "+i+' class="'+(s===t?"active":"")+i+'" data-index="'+t+'" data-picker-index="'+o+'">                    '+n+"                    <span>"+e[l.nameField]+'</span>                    <i class="ba--angle fa fa-angle-right '+(a.length>0?"":"hide")+'"></i>                </li>'});return p('<div class="ba--wrap ba--wrap-'+o+'"><ul>'+c+"</ul></div>")},handleClick:function e(t){var a=this;var n=t.data();var i=n.index;var r=n.pickerIndex;var o=(a.pickerData[r]||[])[i]||null;var s=o[a.childField]||[];var l=a.pickerData.length;for(var c=l;c>r;c--){a.$content.find(".ba--wrap-"+c).remove();a.pickerData.splice(c,1);a.selectData.splice(c-1,1);a.selectIndex.splice(c-1,1)}t.siblings().removeClass("active");t.addClass("active");a.selectData.push(o);a.selectIndex.push(i);if(s.length>0){a.pickerData.push(s);a.$content.find(".ba--wrap-"+(r+1)).remove();a.$content.append(a.createPicker(s,r+1,-1));a.autoPosition();return false}else return!o[a.disabledField]},selectComplete:function e(){var t=this;t.hide();t.setValue(true);s.execCallback(t,t.options.onChanged,t.$value[0],[t,t.selectData,t.selectIndex],t.$value,l.linkagePickerChanged)},setValue:function e(t){var a=this;var n=[];var i=[];a.selectData.map(function(e){n.push(e[a.nameField]);i.push(e[a.idField])});if(a.options.nameAllPath)a.$input.val(n.join(a.options.nameSpace));else a.$input.val(n[n.length-1]);a.$value.val(i.join(a.options.idSpace));t&&a.$value.baTriggerEvent("input").baTriggerEvent("change");if(i.length>0)a.$wrap.addClass("ba--has-value")},initDefault:function e(t){var a=this;var n=0;var i=a.options.list||[];a.selectData=[];a.selectIndex=[];a.pickerData=[];do{var r=a.values[n]||null;if(r===null)break;var o=null;var s=-1;p.each(i,function(e,t){if(t[a.idField]==r){o=t;s=e;return false}});if(!o||s==-1)break;a.selectData.push(o);a.pickerData.push(i);a.selectIndex.push(s);i=o[a.childField]||[];n++}while(true);i=a.options.list||[];if(!a.pickerData.length&&i.length>0)a.pickerData=[i];a.setValue(t)},setDisabled:function e(t){this.$wrap.toggleClass("disabled",t);this.$input.prop("disabled",t)}});var r=s.extends(a.prototype,{destroy:function e(){var t=this;if(t.destroyed)return;t.destroyed=true;t._abort();n.off("click."+t.uuid);c.off("resize."+t.uuid);t.$value.off(l.validateErrorPlacement);t.$form.off("reset."+t.uuid);s.override(r,"destroy",t,arguments)}});function d(e){return s.pluginFn(this,a,e,arguments)}return a.KEY=t,a.DEFAULTS={list:[],idField:null,nameField:null,childField:null,parentField:null,disabledField:null,parentRoot:"",strict:!0,multiple:!1,clear:!1,url:"",params:null,method:"get",model:"",modelExtend:!1,modelIdField:"",modelNameField:"",modelParentField:"",modelDisabledField:"",modelOrder:"",idSpace:",",nameSpace:"/",nameAllPath:!0,container:"",onChanged:p.noop,onClear:p.noop,onShow:p.noop,onShown:p.noop,onHide:p.noop,onHidden:p.noop,emptyText:"无选项",locale:p.extend({},{loading:"请稍后..."},((o.locale||{}).plugin||{}).linkagePicker||{})},p.fn.baLinkagePicker=d,p.fn.baLinkagePicker.Constructor=a,o.plugins.LinkagePicker=a,l.linkagePickerInitialized=e("initialized",i),l.linkagePickerShow=e("show",i),l.linkagePickerShown=e("shown",i),l.linkagePickerHide=e("hide",i),l.linkagePickerHided=e("hidden",i),l.linkagePickerChanged=e("changed",i),l.linkagePickerClear=e("clear",i),l.linkagePickerReady=e("ready",i),o.autoInit(i,s.pluginAttrs(i),function(){d.call(this)}),a}),define("./ba/plug/markdown",["busyAdmin","jquery"],function(s,l){"use strict";var c=s.helper,d=null,u=null,i="markdown",p=c.pluginKey(i);s.e.markdownInitialized=s.ee("initialized",i);var t=function e(t,a){var n=this;n.$element=l(t);n.$wrap=null;n.options=l.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n.ready(n.init)};function e(e){return c.pluginFn(this,t,e,arguments)}return t.prototype={ready:function(a){var i=this;d&&l.fn.baHighCode.Constructor.highlight?a.call(i):requirejs([s.lib.marked,s.lib.highlight],function(e,t){(d=new(u=e).Renderer).paragraph=function(e){return'<p class="markdown-paragraph">'+e+"</p>"},d.blockquote=function(e){return'<blockquote class="markdown-blockquote">'+e+"</blockquote>"},d.list=function(e,t,a){var n=t?"ol":"ul";return"<"+n+' class="markdown-'+n+'" '+(t&&a?'start="'+a+'"':"")+">"+e+"</"+n+">"},d.table=function(e,t){t=l('<div class="table-responsive markdown-table-responsive"><table class="table table-hover table-striped table-bordered markdown-table"><thead> '+e+" </thead> <tbody> "+t+" </tbody></table></div>");return t.find("thead th").each(function(){var e=l(this).addClass("text-center"),t=e.text().trim();t.indexOf(":")&&(t=t.split(":"),e.attr("width",(t[1]||"").trim()),e.html((t[0]||"").trim()))}),t.find("tbody td").each(function(){var t,e=l(this).addClass("text-vtop"),a=e.html().trim();!a.indexOf(":")||"title"===((t=a.split(":"))[1]||"").trim()&&(a=e.closest("tr").addClass("info text-bold").find("td"),e.attr("colspan",a.length),a.each(function(e){0<e?l(this).remove():l(this).html((t[0]||"").trim())}))}),t[0].outerHTML},d.code=function(e,t){if(0!==t.indexOf("demo"))return'<div class="markdown-code">'+l.fn.baHighCode.Constructor.parse(e,t,"",i.options.locale.copy)+"</div>";var a=t.split(":")[1]||"实例",t=e.split("\n"),n={};t.map(function(e){-1!==(e=e.trim()).indexOf(":")&&(e=e.split(":"),n[e[0].trim()]=(e[1]||"").trim())});e=l(e.trim()),e=c.escapeToHtml(e.html().trim());return'<div class="ba-demo panel panel-default"><div class="ba-demo-title panel-heading"><h3 class="panel-title">'+a+'</h3></div><div class="panel-body ba-demo-content">'+e+'</div><div class="ba-demo-code">'+l.fn.baHighCode.Constructor.parse(e,"html","",i.options.locale.copy)+'</div><div class="panel-footer ba-demo-control"><a href="javascript:void(0)"><i class="fa fa-caret-down"></i> '+i.options.locale.showCode+"</a></div></div>"},d.heading=function(e,t){return"<h"+t+' class="markdown-heading" id="'+c.base64Encode(e+":"+t).replace(/([=\/+])/g,"")+'">'+e+"</h"+t+">"},d.link=function(e,t,a){return'<a class="markdown-link" href="'+e+'" target="_blank" title="'+(t||a)+'">'+a+"</a>"},l.fn.baHighCode.Constructor.highlight=t,a.call(i)})},init:function(){var e=this,t=e.$element,a=e.options,n=t.html();n=(n=n.replace(/<\\script/gi,"<script")).replace(/<\\\/script>/gi,"<\/script>");var i=u(n,{renderer:d}),r=l('<div class="row" />'),o=l('<div class="col-sm-12 ba-markdown-content" />'),n=l('<div class="col-sm-3 col-sm-push-9 ba-markdown-catalog" />');a.catalog&&(o=l('<div class="col-sm-9 col-sm-pull-3 ba-markdown-content"/>'),r.append(n)),r.append(o),o.html(i),e.$wrap=l('<div class="ba-markdown" />').append(r),t.hide().after(e.$wrap),o.find(".ba-demo-control a").on("click."+p,function(){var e=l(this),t=e.parent(".ba-demo-control").prev();t.data("opened")?t.slideUp(function(){t.data("opened",!1),e.html('<i class="fa fa-caret-down"></i> '+a.locale.showCode+"</a>")}):t.slideDown(function(){t.data("opened",!0),e.html('<i class="fa fa-caret-up"></i> '+a.locale.hideCode+"</a>")})}),a.catalog&&e.catalog(o,n),c.triggerPluginReady(t,e,"",s.e.markdownInitialized)},catalog:function(e,t){var a=l(document.body).offset().top+l(document.body).outerHeight(!0),e=e.offset().top+e.outerHeight(!0);this.$wrap.baCatalog({container:t,filterSelector:".ba-demo",scroll:this.options.catalogScroll,sticky:!s.app.isMobileSize()&&this.options.catalogSticky,top:s.app.getContentFrame().top+this.options.catalogTop,bottom:a-e+this.options.catalogBottom})},reload:function(){null!==this.$wrap&&this.$wrap.remove(),this.init()},destroy:function(){}},t.KEY=p,t.DEFAULTS={catalog:!0,catalogScroll:!0,catalogSticky:!0,catalogTop:15,catalogBottom:15,locale:l.extend({showCode:"显示代码",hideCode:"隐藏代码",copy:"复制"},((s.locale||{}).plugin||{}).markdown||{})},l.fn.baMarkdown=e,l.fn.baMarkdown.Constructor=t,s.plugins.Markdown=t,s.autoInit(i,c.pluginAttrs(i)+',script[type="text/x-markdown"]',function(){e.call(this)}),t}),define("./ba/plug/modal",["busyAdmin","jquery","bootstrap"],function(r,l){"use strict";var c=r.helper,n=r.ee,o=r.e,s="modal",d=c.pluginKey(s),i=l(window),e=l("body");o.modalRenderBefore=n("render-before",s),o.modalReady=n("ready",s),o.modalShow=n("show",s),o.modalShown=n("shown",s),o.modalHide=n("hide",s),o.modalHided=n("hidden",s),o.modalOk=n("ok",s),o.modalCancel=n("cancel",s);var u=c.extends(l.fn.modal.Constructor.prototype,{adjustDialog:function e(){var t=this;if(!t.baModal){c.override(u,"adjustDialog",t,arguments);return}if(t.baModal.options.drawer)return;if(!t.$win)t.$win=l(window);var a=t.$dialog.height();var n=t.$win.height();var i=t.$win.width();var r=i<=767;var o=r?15:30;if(a+o*2>=n)t.$dialog.css("margin",o+"px auto");else{var s=(n-a)/2-1;t.$dialog.css("margin",s+"px auto")}},show:function e(){var t=this;if(!t.baModal){c.override(u,"show",t,arguments);return}if(!t.isShown)m.INDEX++;c.override(u,"show",t,arguments);var a=t.options.zindex==="auto"?r.zIndex(2):t.options.zindex;t.$element.css("z-index",a);t.$backdrop&&t.$backdrop.addClass("ba-modal-backdrop").css("z-index",a-1)},hide:function e(){var t=this;if(t.baModal)if(typeof t.options.hideCallback==="function")if(false===t.options.hideCallback.call(t))return;if(t.isShown)m.INDEX--;c.override(u,"hide",t,arguments)},hideModal:function e(){var t=this;if(!t.baModal){c.override(u,"hideModal",t,arguments);return}t.$element.hide();t.backdrop(function(){t.reset();t.$element.trigger("hidden.bs.modal")})},reset:function e(){var t=this;if(m.INDEX<=0){t.$body.removeClass("modal-open");t.originalBodyPad="";t.resetAdjustments();t.resetScrollbar()}}}),p=function e(t){if(!t)return"";if(-1===t.indexOf(" "))t="fa "+t;return'<i class="'+t+'"></i> '},f=1,t=0,h=function e(){return"__ba_modal_"+t++},m=function e(t,a){var n=this;n.element=t;n.$element=l(t);n.options=l.extend(true,{},e.DEFAULTS,n.$element.baData(s)||{},a||{});n._defaults={};n.api=null;n.uuid=d+ ++f;var i=n.options;if(!i.url&&!i.content)i.url=n.$element.getUrl();if(i.ok!==false&&l.baIsEmpty(i.ok))i.ok=i.ok||i.locale.confirm;if(i.cancel!==false&&l.baIsEmpty(i.cancel))i.cancel=i.locale.cancel;if(typeof i.buttons==="string")i.buttons=c.scope(i.buttons,[]);if(l.baIsEmpty(i.title)||i.title==="")i.title=n.$element.attr("title")||"";n.ajax=!!i.url&&!i.content;n.leftButtons=[];n.rightButtons=[];n.resizeEvent="resize."+n.uuid;n.mountedEvent=o.vueMounted+"."+n.uuid;l(document).one(o.appRenderBefore,function(){n.destroy()})};function a(e){return c.pluginFn(this,m,e,arguments,"api",function(){this.options.show&&this.show()})}return m.prototype={resetNodes:function(){var e,t,a,n=this,i=n.options;return n.$dialogContent=n.$dialog.find(".modal-content"),n.$dialogHeader=n.$dialogContent.find(".modal-header"),n.$dialogClose=n.$dialogHeader.find(".close"),n.$dialogTitle=n.$dialogContent.find(".modal-title"),n.$dialogBody=n.$dialogContent.find(".modal-body"),n.$dialogFooterUse=n.$dialogContent.find(".modal-footer-use").hide(),n.$dialogFooter=n.$dialogContent.find(n.use?".modal-footer":".modal-footer-sys"),n.$cancelBtn=n.$dialogContent.find('[data-dismiss="modal"]:not(.close)'),n.$okBtn=n.$dialogContent.find('[data-primary="modal"]'),n.$okBtn.off("click").on("click",function(){if(!1!==l(this).data("click")){var e=[];if(!n.$form&&i.select){if("baTable"===i.select&&(e=n.$container.findBaTable("getSelections")),e=e||[],0<i.selectMin){if(e.length<=0)return void r.dialog.toast(i.selectTip||"请选择");if(e.length<i.selectMin)return void r.dialog.toast(c.sprintf(i.selectMinTip||"至少需要选择%s项",i.selectMin))}if(0<i.selectMax&&e.length>i.selectMax)return void r.dialog.toast(c.sprintf(i.selectMaxTip||"最多允许选择%s项",i.selectMax))}!1!==c.execCallback(n,i.onOk,n.element,[n,e],[n.$element,r.app.$doc],o.modalOk,!0,!1)&&(n.$form?n.submit():n.close())}}),i.move&&!i.drawer&&(e="mousedown."+n.uuid,t="mousemove."+n.uuid,a="mouseup."+n.uuid,l(document).off(a).on(a,function(e){n.moveing=!1}),n.$dialogHeader.off(e).off(t).off(a).on(e,function(e){1==e.which&&(n.moveing=!0,n.moveData={x:e.clientX,y:e.clientY,left:n.$dialog.position().left,top:n.$dialog.position().top})}).on(t,function(e){var t;n.moveing&&(t=e.clientX-n.moveData.x,e=e.clientY-n.moveData.y,n.$dialog.css({left:n.moveData.left+t+"px",top:n.moveData.top+e+"px"}))})),n.resetView(),n},_create:function(){var e,t=this,a=t.options;return t.$container=l(m.TEMPLATE).addClass(a.className).data(m.KEY,t).toggleClass("fade",a.fade),a.drawer&&(e="boolean"==typeof a.drawer?"right":a.drawer,t.$container.addClass("ba-drawer").addClass("ba-drawer--"+e),a.fixedTop&&t.$container.addClass("ba--fixed-top")),t.$dialog=t.$container.find(".modal-dialog"),t.resetNodes(),t.setClose(),t.setSize(),t.setPadding(),t.setBorderTop(),t.setBorderBottom(),t.setHeight(),t.setTitle(),t.setFooter(),t.setFooterAlign(),a.cancelRight?(t.$dialogFooter.append(t.$okBtn),t.$dialogFooter.append(t.$cancelBtn)):(t.$dialogFooter.append(t.$cancelBtn),t.$dialogFooter.append(t.$okBtn)),t.setCancel(),t.setOk(),t.setButtons(),t._created=!0,t.$container},setClose:function(e){var t=this,a=t.options,n=t._defaults;n.close||(n.close={v:a.close}),e=a.close=l.baIsEmpty(e)?n.close.v:e,t.$dialogClose&&(e?t.$dialogClose.show():t.$dialogClose.hide())},setButtons:function(e){var t=this,a=t.options,n=t._defaults;n.buttons||(n.buttons={v:a.buttons}),e=a.buttons=l.baIsEmpty(e)?n.buttons.v:e,t.$dialogFooter&&(t.leftButtons&&t.leftButtons.map(function(e){e.remove()}),t.rightButtons&&t.rightButtons.map(function(e){e.remove()}),t.leftButtons=[],t.rightButtons=[],l.map(e||[],function(e){("left"===(e=e||{}).align?t.leftButtons:t.rightButtons).push(t._createBtn(e))}),l.map(t.leftButtons,function(e){t.$dialogFooter.prepend(e)}),l.map(t.rightButtons,function(e){t.$dialogFooter.append(e)}),t.resetView())},setOk:function(e,t,a){var n=this,i=n.options,r=n._defaults;r.ok||(r.ok={text:i.ok,icon:i.okIcon,skin:i.okSkin});var o=i.okSkin;e=i.ok=l.baIsEmpty(e)?r.ok.text:e,t=i.icon=l.baIsEmpty(t)?r.ok.icon:t,a=i.skin=l.baIsEmpty(a)?r.ok.skin:a,n.$okBtn&&(!1!==e?(n.$okBtn.html(p(t)+e).removeClass(o).addClass(a).show(),n.resetView()):n.$okBtn.hide())},setCancel:function(e,t,a){var n=this,i=n.options,r=n._defaults;r.cancel||(r.cancel={text:i.cancel,icon:i.cancelIcon,skin:i.cancelSkin});var o=i.cancelSkin;e=i.cancel=l.baIsEmpty(e)?r.cancel.text:e,t=i.cancelIcon=l.baIsEmpty(t)?r.cancel.icon:t,a=i.cancelSkin=l.baIsEmpty(a)?r.cancel.skin:a,n.$cancelBtn&&(!1!==e?(n.$cancelBtn.html(p(t)+e).removeClass(o).addClass(a).show(),n.resetView()):n.$cancelBtn.hide())},setFooterAlign:function(e){var t=this,a=t.options,n=t._defaults;n.footerAlign||(n.footerAlign={v:a.footerAlign}),e=a.footerAlign=l.baIsEmpty(e)?n.footerAlign.v:e,t.$dialogFooter&&(t.$dialogFooter.removeClass("text-center text-left text-right"),e&&t.$dialogFooter.addClass("text-"+e))},setFooter:function(e){var t=this,a=t.options,n=t._defaults;n.footer||(n.footer={v:a.footer}),e=a.footer=l.baIsEmpty(e)?n.footer.v:e,t.$dialogFooter&&("boolean"!=typeof e&&e?(t.$dialogFooter.hide(),t.$dialogFooterUse.empty().append(e).show()):(e?t.$dialogFooter.show():t.$dialogFooter.hide(),t.$dialogFooterUse.hide()),t.resetView())},setSize:function(e,t,a){var n=this,i=n.options,r=n._defaults;r.size||(r.size={v:i.size,min:i.minSize,max:i.maxSize}),e=i.size=l.baIsEmpty(e)?r.size.v:e,t=i.minSize=l.baIsEmpty(t)?r.size.min:t,a=i.maxSize=l.baIsEmpty(a)?r.size.max:a,n.$dialog&&(n.$dialog.css({width:""}).removeClass("modal-sm modal-lg modal-xl modal-custom"),e&&(-1===["lg","sm","xl"].indexOf(e)?("top"===(i="string"==typeof i.drawer?i.drawer.toLowerCase():"")||"bottom"===i?n.$dialog.css({height:e,minHeight:t,maxHeight:a}):n.$dialog.css({width:e,minWidth:t,maxWidth:a})).addClass("modal-custom"):n.$dialog.addClass("modal-"+e)),n.resetView())},setPadding:function(e){var t=this,a=t.options,n=t._defaults;n.padding||(n.padding={v:a.padding}),e=a.padding=l.baIsEmpty(e)?n.padding.v:e,t.$dialogBody&&(l.isNumeric(e)&&(e+="px"),t.$dialogBody.css({padding:e||""}),t.resetView())},setBorderTop:function(e){var t=this,a=t.options,n=t._defaults;n.borderTop||(n.borderTop={v:a.borderTop}),e=a.borderTop=l.baIsEmpty(e)?n.borderTop.v:e,t.$dialogHeader&&(t.$dialogHeader.css("border-bottom-width",e?"":0),t.resetView())},setBorderBottom:function(e){var t=this,a=t.options,n=t._defaults;n.borderBottom||(n.borderBottom={v:a.borderBottom}),e=a.borderBottom=l.baIsEmpty(e)?n.borderBottom.v:e,t.$dialogFooter&&(t.$dialogFooter.css("border-top-width",e?"":0),t.$dialogFooterUse.css("border-top-width",e?"":0),t.resetView())},setHeight:function(e){var t=this,a=t.options,n=t._defaults;n.height||(n.height={v:a.height}),e=a.height=l.baIsEmpty(e)?n.height.v:e,t.$dialog&&(l.isNumeric(e)&&0<e&&(e+="px"),e?(t.$dialogBody.css("height",e),t.$dialog.addClass("modal-fixed-height")):(t.$dialogBody.css("height",""),t.$dialog.removeClass("modal-fixed-height")),t.resetView())},setContent:function(e){var t=this,a=t.options,n=t._defaults;n.content||(n.content={v:a.content,ajax:t.ajax}),(e=a.content=l.baIsEmpty(e)?n.content.v:e)||!n.content.ajax?(t.ajax=!1,t.render()):t.reload()},setTitle:function(e){var t=this,a=t.options,n=t._defaults;n.title||(n.title={v:a.title}),e=a.title=l.baIsEmpty(e)?n.title.v:e,t.$dialogHeader&&(!1===e?t.$dialogHeader.hide():(t.$dialogHeader.show(),t.$dialogTitle.empty().append(""===e||l.baIsEmpty(e)?a.locale.title:e)),t.resetView())},_renderContent:function(e,t,a){var n=this,i=h(),r="";l("<div />").html(l(e)).each(function(){r+=this.innerHTML.replace(/:modal_id/g,i)}),n.$content=l(r),n.use=!1,0<l("<div />").html(n.$content).find(".modal-content").length?(n.$dialog.empty().append(n.$content).append(a||""),n.use=!0,n.resetNodes(),"string"==typeof(e=n.$dialogTitle.html())&&""!==(e=e.trim())&&(t=e)):n.$dialogBody.empty().append(n.$content).append(a||""),l.baIsEmpty(t)||""===t||""!==n._defaults.title.v?n.setTitle():n.setTitle(t)},render:function(){var e,t=this,a=t.options;l(document).off(t.mountedEvent).on(t.mountedEvent,function(e){e.$vue.closestBaModal()===t&&(t.vue=e.vue,t.$form&&t.renderForm())}),a.content&&!t.ajax&&("function"==typeof a.content?e=l(a.content()):(e=l(a.content)).length&&("script"!==e[0].tagName.toLowerCase()&&"template"!==e[0].tagName.toLowerCase()||(e=l(l(a.content).html()))),t._renderContent(l(e))),"page"!==a.type&&t.$content&&t.$content.length&&t.renderForm(),c.execCallback(t,a.onReady,t.element,[t],[t.$element,r.app.$doc],o.modalReady),t.api.isShown?t.resetView():t.api.show()},submit:function(){return!(!this.$form||0===this.$form.length)&&(this.$form.submit(),!0)},reset:function(){return!(!this.$form||0===this.$form.length)&&(this.$form[0].reset(),!0)},renderForm:function(){var e=this,t=e.options,a=e.$dialog.find("form");0===a.length?(e.$dialogContent.wrap("<form />"),a=e.$dialogContent.parent("form")):(t.formAction=a.getUrl()||t.url,t.formMethod=a.attr("method")||t.formMethod),e.$form=a.off(o.formDisabled).off(o.formEnabled).on(o.formDisabled,function(){e.$okBtn.prop("disabled",!0).addClass("disabled")}).on(o.formEnabled,function(){e.$okBtn.prop("disabled",!1).removeClass("disabled")}),0===a.find(":submit").length&&a.append('<button type="submit" class="input-hidden">submit</button>');var n=c.parseData(t,"form","validate");n.action=n.action||t.url,n.method=n.method||"post",a.baForm(n)},show:function(){var t=this,a=t.options;t.shown||(t.shown=!0,e.append(t._create()),t.$container.modal({show:!1,backdrop:a.backdrop,keyboard:a.keyboard,zindex:a.zindex,hideCallback:function(){if(!t.closed)return!1!==c.execCallback(t,a.onCancel,t.element,[t],[t.$element,r.app.$doc],o.modalCancel,!0,!1)&&void 0;t.closed=!1}}),t.$container.on("show.bs.modal shown.bs.modal hide.bs.modal hidden.bs.modal",function(e){"bs.modal"===e.namespace&&(c.execCallback(t,a[c.camel("on_"+e.type)],t.element,[t],[t.$element,r.app.$doc],n(e.type,"modal")),"show"===e.type&&i.on(t.resizeEvent,function(){t.resetView()}),"hidden"===e.type&&(t.offEvent(),t.shown=!1,t.moveing=!1,t.$container.remove()))}),t.api=t.$container.data("bs.modal"),t.api.baModal=t,!1!==c.execCallback(t,a.onRenderBefore,t.element,[t],t.$element,o.modalRenderBefore,!0,!1)&&(t.ajax?t.load():t.render()))},offEvent:function(){var e=this;i.off(e.resizeEvent),l(document).off(e.mountedEvent),e.vue&&(e.vue.$destroy(),e.vue=null)},hide:function(){this.api&&this.api.hide()},close:function(){this.closed=!0,this.hide()},load:function(t){var a,n=this;n.ajax&&(a=n.options,n.task=r.request(c.scope(a.url)).method(a.method||m.DEFAULTS.method).params(c.scope(a.params)).addHeader("Busy-Admin-Plugin","Modal").addHeader("X-Requested-With","HTML").parse("html").success(function(e){return r.app.responseToHtml(e,function(e){e=r.app.extractContainer(e);n._renderContent(e.content,e.appTitle,e.trace),n.render(),t&&(c.execCallback(n,a.show,n.element,[n],[n.$element,r.app.$doc],o.modalShow),c.execCallback(n,a.shown,n.element,[n],[n.$element,r.app.$doc],o.modalShown))},function(e){n.shown=!1}),!1}).error(function(e,t,a){n.shown=!1}).exec())},reload:function(e){var t=this.options,a=this._defaults;a.url||(a.url={v:t.url}),t.url=l.baIsEmpty(e)?a.url.v:e,this.ajax=!0,this.load(!0)},resetView:function(){this.api&&this._created&&this.api.adjustDialog()},setOption:function(e,t){this.options[e]=t},_createBtn:function(e){var t=this;if(e.element?e.$element=l(e.element):e.$element=l('<button type="button" class="btn"/>').addClass(e.classes||"btn-default").html(e.text),"function"==typeof e.events)e.$element.off("click.busy.modal").on("click.busy.modal",function(){e.events.call(this,t)});else for(var a in e.events=e.events||{},e.events)t._createBtnEvents(e.$element,a,e.events[a]);return e.$element},_createBtnEvents:function(e,t,a){var n=this;e.off(t).on(t,function(){"function"==typeof a&&a.call(this,n)})},destroy:function(){var e=this;e.destroyed||(e.destroyed=!0,e.shown=!1,e.offEvent(),e.api&&(e.api.isShown&&m.INDEX--,e.api.removeBackdrop(),e.api.reset(),e.api=null),e.task&&(e.task.abort(),e.task=null),e.$container&&(e.$container.remove(),e.$container=null))}},m.TEMPLATE='<div class="modal ba-modal">        <div class="modal-dialog">            <div class="modal-content">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>                    <h4 class="modal-title"></h4>                </div>                <div class="modal-body"></div>                <div class="modal-footer modal-footer-sys clearfix">                    <button type="button" class="btn" data-primary="modal"/>                    <button type="button" class="btn" data-dismiss="modal"/>                </div>                <div class="modal-footer modal-footer-use clearfix"></div>            </div>        </div>    </div>',m.INDEX=0,m.KEY=d,m.DEFAULTS={move:!0,drawer:!1,fixedTop:!1,fade:!0,show:!0,type:"",backdrop:!0,keyboard:!1,size:"",minSize:void 0,maxSize:void 0,title:"",footer:!0,footerAlign:null,content:"",url:"",method:"get",params:{},className:"",padding:void 0,borderTop:!0,borderBottom:!0,height:null,buttons:[],zindex:"auto",close:!0,select:null,selectTip:"",selectMin:1,selectMinTip:"",selectMax:0,selectMaxTip:"",ok:null,okSkin:"btn-primary",okIcon:"",cancel:null,cancelSkin:"btn-default",cancelIcon:"",cancelRight:r.getConfig("modal").cancel_right,onOk:l.noop,onCancel:l.noop,onReady:l.noop,onShow:l.noop,onShown:l.noop,onHide:l.noop,onHidden:l.noop,onRenderBefore:l.noop,formMethod:"post",formAction:"",formOnSuccess:"@modal.close",locale:l.extend({},{confirm:"确定",cancel:"取消",title:"操作",reset:"重置"},((r.locale||{}).plugin||{}).modal||{})},l.fn.baModal=a,l.fn.baModal.Constructor=m,r.plugins.Modal=m,r.regSugar(s,function(e,t,a){var n=l(this).closestBaModal();(n=n||l(this).data(m.KEY))&&n[e||"close"](t)}),l.fn.closestBaModal=function(e){e=c.pluginCall(m,"baModal",l(this).closest(".ba-modal"),e,arguments);return e?e.resetNodes():null},l.fn.getBaModal=function(e){e=c.pluginCall(m,"baModal",l(this),e,arguments);return e?e.resetNodes():null},e.on("click."+d,c.pluginAttrs(s),function(e){e.preventDefault(),a.call(l(this))}),m}),define("./ba/plug/appNotice",["busyAdmin","jquery"],function(r,n){var i=false,t={"Busy-Admin-Plugin":"AppNotice"};r.e.appNoticeInitialized=r.ee("initialized","notice");var e=function e(){var t=this;t.options=r.getConfig("notice");t.app=r.app;t.root=r.root();t._init()};e.prototype={_init:function e(){if(i)return;i=true;var a=this;var t=a.app.data.notice||{};if(t.message){a.msgBtn=a.app.createBarButton("bicon bicon-bell");a.msgBtn.insertAfter(a.app.$barRefreshWrap);a.msgBtn.$a.baModal({show:false,drawer:"right",size:"400px",maxSize:"100%",fixedTop:true,type:"page",url:a.options.message_url,api:a,onHide:function e(){a.msgBtn.toggle(false)},onShow:function e(t){a.dialog=t}});a.msgBtn.$a.on("click",function(){a.msgBtn.$a.baModal("show");a.msgBtn.toggle(true)})}if(t.todo){a.todoBtn=a.app.createBarButton("bicon bicon-wait-handle");a.todoBtn.insertAfter(a.msgBtn?a.msgBtn.$li:a.app.$barRefreshWrap);a.todoBtn.$a.baModal({show:false,drawer:"right",size:"400px",maxSize:"100%",fixedTop:true,type:"page",url:a.options.todo_url,api:a,onHide:function e(){a.todoBtn.toggle(false)},onShow:function e(t){a.dialog=t}});a.todoBtn.$a.on("click",function(){a.todoBtn.$a.baModal("show");a.todoBtn.toggle(true)})}if(t.message||t.todo)a.timer=setTimeout(function(){a.getTotal()},1e3);r.helper.triggerPluginReady(n(document),a,"",r.e.appNoticeInitialized)},getTotal:function e(){var i=this;clearTimeout(i.timer);if(i.loading)return;i.loading=true;i.task=r.request(i.options.total_url).headers(t).pending(false).complete(function(){i.loading=false;i.timer=setTimeout(function(){i.getTotal()},1e3*10)}).error(function(){return false}).success(function(e){var t=e.result||{};var a=t.message_total||0;var n=t.todo_total||0;if(i.todoBtn)i.todoBtn.setBadge(n);if(i.msgBtn)i.msgBtn.setBadge(a);return false}).exec()},getList:function e(){var t=this;if(!t.dialog||!t.dialog.hasOwnProperty("noticeRefreshPanelList"))return;t.dialog.noticeRefreshPanelList()},refresh:function e(){this.getTotal();this.getList()},close:function e(){var t=this;if(t.dialog){t.dialog.hide();t.dialog=null}},openMessage:function e(){var t=this;if(t.msgBtn)t.msgBtn.$a.trigger("click")},openTodo:function e(){var t=this;if(t.todoBtn)t.todoBtn.$a.trigger("click")},destroy:function e(){var t=this;clearTimeout(t.timer);if(t.task){t.task.abort();t.task=null}t.close()}},r.regSugar("notice",function(e,t,a){var n=r.app.notice;if(!n)return;n[e||"getTotal"](t)}),n(document).on(r.e.appReadies,function(){if(!r.app.isFrame){i=false;if(r.app.notice){r.app.notice.destroy();r.app.notice=null}return}if(i)return;r.app.notice=new e})}),define("./ba/plug/print",["busyAdmin","jquery"],function(o,v){"use strict";var s,r,b,y=o.helper,e=o.ee,$=o.e,i="print",a=y.pluginKey(i);$.printInitialized=e("initialized",i),$.printExportData=e("export-data",i);var t=function e(t,a){var n=this;n.element=t;n.$element=v(t);n.options=v.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});if(v.baIsEmpty(n.options.title))n.options.title=n.$element.attr("title")||"";n.ready(n._init)};function n(e){return y.pluginFn(this,t,e,arguments)}return t.prototype={ready:function(n){var i=this;s&&r&&b?n.call(i):requirejs([o.lib.print,o.lib.html2canvas,o.lib.jspdf],function(e,t,a){s=e,b=a,r=t,n.call(i)})},_init:function(){var t=this;t.options.clickHandler?t.$element.on("click."+a,function(e){return e.preventDefault(),t.print(),!1}):t.print(),y.triggerPluginReady(t.$element,t,"",$.printInitialized)},print:function(){var m=this,g=m.options;if(g.target){var e=g.type.toLowerCase();switch(e){case"pdf":m.exec({printable:g.target,type:"pdf",base64:g.base64});break;case"image":m.exec({printable:g.target,type:"image"});break;default:var t=v(g.target);if(!t.length)return void o.dialog.toast("未找到需要打印的HTML节点");var a=t[0],t=v.extend({allowTaint:!0,useCORS:!0,scale:(window.devicePixelRatio||1)*(g.captureScale||1)},g.captureOptions||{});"capture"==e?(m.showLoad(),r(a,t).then(function(e){m.exec({printable:e.toDataURL("image/jpeg",1),type:"image"})}).catch(function(e){m.hideLoad(),o.dialog.toast(e)})):"export"==e?(m.showLoad("导出中..."),r(a,t).then(function(e){var t=g.width||210,a=g.height||297,n=10,i=10;v.isNumeric(g.padding)?i=n=g.padding:v.isArray(g.padding)&&(n=g.padding[0]||0,i=g.padding[1]||0);for(var r,o=t-2*n,s=a-2*i,l=new b.jsPDF({orientation:s<o?"l":"p",unit:g.unit,format:[t,a]}),c=e.getContext("2d"),d=Math.floor(s*e.width/o),u=Math.ceil(e.height/d),p=1,f=0;f<e.height;)m.showLoad(p+"/"+u),(r=document.createElement("canvas")).width=e.width,r.height=Math.min(d,e.height-f),r.getContext("2d").putImageData(c.getImageData(0,f,e.width,Math.min(d,e.height-f)),0,0),l.addImage(r.toDataURL("image/jpeg",1),"JPEG",n,i,o,Math.min(s,o*r.height/r.width)),(f+=d)<e.height&&l.addPage(),p++;r=null;var h=g.title;""===h&&(t=function(e){return e<10?"0"+e:e},h=[(a=new Date).getFullYear(),t(a.getMonth()+1),t(a.getDate()),t(a.getHours()),t(a.getMinutes()),t(a.getSeconds())].join(""));h+=".pdf";g.download&&l.save(h),m.hideLoad(),y.execCallback(m,g.onExportData,m.element,[l,h],m.$element,$.printExportData)}).catch(function(e){m.hideLoad(),o.dialog.toast(e)})):m.exec({printable:a,type:"html",targetStyles:["*"]})}}else o.dialog.toast("打印目标为空")},exec:function(e){var t=this,a=t.options,n=[],i=[];v(document).find('link[type="text/css"],style').each(function(){v(this).is("link")?n.push(v(this).attr("href")):i.push(v(this).html())});var r=o.getConfig("print",{});r.css&&(v.isArray(r.css)?r.css.map(function(e){n.push(e)}):n.push(r.css)),a.css&&(v.isArray(a.css)?a.css.map(function(e){n.push(e)}):n.push(a.css)),r.style&&i.push(r.style),a.style&&i.push(a.style);r={header:a.header,css:n,style:i.join("\n\n"),documentTitle:a.title};a.headerStyle&&(r.headerStyle=a.headerStyle),s(v.extend(r,e||{},a.printOptions||{},{onLoadingStart:function(){t.showLoad()},onLoadingEnd:function(){t.hideLoad()},onError:function(e){t.hideLoad(),o.dialog.toast(e)}}))},showLoad:function(e){this.pending?e&&this.pending&&this.pending.update(e):this.pending=o.dialog.pending(e||"预览中...")},hideLoad:function(){this.pending&&this.pending.close(),this.pending=null},destroy:function(){this.options.clickHandler&&this.$element.off("click."+a)}},t.KEY=a,t.DEFAULTS={target:null,type:"",header:null,headerStyle:null,css:null,style:null,title:null,width:0,height:0,padding:10,unit:"mm",download:!0,captureScale:2,captureOptions:{},printOptions:{},clickHandler:!0},v.fn.baPrint=n,v.fn.baPrint.Constructor=t,o.plugins.Print=t,o.autoInit(i,y.pluginAttrs(i),function(){n.call(this)}),t}),define("./ba/plug/random",["busyAdmin","jquery"],function(e,i){"use strict";var a=e.helper,r="random",t=a.pluginKey(r),n=function e(t,a){var n=this;n.element=t;n.$element=i(t);n.options=i.extend(true,{},e.DEFAULTS,n.$element.baData(r)||{},a||{})};function o(e){return a.pluginFn(this,n,e,arguments,[],function(){this.options.write&&this.value()})}return n.prototype={value:function(){var e,t=this.options;t.target&&((e=i(t.target)).is(":input")?e.val(a.random(t.length,t.char)).baTriggerEvent("input").baTriggerEvent("change"):(e.text(a.random(t.length,t.char)),e.trigger("change")))},destroy:function(){}},n.KEY=t,n.DEFAULTS={write:!0,target:null,length:32,char:null},i.fn.baRandom=o,i.fn.baRandom.Constructor=n,e.plugins.Random=n,i("body").on("click."+t,a.pluginAttrs(r),function(e){o.call(i(this))}),n}),define("./ba/plug/rangeSlider",["busyAdmin","jquery"],function(l,r){var n=null,c=l.helper,e=l.ee,d=l.e,o="range-slider",s=c.pluginKey(o),t=function e(t,a){var n=this;n.element=t;n.$element=r(t);n.index=e.INDEX++;n.options=this._parseOptions(r.extend(true,{},e.DEFAULTS,n.$element.baData(o)||{},a||{}));var i=n.options.values;if(i){n.$element.removeData("values").removeAttr("data-values");if(typeof i==="string")i=i.split(",");if(!Array.isArray(i))i=[];n.options.values=i}n.resetEvent="reset."+s+n.index;n.$form=n.$element.closest("form");n.$form.on(n.resetEvent,function(){n.setValue(n.defaultValue)});n.defaultValue=n.$element.val().trim();n._parseValue(n.defaultValue);n.ready(n._init)};function a(e){return c.pluginFn(this,t,e,arguments,"api")}return t.prototype={ready:function(t){var a=this;n?t.call(a):requirejs([l.lib.ionRangeSlider],function(e){n=e,t.call(a)})},_init:function(){var t=this,e=t.options,a=e.onStart,n=e.onChange,i=e.onFinish,r=e.onUpdate,o=t.$element,s=t.element;e.onStart=function(e){c.execCallback(t,a,s,[e],o,d.rangeSliderStart)},e.onChange=function(e){t.$element.baTriggerEvent("input").baTriggerEvent("change"),c.execCallback(t,n,s,[e],o,d.rangeSliderChange)},e.onFinish=function(e){c.execCallback(t,i,s,[e],o,d.rangeSliderFinish)},e.onUpdate=function(e){c.execCallback(t,r,s,[e],o,d.rangeSliderUpdate)},e.skin="round",e.extra_classes="ba-range-slider",t.api=o.ionRangeSlider(e).data("ionRangeSlider"),l.app.triggerResize(),c.triggerPluginReady(o,t,"",d.rangeSliderInitialized)},_parseOptions:function(e){for(var t in e){var a;"on"!==t.substring(0,2)&&("readonly"===t&&(e.block=e[t],delete e[t]),"disabled"===t&&(e.disable=e[t],delete e[t]),-1!==t.indexOf("_")||(a=c.snake(t,"_"))!=t&&(e[a]=e[t],delete e[t]))}return e},_parseValue:function(e,t){e=null==e?"":e+"";var a,n=this.options,i=n.values;0<i.length?"single"!=n.type?(a=e.split(n.input_values_separator),r.isNumeric(n.from)&&!t||(n.from=i.indexOf(a[0])),1<a.length?r.isNumeric(n.to)&&!t||(n.to=i.indexOf(a[1]),n.to=-1==n.to?null:n.to):t&&(n.to=null)):r.isNumeric(n.from)&&!t||(n.from=i.indexOf(e)):"single"!=n.type?(a=e.split(n.input_values_separator),n.from=a[0],1<a.length?n.to=a[1]:n.to=null):n.from=e},setOption:function(e,t){this.options[e]=t,this.setOptions()},setOptions:function(e){var t=this;t.options=t._parseOptions(r.extend(!0,{},t.options,e||{})),t.api&&t.api.update(t.options)},setValue:function(e){this.api&&(this._parseValue(e,!0),this.api.update(this.options))},getApi:function(){return this.api},destroy:function(){var e=this;e.$form.off(e.resetEvent),e.api&&(e.api.destroy(),e.api=null)}},t.INDEX=0,t.KEY=s,t.DEFAULTS={type:"single",min:0,max:100,from:null,to:null,step:1,minInterval:0,maxInterval:0,dragInterval:!1,values:[],fromFixed:!1,fromMin:null,fromMax:null,fromShadow:!1,toFixed:!1,toMin:null,toMax:null,toShadow:!1,prettifyEnabled:!0,prettifySeparator:" ",prettify:null,forceEdges:!1,keyboard:!0,grid:!1,gridMargin:!0,gridNum:4,gridSnap:!1,hideMinMax:!1,hideFromTo:!1,prefix:"",postfix:"",maxPostfix:"",decorateBoth:!0,valuesSeparator:" — ",inputValuesSeparator:",",disabled:!1,readonly:!1,scope:null,onStart:null,onChange:null,onFinish:null,onUpdate:null},r.fn.baRangeSlider=a,r.fn.baRangeSlider.Constructor=t,l.plugins.RangeSlider=t,d.rangeSliderInitialized=e("initialized",o),d.rangeSliderStart=e("start",o),d.rangeSliderChange=e("change",o),d.rangeSliderUpdate=e("update",o),d.rangeSliderFinish=e("finish",o),l.autoInit(o,c.pluginAttrs(o),function(){a.call(this)}),t}),define("./ba/plug/rate",["busyAdmin","jquery"],function(a,i){var n=null,s=a.helper,t=a.ee,l=a.e,c="rate",e=s.pluginKey(c),d="hover,hoverleave,focus,blur,keydown,mouseenter,mouseleave,clear,reset,refresh,change".split(",");l.rateInitialized=t("initialized",c),d.map(function(e){l[s.camel(c+"_"+e)]=t(e,c)});var r=function e(t,a){var n=this;n.element=t;n.$element=i(t);n.index=e.INDEX++;n.options=i.extend(true,{},e.DEFAULTS,n.$element.baData(c)||{},a||{});n.ready(n._init)};function o(e){return s.pluginFn(this,r,e,arguments,"api")}return r.prototype={ready:function(e){var t=this;n?e.call(t):requirejs([a.lib.bootstrapStarRating],function(){n=!0,e.call(t)})},_init:function(){var t=this,a=t.options;if(a.containerClass="ba-rate",a.clearCaption=a.clearCaption||a.locale.clearCaption,a.clearButtonTitle=a.clearButtonTitle||a.locale.clearButtonTitle,a.defaultCaption=a.defaultCaption||a.locale.caption,t._initDefaultCaption(a),!a.starTitles){for(var e={},n=1;n<=a.max;n++)e[n]=a.defaultCaption.replace(/\{rating}/g,n);a.starTitles=e}a.starCaptions||(a=t._initTexts(a));var i=[];d.map(function(e){i.push("rating:"+e)});var r=t.$element,o=t.element;r.on(i.join(" "),function(e){e=e.type.substring(7);"change"!==e&&"clear"!==e&&"reset"!==e||r.baTriggerEvent("input").baTriggerEvent("change"),s.execCallback(t,a[s.camel("on_"+e)],o,[],r,l[s.camel(c+"_"+e)])}),t.api=r.addClass("input-hidden").rating(a).data("rating"),s.triggerPluginReady(r,t,"",l.rateInitialized)},getApi:function(){return this.api},setValue:function(e){this.api&&this.api.update(e)},clear:function(){this.api&&this.api.clear()},reset:function(){this.api&&this.api.reset()},setOption:function(e,t){this.options[e]=t,this.setOptions(this.options)},setOptions:function(e){var t=this;t.api&&(t.options=i.extend(!0,{},t.options,e||{}),t.options=t._initDefaultCaption(t.options),t.options=t._initTexts(t.options),t.api.refresh(t.options))},_initTexts:function(e){var t=e.texts;if(0<t.length){for(var a={},n=[],i=e.step;i<=e.max;i+=e.step)a[i]=t.splice(0,1),n.push(a[i]);e.texts=n,e.starCaptions=a}return e},_initDefaultCaption:function(e){var t=e.defaultCaption;return-1===t.indexOf("{rating}")&&(t="{rating}"+e.defaultCaption),e.defaultCaption=t,e},destroy:function(){this.api&&(this.api.destroy(),this.api=null)}},r.INDEX=0,r.KEY=e,r.DEFAULTS={min:0,max:5,stars:5,size:"",step:1,showClear:!1,showCaption:!1,defaultCaption:"",captionElement:null,clearElement:null,texts:["极差","失望","一般","满意","惊喜"],animate:!1,onReset:null,onClear:null,onRefresh:null,onChange:null,locale:i.extend({},{caption:"{rating}分",clearButtonTitle:"清理",clearCaption:"未评分"},((a.locale||{}).plugin||{}).rate||{})},i.fn.baRate=o,i.fn.baRate.Constructor=r,a.plugins.Rate=r,a.autoInit(c,s.pluginAttrs(c),function(){o.call(this)}),r}),define("./ba/plug/request",["busyAdmin","jquery"],function(o,s){"use strict";var r=o.helper,e=o.ee,l=o.e,c="request",t=r.pluginKey(c);function d(e){return Array.prototype.slice.call(e)}l.requestBefore=e("before",c),l.requestComplete=e("complete",c),l.requestSuccess=e("success",c),l.requestError=e("error",c);var u=function e(t,a){var n=this;n.element=t;n.$element=s(t);n.options=s.extend(true,{},e.DEFAULTS,n.$element.baData(c)||{},a||{});var i=s.proxy(n.destroy,n);s(document).one(l.appRenderBefore,i);var r=n.$element.closestBaModal();if(r)r.$element.one(o.e.modalHide,i)};function a(e){return r.pluginFn(this,u,e,arguments,null,function(){this.options.show&&this.show()})}return u.prototype={show:function(){var e=this,t=e.options,a=t.confirm;a?e.dialog&&e.dialog.isShown()||("function"==typeof a&&(a=a.call(e)),e.dialog=o.dialog.confirm(a,{btn:[t.confirmOk||t.locale.confirm,t.confirmCancel||t.locale.cancel]},function(){e._exec()})):e._exec()},_exec:function(){var t=this,a=t.options,n=t.element,i=t.$element;t._abort(),t.task=o.request(a.url?r.scope(a.url):i.getUrl()).headers(r.scope(a.headers)).pending(a.pending,a.pendingMessage).params(r.scope(a.params)).method(a.method||u.DEFAULTS.method).before(function(){return!1!==r.execCallback(t,a.onBefore,n,d(arguments),i,l.requestBefore,!0,!1)}).complete(function(){return!1!==r.execCallback(t,a.onComplete,n,d(arguments),i,l.requestComplete,!0,!1)}).success(function(e){return!1===r.execCallback(t,a.onSuccess,n,d(arguments),i,l.requestSuccess,!0,!1)||!1===a.onSuccess||o.dialog.tipSuccess(e.message),!1}).error(function(e){return!1===r.execCallback(t,a.onError,n,d(arguments),i,l.requestError,!0,!1)||!1===a.onError||o.dialog.tipError(e.message),!1}).exec()},_abort:function(){this.task&&(this.task.abort(),this.task=null)},destroy:function(){this._abort()}},u.KEY=t,u.DEFAULTS={show:!0,url:void 0,params:{},headers:{},confirm:void 0,confirmOk:null,confirmCancel:null,method:"get",pending:!0,pendingMessage:void 0,onSuccess:s.noop,onError:s.noop,onComplete:s.noop,onBefore:s.noop,locale:s.extend({},{confirm:"确定",cancel:"取消"},((o.locale||{}).plugin||{}).request||{})},s.fn.baRequest=a,s.fn.baRequest.Constructor=u,o.plugins.Request=u,s("body").on("click."+t,r.pluginAttrs(c),function(e){e.preventDefault(),a.call(s(this))}),u}),define("./ba/plug/searchBar",["busyAdmin","jquery"],function(s,l){"use strict";var c=s.helper,i="search-bar",e=c.pluginKey(i);function d(e,t){return e.find('[data-search-id="'+t+'"]')}function u(e,t){return e.find('[data-template="'+t+'"]')}s.e.searchBarInitialized=s.ee("initialized",i);var p=function e(t,a){var n=this;n.$element=l(t);n.options=l.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n._init()};function t(e){return c.pluginFn(this,p,e,arguments)}return p.prototype={_init:function(){var a,e=this,t=e.options;t.fields&&"string"==typeof t.fields&&(n=t.fields.split(","),a=[],n.map(function(e){var t=e.split(":"),e=(t[0]||"").trim(),t=(t[1]||"").trim();a.push({name:t,value:e})}),t.fields=a),t.contentLeft?e.contentLeftHtml=l(t.contentLeft).html():e.contentLeftHtml=u(e.$element,"left").html(),t.contentRight?e.contentRightHtml=l(t.contentRight).html():e.contentRightHtml=u(e.$element,"right").html(),t.toolbar?e.toolbarHtml=l(t.toolbar).html():e.toolbarHtml=u(e.$element,"toolbar").html(),t.url=t.url||document.URL;var n=p.TEMPLATE.replace("_toolbar_",e.toolbarHtml||"");n=(n=(n=n.replace("_content_left_",e.contentLeftHtml||"")).replace("_content_right_",e.contentRightHtml||"")).replace("_title_","<span>"+(e.options.title||e.options.locale.title)+"</span>"),e.$template=l(n),e.$form=d(e.$template,"form").attr("action",t.url),e.$fieldSelect=d(e.$template,"field"),e.$accurateInput=d(e.$template,"accurate").prop("checked",t.accurate).attr("title",t.locale.accurate).attr("name",t.accurateName).addClass(t.accurateClass),e.$wordInput=d(e.$template,"word").attr("name",e.options.wordName).attr("placeholder",e.options.placeholder||t.locale.placeholder),e.$keywords=d(e.$template,"keywords"),e.$btnReset=d(e.$template,"reset").html(t.resetText||t.locale.reset).addClass(t.resetClass).attr("href",t.url),e.$btnSubmit=d(e.$template,"submit").addClass(t.searchClass),e.$btnSubmit.find("span").html(t.searchText||t.locale.search),e.$accurateWrap=e.$accurateInput.closest(".checkbox");var i=[e.options.accurateName,e.options.fieldName,e.options.wordName];e.$template.find("[name]").each(function(){var e=l(this),t=e.attr("name");return!t||(-1!==i.indexOf(t)||-1!==t.indexOf("static[")||void e.attr("name","static["+t+"]"))});var r="";(t.fields||[]).map(function(e){var t=e.name||"",e=e.value||"";r+='<option value="'+e+'">'+t+"</option>"}),r?(e.$keywords.addClass("has-field"),o="",t.fieldUnlimited&&(o+='<option value="'+(t.fieldUnlimitedValue||"")+'">'+(!0===t.fieldUnlimited?t.locale.unlimited:t.fieldUnlimited)+"</option>"),o+=r,e.$fieldSelect.html(o)):(e.$fieldSelect.remove(),e.$keywords.addClass("no-field")),t.accurateShow||e.$accurateWrap.remove();n=c.parseURL(document.URL).params||{};e.$form.baFormVal(l.extend({},c.parseURL(t.url).params||{},n));var o=n.hasOwnProperty(t.searchMark);o||e.$form.append('<input type="hidden" name="'+t.searchMark+'" value="1"/>'),o&&!n.hasOwnProperty(t.locale.accurateName)&&!0===t.accurate&&e.$accurateInput.prop("checked",!1),e.$element.addClass("ba-search clearfix").prepend(e.$template),s.app.triggerResize(),c.triggerPluginReady(e.$element,e,"",s.e.searchBarInitialized)},destroy:function(){this.$element.removeClass("ba-search clearfix"),this.$template&&(this.$template.remove(),this.$template=null)}},p.TEMPLATE='<div class="ba-search-left fa fa-search">_title_</div>        <div class="ba-search-right clearfix">_toolbar_</div>\t\t<div class="ba-search-form">\t\t    <form data-search-id="form" method="get" class="form-inline">\t\t        _content_left_\t\t        <div class="form-group" data-search-id="keywords">\t\t            <div class="input-group">\t\t                <div class="input-group-btn"><select data-search-id="field" class="form-control" name="field"></select></div>\t\t                <input data-search-id="word" class="form-control" name="word" />\t\t            </div>\t\t        </div>\t\t        <div class="checkbox"><input class="pill" data-search-id="accurate" type="checkbox" data-toggle="busy-checkbox" value="1" /></div>\t\t        _content_right_\t\t        <div class="form-group btns--bar">\t\t            <button data-search-id="submit" class="btn" type="submit"><i class="fa fa-search"></i> <span></span></button>\t\t            <a type="reset" data-search-id="reset" class="btn"></a>\t\t        </div>\t\t    </form>\t\t</div>',p.KEY=e,p.DEFAULTS={url:"",fields:[],fieldUnlimited:!1,fieldName:"field",wordName:"word",placeholder:"",title:"",accurate:!1,accurateShow:!1,accurateClass:"",accurateName:"accurate",toolbar:"",contentLeft:"",contentRight:"",searchMark:"_search",searchClass:"btn-info",searchText:null,resetClass:"btn-default",resetText:null,locale:l.extend({search:"搜索",reset:"显示全部",placeholder:"请输入关键字",accurate:"精确搜索",unlimited:"不限",title:"按条件搜索"},((s.locale||{}).plugin||{}).searchBar||{})},l.fn.baSearchBar=t,l.fn.baSearchBar.Constructor=p,s.plugins.SearchBar=p,s.autoInit(i,c.pluginAttrs(i),function(){t.call(this)}),p}),define("./ba/plug/selectPicker",["busyAdmin","jquery"],function(c,d){var r=null,l=null,o=null,u=c.helper,p=c.ee,f=c.e,h="select",m="closing,close,opening,open,selecting,select,unselecting,unselect,clearing,clear".split(","),s=u.pluginKey(h);f.selectInitialized=p("initialized",h),m.map(function(e){f[u.camel("select_"+e)]=p(e,h)});var g=function e(t){return"select2:"+t},t=false,v=function e(){if(t)return;t=true;d.fn.select2.defaults.set("theme","ba");var a=u.extends(r.prototype,{render:function e(){var t=u.override(a,"render",this,arguments);t.addClass("ba--select");return t}})};function b(e){function t(e){return o[e]||e}return e.replace(/[^\u0000-\u007E]/g,t)}function y(e,t){if(e.term==null||e.term.trim()==="")return t;if(t.children&&t.children.length>0){var a=d.extend(true,{},t);for(var n=t.children.length-1;n>=0;n--){var i=t.children[n];var r=y(e,i);if(r==null)a.children.splice(n,1)}if(a.children.length>0)return a;return y(e,a)}if(!t.pinyin)t.pinyin=l.convert({text:t.text}).toUpperCase();if(!t.initials)t.initials=l.initials(t.text);var o=b(t.text).toUpperCase();var s=b(e.term).toUpperCase();if(o.indexOf(s)>-1||t.pinyin.indexOf(s)>-1||t.initials.indexOf(s)>-1)return t;return null}var a=function e(t,a){var n=this;n.index=e.INDEX++;n.element=t;n.$element=d(t);n.options=d.extend(true,{},e.DEFAULTS,n.$element.baData(h),a||{});n.isSelect=n.element.tagName==="SELECT";if(n.isSelect){n.$select=n.$element.wrap("<div />");n.$wrap=n.$select.parent()}else{n.$select=n.$element.find("select");n.$wrap=n.$element;if(!n.$select.length){n.$select=d("<select />");n.$select.attr("name",n.options.name||n.$wrap.attr("name")||"").attr("multiple",n.options.multiple||n.$wrap.attr("multiple")?"multiple":null);n.$wrap.append(n.$select)}}n.$select.addClass("form-control").addClass(n.options.selectClass);n.$wrap.addClass("ba-select");var i=n.options;i.data=u.scope(i.data);if(i.width){var r=i.width;if(typeof i.width==="number")r=i.width+"px";n.$wrap.css("width",r)}if(n.$select.attr("multiple"))n.options.multiple=true;n.resetEvent="reset."+s+n.index;n.defaultValue=d.baIsEmpty(n.options.value)?n.$select.val():n.options.value;n.$form=n.$element.closest("form");n.$form.on(n.resetEvent,function(){n.setValue(n.defaultValue)});n.formStatus=n.$select.baFormStatus(n).render();n.ready(n._init)};function e(e){return u.pluginFn(this,a,e,arguments,"api")}return a.prototype={ready:function(n){var i=this;t?n.call(i):c.require([c.lib.select2,c.lib.pinyin],function(t,a){c.plugins.Template.ready(function(){d.fn.select2.amd.require(["select2/diacritics"],function(e){o=e,l=a,r=t,v(),n.call(i)})})})},_init:function(){var i=this,n=i.options,e=i.$select,t=n.locale,a=d.proxy(i.destroy,i);d(document).one(f.appRenderBefore,a),i.modal=i.$wrap.closestBaModal(),i.modal&&i.modal.$element.one(f.modalHide,a),i.url=n.model?c.getConfig("selectPicker").url:"function"==typeof n.url?n.url():n.url,i.isAjax=n.url||n.model,i.singleInline=n.search&&!n.multiple,i.select2Options=d.extend(!0,{},n.select2||{},{minimumResultsForSearch:n.search?0:-1,placeholder:n.placeholder,allowClear:n.clear,multiple:n.multiple,width:"style",containerCssClass:":all:",data:"function"==typeof n.data?n.data():n.data,minimumInputLength:n.searchMin,maximumSelectionLength:n.max,tags:n.tags,tokenSeparators:n.tagsSpace,language:{errorLoading:function(){return t.errorLoading},inputTooLong:function(e){e=e.input.length-e.maximum;return u.sprintf(n.inputLongText||t.inputTooLong,e)},inputTooShort:function(e){e=e.minimum-e.input.length;return u.sprintf(n.inputShortText||t.inputTooShort,e)},loadingMore:function(){return n.loadingMoreText||t.loadingMore},maximumSelected:function(e){return n.maxSelectedText||u.sprintf(t.maximumSelected,e.maximum)},noResults:function(){return n.emptyText||t.noResults},searching:function(){return n.loadingText||t.searching}},ajax:i.isAjax?{delay:0===n.modelLength?0:n.delay,url:i.url,transport:function(e,t,a){if(0!==n.modelLength||!i.remoteData)return i._request(e.url,"list",e.data.q,e.data.page,function(e){i.remoteData=e.result,t(e.result)},function(){a()});t(i.remoteData)}}:null}),i.select2Options.matcher||(i.select2Options.matcher=y);var r=u.scope(n.selectedTemplate);r&&("function"==typeof r?i.select2Options.templateSelection=r:"string"==typeof r&&0===r.indexOf("@")&&(r=(""===(r=r.substring(1).trim())?i.$element.find('[data-template="selected"]'):d(r)).html()||"{{text}}",i.select2Options.templateSelection=function(e){return e.element?d('<div class="clearfix ba--value text-line-1"/>').append(c.plugins.Template.render(r,{id:e.id,text:e.text,selected:!!e.selected,disabled:!!e.disabled,option:e},!0)):e.text}));var o,s=u.scope(n.optionTemplate);s&&("function"==typeof s?i.select2Options.templateResult=s:"string"==typeof s&&0===s.indexOf("@")&&(s=(""===(s=s.substring(1).trim())?i.$element.find('[data-template="option"]'):d(s)).html()||"{{text}}",i.select2Options.templateResult=function(e){if(e.loading)return e.text;e={id:e.id,text:e.text,group:!(!e.element||"OPTGROUP"!==e.element.tagName),selected:!!e.selected,disabled:!!e.disabled,option:e};return d('<div class="clearfix ba--option"/>').toggleClass("ba--group",e.group).append(c.plugins.Template.render(s,e,!0))})),n.placeholder&&!n.multiple&&0===e.find("option").length&&e.prepend(new Option),i.api=e.select2(i.select2Options).data("select2"),i.api.$dropdown.addClass("ba-select--dropdown").css("z-index",c.zIndex()).find("> .select2-dropdown").append('<div class="arrow"/>'),n.multiple&&(i.api.$dropdown.addClass("ba--multiple"),n.clear&&i.api.$selection.addClass("ba--has-clear")),i.singleInline&&(i.api.$selection.after(i.api.dropdown.$searchContainer),i.$inlineSearch=i.api.dropdown.$search,i.$inlineSearch.on("input",function(){i.$inlineSearch.toggleClass("ba--has-val",0<d(this).val().length)})),i.isAjax&&0===n.modelLength&&(o=i.api.dataAdapter.query,i.api.dataAdapter.query=function(a,n){o.call(this,a,function(e){var t=[];return d.each(e.results,function(){var e=i.api.options.options.matcher(a,this);e&&t.push(e)}),n({results:t,pagination:{more:!1}})})}),n.search||n.multiple||i.api.dropdown.$searchContainer.addClass("hidden");var l=[];m.map(function(e){l.push(g(e))}),e.on(l.join(" "),function(e){e=e.type.substring(8);switch(e){case"opening":!n.search&&n.multiple&&i.api.selection.$search.prop("disabled",!0);break;case"open":i.singleInline&&(i.$inlineSearch.removeClass("ba--has-val"),i.$inlineSearch[0].focus(),clearTimeout(i._setFocusTimeId),i._setFocusTimeId=setTimeout(function(){i.$inlineSearch[0].focus()},100));break;case"closing":clearTimeout(i._setFocusTimeId),i._abort()}u.execCallback(i,n[u.camel("on_"+e)],i.element,[i],i.isSelect?i.$element:[i.$wrap,i.$select],p(e,h))}),e.on(f.validateErrorPlacement,function(e,t){return i.$wrap.after(t),!1}),d.baIsEmpty(n.value)?i.formStatus.rendered():i.setValue(n.value),u.triggerPluginReady(i.$element,i,"",f.selectInitialized)},_request:function(e,t,a,n,i,r){var o=this.options;return this._abort(),this.task=c.request(e).method("get").addHeader("Busy-Admin-Plugin","Select").params(this._parseParams({action:t,word:a,page:n,model:o.model,id_field:o.modelIdField||"",text_field:o.modelTextField||"",length:o.modelLength,order:o.modelOrder||"",extend:o.modelExtend?1:0})).pending(!1).success(function(e){return i(e),!1}).error(function(e){return r(e),!1}).exec()},_abort:function(){this.task&&(this.task.abort(),this.task=null)},_parseParams:function(e){var t=this.options,a=u.scope(t.params);return"object"===(void 0===a?"undefined":_typeof(a))?e=d.extend(!0,{},t.params,e):"function"==typeof a&&(e=a(e)),e},setValue:function(t){var a=this,n=a.$select;a.isAjax&&!d.baIsEmpty(t)?a._request(a.url,"value",t,0,function(e){e=e.result.results||[];e.length&&d.map(e,function(e){e.selected=!0}),n.append(a.api.dataAdapter.convertToOptions(e)).val(t).baTriggerEvent("change"),a.formStatus.rendered()},function(){n.val(t).baTriggerEvent("change"),a.formStatus.rendered()}):(n.val(t).baTriggerEvent("change"),a.formStatus.rendered())},setData:function(e,t,a){var n=this,i=[],r=n.$select;e=d.isArray(e)?e:[e],n.api.dataAdapter.convertToOptions?i=n.api.dataAdapter.convertToOptions(e):e.forEach(function(e){var t=n.api.dataAdapter.option(e);t.is("optgroup")&&e.children.forEach(function(e){t.append(n.api.dataAdapter.option(e))}),i.push(t)}),d.baIsEmpty(a)||a?r.html(i):t?r.prepend(i):r.append(i),r.baTriggerEvent("change")},append:function(e){this.setData(e,!1,!1)},prepend:function(e){this.setData(e,!0,!1)},getSelectedData:function(){return this.api.data()},destroy:function(){this.remoteData=null,this._abort(),this.$select.off(f.validateErrorPlacement),this.$form.off(this.resetEvent),clearTimeout(this._setFocusTimeId);try{this.api&&(this.api.destroy(),this.api=null)}catch(e){}}},a.INDEX=0,a.KEY=s,a.DEFAULTS={placeholder:"",search:!0,searchMin:0,multiple:!1,clear:!1,data:null,max:0,value:null,width:null,url:!1,delay:250,params:null,model:"",modelExtend:!1,modelIdField:"",modelTextField:"",modelOrder:"",modelLength:20,selectedTemplate:null,optionTemplate:null,tags:!1,tagsSpace:null,select2:{},loadingText:null,inputLongText:null,inputShortText:null,loadingMoreText:null,maxSelectedText:null,emptyText:null,locale:d.extend({errorLoading:"数据加载失败",inputTooLong:"请删除%s个字符",inputTooShort:"至少需要输入%s个字符",loadingMore:"加载中...",maximumSelected:"最多能选择%s个选项",noResults:"无选项",searching:"请稍后..."},((c.locale||{}).plugin||{}).select||{})},d.fn.baSelect=e,d.fn.baSelect.Constructor=a,c.plugins.Select=a,c.autoInit(h,u.pluginAttrs(h),function(){e.call(this)}),a}),define("./ba/plug/shuttle",["busyAdmin","jquery"],function(r,s){var o=r.helper,l=r.e,i="shuttle",c=o.pluginKey(i),d=function e(t,a,n){var i=this;i.api=t;var r=t.options;i.$element=a;i.$header=a.find(".panel-heading");i.$title=i.$header.find("span");i.index=t.index;i.childClass="__ba_shuttle_"+(n?"l":"r")+"_child_"+i.index;i.parentClass="__ba_shuttle_"+(n?"l":"r")+"_parent_"+i.index;i.$checkAll=i.$header.find("input").attr("data-toggle","busy-checked-all").attr("data-child","."+i.childClass).addClass(i.parentClass).baCheckboxRadio();i.$searchBar=a.find(".panel-search");i.$searchInput=i.$searchBar.find("input");i.$body=a.find(".panel-body");i.$empty=i.$body.find(".empty-info").html(r.locale.noData);i.checkTimer=null;i.emptyTimer=null;i.list=[];i.isLeft=n;if(n){i.$title.html(r.leftTitle);i.$moveBtn=t.$btnRight;i.$moveBtn.find("span").html(r.locale.moveDown)}else{i.$title.html(r.rightTitle);i.$moveBtn=t.$btnLeft;i.$moveBtn.find("span").html(r.locale.moveUp)}i.$element.css("height",r.height+"px");var o=i.$header.outerHeight(true);if(!r.search)i.$searchBar.hide();else o+=i.$searchBar.outerHeight(true);i.$body.css("height",r.height-o+"px").on("change",":checkbox",function(){clearTimeout(i.checkTimer);i.checkTimer=setTimeout(function(){if(i.$body.find(":checked").length>0)i.$moveBtn.removeClass("btn-default").addClass("btn-primary").prop("disabled",false);else i.$moveBtn.removeClass("btn-primary").addClass("btn-default").prop("disabled",true)})});i.$searchInput.attr("placeholder",r.placeholder).on("input",function(){var t=(s(this).val()||"").trim();if(t===""){s.map(i.list,function(e){e.$item.removeClass("hide")});i.$empty.html(r.locale.noData);i.empty();return}s.map(i.list,function(e){if(-1!==e.text.indexOf(t))e.$item.removeClass("hide");else e.$item.addClass("hide");i.$empty.html(r.locale.noMatchData);i.empty()})})};d.prototype={append:function e(t){var a=this;if(!t.$item){t.$item=s('<div class="ba--checkbox'+(t.disabled?" disabled":"")+'"><label><input type="checkbox" value="'+t.id+'"'+(t.disabled?" disabled":"")+" /><span>"+t.text+"</span></label></div>");t.$checkbox=t.$item.find("input").attr("data-toggle","busy-checked-all").baCheckboxRadio()}t.$checkbox.off("change").on("change",function(){t.selected=s(this).prop("checked")});t.$checkbox.prop("checked",false).attr("data-parent","."+a.parentClass).attr("class",a.childClass);a.list.push(t);a.$body.append(t.$item);a.empty()},moveTo:function e(a){var t=this;if(a==t)return;var n=[];t.list=s.map(t.list,function(e,t){if(e.selected&&!e.disabled){e.selected=false;e.$item.remove();a.append(e);n.push({id:e.id,text:e.text,disabled:e.disabled});return null}return e});o.execCallback(t.api,t.api.options.onChange,t.api.element,[t.api,n,t.isLeft],t.api.$element,l.shuttleChange);t.$checkAll.prop("checked",false);t.$checkAll[0].indeterminate=false;t.$moveBtn.prop("disabled",true).removeClass("btn-primary").addClass("btn-default");t.empty()},empty:function e(){var t=this;clearTimeout(t.emptyTimer);t.emptyTimer=setTimeout(function(){if(t.$body.find(".ba--checkbox").length>0)t.$empty.hide();else t.$empty.show()})},clear:function e(){this.$body.children().each(function(){if(!s(this).hasClass("empty-info"))s(this).remove()})}};var u=function e(t,a){var n=this;n.element=t;n.$element=s(t);n.index=e.INDEX++;n.options=s.extend(true,{},e.DEFAULTS,n.$element.baData(i),a||{});n._init()};function e(e){return o.pluginFn(this,u,e,arguments)}return u.prototype={_init:function(){var a=this,e=a.options,t=a.$element;a.resetEvent="reset."+c+a.index,a.$form=a.$element.closest("form"),a.$form.on(a.resetEvent,function(){var t=a.defaultValue||[];e.data.map(function(e){e.selected=-1!==t.indexOf(e.id)}),a.render()});var n,i=o.scope(e.data);"function"==typeof i&&(i=i()),e.data=s.isArray(i)?i:[],a.$template=s(u.TEMPLATE),a.isSelect="select"===a.element.tagName.toLowerCase(),a.isSelect?(a.$select=t,a.$template.insertAfter(a.$select).append(a.$select),e.name=a.$select.attr("name"),n=[],a.$select.find("option").each(function(){n.push({id:this.value||"",text:s(this).text()||"",selected:this.hasAttribute("selected"),disabled:this.hasAttribute("disabled")})}),e.data.unshift.apply(e.data,n)):(a.$select=s("<select />"),a.$template.append(a.$select),t.html(a.$template)),a.$select.addClass("input-hidden").attr("name",e.name).attr("multiple","multiple"),a.$btnLeft=a.$template.find(".btn-left"),a.$btnRight=a.$template.find(".btn-right"),a.leftPanel=new d(a,a.$template.find(".panel-left"),!0),a.rightPanel=new d(a,a.$template.find(".panel-right"),!1),a.$btnLeft.on("click",function(){a.$btnLeft.prop("disabled")||(a.rightPanel.moveTo(a.leftPanel),a._setVal())}),a.$btnRight.on("click",function(){a.$btnRight.prop("disabled")||(a.leftPanel.moveTo(a.rightPanel),a._setVal())}),a.render(),t.on(l.validateErrorPlacement,function(e,t){return a.$template.after(t),!1}),r.app.triggerResize(),o.triggerPluginReady(t,a,"",l.shuttleInitialized)},render:function(){var t=this,e=t.options,a=[],n="";t.rightPanel.clear(),t.leftPanel.clear(),s.map(e.data,function(e){e.id=(e.id||"")+"",e.text=e.text||"",e.disabled=e.disabled||!1,e.selected=e.selected||!1,e.selected?(t.rightPanel.append(e),a.push(e.id)):t.leftPanel.append(e),n+='<option value="'+e.id+'"'+(e.selected?" selected":"")+(e.disabled?" disabled":"")+">"+e.text+"</option>"}),t.defaultValue||(t.defaultValue=a),t.$select.html(n)},_setVal:function(){var t=this;s.map(t.leftPanel.list,function(e){t.$select.find('[value="'+e.id+'"]').prop("selected",!1)}),s.map(t.rightPanel.list,function(e){t.$select.find('[value="'+e.id+'"]').prop("selected",!0)}),t.$select.baTriggerEvent("change")},getData:function(){return s.map(this.rightPanel.list,function(e){return{id:e.id,text:e.text,disabled:e.disabled}})},destroy:function(){this.isSelect&&this.$select.removeClass("input-hidden").insertAfter(this.$template),this.$template.remove(),this.$element.off(l.validateErrorPlacement),this.$form.off(this.resetEvent)}},u.INDEX=0,u.TEMPLATE='<div class="ba-shuttle row">    <div class="col-sm-5">        <div class="panel panel-default panel-left">            <div class="panel-heading">                <div class="ba--checkbox">                    <label>                        <input type="checkbox"/>                        <span></span>                    </label>                </div>            </div>            <div class="panel-search"><div class="input-group input-group-sm"><div class="input-group-addon"><i class="fa fa-search"></i></div><input type="text" class="form-control"/></div></div>            <div class="panel-body"><div class="empty-info"></div></div>        </div>    </div>    <div class="col-sm-2">        <div class="toolbar">            <button type="button" disabled class="btn btn-default btn-block btn-right"><i class="fa fa-angle-double-right hidden-xs"></i><i class="fa fa-angle-double-down visible-xs-inline"></i> <span class="visible-xs-inline"></span></button>            <button type="button" disabled class="btn btn-default btn-block btn-left"><i class="fa fa-angle-double-left hidden-xs"></i><i class="fa fa-angle-double-up visible-xs-inline"></i> <span class="visible-xs-inline"></span></button>        </div>    </div>    <div class="col-sm-5">        <div class="panel panel-default panel-right">            <div class="panel-heading">                <div class="ba--checkbox">                    <label>                        <input type="checkbox"/>                        <span></span>                    </label>                </div>            </div>            <div class="panel-search"><div class="input-group input-group-sm"><div class="input-group-addon"><i class="fa fa-search"></i></div><input type="text" class="form-control"/></div></div>            <div class="panel-body"><div class="empty-info"></div></div>        </div>    </div></div>',u.KEY=c,u.DEFAULTS={leftTitle:"列表1",rightTitle:"列表2",placeholder:"关键词搜索",search:!1,height:320,data:null,locale:s.extend({noData:"无数据",noMatchData:"无匹配数据",moveUp:"上移",moveDown:"下移"},((r.locale||{}).plugin||{}).table||{})},u.Panel=d,s.fn.baShuttle=e,s.fn.baShuttle.Constructor=u,r.plugins.Shuttle=u,l.shuttleInitialized=r.ee("initialized",i),l.shuttleChange=r.ee("change",i),r.autoInit(i,o.pluginAttrs(i),function(){e.call(this)}),u}),define("./ba/plug/table",["busyAdmin","jquery","bootstrap"],function(x,k){var C="table",S=x.helper,o=x.ee,s=x.e,p=S.override,r="table.state",l="table.tree",e="check,check-all,check-some,click-cell,click-row,collapse-row,column-switch,dbl-click-cell,dbl-click-row,expand-row,load-error,load-success,page-change,init-table-after,post-body,post-footer,post-header,pre-body,refresh,refresh-options,reset-view,search-view,scroll-body,sort-view,toggle,uncheck,uncheck-all,uncheck-some,before-refresh,export-saved,export-started,resume-url".split(","),f=S.pluginKey(C),_=k("body"),T=0,n;s.tableInitialized=o("initialized",C),k.map(e,function(e){s[S.camel("table_"+e.replace(/-/g,"_"))]=o(e,C)});var t=function e(a){a=typeof a==="string"?[a]:a;a.map(function(e,t){a[t]=e+".bs.table"});return a.join(" ")},E=function e(t,a){return x.plugins.Template.render(t,a,true)},c=function e(t){return typeof t.state==="boolean"?document.URL:t.state},D=function e(t,a){if(a===true)if(x.app.isInContent(t))return x.app.isMobileSize()?0:k(window).height()-t.offset().top-x.app.getContentFrame().paddingBottom;else return 0;else if(typeof a==="string"&&a){if(0===a.indexOf("parent")){a=a.substring(6);if(!a)return t.parent().height();return t.closest(a).height()}return k(a).height()}else if(a instanceof k)return a.height();return a},h=function e(t,a){var n=a.options;t._data=t._data||{};t._data["tree-node"]=!k.baIsEmpty(t[n.idField])?t[n.idField]:"";t._data["tree-parent"]=!k.baIsEmpty(t[n.parentField])?t[n.parentField]:"";t._data["tree-branch"]=!!t[n.hasChildrenField];a.handleRow(t)},d=function e(t,a,n){if(!t.treeState)return;var i=JSON.parse(localStorage.getItem(x.app.cacheKey(l))||"{}");var r=c(t);i[r]=i[r]||[];var o=i[r].indexOf(a);if(n){if(-1!==o)i[r].splice(o,1)}else if(-1===o)i[r].push(a);localStorage.setItem(x.app.cacheKey(l),JSON.stringify(i))},m=function e(t){if(!t.treeState)return[];var a=JSON.parse(localStorage.getItem(x.app.cacheKey(l))||"{}");var n=c(t);return a[n]||[]},i=function e(){if(n)return;n=true;var u=S.extends(k.BootstrapTable.prototype,{initContainer:function e(){var t=this;p(u,"initContainer",t,arguments);t._initFixedColumns()},_initFixedColumns:function e(){var t=this;if(!t.options.stickyHeader)return;var a=s.modalShow;var n=s.modalHided;k(document).off(a).on(a,function(){if(t.needFixedColumns&&t.options.fixedRightNumber){var e=t.options.stickyHeaderOffsetRight||0;e+=S.getScrollbarWidth();t.$fixedColumnsRight.find(".sticky-header-container").css("right",e+"px");t.$stickyContainer.css("right",e+"px")}}).off(n).on(n,function(){if(t.needFixedColumns&&t.options.fixedRightNumber){var e=t.options.stickyHeaderOffsetRight||0;t.$fixedColumnsRight.find(".sticky-header-container").css("right",e+"px");t.$stickyContainer.css("right",e+"px")}})},initToolbar:function e(){var t=this;t._initExportWayButton();p(u,"initToolbar",t,arguments);t._initToolbarSystem();t._initExportWay()},_initExportWay:function e(){var a=this;var t=a.constants.html;var n=a.options;var i=n.exportDataType;var r=n.exportTypes;var o=function e(t){a.exportTable({type:t,escape:false});n.exportDataType=i};var s=function e(){if(r.length===1)o(r[0]);else{var t=[];r.forEach(function(e){t.push({name:k.fn.bootstrapTable.exportTypeName[e],value:e})});x.dialog.prompt("请选择导出类型",r[0],{formType:"select",selectOptions:t,minlength:1,btn:["导出","取消"]},function(e){o(e)},function(){n.exportDataType=i})}};if(!a.options.showExportWay)return;var l=false;a.columns.forEach(function(e){if(e.checkbox||e.radio)l=true});a.$exportWay=a.$toolbar.find(".columns div.ba--export-way");a.$exportWayCurrent=k(S.sprintf(t.pageDropdownItem,"","导出当页数据"));a.$exportWaySelected=k(S.sprintf(t.pageDropdownItem,"","导出选中数据"));a.$exportWayAll=k(S.sprintf(t.pageDropdownItem,"","导出全部数据"));a.$exportWayMenu=k(t.toolbarDropdown.join(""));a.$exportWayMenu.append(a.$exportWayCurrent);if(l)a.$exportWayMenu.append(a.$exportWaySelected);if(n.pagination)a.$exportWayMenu.append(a.$exportWayAll);a.$exportWay.append(a.$exportWayMenu);a.$exportWayMenu.children().off("click").on("click",function(e){e.preventDefault();var t=k(this);if(t.is(a.$exportWayAll)){n.exportDataType="all";x.dialog.confirm('确认要导出全部记录吗？<div class="text-danger size-13">如果数据量过大可能会造成浏览器卡顿，属于正常现象，请耐心等待。</div>',function(){s()},function(){n.exportDataType=i})}else if(t.is(a.$exportWaySelected)){if(a.getSelections().length===0){x.dialog.toast("请选择导出的数据行");return}n.exportDataType="selected";s()}else{n.exportDataType="basic";s()}})},_initExportWayButton:function e(){var t=this;var a=t.constants;var n=t.options;if(!t.options.showExportWay)return;t.buttons=Object.assign(t.buttons,{exportWay:{html:'<div class="ba--export-way '+a.classes.buttonsDropdown+'">    <button type="button" title="'+n.formatExport()+'" class="'+a.buttonsClass+' dropdown-toggle" '+a.dataToggle+'="dropdown">        '+(n.showButtonIcons?S.sprintf(a.html.icon,n.iconsPrefix,n.icons.export):"")+"        "+(n.showButtonText?n.formatExport():"")+"        "+a.html.dropdownCaret+"    </button></div>"}})},_initToolbarSystem:function e(){var l=this;if(l.$toolbarSystem)return;var t=l.$toolbar.children();var a=l.options.toolbarSelector;if(a)l.$toolbarSystem=k(a);else l.$toolbarSystem=k('<div class="fixed-table-toolbar-system clearfix"/>');l.$toolbarSystem.append(t);l.$toolbarSearchBar=k('<div class="fixed-table-toolbar-search clearfix"/>');l.$toolbar.prepend(l.$toolbarSearchBar);if(!a)l.$toolbar.append(l.$toolbarSystem);if(t.length){l.$toolbar.show();l.$toolbarSystem.show()}else{l.$toolbar.hide();l.$toolbarSystem.hide()}l.$toolbarSystem.on("click","[data-url]",function(){var e=k(this);var n=e.data()||{};if(n.hasOwnProperty("toggle"))return;var i=n.field||"id";var r="";if(-1!==i.indexOf(",")){var t=i.split(",");i=t[1].trim();r=t[0].trim()}var o=n.name||i;var s=S.scope(n.params);e.baRequest({params:function e(){if(s===false)return{};var t=((typeof s==="undefined"?"undefined":_typeof(s))==="object"?s:{})||{};if(i){var a=r?{}:[];(n.checked?l.getSelections():l.getData()).map(function(e){if(r)t[o+"["+e[r]+"]"]=e[i];else a.push(e[i])});if(!r)t[o]=a}if(typeof s==="function")return s.call(l,t);return t},confirm:function e(){if(n.confirm&&n.checked)return S.sprintf(n.confirm,l.getSelections().length);return n.confirm}})})},initHeader:function e(){var t=this;p(u,"initHeader",t,arguments);t.prepareTree()},initBody:function e(){var t=this;if(t.treeTableEnable)t.options.virtualScroll=false;p(u,"initBody",t,arguments);t.initTree()},prepareTree:function e(){var t=this;var a=t.options.treeShowField;t.treeTableEnable=false;if(a)for(var n in t.header.fields)if(t.header.fields[n]===a){t.treeTableEnable=true;break}},initTree:function e(){var o=this;var s=o.options;o.destroyTree();if(!o.treeTableEnable)return;var t=-1;var a=-1;o.columns.map(function(e){if(e.visible)a++;if(e.field==s.treeShowField&&e.visible)t=a});if(t<0)return;var n=null;var i=null;var l=function e(){if(n===null)n=m(s);if(!n.length)return;var a=[];n.map(function(e){var t=i.tree[e];if(!t)a.push(e);else if(t.isBranchNode())t.expand()});n=a};o.$el.treetable({expandable:true,column:t,indenterTemplate:'<span class="ba--tree-indenter"><i></i></span>',expanderTemplate:'<span class="fa"></span>',indent:s.treeIndent,stringCollapse:"",stringExpand:"",branchAttr:"treeBranch",nodeIdAttr:"treeNode",parentIdAttr:"treeParent",collapsedClassName:"ba--tree-collapsed",expandedClassName:"ba--tree-expanded",branchClassName:"ba--tree-branch",leafClassName:"ba--tree-leaf",onInitialized:function e(){i=this;l();o.resetView()},onNodeCollapse:function e(){var t=this;if(t._treeTask){t._treeTask.abort();t._treeTask=null}t.expander.removeClass("fa-spin");d(o.options,t.id,true);o.resetView()},onNodeExpanded:function e(){var t=this;if(t.children.length)o.resetView()},onNodeExpand:function e(){var i=this;if(i.children.length||!s.treeLazy){d(o.options,i.id,false);return}var r=function e(){i.expander.removeClass("fa-spin")};var t=function e(t){var a=[];var n=s.data.length;t.map(function(e){s.data.push(e);h(e,o);a.push(p(u,"initRow",o,[e,n]));n++});o.initData(s.data);o.initSearch();o.initSort();o.$el.treetable("loadBranch",i,a.join("")).treetable("expandNode",i.id);o.initBodyEvent();o.updateSelected();o.initFooter();o.resetView();d(o.options,i.id);r();l()};var a=function e(t){x.dialog.tipError(t);r()};i.expander.addClass("fa-spin");i._treeTask&&i._treeTask.abort();var n=S.scope(s.treeLoad);if(typeof n==="function")i._treeTask=n.apply(o,[o.options,o.options.data[i.row.data("index")],t,a]);else i._treeTask=x.request(s.url).addHeader("Busy-Admin-Plugin","Table").pending(false).params({action:"get_children",model:s.model,extend:s.modelExtend?1:0,order:s.sortOrder||"",sort:s.sortName||"",tree_parent_field:s.parentField,tree_parent_root:s.parentRoot,tree_parent_id:i.id,tree_id_field:s.idField,tree_has_children_field:s.hasChildrenField}).method(s.method).error(function(e){a(e.message);return false}).success(function(e){t(e.result.list);return false}).exec();o._treeTask=o._treeTask||[];o._treeTask.push(i._treeTask)}},true)},renderTree:function e(t,a,n,i){var r=this;var o=r.options;var s=n.filter(function(e){return t[o.idField]==e[o.parentField]});i.append(p(u,"initRow",r,arguments));var l=s.length-1;for(var c=0;c<=l;c++){var d=s[c];h(d,r);r.renderTree(d,k.inArray(d,n),n,i)}},destroyTree:function e(){var t=this;if(t._treeTask){(t._treeTask||[]).map(function(e){e&&e.abort&&e.abort()});t.$el.treetable("destroy")}t._treeTask=null},initRow:function e(t,a,n,i){var r=this;if(r.treeTableEnable){if(r.options.parentRoot==t[r.options.parentField]||!t[r.options.parentField]){h(t,r);r.renderTree(t,a,n,i);return true}return false}return p(u,"initRow",r,arguments)},initResizable:function e(){var n=this;if(!n.options.resizable)return;var t=f+".col-resize"+n.tableIndex;var a="mousemove."+t;var i="mouseup."+t;var r="mousedown."+t;var o="mouseleave."+t;var s=n.$tableContainer;var l={};var c="cursor-col-resize";var d;var u=function e(){n._colResizeStart=false;n._colResizeAllow=false;n._colResize=null;d.hide();_.removeClass(c)};n.columns.map(function(e){l[e.field]=e});n._colResizeStart=false;d=n._$colResizeLine=(n._$colResizeLine||k('<div class="ba--resizable-line"/>')).hide().remove();s.append(d);n.$container.addClass("ba--resizable");n.$header.find("th[data-field]").off([a,o,r,i].join(" ")).on(a,function(e){var t=k(this);n._colResizeAllow=t.width()-(e.clientX-t.offset().left)<5;_.toggleClass(c,n._colResizeAllow||n._colResizeStart)}).on(o,function(){if(!n._colResizeStart)u()}).on(r,function(e){if(!n._colResizeAllow)return;e.preventDefault();var t=k(this);var a=t.outerWidth(true);n._colResizeStart=true;n._colResize={column:l[t.data("field")],width:a,newWidth:a,start:e.clientX,left:e.clientX-s.offset().left};d.show().css("left",n._colResize.left)});_.off([a,i].join(" ")).on(a,function(e){if(!n._colResizeStart)return;var t=e.clientX-n._colResize.start;n._colResize.newWidth=n._colResize.width+t;if(n._colResize.newWidth<=30){n._colResize.newWidth=30;return}d.css("left",n._colResize.left+t)}).on(i,function(){if(n._colResize){n._colResize.column.width=n._colResize.newWidth;n.initHeader();n.initFooter();n.resetView()}u()})},resetView:function e(t){var a=this;if(!t||t&&!t.hasOwnProperty("height"))a.options.height=D(a.$container.parent(),a.options._height);a.initResizable();p(u,"resetView",a,arguments)},trigger:function e(t){var a=this;var n=a.options;var i=Array.prototype.slice.call(arguments),r;if(-1!==["check","uncheck","check-all","uncheck-all","pre-body"].indexOf(t)){var o=a.getSelections().length===0;a.$toolbarSystem.find("[data-disabled]").prop("disabled",o).toggleClass("disabled",o)}switch(t){case"init-table-after":if(n.state){r=v(n);if(!r.columns||Object.keys(r.columns).length!=a.columns.length){r.columns={};a.columns.map(function(e){r.columns[e.field]=e.visible});g(n,r)}else a.columns.map(function(e){e.visible=!!r.columns[e.field]});if(k.isNumeric(r.pageSize))a.options.pageSize=r.pageSize}break;case"column-switch":if(n.state){var s=i[1];var l=i[2];var c=v(n);c.columns=c.columns||{};c.columns[s]=l;g(n,c)}break;case"page-change":if(n.state){r=v(n);r.pageSize=i[2];g(n,r)}break}p(u,"trigger",a,arguments)},destroy:function e(){p(u,"destroy",this,arguments);_.off("."+f);this.destroyTree()}})},I=function e(t,a,n,i,r,o){return E(t,{index:i,item:n,value:a,field:r,is_print:o})},g=function e(t,a){var n=x.app.cacheKey(r);var i=JSON.parse(localStorage.getItem(n)||"{}");i[c(t)]=a;localStorage.setItem(n,JSON.stringify(i))},v=function e(t){var a=JSON.parse(localStorage.getItem(x.app.cacheKey(r))||"{}");return a[c(t)]||{}},a=function i(e,t){var g=this;g.element=e;g.$element=k(e);g.libs=[];g.api=null;g.index=T++;g.options=k.extend(true,{},i.DEFAULTS,g.$element.baData(C)||{},t||{},{classes:"table",tableBorderExtra:3,fixedColumnsBorderExtra:2,fixedColumnsExtra:1,iconsPrefix:"fa",queryParamsType:"limit",paginationLoop:false,silentSort:false,flex:true,loadingTemplate:function e(){return'<i class="ba-pending-icon"></i>'}});g.table=g.element.tagName==="TABLE";if(g.table){g.$table=g.$element.wrap('<div class="ba-table"/>');g.$wrap=g.$table.parent()}else{g.$wrap=g.$element;g.$table=g.$element.addClass("ba-table").find("table");g.$table.data(i.KEY,g)}g.$wrap.data(i.KEY,g);var v=g.options;v.buttons=S.scope(v.buttons);v.customSearch=S.scope(v.customSearch);v.icons=S.scope(v.icons);v.headerStyle=S.scope(v.headerStyle);v.customSort=S.scope(v.customSort);v.rowStyle=S.scope(v.rowStyle);v.rowAttributes=S.scope(v.rowAttributes);v.detailFilter=S.scope(v.detailFilter);v.footerStyle=S.scope(v.footerStyle);if(v.stickyHeader){var a=x.app.getContentFrame();var n=a.left+a.paddingLeft;var r=a.paddingRight;if(!v.stickyHeaderOffsetY)v.stickyHeaderOffsetY=a.top-1;if(!v.stickyHeaderOffsetLeft)v.stickyHeaderOffsetLeft=n;if(!v.stickyHeaderOffsetRight)v.stickyHeaderOffsetRight=r}if(v.filterControl){g.libs.push(x.lib.bootstrapTableFilterControl);if(!v.filterControlContainer){var o="ba_table__filter_control_"+g.index;g.$filterControlContainer=k('<div id="'+o+'"/>');v.filterControlContainer="#"+o;_.append(g.$filterControlContainer)}}if(v.reorderableRows)g.libs.push(x.lib.bootstrapTableReorderRows);if(v.reorderableColumns)g.libs.push(x.lib.bootstrapTableReorderColumns);if(v.treeShowField)g.libs.push(x.lib.treeTable);if(v.showPrint){v.icons.print="fa-print";v.printPageBuilder=v.printPageBuilder||function(e){return'<html lang="zh-CN">    <head>        <title>打印</title>        <style type="text/css" media="print">            @page {size: auto; margin: 25px 0 25px 0;}        </style>        <style type="text/css" media="all">            table { border-collapse: collapse; font-size: 12px; }            table, th, td { border: 1px solid grey; }            th, td { text-align: center; vertical-align: middle; }            p { font-weight: bold; margin-left:20px; }            table { width:94%; margin-left:3%; margin-right:3%; }            div.bs-table-print { text-align:center; }        </style>    </head>    <body><div class="bs-table-print">'+e+"</div></body></html>"};g.libs.push(x.lib.bootstrapTablePrint)}if(v.showExport||v.showExportWay){if(typeof v.exportTypes==="string")v.exportTypes=v.exportTypes.split(",");var s=v.exportFilename||"%s";v.exportFilename=function(){return S.sprintf(s,moment().format(v.exportFilenameDateFormat||"YYYYMMDDHHmmss"))};var l="fa-download";if(!k.isArray(v.exportTypes)){var c=[];v.exportTypes.split(",").map(function(e){e=e.trim();if(e)c.push(e)});v.exportTypes=c}var d=v.exportTypes;if(d.length===1)switch(d[0]){case"excel":case"csv":case"xlsx":l="fa-file-excel-o";break;case"png":l="fa-file-image-o";break;case"txt":l="fa-file-txt-o";break;case"doc":l="fa-file-word-o";break;case"xml":case"json":l="fa-file-code-o";break}var u=function e(t,a){if(-1!==d.indexOf(t))g.libs.push(a)};u("png",{module:x.lib.html2canvas,exports:"html2canvas"});u("xlsx",{module:x.lib.xlsx,exports:"XLSX"});v.icons.export=l;g.libs.push(x.lib.bootstrapTableExport,{module:x.lib.moment,exports:"moment"})}if(v.model)v.url=x.getConfig("table").url;if(v.url){var p=S.scope(v.queryParams);v.queryParams=function(e){var t=g._searchParams||{};for(var a in t)e[a]=t[a];if(typeof p==="function")e=p.call(this,e);if(e===false)return false;return k.extend(true,{},e,{model:v.model,extend:v.modelExtend?1:0},v.treeLazy?{tree_lazy:1,tree_parent_field:v.parentField,tree_parent_root:v.parentRoot,tree_id_field:v.idField,tree_has_children_field:v.hasChildrenField}:{})};if(typeof v.pagination!=="boolean")v.pagination=true;v.url=v.url===true?document.URL:v.url;v.sidePagination="server";v.ajax=function(n){if(v.route&&!v.model)if(!g._routeInit)g._routeInit=true;else if(!g._noRecordRoute||g._needReplaceRoute){g._noRecordRoute=false;g._needReplaceRoute=false;var e=S.parseURL(v.url);var t=k.extend(true,{},e.params||{},n.data);var a=S.scope(v.routeFilterKeys);if(typeof a==="function")a=a.call(g);if(!k.isArray(a))a=[];a.concat(i.ROUTE_FILTER_KEYS).map(function(e){delete t[e]});x.route.show(e.path+"?"+k.param(t),{popStateDispatch:false},false,true)}g._abort();g.task=x.request(n.url).addHeader("Busy-Admin-Plugin","Table").pending(false).cache(n.cache).params(n.data).method(n.type).error(function(e,t,a){n.error(a)}).success(function(e,t,a){n.success(e.result||{},t,a);return false}).exec()}}else if(typeof v.pagination!=="boolean")v.pagination=false;g.searchImplant=false;if(v.search&&typeof v.search==="string"){g.searchSelector=v.search;v.search=false;if(0===g.searchSelector.indexOf("@")){g.searchSelector=g.searchSelector.substring(1).trim();g.searchImplant=true;if(!g.searchSelector)g.searchSelector=k(g.$wrap.find('[data-template="search"]').html())}}v._height=v.height;v.height=D(g.$wrap,v._height);g.$table.find("> thead > tr").each(function(){var e=k(this);e.find("> th").each(function(e){var t=k(this);var a=t.attr("width");if(a)t.attr("data-width",a);if(v.url)if(t.attr("data-searchable")===undefined)t.attr("data-searchable","false");if(typeof v.clickToSelect!=="boolean"&&t.data("checkbox"))v.clickToSelect=true;var n="ba-backups-print-formatter";var i="ba-backups-formatter";var r="ba-backups-footer-formatter";var o="data-print-formatter";var s="data-formatter";var l="data-footer-formatter";var c="print-formatter";var d=t.attr(o);var u;d=(k.baIsEmpty(d)?t.attr(n):d)||"";if(0===d.indexOf("@")){u=d.substring(1).trim();var p=(u===""?t.find('[data-template="print"]').html():g.$element.find('[data-template="print@'+u+'"]').html())||"{{value}}";t.removeAttr(o).attr(n,d).data(c,function(e,t,a){return I(p,e,t,a,this.field,true)})}d=t.attr(s);d=(k.baIsEmpty(d)?t.attr(i):d)||"";if(0===d.indexOf("@")){u=d.substring(1).trim();var f=(u===""?t.find('script[type="text/html"],script[type="text/template"],template').not('[data-template="print"]').html():g.$element.find('[data-template="formatter@'+u+'"]').html())||"{{value}}";t.removeAttr(s).attr(i,d).data("formatter",function(e,t,a,n){return I(f,e,t,a,n,false)});if(!t.data(c))t.data(c,function(e,t,a){return I(f,e,t,a,this.field,true)})}d=t.attr(l);d=(k.baIsEmpty(d)?t.attr(r):d)||"";if(d){var h=d.replace(/\\@/g,S.encodeUnicode("@")).replace(/\\\(/g,S.encodeUnicode("(")).replace("\\)",S.encodeUnicode(")")).replace(/\\u/g,"#$u");var m=/(@[a-z]+\(.*?\))/gim;if(h.match(m))t.removeAttr(l).attr(r,d).data("footer-formatter",function(n){var a=this.field;var i=function e(){var t=0;n.map(function(e){t+=+(e[a]||0)});return t};return S.decodeUnicode(h.replace(m,function(e){var a=e.match(/([a-z]+)\((.*?)\)/i);if(a){var t=function e(t){if(a[2])return t.toFixed(+a[2]);return t};switch(a[1].toLowerCase()){case"sum":return t(i());case"average":return t(i()/n.length);case"count":return n.length;default:return a[0]}}}).replace(/#\$u/g,"\\u"))})}})});if(typeof v.clickToSelect!=="boolean")v.clickToSelect=false;if((v.fixedNumber>0||v.fixedRightNumber>0)&&typeof v.fixedColumns!=="boolean")v.fixedColumns=true;if(v.data){v.data=S.scope(v.data);if(typeof v.data==="function")v.data=v.data()}var f="ba-backups-detail-formatter";var h=g.$element.attr(f);if(h&&!v.detailFormatter)v.detailFormatter=h;if(v.detailView&&typeof v.detailFormatter==="string"&&0===v.detailFormatter.indexOf("@")){g.$element.attr(f,v.detailFormatter);var m=g.$element.find('[data-template="detail"]').html();v.detailFormatter=function(e,t,a){return E(m||"{{item}}",{index:e,item:t})}}v.detailFormatter=S.scope(v.detailFormatter);f="ba-backups-toolbar";h=g.$element.attr(f);if(h&&!v.toolbar)v.toolbar=f;if(typeof v.toolbar==="string"&&0===v.toolbar.indexOf("@")){g.$element.attr(f,v.toolbar);g.toolbarTpl=true;v.toolbar=k(g.$element.find('[data-template="toolbar"]').html())}var b=S.scope(v.ignoreClickToSelectOn);v.ignoreClickToSelectOn=function(e){var t=k(e);var a=e.tagName;var n=t.closest("label");if(t.data("click-to-select")===false||t.closest("a").length||t.closest("button").length||t.parent().closest(".bs-checkbox").length||t.closest(".ba--tree-indenter").length||["A","BUTTON","INPUT","TEXTAREA","SELECT"].includes(a)||n.length&&n.attr("for"))return true;if(typeof b==="function")return b.call(this,e);return false};var y=v.locale;if(v.noDataText)y.noMatches=v.noDataText;v.locale="";for(var $ in y){var w=y[$];if($==="showingRowsHasFilter")continue;v["format"+$.charAt(0).toUpperCase()+$.slice(1)]=new Function('var args = Array.prototype.slice.call(arguments);\nif (args[3] !== undefined && args[2] !== undefined && args[3] > 0 && args[3] > args[2]) {\n    args.unshift("'+w+y.showingRowsHasFilter+'")\n} else {\n    args.unshift("'+w+'");\n}\nreturn busyAdmin.helper.sprintf.apply(null, args);')}g.ready(g.init)};function u(e){return S.pluginFn(this,a,e,arguments,"api")}return a.prototype={ready:function(e){function t(){x.requireQueue(a.libs,function(){e.call(a)})}var a=this;n?t():x.requireQueue([x.lib.bootstrapTable,x.lib.bootstrapTableStickyHeader,x.lib.bootstrapTableFixedColumns],function(){x.plugins.Template.ready(function(){i(),t()})})},init:function(){var r=this,e=k.proxy(r.destroy,r);r.eventNamespace="."+a.KEY+r.index,r.routeNoDispatchEvent=""+s.routeNoDispatch+r.eventNamespace,r.modalReadyEvent=""+s.modalReady+r.eventNamespace,k(document).one(s.appRenderBefore,e).off(r.routeNoDispatchEvent).on(r.routeNoDispatchEvent,function(){var e=r.resumeByUrl();0<e&&r.api.refresh({pageNumber:e})}).on(r.modalReadyEvent,function(e,t){t.$element.closestBaTable()===r&&(t._bindBaTable=r)}),r.modal=r.$wrap.closestBaModal(),r.modal&&r.modal.$element.one(x.e.modalHide,e),r.$table.on(t("all"),function(e,t,a){t=t.replace(".bs.table","");var n=r.api=e.sender;switch(a.unshift(n),r.modal&&-1!==["post-body","load-success"].indexOf(t)&&r.modal.resetView(),t){case"init-table-after":r.$wrap.addClass("ba--ready");var i=r.resumeByUrl();0<i&&(n.options.pageNumber=i);break;case"pre-body":r.initCustomSearch();break;case"post-body":r._needResumeScroll&&(r._needResumeScroll=!1,n.scrollTo(r._scrollTop)),r.initialized||(r.initialized=!0,S.triggerPluginReady(r.$element,r,"",s.tableInitialized));break;case"before-refresh":r._scrollTop=n.getScrollPosition(),r._needResumeScroll=!0,r._noRecordRoute=!0}S.execCallback(r,r.options.onAll,r.element,a,r.$element,o(t,C))}).bootstrapTable(r.options),r.api=r.$table.data("bootstrap.table")},resumeByUrl:function(){var e=this,t=e.options,a=e.api;if(!a||!t.route||t.model)return 0;var n=S.parseURL(document.URL).params||{},i=1,r=+(n.limit||a.options.pageSize||0),o=+(n.offset||0);0<r&&0<o&&(i=Math.ceil(o/r)+1,a.options.pageSize=r);o=k.trim(n.sort||""),r=k.trim(n.order||"");return o&&r&&(a.options.sortName=o,a.options.sortOrder=r),a.options.search&&(a.options.searchText=k.trim(n.search),a.initSearchText()),delete n.limit,delete n.offset,delete n.sort,delete n.order,delete n.search,e.$searchBarForm&&e.$searchBarForm.length&&(e.$searchBarForm[0].reset(),e.$searchBarForm.baFormVal(n)),S.execCallback(e,t.onResumeUrl,e.element,[n],e.$element,s.tableResumeUrl),e._searchParams=n,i},initCustomSearch:function(){var n=this,e=n.api,t=n.options;e&&t.url&&n.searchSelector&&!n.$searchBar&&e.$toolbarSearchBar&&(n.$searchBar=k(n.searchSelector),n.searchImplant&&n.$searchBar.length&&(k(document).on(x.e.appPluginReady,function(e,t,a){a instanceof x.plugins.SearchBar&&t.closest(n.$searchBar).length&&n.initCustomSearchEvent()}),n.$searchBarMark=k("<div />").insertAfter(n.$searchBar),e.$toolbarSearchBar.append(n.$searchBar),e.$toolbar.show()),n.initCustomSearchEvent())},initCustomSearchEvent:function(){var t=this,a=t.api;t.$searchBar&&t.$searchBar.length&&a&&(t.$searchBarForm=t.$searchBar.find("form"),t.$searchBarReset=t.$searchBarForm.find('[type="reset"]'),t.$searchBarForm.off("submit."+f).on("submit."+f,function(e){return e.preventDefault(),t._searchParams={},k(this).serializeArray().map(function(e){-1===["offset","limit","sort","order","search","searchable","filter"].indexOf(e.name)&&(t._searchParams[e.name]=e.value)}),t._needReplaceRoute=!0,a.refresh({pageNumber:1}),!1}),t.$searchBarReset.off("click."+f).on("click."+f,function(e){return e.preventDefault(),t.reset(),!1}))},reset:function(e){var t=this.api;this._searchParams=e||{},this._needReplaceRoute=!0,this.$searchBarForm&&this.$searchBarForm.length&&(this.$searchBarForm[0].reset(),this.$searchBarForm.baFormVal(this._searchParams)),t&&(t.options.sortName=void 0,t.options.sortOrder=void 0,t.getCaret(),t.refresh({pageNumber:1}))},getQueryParams:function(e,t){var a=this.api,n={};return!0===e&&(t=!(e=null)),a&&(n=a.initServer(!1,e,null,!0)),t?k.param(n):n},_abort:function(){this.task&&(this.task.abort(),this.task=null)},destroy:function(){var e=this;e.$searchBar&&(e.$searchBarForm&&(e.$searchBarForm.off("."+f),e.$searchBarReset.off("."+f)),e.$searchBarMark&&(e.$searchBar.insertBefore(e.$searchBarMark),e.$searchBarMark.remove()),e.$searchBar=null),e._abort(),e.$filterControlContainer&&(e.$filterControlContainer.remove(),e.$filterControlContainer=null),e.api&&(e.api.destroy(),e.api=null),k(document).off(e.eventNamespace),e.$table.off(t("all")).removeData("bootstrap.table"),e.table&&(e.$element.insertAfter(e.$wrap),e.$wrap.remove()),e.toolbarTpl&&e.options.toolbar.remove()}},a.KEY=f,a.ROUTE_FILTER_KEYS=["model","extend","searchable","tree_lazy","tree_parent_field","tree_parent_root","tree_id_field","tree_has_children_field"],a.DEFAULTS={type:"ajax",route:!1,fixedLayout:!0,showColumns:!1,showPrint:!1,search:!1,showSearchButton:!0,showSearchClearButton:!0,searchOnEnterKey:!0,bordered:!1,resizable:!0,reorderableRows:!1,reorderableColumns:!1,showExport:!1,exportTypes:"excel",showExportWay:!1,idField:"id",selectItemName:"id[]",noDataText:"",state:!1,treeShowField:null,treeState:!1,treeIndent:16,treeLazy:!1,treeLoad:null,parentField:"parent_id",parentRoot:0,hasChildrenField:"has_children",pageList:[10,20,30,40,50,100,200],pageSize:20,model:"",modelExtend:!1,icons:{paginationSwitchDown:"fa-chevron-down",paginationSwitchUp:"fa-chevron-up",refresh:"fa-refresh",toggleOff:"fa-list-alt",toggleOn:"fa-list-alt",columns:"fa-th",detailOpen:"fa-angle-right",detailClose:"fa-angle-down",fullscreen:"fa-arrows-alt",search:"fa-search",clearSearch:"fa-repeat"},onBeforeRefresh:k.noop,onInitTableAfter:k.noop,locale:k.extend({copyRows:"复制行",print:"打印",loadingMessage:"请稍候...",recordsPerPage:"每页%s条",showingRows:"%s-%s/%s条",showingRowsHasFilter:", (从%s条中过滤)",sRPaginationPreText:"上一页",sRPaginationPageText:"第%s页",sRPaginationNextText:"下一页",detailPagination:"共%s条",clearSearch:"重置",search:"搜索",noMatches:"暂无相关记录",paginationSwitch:"隐藏/显示分页",paginationSwitchDown:"显示分页",paginationSwitchUp:"隐藏分页",refresh:"刷新",toggle:"切换",toggleOn:"显示卡片视图",toggleOff:"隐藏卡片视图",columns:"列",columnsToggleAll:"切换所有",fullscreen:"全屏",allRows:"所有",autoRefresh:"自动刷新",export:"导出",jumpTo:"跳转",advancedSearch:"高级搜索",advancedCloseButton:"关闭",filterControlSwitch:"隐藏/显示过滤",filterControlSwitchHide:"隐藏过滤",filterControlSwitchShow:"显示过滤"},((x.locale||{}).plugin||{}).table||{})},k.fn.baTable=u,k.fn.baTable.Constructor=a,x.plugins.Table=a,k.fn.closestBaTableEl=function(){return this.closest(".ba-table")},k.fn.findBaTableEl=function(){return this.find(".ba-table")},k.fn.closestBaTable=function(e){return S.pluginCall(a,"baTable",this.closestBaTableEl(),e,arguments)},k.fn.findBaTable=function(e){return S.pluginCall(a,"baTable",this.findBaTableEl(),e,arguments)},k.fn.elInBaTable=function(e){if(e=void 0===e||e,!this.closestBaTableEl().length)return!1;if(e){e=this.closest(".fixed-table-body").parent();return!e.hasClass("fixed-columns")&&!e.hasClass("fixed-columns-right")}return!0},x.regSugar(C,function(e,t,a){var n=k(this),i=n.closestBaModal();if(i&&(n=i.$element,i._bindBaTable&&(n=i._bindBaTable.$element)),"reload"===e&&(e=""),e=e||"refresh",n.closestBaTableEl().length)n.closestBaTable(e,t);else{if(i)n=i.$container;else{if(!x.app.isInContent(n))return;n=x.app.$contentBody}n.findBaTable(e,t)}}),x.autoInit(C,S.pluginAttrs(C),function(){u.call(this)}),a}),define("./ba/plug/tabs",["busyAdmin","jquery"],function(p,f){var h=p.helper,m=p.e,g="tabs",v=f(window),d=["show","hide","shown","hidden"];d.map(function(e){m[h.camel("tabs_"+e)]=p.ee(e,g)}),m.tabsBeforeRemove=p.ee("before-remove",g),m.tabsRemoved=p.ee("removed",g),m.tabsBeforeClear=p.ee("before-clear",g),m.tabsCleared=p.ee("cleared",g),m.tabsAdded=p.ee("added",g);var b=function e(t,a){return t+"."+u.KEY+"-"+a.index},u=function e(t,a){var n=this,i,r;n.index=e.INDEX++;n.resizeEvent=b("resize",n);n.element=t;i=n.$element=f(t).removeClass("nav-justified");r=n.options=f.extend(true,{},e.DEFAULTS,i.baData(g)||{},a||{});n.$content=r.content?f(r.content).addClass("tab-content"):n.$element.next(".tab-content");n.tabs=[];var o=!f.baIsEmpty(r.active)&&r.active!=="";var s=n.$content.find("> .tab-pane");i.find("> li > a").each(function(e){var t=f(this);var a=n._createTab(e,t.attr("data-name"),t,s.eq(e));if(a.err){t.parent().remove();s.eq(e).remove();return}if(t.parent().hasClass("active")&&!o){r.active=a;o=true}});if(!o&&n.tabs.length){o=true;r.active=n.tabs[0]}n.$container=f('<div class="ba-tabs dropdown ba-tabs--'+n.index+'">    <div class="ba--container">        <div class="ba--prev"><i class="fa fa-angle-left"></i></div>        <div class="ba--body"></div>        <div class="ba--toolbar">            <div class="ba--next"><i class="fa fa-angle-right"></i></div>            <div class="ba--more" data-toggle="dropdown" data-target=".ba-tabs--'+n.index+'"><i class="fa fa-angle-down"></i></div>            <div class="ba--clear"><i class="bicon bicon-close"></i></div>            <div class="ba--plus"><i class="bicon bicon-plus"></i></div>        </div>    </div>    <div class="dropdown-menu dropdown-menu-right"><div class="ba--menu-head"><ul><li><a>关闭所有标签</a></li></ul></div><ul class="ba--menu-list"></ul></div></div>').insertBefore(i);n.$prev=n.$container.find(".ba--prev");n.$next=n.$container.find(".ba--next");n.$plus=n.$container.find(".ba--plus");n.$clear=n.$container.find(".ba--clear");n.$toolbar=n.$container.find(".ba--toolbar");n.$more=n.$container.find(".ba--more");n.$menu=n.$container.find(".dropdown-menu");n.$menuHead=n.$menu.find(".ba--menu-head");n.$menuList=n.$menu.find(".ba--menu-list");n.$body=n.$container.find(".ba--body").html(i);n.$container.toggleClass("ba--addable",r.addable||r.editable);n.$container.toggleClass("ba--show-more",r.more);if(r.card){n.$card=n.$container.parent(".panel");n.isCard=!!n.$card.length;if(!n.isCard){n.$card=f('<div class="panel" />').insertBefore(n.$container);n.$card.append(n.$container);if(!r.content)n.$card.append(n.$content.addClass("panel-body"))}var l=r.card===true?"":"panel-"+r.card;var c=[];["default","primary","secondary","dark","light","success","warning","danger","info"].map(function(e){c.push("panel-"+e)});n.$card.removeClass(c).addClass(l);n.$card.toggleClass("ba--no-body",n.$card.find("> .panel-body").length<1)}(i.attr("class")||"").split(" ").map(function(e){e=e.trim();if(e&&e!=="nav")n.$container.addClass("ba-tabs--"+e)});n.$plus.on("click",function(){var e=h.scope(n.options.add);if(typeof e==="function"){var t=e();if((typeof t==="undefined"?"undefined":_typeof(t))==="object"&&t!==null)n.add(t.name,t.label,t.pane,t.show)}else n.add(null,null,null,true)});n.$clear.on("click",function(){if(false!==h.execCallback(n,r.onBeforeClear,n.element,[n],i,m.tabsBeforeClear,true,false))n.clear()});n.$menuHead.find("a").on("click",function(){n.$clear.trigger("click")});n.$container.on("shown.bs.dropdown",function(){var e=n.$menuList;e.animate({scrollTop:e.find("li.active").position().top+e.position().top+e.scrollTop()},0)});n.$body.on("scroll",f.proxy(n.onScroll,n));n.$prev.on("click",f.proxy(n.prev,n));n.$next.on("click",f.proxy(n.next,n));v.off(n.resizeEvent).on(n.resizeEvent,f.proxy(n.update,n));var d=f.proxy(n.destroy,n);f(document).one(m.appRenderBefore,d);var u=n.$element.closestBaModal();if(u)u.$element.one(p.e.modalHide,d);n.show(r.active)};function e(e){return h.pluginFn(this,u,e,arguments)}return u.prototype={getTab:function(e){if(e instanceof jQuery)return e.data(u.KEY+"-item");if("object"===(void 0===e?"undefined":_typeof(e))&&null!==e)return e;e+="";for(var t=0;t<this.tabs.length;t++){var a=this.tabs[t];if(a.name===e)return a}return null},_createTab:function(e,t,a,n){var i,r,o=this,s=o.options,l="ba--tabs-pane-"+o.index+"-"+e;if(a=a||f("<a />"),!f.baIsEmpty(t)&&""!==(t+"").trim()||(t=e),i=o.getTab(t)){var c=h.scope(s.error);return c?c.call(o,i):console.error("选项卡已存在",i),i.err=!0,i}return a.attr("data-target","."+l).attr("data-name",t).attr("data-index",e),s.html||(n=n||f('<div class="tab-pane"/>'),a.attr("data-toggle","tab"),n.toggleClass("fade",s.fade).addClass(l),(s.closable||s.editable)&&(a.addClass("ba--closable").append('<span class="bicon bicon-close ba--close" data-close="tab"></span>'),a.find(".bicon-close").on("click",function(){return!1!==h.execCallback(o,s.onBeforeRemove,o.element,[o,t],o.$element,m.tabsBeforeRemove,!0,!1)&&o.remove(t),!1})),r=[],d.map(function(e){r.push(b(e+".bs.tab",o)+"."+l)}),a.on(r.join(" "),function(e){var t=f(e.target),a=f(e.relatedTarget);"show"===e.type&&(o.active=i,o.update()),h.execCallback(o,s[h.camel("on_"+e.type)],o.element,[o,t,a],o.$element,m[h.camel("tabs_"+e.type)])})),o.tabs.push(i={index:e,name:t+"",$tab:a,$pane:n,target:"."+l}),a.data(u.KEY+"-item",i),i},add:function(e,t,a,n){var i=this,r=i.tabs.length,e=i._createTab(r,e);e.err||(i.$element.append(f("<li />").append(e.$tab.prepend(f.baIsEmpty(t)?"选项卡"+r:t))),e.$pane&&i.$content.append(e.$pane.html(a)),h.execCallback(i,i.options.onAdded,i.element,[i,e.name],i.$element,m.tabsAdded),n?i.show(e):i.update())},remove:function(e){this._remove(e),h.execCallback(this,this.options.onRemoved,this.element,[this,e],this.$element,m.tabsRemoved)},_remove:function(e){var t,a,n,i=this.getTab(e);i&&(a=(t=i.$tab.parent()).parent(),n=t.prev(),e=t.next(),i.$pane&&i.$pane.remove(),t.remove(),a.children().length<=0&&(this.tabs=[]),this.isActive(i)?n.length?this.show(n.find("> a").data(u.KEY+"-item")):e.length?this.show(e.find("> a").data(u.KEY+"-item")):this.update():this.update())},clear:function(){var t=this;t.tabs.map(function(e){t._remove(e)}),h.execCallback(t,t.options.onCleared,t.element,[t],t.$element,m.tabsCleared)},isActive:function(e){e=this.getTab(e);return!!e&&e.$tab.parent().hasClass("active")},show:function(e){e=this.getTab(e);if(e){if(this.options.html)return this.active=e,void this.update();e.$tab.parent().removeClass("active"),e.$tab.tab("show")}},update:function(){var a=this,n=a.options;a.tabWidth=a.$element.outerWidth(!0),a.bodyWidth=a.$body.width();var e=a.tabWidth>a.bodyWidth;a.$container.toggleClass("ba--clearable",n.clearable&&0<a.tabs.length),a.$element.toggleClass("ba--scrollable",e),a.$container.toggleClass("ba--scrollable",e),a.onScroll(),e?(e=n.html,a.frist||(e=a.frist=!0),a.scrollTo(a.active,e)):a._scroll(0,!0);var i=a.getTab(a.active);a.$menuList.html(a.$element.children().clone().removeClass("active").each(function(){var e=f(this),t=e.find("> a[data-target]").removeAttr("data-toggle");i&&i.target==t.data("target")&&e.addClass("active"),n.html||(t.on("click",function(e){e.preventDefault(),a.show(f(this).data("name"))}),t.find('> span[data-close="tab"]').on("click",function(e){e.preventDefault(),a.$element.find('a[data-target="'+f(this).parent().data("target")+'"]').find('> span[data-close="tab"]').trigger("click")}))}))},prev:function(){this._scroll(this.$body.scrollLeft()-this.bodyWidth)},next:function(){this._scroll(this.$body.scrollLeft()+this.bodyWidth)},_scroll:function(e,t){!0===t?this.$body.scrollLeft(e):this.$body.stop().animate({scrollLeft:e})},onScroll:function(){var e=this.$body.scrollLeft(),t=e<=0;this.$prev.toggleClass("disabled",t).attr("disabled",function(){return t?"disabled":null});var a=e+this.$body[0].clientWidth>=this.$body[0].scrollWidth;this.$toolbar.toggleClass("ba--end",a),this.$next.toggleClass("disabled",a).attr("disabled",function(){return a?"disabled":null})},scrollTo:function(e,t){var a=this.getTab(e);a&&(a=(e=a.$tab.parent()).position().left,e=e.outerWidth(!0),this._scroll(a-this.bodyWidth/2+e/2,t))},destroy:function(){var t=this;v.off(t.resizeEvent),t.tabs.map(function(e){e.$tab.off(b("",t))}),t.$element.removeClass("ba--scrollable"),!t.isCard&&t.options.card?(t.$element.insertBefore(t.$card),t.$content.removeClass("panel-body").insertAfter(t.$element),t.$card.remove()):(t.$element.insertBefore(t.$container),t.$container.remove())}},u.INDEX=0,u.KEY=h.pluginKey(g),u.DEFAULTS={fade:!0,active:null,closable:!1,addable:!1,editable:!1,clearable:!1,more:!0,card:!1,content:null,html:!1},f.fn.baTabs=e,f.fn.baTabs.Constructor=u,p.plugins.Tabs=u,p.autoInit(g,h.pluginAttrs(g),function(){e.call(this)}),u}),define("./ba/plug/template",["busyAdmin","jquery"],function(n,r){var o,i=n.helper,s="template",l=function e(t){if(o)t();else requirejs([n.lib.artTemplate],function(e){o=e;i.initArt(o);t()})},a=function e(t,a,n,i){if(n===true||i===true){n=n===true?{}:n||{};if(!o)throw"ArtTemplate is not define";return o.render(t,a||{},n)}if(typeof n==="function"){i=n;n={}}if(typeof i!=="function")i=r.noop;l(function(){i(o.render(t,a||{},n))})},t=function e(t,a){var n=this;n.element=t;n.$element=r(t);n.options=r.extend(true,{},e.DEFAULTS,n.$element.baData(s)||{},a||{});n.$template=n.options.template?r(n.options.template):n.$element;n.tmpl=n.$template.html();n.init()};function e(e){return i.pluginFn(this,t,e,arguments)}return t.prototype={init:function(){var t=this,a=t.options.onDone;t.options.onDone=function(e){i.execCallback(t,a,t.element,[e],t.$element,n.e.templateDone),t.first||(t.first=!0,i.triggerPluginReady(t.$element,t,"",n.e.templateInitialized))},t.apply()},apply:function(e){var t=this;e=e||("function"==typeof(e=i.scope(t.options.data))?e():t.options.data),a(t.tmpl,e||{},t.options,function(e){t.options.onDone(e),t.$element.html(e)})}},t.KEY=i.pluginKey(s),t.DEFAULTS={data:{},template:null,onDone:null},t.render=a,t.ready=l,r.fn.baTemplate=e,r.fn.baTemplate.Constructor=t,n.plugins.Template=t,n.e.templateDone=n.ee("done",s),n.e.templateInitialized=n.ee("initialized",s),n.autoInit(s,i.pluginAttrs(s),function(){e.call(this)}),t}),define("./ba/plug/tree",["busyAdmin","jquery"],function(p,f){"use strict";var o="init,loading,loaded,ready,destroy,set_state,refresh,load_node,load_all,redraw,model,before_open,open_node,after_open,close_node,after_close,open_all,close_all,enable_node,disable_node,hide_node,show_node,hide_all,show_all,activate_node,hover_node,dehover_node,select_node,deselect_node,changed,select_all,deselect_all,refresh_node,set_id,set_text,create_node,rename_node,delete_node,move_node,copy_node,cut,copy,paste,clear_buffer,disable_checkbox,enable_checkbox,check_node,uncheck_node,check_all,uncheck_all".split(","),h=p.helper,s=p.ee,d=p.e,u="tree",m=h.pluginKey(u);d.treeInitialized=s("initialized",u),d.treeOperate=s("operate",u),f.map(o,function(e){d[h.camel("tree_"+e)]=s(e,u)});var a=false,n=function e(){if(a)return;a=true;var u=h.extends(f.jstree.core.prototype,{redraw_node:function e(t,a,n,i){var r=this;var o=h.override(u,"redraw_node",r,arguments);if(!o)return false;var s=r.settings.core;if(!s._nodeExtend)return o;var l=f(o);var c=r.get_node(t);var d="";c.group=c.children&&c.children.length>0;if(typeof s._nodeExtend==="function")d=s._nodeExtend.call(r,c);else d=p.plugins.Template.render(""+s._nodeExtend,c,true);l.find("> .jstree-anchor").append('<span class="ba--custom">'+d+"</span>");return o}})},t=function e(t,a){var s=this;s.index=e.INDEX++;s.element=t;s.$element=f(t);s._$element=s.$element.clone(true,true);s.options=f.extend(true,{},e.DEFAULTS,s.$element.baData(u)||{},a||{});s.$container=f('<div class="ba-tree"/>');s.$container.insertAfter(s.$element).append(s.$element);var l=s.options;var n=s.$element.find("select");s.$selectMain=s.$element.find('select[data-template="main"]');s.$selectUncertain=s.$element.find('select[data-template="uncertain"]');if(!s.$selectMain.length&&n.length>0)s.$selectMain=n.eq(0);if(!s.$selectUncertain.length&&n.length>1)s.$selectUncertain=n.eq(1);if(!s.$selectMain.length)s.$selectMain=f("<select />");if(!s.$selectUncertain.length)s.$selectUncertain=f("<select />");if(!l.name)l.name=s.$selectMain.attr("name")||"";if(!l.uncertainName)l.uncertainName=s.$selectUncertain.attr("name")||"";s.$selectMain.addClass("input-hidden").attr("multiple","multiple").attr("name",function(){if(l.name)return l.name.indexOf("[]")>0?l.name:l.name+"[]";return null});s.$selectUncertain.addClass("input-hidden").attr("multiple","multiple").attr("name",function(){if(l.uncertainName)return l.uncertainName.indexOf("[]")>0?l.uncertainName:l.uncertainName+"[]";return null});s.defaultValue=[];s.resetEvent="reset."+m+s.index;s.$form=s.$element.closest("form");s.$form.on(s.resetEvent,function(){if(!s.api||!s.defaultValue)return;s.api.uncheck_all();if(s.defaultValue.length)s.api.check_node(s.defaultValue)});var i=h.scope(l.nodeExtend);if(typeof i==="string"&&0===i.indexOf("@"))i=s.$element.find('[data-template="node-extend"]').html();s.api=null;s.jstreeOpt={core:{_nodeExtend:i,animation:l.animation,multiple:l.multiple,expand_selected_onload:l.expandSelectedOnload,force_text:l.forceText,dblclick_toggle:false,check_callback:function e(t,a,n,i,r){if(f.isArray(l.operate))return-1!==(l.onOperate||[]).indexOf(t);var o=Array.prototype.slice.call(arguments);o.unshift(s);return h.execCallback(s,l.operate,s.element,o,s.$element,d.treeOperate,true,"boolean",true)},themes:{dots:l.dots,icons:l.icons,ellipsis:l.ellipsis,stripes:l.stripes},strings:{"Loading ...":l.locale.loading,"New node":l.locale.newNode,nodes:l.locale.nodes}},types:{default:{}},plugins:["types"]};if(l.leafTile)s.$element.addClass("leaf-tile");if(l.border)s.$element.addClass("show-border");var r=s.jstreeOpt;if(l.checkbox){r.plugins.push("checkbox");r.checkbox={keep_selected_style:l.checkboxKeepSelectedStyle,tie_selection:l.checkboxTieSelection,three_state:l.checkboxRelation,cascade:l.checkboxRelationDir,cascade_to_disabled:l.checkboxRelationDisabled,cascade_to_hidden:l.checkboxRelationHidden}}if(l.block)r.plugins.push("wholerow");if(l.dnd)r.plugins.push("dnd");if(l.contextmenu){var o=h.scope(l.contextmenuItems);r.plugins.push("contextmenu");r.contextmenu={items:function e(t){p.dialog.toast("没有配置右键菜单项");return{}}};if(typeof o==="function")r.contextmenu.items=o;else r.contextmenu.items=o||{}}if(l.url||l.model)r.core.data=function(e,n){var i=this;var t={model:l.model,extend:l.modelExtend?1:0,id_field:l.modelIdField||"",parent_field:l.modelParentField||"",name_field:l.modelNameField||"",icon_field:l.modelIconField||"",disabled_field:l.modelDisabledField||"",async_node:l.asyncNode?1:0,async_parent_id:e.id==="#"?"":e.id,order:l.modelOrder||""};var a=h.scope(l.params);if(typeof a==="function")a=a.call(s,t);t=f.extend(true,{},a||{},t);s._abort();s.task=p.request(l.model?p.getConfig("tree").url:l.url).method(l.method).addHeader("Busy-Admin-Plugin","Tree").pending(false).params(t).error(function(e,t,a){n.call(i,[])}).success(function(e,t,a){n.call(i,e.result.data);return false}).exec()};else if(l.data){var c=h.scope(l.data);if(typeof c==="function")c=c();r.core.data=c||[]}s.formStatus=s.$element.baFormStatus(s).render();s.ready(s._init)};function e(e){return h.pluginFn(this,t,e,arguments,["api",function(e){return{name:"api",method:h.snake(e)}}])}return t.prototype={ready:function(e){var t=this;a?e.call(t):requirejs([p.lib.tree],function(){p.plugins.Template.ready(function(){n(),e.call(t)})})},_abort:function(){this.task&&(this.task.abort(),this.task=null)},_init:function(){var n=this,i=n.$element,r=n.options,e=f.proxy(n.destroy,n);f(document).one(d.appRenderBefore,e);var t=i.closestBaModal();t&&t.$element.one(d.modalHided,e),i.find("[disabled],[data-disabled],[data-icon],[data-opened],[data-selected],[data-jstree]").each(function(){var e=f(this),t=e.data();e.removeData(),this.hasAttribute("disabled")&&(t.disabled=!0),t.hasOwnProperty("jstree")&&"object"===_typeof(t.jstree)&&delete(t=f.extend(t.jstree,t)).jstree,e.data("jstree",t)});var a=[];o.map(function(e){a.push(e+".jstree")}),i.on(a.join(" "),function(e,t){var a=e.type,e=Array.prototype.slice.call(arguments);e.shift(),!n.api&&t&&t.instance&&(n.api=t.instance),e.unshift(n),-1<["ready","refresh","delete_node","create_node"].indexOf(a)&&(t=n.api.get_json()||[],n.$empty&&n.$empty.remove(),0==t.length&&(n.$empty=f('<div class="ba-tree-empty">'+r.emptyText+"</div>"),i.append(n.$empty))),-1<["after_open","after_close","ready"].indexOf(a)&&p.app.triggerResize(),-1<["ready","changed"].indexOf(a)&&(n.$selectMain.empty(),n.api.get_checked().map(function(e){n.$selectMain.append('<option value="'+e+'" selected/>')}),n.$selectMain.baTriggerEvent("change"),n.$selectUncertain.empty(),n.api.get_undetermined().map(function(e){n.$selectUncertain.append('<option value="'+e+'" selected/>')}),n.$selectUncertain.baTriggerEvent("change")),"ready"===a&&(r.checkbox&&n.$container.append(n.$selectMain).append(n.$selectUncertain),n.defaultValue=n.api.get_checked(),n.formStatus.rendered()),h.execCallback(n,r[h.camel("on_"+a)],n.element,e,i,s(a,u))}),i.jstree(n.jstreeOpt),n.api=i.jstree(!0),h.triggerPluginReady(i,n,"",d.treeInitialized),n.$selectMain.on(d.validateErrorPlacement,function(e,t){return n.$element.after(t),!1}),n.$selectUncertain.on(d.validateErrorPlacement,function(e,t){return n.$element.after(t),!1})},destroy:function(){var e=this;e._abort(),e.api&&(e.api.destroy(),e.api=null),e._$element.insertBefore(e.$container),e.$container.remove(),e.$form.off(e.resetEvent),e.$selectMain.off(d.validateErrorPlacement),e.$selectUncertain.off(d.validateErrorPlacement)}},t.KEY=m,t.INDEX=0,t.DEFAULTS={dots:!0,icons:!0,ellipsis:!1,stripes:!1,onOperate:!1,animation:200,multiple:!0,expandSelectedOnload:!1,forceText:!1,leafTile:!1,border:!0,url:null,method:"get",params:null,emptyText:"无选项",model:"",modelExtend:!1,modelIdField:"",modelNameField:"",modelDisabledField:"",modelIconField:"",modelParentField:"",asyncNode:!1,modelOrder:"",data:null,name:null,uncertainName:null,checkbox:!1,checkboxKeepSelectedStyle:!1,checkboxTieSelection:!0,checkboxRelation:!0,checkboxRelationDir:"",checkboxRelationDisabled:!0,checkboxRelationHidden:!0,block:!1,contextmenu:!1,contextmenuItems:null,nodeExtend:null,locale:f.extend({},{loading:"请稍后...",newNode:"未命名",nodes:"节点"},((p.locale||{}).plugin||{}).tree||{})},f.fn.baTree=e,f.fn.baTree.Constructor=t,p.plugins.Tree=t,p.autoInit(u,h.pluginAttrs(u),function(){e.call(this)}),t}),define("./ba/plug/upload",["busyAdmin","jquery"],function(C,S){var _={},T=null,h=null,d=null,s=false,E=undefined,D=C.helper,e=C.ee,u=C.e,I="upload",l=D.pluginKey(I),m=function e(t,a){return t.find('[data-upload-id="'+a+'"]')},P=function e(){C.app.triggerResize()},c=function e(t,a){var n=this;n.element=t;n.$element=S(t);n.options=S.extend(true,{},e.DEFAULTS,n.$element.baData(I),a||{});n.uploader=null;n.category={};n.headers={};n.$uploadBtn=null;n.$selectBtn=null;n.module=null;n.isInput=n.$element.is(":input");n.options.disabled=n.$element.prop("disabled")||n.options.disabled;n.callback={responseSuccess:S.noop};n.formStatus=n.$element.baFormStatus(n).render();n.ready(n.init)};c.prototype={ready:function e(r){var o=this;var t=C.lib;requirejs([t.bootstrap,t.webUploader,t.sortable,t.uploadConfig,t.sparkMd5],function(e,t,a,n,i){if(s){r.call(o);return}s=true;T=t;h=a;d=i;_=n;_.disks=_.disks||{};T.Uploader.register({init:"init","before-send-file":"beforeSendFile","before-send":"beforeSend","after-send-file":"afterSendFile"},{init:function e(t){var a=t._busy;if(!a)return;if(a.use)return D.execCallback(a.me,a.asyncInit,a.el[0],[this.owner,t],a.el,u.uploadAsyncInit,null);var n=_.disks[a.disk].asyncInit;if(typeof n==="function")return n.call(this,t)},beforeSendFile:function e(i){var r=this;var n=r.options;var o=n._busy;if(!o)return;if(o.use)return D.execCallback(o.me,o.asyncBeforeSendFile,o.el[0],[this.owner,i],o.el,u.uploadAsyncBeforeSendFile,null);i.doneParts=[];var s=T.Deferred();var l=r.owner;var t=function e(){var t=n.chunkSize;var a=t?Math.ceil(i.source.size/t):1;c.md5File(i.source.source,t).progress(function(e){l.trigger("uploadProgress",i,.049*e,"hash")}).done(function(e){C.request(_.prepare).method("post").pending(false).params({md5:e,mimetype:i.type||"",filesize:i.size,filename:i.name,class_type:o.classType,class_value:o.classValue,part:a>1?1:0,disk:o.disk}).success(function(e){var t=e.result;i.prepareResult=t;if(t.fast){l.skipFile(i);l.trigger("uploadProgress",i,1)}else{var a=_.disks[o.disk].asyncBeforeSendFile;if(typeof a==="function"){var n=a.call(r,i,t);if(T.isPromise(n)){n.done(function(){l.trigger("uploadProgress",i,.05,"hash");s.resolve()}).fail(function(e){s.reject(e)});return false}}l.trigger("uploadProgress",i,.05,"hash")}s.resolve();return false}).error(function(e){s.reject(e.message);return false}).exec()}).fail(function(e){s.reject("Hash error")})};if(n.compress)l.waitCompressTimeId=setInterval(function(){if(i._compressed){clearInterval(l.waitCompressTimeId);t()}},10);else t();return s.promise()},beforeSend:function e(t){var a=this.options;var n=a._busy;if(!n)return;if(n.use)return D.execCallback(n.me,n.asyncBeforeSend,n.el[0],[this.owner,t],n.el,u.uploadAsyncBeforeSend,null);var i=_.disks[n.disk].asyncBeforeSend;if(typeof i==="function")return i.call(this,t)},afterSendFile:function e(t,a){var n=this.options;var i=n._busy;if(!i)return;if(i.use)return D.execCallback(i.me,i.asyncAfterSendFile,i.el[0],[this.owner,t,a],i.el,u.uploadAsyncAfterSendFile,null);var r=T.Deferred();var o=function e(t){r.reject(t)};var s=function e(t){r.resolve(t)};var l=function e(){if(t.prepareResult&&!t.prepareResult.fast)C.request(_.done).method("post").pending(false).params({file_id:t.prepareResult.file_id,upload_id:t.prepareResult.upload_id,parts:JSON.stringify(t.doneParts||[])}).success(function(){s();return false}).error(function(e){o(e.message);return false}).exec();else s()};var c=_.disks[i.disk].asyncAfterSendFile;if(typeof c==="function"){var d=c.call(this,t,a);if(T.isPromise(d)){d.done(l).fail(o);return r.promise()}}l();return r.promise()}});r.call(o)})},init:function e(){var t=this;var a=t.options;t.category=_.category[a.classType]||null;t.category=t.category||_.category[""]||{};if(!a.title){a.title=t.$element.attr("title");if(!a.title)a.title=t.category.name||t.options.locale.file}if(S.baIsEmpty(a.allowExtensions))a.allowExtensions=(t.category.allow_extensions||[]).join(",");else t.useExtensions=true;if(S.baIsEmpty(a.allowMimetypes))a.allowMimetypes=(t.category.allow_mimetypes||[]).join(",");else t.useMimetypes=true;if(!S.isNumeric(a.maxSingleSize))a.maxSingleSize=S.isNumeric(t.category.max_size)?t.category.max_size:2*1024*1024;else t.useMaxSingleSize=true;if(!a.placeholder)a.placeholder=D.sprintf(a.locale.pleaseUploadOrSelect,a.title);if(!a.objectFit)a.objectFit="cover";if(t.isInput){var n=t.$element.val();var i=t.$element.attr("name");var r=t.$element.attr("placeholder");if(n)a.value=n;if(i)a.name=i;if(r)a.placeholder=r}else{a.value=D.scope(a.value);if(typeof a.value==="function")a.value=a.value()}switch(a.type.toLowerCase()){case"files":t.module=new p(t);break;case"card":t.module=new f(t);break;case"use":t.module=new g(t);break;default:t.module=new o(t)}D.triggerPluginReady(t.$element,t,"",u.uploadInitialized)},_initUploader:function e(t,a,n,i){var l=this;var c=l.$element;var d=c[0];var u=l.options;var r=u.pasteContainer;var p=C.e;var f=D;if(typeof r==="string")r=S(r);if(r instanceof jQuery)if(r.length>0)r=r[0];else u.paste=false;l.multiple=i;l.$uploadBtn=t;l.$selectBtn=n;l.$uploadIcon=S("<i icon/>");l.$uploadName=S("<span text/>");u.uploadName=u.uploadName||f.sprintf(u.locale.uploadFile,u.title);l._updateUploadBtn();l.$selectIcon=S("<i icon/>");l.$selectName=S("<span text/>");u.selectName=u.selectName||f.sprintf(u.locale.selectFile,u.title);l._updateSelectBtn();var o=_.url;var s="POST";var h=false;var m=false;var g=I;var v=u.server!==true;var b={};var y={};var $=true;var w=u.classType||"";var x=u.classValue||"";var k=u.disk||_.disk;if(v){b=D.scope(u.params||{});if(typeof b==="function")b=b();y=D.scope(u.headers||{});if(typeof y==="function")y=y();s=u.method||"POST";h=u.binary||false;m=u.credential||false;g=u.fileVal||"file";b=b||{};y=y||{};$=u.chunked||false;if(u.server===false){b["class_type"]=w;b["class_value"]=x;b["disk"]=k;y["Busy-Admin-Plugin"]="Upload";g=I}else o=u.server}l.uploader=new T.Uploader({server:o,auto:u.auto,fileVal:g,method:s,runtimeOrder:"html5",sendAsBinary:h,withCredentials:m,dnd:u.dnd&&a&&a.length>0?a[0]:E,paste:u.paste?r:E,disableGlobalDnd:true,chunked:$,chunkSize:u.chunkSize,threads:u.threads,duplicate:u.duplicate,fileNumLimit:u.maxTotal||E,fileSizeLimit:u.maxSize||E,fileSingleSizeLimit:u.maxSingleSize,compress:u.compress?{width:u.compressWidth,height:u.compressHeight,quality:u.compressQuality,allowMagnify:u.compressZoom,crop:u.compressCrop,preserveHeaders:u.compressMeta,noCompressIfLarger:u.compressLarger,compressSize:u.compressSize}:false,pick:{id:t[0],multiple:i},formData:b,headers:y,accept:{title:f.sprintf(u.locale.selectFile,u.title),extensions:u.allowExtensions,mimeTypes:u.allowMimetypes},_busy:{me:l,use:v,el:c,disk:k,classType:w,classValue:x,asyncInit:u.asyncInit,asyncBeforeSendFile:u.asyncBeforeSendFile,asyncBeforeSend:u.asyncBeforeSend,asyncAfterSendFile:u.asyncAfterSendFile}});l.uploader.on("ready",function(){l.$uploadIcon=l.$uploadBtn.find("[icon]");l.$uploadName=l.$uploadBtn.find("[text]");l.formStatus.rendered();P();f.execCallback(l,u.onReady,d,[this],c,p.uploadReady)}).on("uploadBeforeSend",function(e,t,a){["id","lastModifiedDate","name","size","type","chunk","chunks"].map(function(e){delete t[e]});if(v)f.execCallback(l,u.onBeforeSend,d,[this,e,t,a],c,p.uploadBeforeSend,null);else{var n=_.disks[k].syncBeforeSend;if(typeof n==="function")n.call(this,e,t,a)}e.file._requestHeaders=a;e.file._requestParams=t}).on("uploadAccept",function(e,a,t){var n=this.options;var i=function e(t){a._result=t};if(!v){var r=_.disks[k].syncUploadAccept;if(typeof r==="function")return r.call(this,e,a,i,t)!==false}else{var o=f.execCallback(l,u.onResultAccept,d,[this,e,a,i,t],c,p.uploadAccept,null);if(typeof o==="boolean")return o}var s;C.response.parse(a._raw,{url:n.server,type:n.method,data:S.param(e.file._requestParams||{}),headers:e.file._requestHeaders||{}},function(e){s=true;i(e.result)},function(e){t(e.message);s=false});return s}).on("error",function(e,t,a){var n;if(t instanceof T.File)n=t;else if(a instanceof T.File)n=a;f.execCallback(l,u.onFileError,d,[this,n,l._parseCodeError(e)],c,p.uploadFileError)}).on("fileQueued",function(e){f.execCallback(l,u.onFileQueued,d,[this,e],c,p.uploadFileQueued)}).on("filesQueued",function(e){f.execCallback(l,u.onFilesQueued,d,[this,e],c,p.uploadFilesQueued)}).on("fileDequeued",function(e){f.execCallback(l,u.onFileDequeued,d,[this,e],c,p.uploadFileDequeued)}).on("reset",function(){f.execCallback(l,u.onReset,d,[this],c,p.uploadReset)}).on("startUpload",function(){u.bindForm&&l.formStatus.run();f.execCallback(l,u.onBegin,d,[this],c,p.uploadBegin)}).on("stopUpload",function(){f.execCallback(l,u.onStop,d,[this],c,p.uploadStop)}).on("uploadFinished",function(){u.bindForm&&l.formStatus.ran();f.execCallback(l,u.onFinished,d,[this],c,p.uploadFinished)}).on("uploadStart",function(e){f.execCallback(l,u.onStart,d,[this,e],c,p.uploadStart)}).on("uploadProgress",function(e,t,a){if(a!=="hash")t=.05+t*.95;f.execCallback(l,u.onProgress,d,[this,e,t,a],c,p.uploadProgress)}).on("uploadComplete",function(e){f.execCallback(l,u.onComplete,d,[this,e],c,p.uploadComplete)}).on("uploadError",function(e,t){f.execCallback(l,u.onError,d,[this,e,l._parseServerError(t)],c,p.uploadError)}).on("uploadSuccess",function(e,t){var a=e.prepareResult||t._result;f.execCallback(l,u.onSuccess,d,[this,e,a],c,p.uploadSuccess);l._triggerResult(a,true)})},_updateSelectBtn:function e(){var a=this;var t=this.options;if(!a.$selectBtn||!a.$selectBtn.length)return;if(!a.$selectBtn.data("init-click"))a.$selectBtn.data("init-click",true).off("click").on("click",function(){S(this).baFilePicker({classType:t.classType,classValue:t.classValue,title:D.sprintf(t.locale.selectFile,t.title),count:a.multiple?0:1,extensions:a.useExtensions?t.allowExtensions:E,mimetypes:a.useMimetypes?t.allowMimetypes:E,maxSize:a.useMaxSingleSize?t.maxSingleSize:E,currentInfo:t.selectCurrentInfo,success:function e(t){typeof a.module.setSelectFiles==="function"&&a.module.setSelectFiles(t)}})});if(t.type=="use")return;if(!a.$selectBtn.data("init-icon"))a.$selectBtn.data("init-icon",true).addClass(t.selectClass).append(a.$selectIcon).append(" ");if(!a.$selectBtn.data("init-name")&&t.type!=="card")a.$selectBtn.data("init-name",true).append(a.$selectName);if(t.select)a.$selectBtn.removeClass("hide").parent().removeClass("no-select");else a.$selectBtn.addClass("hide").parent().addClass("no-select");if(t.selectIcon)a.$selectIcon.removeAttr("class").addClass(t.selectIcon);else a.$selectIcon.addClass("hide");if(t.selectName)a.$selectName.removeAttr("class").html(t.selectName);else a.$selectName.addClass("hide")},_updateUploadBtn:function e(){var t=this;var a=this.options;if(a.type=="use"||!t.$uploadBtn||!t.$uploadBtn.length)return;if(!t.$uploadBtn.data("init-icon"))t.$uploadBtn.data("init-icon",true).addClass(t.options.uploadClass).append(t.$uploadIcon).append(" ");if(!t.$uploadBtn.data("init-name")&&a.type!=="card")t.$uploadBtn.data("init-name",true).append(t.$uploadName);if(a.upload)t.$uploadBtn.removeClass("hide").parent().removeClass("no-upload");else t.$uploadBtn.addClass("hide").parent().addClass("no-upload");if(a.uploadIcon)t.$uploadIcon.removeAttr("class").addClass(a.uploadIcon);else t.$uploadIcon.addClass("hide");if(a.uploadName)t.$uploadName.removeAttr("class").html(a.uploadName);else t.$uploadName.addClass("hide");if(t.uploader)t.uploader.refresh()},showUpload:function e(t){this.options.upload=t;this._updateUploadBtn()},setUploadName:function e(t){this.options.uploadName=t;this._updateUploadBtn()},setUploadIcon:function e(t){this.options.uploadIcon=t;this._updateUploadBtn()},showSelect:function e(t){this.options.select=t;this._updateSelectBtn()},setSelectName:function e(t){this.options.selectName=t;this._updateSelectBtn()},setSelectIcon:function e(t){this.options.selectIcon=t;this._updateSelectBtn()},_parseCodeError:function e(t){var a=this.options.locale;var n=this.uploader.options;switch(t){case"Q_EXCEED_NUM_LIMIT":t=D.sprintf(a.uploadExceedNumLimit,n.fileNumLimit);break;case"Q_EXCEED_SIZE_LIMIT":t=D.sprintf(a.uploadExceedSizeLimit,this.formatSize(n.fileSizeLimit));break;case"Q_TYPE_DENIED":var i=n.accept[0]||{};var r=i.extensions||"";if(r)t=D.sprintf(a.uploadTypeDeniedDetail,r);else t=a.uploadTypeDenied;break;case"F_EXCEED_SIZE":case"exceed_size":t=D.sprintf(a.uploadExceedSize,this.formatSize(n.fileSingleSizeLimit));break;case"F_DUPLICATE":t=a.uploadDuplicate;break;default:t=a.unknownError+": "+t}return t},formatSize:function e(t){return T.Base.formatSize(t,1,["B","KB","MB","GB","TB"])},_parseServerError:function e(t){var a=this.options.locale;switch(t){case"server":t=a.serverError;break;case"http":t=a.httpError;break;case"abort":t=a.httpAbort;break;case"timeout":t=a.httpTimeout;break}return t},_changeDisabled:function e(t){var a=this;var n=a.uploader;if(t){if(n)n.disable();if(a.$selectBtn)a.$selectBtn.addClass("disabled").prop("disabled",true);if(a.$uploadBtn)a.$uploadBtn.addClass("disabled").prop("disabled",true)}else{if(n)n.enable();if(a.$selectBtn)a.$selectBtn.removeClass("disabled").prop("disabled",false);if(a.$uploadBtn)a.$uploadBtn.removeClass("disabled").prop("disabled",false)}},_previewHandler:function e(t,a,n,i,r){var o=this;D.urlPreviewHandler({url:t,image:a,video:n,audio:i,file:r})},_triggerResult:function e(t,a){var n=null;if(t)if(a)n={id:t.file_id,url:t.file_url,size:t.size||0,name:t.name,extension:t.extension};else n={id:t.id,url:t.url,size:t.size,name:t.name,extension:t.extension};D.execCallback(this,this.options.onResult,this.$element[0],[n],this.$element,u.uploadResult)},_triggerChange:function e(t){D.execCallback(this,this.options.onChange,this.$element[0],[t],this.$element,u.uploadChange);this.options.value=t},setOption:function e(t,a){this.options[t]=a},destroy:function e(){var t=this;if(t.uploader){clearInterval(t.uploader.waitCompressTimeId);t.uploader.destroy();t.uploader=null}if(t.module){t.module.destroy();t.module=null}}},c.md5File=function(a,n){n=n||a.size;var t=T.Deferred();var i=File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice;if(!i){t.reject();return t.promise()}var r=Math.ceil(a.size/n);var o=0;var s=new d.ArrayBuffer;var l=new FileReader;l.onerror=function(e){t.reject(e)};l.onload=function(e){s.append(e.target.result);o++;t.notify(o/r);if(o<r)c();else t.resolve(s.end())};function c(){var e=o*n;var t=e+n>=a.size?a.size:e+n;l.readAsArrayBuffer(i.call(a,e,t))}c();return t.promise()},c.KEY=l,c.DEFAULTS={type:"single",name:"",classType:"",classValue:"",value:"",dnd:false,paste:false,pasteContainer:document.body,chunked:false,chunkSize:5242880,threads:3,duplicate:false,className:"",placeholder:"",auto:true,disabled:false,bindForm:true,previewPlaceholder:null,disk:E,server:true,fileVal:"file",method:"post",binary:false,credential:false,params:{},headers:{},allowExtensions:E,allowMimetypes:E,title:"",select:true,selectName:"",selectIcon:"fa fa-folder-open",selectClass:"btn-default",selectCurrentInfo:"",upload:true,uploadName:"",uploadIcon:"fa fa-cloud-upload",uploadClass:"btn-primary",compress:false,compressWidth:1600,compressHeight:1600,compressQuality:90,compressZoom:false,compressCrop:false,compressMeta:true,compressLarger:false,compressSize:0,objectFit:"",singleInput:true,singlePreview:true,singlePreviewSize:"",singleSize:"",filesEditFilename:false,filesUi:"all",filesGrid:false,filesGridWidth:null,cardType:"",cardIcon:"fa fa-cloud-upload",useSelect:"",useDnd:"",useProgress:false,useError:false,maxSize:E,maxSingleSize:E,maxTotal:E,result:E,fileError:E,fileQueued:E,filesQueued:E,fileDequeued:E,reset:E,begin:E,stop:E,finished:E,start:E,progress:E,complete:E,error:E,success:E,resultAccept:E,beforeSend:E,asyncInit:E,asyncBeforeSendFile:E,asyncBeforeSend:E,asyncAfterSendFile:E,locale:S.extend({uploadFile:"上传%s",selectFile:"选择%s",replaceFile:"替换%s",pleaseUploadOrSelect:"请上传或选择%s",uploadSuccess:"上传成功",uploadLoading:"上传中...",uploadWait:"等待上传",uploadCanceled:"已取消上传",file:"文件",filename:"文件名",fileSize:"文件大小",progress:"进度",operate:"操作",uploadStart:"开始上传",uploadPause:"暂停上传",uploadContinue:"继续上传",uploadPaused:"暂停中",preview:"预览",replace:"替换",delete:"删除",modifyFileName:"修改文件名",pleaseInputFileName:"请输入文件名",confirmDeleteThat:"确认要删除%s吗？",uploadExceedSizeLimit:"所有文件总大小超过%s",uploadTypeDenied:"请选择有效的文件",uploadTypeDeniedDetail:"仅支持格式为%s的文件",uploadExceedSize:"文件大小超过%s",uploadDuplicate:"选择的文件重复",uploadExceedNumLimit:"单次最多允许选择%s个文件",unknownError:"未知错误",serverError:"服务器错误",httpError:"HTTP请求错误",httpTimeout:"请求超时",httpAbort:"请求被中断",uploadTipSelected:"共%s个文件，合计%s",uploadTipSuccess:"共%s个文件，已上传%s个文件",uploadTipComplete:"共%s个文件，已上传%s个，失败%s个"},((C.locale||{}).plugin||{}).upload||{})};var o=function e(t){var a=this;a.api=t;a.$template=null;a.$input=null;a.init()};o.prototype={init:function e(){var r=this;var i=r.api;var o=i.options;var a=r.$template=S('<div class="ba-upload-single">\n    <div class="input-group" data-upload-id="input-group">\n        <i data-upload-id="input"></i>\n        <div class="input-group-btn">\n            <button class="btn" data-upload-id="upload-btn" type="button"></button>\n            <button class="btn" data-upload-id="select-btn" type="button"></button>\n        </div>\n    </div>\n    <div class="upload-wait" style="display: none" data-upload-id="wait">\n        <div class="media" data-upload-id="item">\n            <a class="close" data-upload-id="close">&times;</a>\n            <div class="media-left" data-upload-id="thumb-box">\n                <img class="media-object" src="" data-upload-id="thumb-img"/>\n            </div>\n            <div class="media-body">\n                <div class="media-heading size-13 text-bold" data-upload-id="title"></div>\n                <div class="progress">\n                    <div class="progress-bar progress-bar-success progress-bar-striped active" data-upload-id="progress" style="width: 0%">\n                        <span class="progress-number" data-upload-id="speed">0%</span>\n                    </div>\n                </div>\n                <div class="media-foot size-12 clearfix">\n                    <div class="pull-right" data-upload-id="file-size"></div>\n                    <div class="pull-left" data-upload-id="status"></div>\n                </div>\n                <div class="media-toolbar clearfix" data-upload-id="toolbar">\n                    <button class="btn btn-success btn-sm pull-right" data-upload-id="operate-btn"></button>\n                </div>\n            </div>\n        </div>\n    </div>\n    <div class="clearfix"></div>\n    <div class="upload-preview" style="display: none;" data-upload-id="preview"></div>\n</div>').addClass(o.className);var t=m(a,"input");var n=i.$element;if(i.isInput){r.$input=n;n.after(a)}else{r.$input=S('<input type="text"/>');n.html(a)}r.$input.val(o.value).attr("name",o.name||"").addClass("form-control");r.setPlaceholder(o.placeholder);t.after(r.$input);t.remove();r.$inputGroup=m(a,"input-group");r.$uploadBtn=m(a,"upload-btn");r.$selectBtn=m(a,"select-btn");r.$wait=m(a,"wait");r.$close=m(a,"close");r.$item=m(a,"item");r.$thumbBox=m(a,"thumb-box");r.$thumbImg=m(a,"thumb-img");r.$title=m(a,"title");r.$progress=m(a,"progress");r.$speed=m(a,"speed");r.$fileSize=m(a,"file-size");r.$status=m(a,"status");r.$preview=m(a,"preview");r.$toolbar=m(a,"toolbar");r.$operateBtn=m(a,"operate-btn").html(o.locale.uploadStart);r.closeTimer=null;if(o.singleSize)r.setSize(o.singleSize);if(!o.singleInput)r.showInput(false);r.$operateBtn.on("click",function(){if(S(this).hasClass("disabled"))return;r.setOperateDisabled(true);i.uploader.upload()});i._initUploader(r.$uploadBtn,a,r.$selectBtn,false);n.on(u.uploadFileError,function(e,t,a,n){t.reset();C.dialog.tipError(n)}).on(u.uploadReset,function(){r.setDisabled(false)}).on(u.uploadFileQueued,function(e,t,a){r.$thumbImg.attr("src","");t.makeThumb(a,function(e,t){if(e)r.$thumbBox.hide();else{r.$thumbImg.attr("src",t);r.$thumbBox.show()}},60,60);r.$close.show().off("click").on("click",function(){t.removeFile(a,true)});r.$title.html(a.name);r.$speed.html("0%");r.$fileSize.html(i.formatSize(a.size));r.$progress.removeClass("progress-bar-danger").addClass("progress-bar-success").css("width","0%");r.setStatus(o.locale.uploadWait,"gray",true,false);r.setOperateDisabled(false);o.auto?r.$toolbar.hide():r.$toolbar.show();r.$wait.show()}).on(u.uploadFileDequeued,function(e,t){t.reset();r.setStatus(o.locale.uploadCanceled,"gray",false);r.setOperateDisabled(true)}).on(u.uploadProgress,function(e,t,a,n){var i=(n*100).toFixed(2)+"%";r.$progress.css("width",i);r.$speed.text(i);r.setStatus(o.locale.uploadLoading,"gray",true,false)}).on(u.uploadComplete,function(e,t){t.reset()}).on(u.uploadError,function(e,t,a,n){r.setStatus(i._parseServerError(n),"danger",false)}).on(u.uploadSuccess,function(e,t,a,n){r.setStatus(o.locale.uploadSuccess,"success",true);r.setValue(n.file_url)});i.uploader.on("beforeFileQueued",function(e){r.setDisabled(true);return true});r.inputTimer=null;r.$input.off("input."+l).on("input."+l,function(e){var t=r.$input.val();i._triggerChange(t);clearTimeout(r.inputTimer);if(r._mustPreview){r._mustPreview=false;r.showPreview(t)}else r.inputTimer=setTimeout(function(){r.showPreview(t)},500)});r._mustPreview=true;r.$input.baTriggerEvent("input").baTriggerEvent("change");r.$input.on(u.validateErrorPlacement,function(e,t){a.after(t);return false});r.setDisabled(o.disabled)},setValue:function e(t){var a=this;a.api.options.value=t;a._mustPreview=true;a.$input.val(t).baTriggerEvent("input").baTriggerEvent("change")},showInput:function e(t){if(!t){this.$template.addClass("no-input");this.$input.hide()}else{this.$template.removeClass("no-input");this.$input.show()}P()},setSize:function e(t){if(t){this.setSize("");this.$inputGroup.addClass("input-group-"+t)}else this.$inputGroup.removeClass("input-group-xs input-group-sm input-group-lg");if(this.api.uploader)this.api.uploader.refresh();P()},setPlaceholder:function e(t){this.$input.attr("placeholder",t)},setSelectFiles:function e(t){t=t||[];if(t.length<=0)return;var a=t[0];this.setValue(a.url);this.api._triggerResult(a,false)},setPreview:function e(t){this.api.options.singlePreview=t;this.showPreview(this.api.options.value)},setPreviewSize:function e(t){this.api.options.singlePreviewSize=t;this.showPreview(this.api.options.value)},showPreview:function e(t){var a=this;var n=a.api;if(a.$prevElement){a.$prevElement.off("load");a.$prevElement=null}t=(t||"").trim();if(t.length===0||!n.options.singlePreview){a.$preview.empty().hide();P();return}var i=n.options.singlePreviewSize||"";var r,o,s;if(!S.isArray(i))i=i.split(",");r=i[0]||"";o=i[1]||"";if(r&&S.isNumeric(r)&&r>0)r+="px";if(o&&S.isNumeric(o)&&r>0)o+="px";a.$delete=S('<a class="trash">&times;</a>');a.$delete.on("click",function(){a._mustPreview=true;a.$input.val("").baTriggerEvent("input").baTriggerEvent("change");a.api._triggerResult(null)});a.$preview.removeClass("upload-preview-image upload-preview-video upload-preview-audio upload-preview-file");n._previewHandler(t,function(){var e="";if(n.options.previewPlaceholder===true)e='data-avatar="true"';else if(n.options.previewPlaceholder)e='data-placeholder="'+n.options.previewPlaceholder+'"';a.$preview.addClass("upload-preview-image").html(a.$prevElement=s=S('<img src="'+t+'" class="img-thumbnail cursor-zoom-in" data-title="false" '+e+"/>"));if(r)s.width(r);else s.width(100);if(o)s.height(o);s.css("object-fit",n.options.objectFit);s.on("load",function(){a.$prevElement=null;P()});s.baImageViewer();a.$preview.append(a.$delete);a.$preview.show();P()},function(){a.$preview.addClass("upload-preview-video").html(s=S('<video><source src="'+t+'"/></video>'));if(r)s.width(r);else s.width(100);if(o)s.height(o);else s.height(100);s.css("object-fit",n.options.objectFit);s.baVideoViewer();a.$preview.append(a.$delete);a.$preview.show();P()},function(){a.$preview.addClass("upload-preview-audio").html(s=S('<audio src="'+t+'" preload="auto"></audio>'));s.baAudio();a.$preview.append(a.$delete);a.$preview.show();P()},function(){var e=D.parseURL(t);a.$preview.addClass("upload-preview-file").html(s=S('<div class="text-line-1"><i class="fa fa-file-o"></i><a href="'+t+'" target="_blank">'+e.filename+"</a></div>"));s.append(a.$delete);a.$preview.show();P()})},setStatus:function e(t,a,n,i){var r=this;clearTimeout(r.closeTimer);r.$status.html('<span class="text-'+a+'">'+t+"</span>");var o;if(!n){r.$progress.removeClass("progress-bar-success").addClass("progress-bar-danger");o=3e3}else o=1500;i=i===E?true:i;if(i){r.$close.hide();r.closeTimer=setTimeout(function(){r.$wait.fadeOut(function(){P()})},o)}else r.$close.show()},setDisabled:function e(t){var a=this;a.api._changeDisabled(t);a.$input.prop("readonly",t);a.$preview.toggleClass("disabled",t)},setOperateDisabled:function e(t){if(t)this.$operateBtn.prop("disabled",true).removeClass("btn-success").addClass("disabled btn-default");else this.$operateBtn.prop("disabled",false).removeClass("disabled btn-default").addClass("btn-success")},destroy:function e(){var t=this;var a=t.api.$element;if(a[0].tagName==="INPUT"){t.$template.before(a);t.$template.remove()}else a.empty();t.$input.off(u.validateErrorPlacement)}};var p=function e(t){this.api=t;this.uploadInProgress=false;this.fileTotal=0;this.fileSize=0;this.successIndex=0;this.successList={};this.sortable=null;this.addSuccessFileTimer=null;this.init()};p.prototype={init:function e(){var i=this;var r=i.api;var t=r.options;var a=t.locale;var n=i.$template=S('<div class="ba-upload-files">\n    <div class="panel panel-default no-margin-bottom">\n        <div class="panel-heading">\n            <button class="btn btn-sm" data-upload-id="upload-btn" type="button"></button>\n            <button class="btn btn-sm" data-upload-id="select-btn" type="button"></button>\n        </div>\n        <div class="table-responsive file-queue-list" data-upload-id="file-queue-container">\n            <table class="table table-hover table-bordered table-striped">\n                <thead>\n                    <tr>\n                        <th class="text-center size-12" data-upload-id="locale-filename"></th>\n                        <th class="text-center size-12" data-upload-id="locale-fileSize" width="80"></th>\n                        <th class="text-center size-12" data-upload-id="locale-progress" width="150"></th>\n                        <th class="text-center size-12" data-upload-id="locale-operate" width="100"></th>\n                    </tr>\n                </thead>\n                <tfoot data-upload-id="toolbar">\n                    <tr>\n                        <td colspan="4">\n                            <button class="btn btn-sm btn-success pull-right" data-upload-id="operate-btn"></button>\n                            <div class="text-gray size-12" data-upload-id="tip"></div>\n                        </td>\n                    </tr>\n                </tfoot>\n                <tbody data-upload-id="queue-list"></tbody>\n            </table>\n        </div>\n        <div class="table-responsive image-queue-list" data-upload-id="image-queue-container">\n            <table class="table table-hover table-bordered table-striped">\n                <tfoot data-upload-id="toolbar">\n                    <tr>\n                        <td colspan="4">\n                            <button class="btn btn-sm btn-success pull-right" data-upload-id="operate-btn"></button>\n                            <div class="text-gray size-12" data-upload-id="tip"></div>\n                        </td>\n                    </tr>\n                </tfoot>\n                <tbody><tr><td data-upload-id="queue-list"></td></tr></tbody>\n            </table>\n        </div>\n        <div class="table-responsive file-result-list" data-upload-id="file-result-container">\n            <table class="table table-hover table-bordered table-striped">\n                <tbody data-upload-id="result-list"></tbody>\n            </table>\n        </div>\n        <div class="table-responsive image-result-list" data-upload-id="image-result-container">\n            <table class="table table-hover table-bordered table-striped">\n                <tbody><tr><td data-upload-id="result-list"></td></tr></tbody>\n            </table>\n        </div>\n    </div>\n</div>').addClass(t.className);i.$uploadBtn=m(n,"upload-btn").addClass(t.uploadClass);i.$selectBtn=m(n,"select-btn").addClass(t.selectClass);i.$fileQueueContainer=m(n,"file-queue-container").hide();i.$fileResultContainer=m(n,"file-result-container").hide();i.$imageQueueContainer=m(n,"image-queue-container").hide();i.$imageResultContainer=m(n,"image-result-container").hide();i.$queueContainer=null;i.$resultContainer=null;if(t.filesGrid){i.$waitEmpty=S('<div class="text-center empty">\n     <div data-upload-id="message" class="text-gray"></div>\n    <div data-upload-id="desc" class="text-gray"></div>\n</div>');i.$queueContainer=i.$imageQueueContainer.show();i.$resultContainer=i.$imageResultContainer}else{i.$waitEmpty=S('<tr>\n    <td class="text-center empty" colspan="4">\n        <div data-upload-id="message" class="text-gray"></div>\n        <div data-upload-id="desc" class="text-gray"></div>\n    </td>\n</tr>');i.$queueContainer=i.$fileQueueContainer.show();i.$resultContainer=i.$fileResultContainer;m(n,"locale-filename").html(a.filename);m(n,"locale-fileSize").html(a.fileSize);m(n,"locale-progress").html(a.progress);m(n,"locale-operate").html(a.operate)}var o=i.$queueContainer;i.$queueList=m(o,"queue-list").addClass("no-list");i.$toolbar=m(o,"toolbar");i.$operateBtn=m(o,"operate-btn").html(a.uploadStart);i.$tip=m(o,"tip");i.$resultList=m(i.$resultContainer,"result-list").addClass("no-list");i.$waitMessage=m(i.$waitEmpty,"message");if(r.isInput){i.$input=r.$element;r.$element.after(n)}else{i.$input=S('<input type="text" name="'+t.name+'"/>');r.$element.html(n).append(i.$input)}i.$input.addClass("input-hidden");if(t.auto)i.$toolbar.hide();r._initUploader(i.$uploadBtn,n,i.$selectBtn,true);i.setOperateDisabled(true);i.$operateBtn.on("click",function(){if(S(this).hasClass("disabled"))return;if(i.uploadInProgress){i.uploadInProgress=false;r.uploader.stop()}else{i.uploadInProgress=true;r.uploader.upload()}});r.$element.on(u.uploadFileError,function(e,t,a,n){if(a){i.addFile(a);i.setFileStatus(a,n,"danger",false,false,true)}else C.dialog.tipError(n)}).on(u.uploadReset,function(){i.setDisabled(false);i.uploadInProgress=false;i.$operateBtn.html(a.uploadStart);i.setOperateDisabled(true);i.setTip(true)}).on(u.uploadFileQueued,function(e,t,a){i.fileSize+=a.size;i.fileTotal+=1;i.addFile(a);i.setFileStatus(a,i.api.options.locale.uploadWait,"gray",false,true,false);i.setOperateDisabled(false);i.setTip(false)}).on(u.uploadBegin,function(){i.setDisabled(true);i.$operateBtn.html(a.uploadPause).removeClass("btn-warning btn-default").addClass("btn-success")}).on(u.uploadStop,function(){i.$operateBtn.html(a.uploadContinue).removeClass("btn-success btn-default").addClass("btn-warning")}).on(u.uploadStart,function(e,t,a){a.$status.hide();a.$progressBar.show()}).on(u.uploadFinished,function(e,t){t.reset()}).on(u.uploadProgress,function(e,t,a,n){a.$progress.css("width",(n*100).toFixed(2)+"%")}).on(u.uploadError,function(e,t,a,n){i.setTip(false);i.setFileStatus(a,r._parseServerError(n),"danger",false,false,true)}).on(u.uploadSuccess,function(e,t,a,n){i.setTip(false);i.setFileStatus(a,r.options.locale.uploadSuccess,"success",true,false,true);i.addSuccessFile(n.file_url,n.name,n.file_size||0,n.file_id)});i.$input.on(u.validateErrorPlacement,function(e,t){n.after(t);return false});i.setUi(t.filesUi);i.setPlaceholder(t.placeholder);i.setDisabled(t.disabled)},parseValue:function e(t){var a=[];if(S.isArray(t))a=t;else if(typeof t==="string")try{a=JSON.parse(t);if(!S.isArray(a))throw new Error("")}catch(e){a=[];t.split(",").map(function(e,t){e=e.trim();if(e.length>0)a.push({url:e})})}return a},setPlaceholder:function e(t){this.$waitMessage.html(t)},setUi:function e(t){var a=this;var n=a.api.options;n.filesUi=t;a.$resultList.empty();a.$queueList.empty();if(t=="result")a.$resultList.html(a.$waitEmpty);else a.$queueList.html(a.$waitEmpty);a.successList={};a.successIndex=0;a.parseValue(n.value).map(function(e){a.addSuccessFile(e.url,e.name,e.size,e.id)});a.displayWaitEmpty()},setValue:function e(t){this.api.options.value=t;this.setUi(this.api.options.filesUi)},setSelectFiles:function e(t){t=t||[];if(t.length<=0)return;var a=this;S.map(t,function(e){a.addSuccessFile(e.url,e.name,e.size,e.id);a.api._triggerResult(e,false)})},addSuccessFile:function e(t,a,n,i,r){var o=this;var s=o.api;var l=s.options;var c=l.locale;var d={};var u=function e(){var t=[];for(var a in o.successList)t.push(o.successList[a].data);t.sort(function(e,t){return e.sort-t.sort});if(l.filesValueUrl){var n=[];t.forEach(function(e){n.push(e.url)});t=n;if(l.filesValueUrl!==true)t=t.join(l.filesValueUrl);else t=t.length?JSON.stringify(t):""}else t=t.length?JSON.stringify(t):"";o.$input.val(t).baTriggerEvent("input").baTriggerEvent("change");s._triggerChange(t);o.displayWaitEmpty()};var p=function e(t,a){var n=false;var i=t;o.api._previewHandler(t,function(){},function(){n=true},function(){i=C.imagesRoot()+"no_audio.png"},function(){i=C.imagesRoot()+"no_file.png"});if(!n){d.$thumb=S('<img src="'+i+'" alt="'+a+'" style="object-fit: '+l.objectFit+'"/>');if(l.previewPlaceholder===true)d.$thumb.attr("data-avatar","true");else if(l.previewPlaceholder)d.$thumb.attr("data-placeholder",l.previewPlaceholder)}else d.$thumb=S('<video style="object-fit: '+l.objectFit+'"><source src="'+t+'"/></video>');d.$item.find(".thumb").html(d.$thumb)};a=(a||"").trim();if(a.length===0)a=t.substring(t.lastIndexOf("/")+1);d.data={url:t||"",name:a,size:n||0,id:i||"",sort:r||o.successIndex};if(l.filesGrid){d.$item=S('<div class="item">\n    <div>\n        <div class="thumb"></div>\n        <div class="item-content">\n            <div class="toolbar" data-upload-id="toolbar">\n                <a href="javascript:void(0)" class="fa fa-folder-open" data-upload-id="replace"></a>\n                <a href="javascript:void(0)" class="fa fa-trash" data-upload-id="delete"></a>\n            </div>\n            <a href="javascript:void(0)" class="fa fa-edit name" data-upload-id="name"></a>\n        </div>\n    </div>\n</div>');if(l.filesGridWidth>0)d.$item.width(l.filesGridWidth);p(t,a)}else d.$item=S('<tr>\n    <td data-upload-id="content" class="text-vcenter">\n        <a href="javascript:void(0)" class="name" data-upload-id="name"></a>\n        <code data-upload-id="size"></code>\n    </td>\n    <td class="text-center" width="100">\n        <a class="btn btn-default btn-xs" data-upload-id="preview"><i class="fa fa-search-plus"></i></a>\n        <a class="btn btn-success btn-xs" data-upload-id="replace"><i class="fa fa-folder-open"></i></a>\n        <a class="btn btn-danger btn-xs" data-upload-id="delete"><i class="fa fa-trash"></i></a>\n    </td>\n</tr>');d.$item.attr("data-index",o.successIndex).attr("data-upload-id","item");if(l.filesSortable)d.$item.addClass("ba--sortable");d.$delete=m(d.$item,"delete").attr("title",c.delete).attr("data-index",o.successIndex);d.$replace=m(d.$item,"replace").attr("title",c.replace).attr("data-index",o.successIndex);d.$name=m(d.$item,"name").attr("data-index",o.successIndex).html(a);d.$size=m(d.$item,"size").attr("data-index",o.successIndex).html(s.formatSize(n));d.index=o.successIndex;if(l.filesGrid)d.$preview=d.$item;else d.$preview=m(d.$item,"preview").attr("title",c.preview).attr("data-index",o.successIndex);o.successList[o.successIndex]=d;o.successIndex++;if(l.filesEditFilename)d.$name.attr("title",c.modifyFileName).on("click",function(){C.dialog.prompt(c.modifyFileName,d.data.name,"text",function(e){e=(e||"").trim();if(e.length===0){C.dialog.toast(c.pleaseInputFileName);return false}d.data.name=e;d.$name.html(e);u()});return false});else if(l.filesGrid)d.$name.remove();else d.$name.addClass("no-editable");d.$delete.on("click",function(){C.dialog.confirm(D.sprintf(c.confirmDeleteThat,"<code>"+d.data.name+"</code>"),function(){d.$item.remove();delete o.successList[d.index];u()});return false});d.$preview.on("click",function(){o.api._previewHandler(d.data.url,function(){d.$preview.baImageViewer({clickHandler:false,src:d.data.url,alt:d.data.name},true)},function(){d.$preview.baVideoViewer({clickHandler:false,src:d.data.url},true)},function(){d.$preview.baAudioViewer({src:d.data.url},true)},function(){window.open(d.data.url)})});d.$replace.on("click",function(){S(this).baFilePicker({classType:l.classType,classValue:l.classValue,title:D.sprintf(c.replaceFile,l.title),extensions:o.api.useExtensions?l.allowExtensions:E,mimetypes:o.api.useMimetypes?l.allowMimetypes:E,maxSize:o.api.useMaxSingleSize?l.maxSingleSize:E,count:1,success:function e(t){if(t.length<=0)return;var a=t[0];d.$name.html(a.name);d.$size.html(s.formatSize(n));if(l.filesGrid)p(a.url,a.name);d.data.url=a.url;d.data.name=a.name;d.data.size=a.size;d.data.id=a.id;u()}});return false});var f=[d.$delete,d.$replace];if(!l.filesGrid)f.push(d.$preview);if(l.filesEditFilename)f.push(d.$name);S(f).tooltip({container:o.$template,trigger:"hover"});n>0?d.$size.show():d.$size.hide();o.$resultList.append(d.$item);clearTimeout(o.addSuccessFileTimer);o.addSuccessFileTimer=setTimeout(function(){u();if(l.filesSortable){if(o.sortable)o.sortable.destroy();o.sortable=new h(o.$resultList[0],{animation:150,onEnd:function e(){m(o.$resultList,"item").each(function(e){o.successList[S(this).data("index")].data.sort=e});u()}})}},10)},setGridWidth:function e(t){this.api.options.filesGridWidth=t;this.setUi(this.api.options.filesUi)},addFile:function e(a){var n=this;var i=n.api;var r=n.api.options.locale;if(i.options.filesGrid){a.$item=S('<div class="item">\n    <div>\n        <div class="name text-line-2" data-upload-id="name"></div>\n        <div class="thumb"><img data-upload-id="thumb"/></div>\n        <div class="item-content">\n            <div class="toolbar" data-upload-id="toolbar">\n                <a href="javascript:void(0)" class="fa fa-trash" data-upload-id="delete"></a>\n            </div>\n            <div class="progress no-margin" data-upload-id="progress-bar">\n                <div class="progress-bar progress-bar-success progress-bar-striped active" data-upload-id="progress" style="width: 0%"></div>\n            </div>\n            <div class="status" data-upload-id="status"></div>\n        </div>\n    </div>\n</div>');if(i.options.filesGridWidth>0)a.$item.width(i.options.filesGridWidth);a.$thumb=m(a.$item,"thumb");a.$toolbar=m(a.$item,"toolbar");a.rotation=0;var t="";n.api._previewHandler(a.name,function(){},function(){t=C.imagesRoot()+"no_video.png"},function(){t=C.imagesRoot()+"no_audio.png"},function(){t=C.imagesRoot()+"no_file.png"});a.$thumb.attr("src",t);if(!t)i.uploader.makeThumb(a,function(e,t){if(e);else a.$thumb.attr("src",t)},150,150)}else a.$item=S('<tr>\n    <td data-upload-id="name" class="text-vcenter text-left text-bold"></td>\n    <td data-upload-id="size" class="text-vcenter text-center text-gray"></td>\n    <td class="text-vcenter text-center">\n        <div class="progress no-margin height-10" data-upload-id="progress-bar">\n            <div class="progress-bar progress-bar-success progress-bar-striped active" data-upload-id="progress" style="width: 0%"></div>\n        </div>\n        <div class="status" data-upload-id="status"></div>\n    </td>\n    <td class="text-center text-vcenter">\n        <a class="btn btn-danger btn-xs" data-upload-id="delete"><i class="fa fa-trash"></i></a>\n    </td>\n</tr>');a.$item.attr("data-upload-id","wait-item");a.$name=m(a.$item,"name");a.$size=m(a.$item,"size");a.$progressBar=m(a.$item,"progress-bar");a.$progress=m(a.$item,"progress");a.$delete=m(a.$item,"delete");a.$status=m(a.$item,"status");a.$name.html(a.name);a.$size.html(n.api.formatSize(a.size));a.$progress.css("width","0%");a.$delete.on("click",function(){a.isDelete=true;i.uploader.removeFile(a,true)});a.on("statuschange",function(e,t){switch(e){case"error":n.setFileStatus(this,i._parseServerError(this.statusText),"danger",false,false,true);break;case"invalid":n.setFileStatus(this,i._parseCodeError(this.statusText),"danger",false,false,true);break;case"interrupt":n.setFileStatus(this,r.uploadPaused,"warning",false,true,false);break;case"cancelled":n.fileTotal-=1;n.fileSize-=a.size;n.setTip(false);n.setFileStatus(this,r.uploadCanceled,"danger",false,false,true);break}});n.$queueList.append(a.$item);n.displayWaitEmpty()},setFileStatus:function e(t,a,n,i,r,o){var s=this;t.$progressBar.hide();t.$status.html('<span class="text-'+n+'">'+a+"</span>").show();r?t.$delete.show():t.$delete.hide();clearTimeout(t.closeTimer);if(o)t.closeTimer=setTimeout(function(){t.$item.fadeOut(function(){t.$item.remove();s.displayWaitEmpty()})},i?1500:2500)},displayWaitEmpty:function e(){var t=this;var a=t.api.options.filesUi;var n=0;for(var i in t.successList)n++;t.$resultContainer.removeClass("only-result").show();t.$resultList.removeClass("no-list");t.$queueList.removeClass("no-list");t.$queueContainer.show();switch(a){case"result":if(m(t.$queueList,"wait-item").length===0){t.$queueContainer.hide();t.$resultContainer.addClass("only-result")}else{t.$queueContainer.show();t.$resultContainer.removeClass("only-result")}if(n==0){t.$waitEmpty.show();t.$resultList.addClass("no-list");t.$resultContainer.show()}else{t.$waitEmpty.hide();t.$resultList.removeClass("no-list");t.$resultContainer.show()}break;default:if(a=="queue")t.$resultContainer.hide();else if(n==0)t.$resultContainer.hide();else t.$resultContainer.show();if(m(t.$queueList,"wait-item").length===0){t.$waitEmpty.show();t.$queueList.addClass("no-list")}else{t.$waitEmpty.hide();t.$queueList.removeClass("no-list")}}P()},setTip:function e(t){var a=this;var n=a.api;var i=n.options.locale;clearTimeout(a.tipTimer);if(t){a.tipTimer=setTimeout(function(){a.$tip.fadeOut()},2500);a.fileTotal=0;a.fileSize=0}else{var r=n.uploader.getStats();if(r.uploadFailNum>0)a.$tip.html(D.sprintf(i.uploadTipComplete,"<code>"+a.fileTotal+"</code>","<code>"+r.successNum+"</code>","<code>"+r.uploadFailNum+"</code>"));else if(r.successNum>0)a.$tip.html(D.sprintf(i.uploadTipSuccess,"<code>"+a.fileTotal+"</code>","<code>"+r.successNum+"</code>"));else a.$tip.html(D.sprintf(i.uploadTipSelected,"<code>"+a.fileTotal+"</code>","<code>"+n.formatSize(a.fileSize)+"</code>")).show();if(a.fileTotal===0){a.setOperateDisabled(true);a.setTip(true)}}},setOperateDisabled:function e(t){if(t)this.$operateBtn.prop("disabled",true).removeClass("btn-success btn-warning").addClass("disabled btn-default");else this.$operateBtn.prop("disabled",false).removeClass("disabled btn-default").addClass("btn-success")},setDisabled:function e(t){this.$resultList.toggleClass("disabled",t);this.api._changeDisabled(t)},destroy:function e(){var t=this;t.$template.remove();t.$input.off(u.validateErrorPlacement);if(t.api.isInput)t.api.$element.removeClass("input-hidden");else t.$input.remove()}};var f=function e(t){this.api=t;this.init()};f.prototype={init:function e(){var i=this;var t=i.api;var r=t.options;var a=t.$element.outerWidth();var n=t.$element.outerHeight();var o=i.$template=S('<div class="ba-upload-card">\n    <div class="upload-container">\n        <div class="upload-btn" data-upload-id="upload-btn2"><i data-upload-id="icon"></i><span data-upload-id="placeholder"></span><span data-upload-id="desc"></span></div>\n        <div class="preview" data-upload-id="preview"></div>\n        <div class="pending" data-upload-id="progress"><div><i class="ba-pending-icon"></i><span data-upload-id="speed"></span></div></div>\n        <div class="toolbar" data-upload-id="toolbar">\n            <div class="tool-upload" data-upload-id="upload-btn"><i class="fa fa-cloud-upload"></i></div>\n            <div class="tool-select" data-upload-id="select-btn"></div>\n            <div class="tool-remove" data-upload-id="remove-btn"><i class="fa fa-remove"></i></div>\n        </div>\n    </div>\n</div>').addClass(r.className);i.$toolbar=m(o,"toolbar");i.$uploadBtn=m(o,"upload-btn").addClass(r.uploadClass);i.$uploadBtn2=m(o,"upload-btn2");i.$selectBtn=m(o,"select-btn").addClass(r.selectClass);i.$icon=m(o,"icon").addClass(r.cardIcon);i.$preview=m(o,"preview").hide();i.$progress=m(o,"progress").hide();i.$speed=m(o,"speed");i.$delete=m(o,"remove-btn");if(t.options.cardType==="circle")o.addClass("upload-card-type-circle");var s=t.options.cardSize;if(s==="parent"){t.$element.parent().addClass("ba-upload-card-parent");a=true}else if(s){if(!S.isArray(s))s=s.split(",");a=s[0];n=s[1]}if(t.options.cardRadius)o.css("border-radius",t.options.cardRadius);if(t.isInput){i.$input=t.$element;o.insertAfter(i.$input).append(i.$input)}else{i.$input=S('<input type="text" name="'+r.name+'"/>');t.$element.html(o).append(i.$input)}i.$input.addClass("input-hidden").on(u.validateErrorPlacement,function(e,t){o.after(t);return false});i.$delete.on("click",function(){i.showPreview("")});i.setSize(a,n);r.auto=true;t._initUploader(i.$uploadBtn,o,i.$selectBtn,false);i.$toolbar.hide();t.uploader.addButton({id:i.$uploadBtn2,multiple:false}).then(function(){i.$placeholder=m(o,"placeholder");i.$icon=m(o,"icon");i.setPlaceholder(r.placeholder)});t.$element.on(u.uploadFileError,function(e,t,a,n){t.reset();C.dialog.tipError(n)}).on(u.uploadReset,function(){i.setDisabled(false);i.$progress.hide()}).on(u.uploadFileQueued,function(){i.$speed.html("0%");i.$progress.show()}).on(u.uploadProgress,function(e,t,a,n){i.$speed.html((n*100).toFixed(2)+"%")}).on(u.uploadComplete,function(e,t){t.reset()}).on(u.uploadError,function(e,t,a,n){C.dialog.tipError(n)}).on(u.uploadSuccess,function(e,t,a,n){C.dialog.tipSuccess(r.locale.uploadSuccess);i.setValue(n.file_url)});t.uploader.on("beforeFileQueued",function(e){i.setDisabled(true);return true});i.setValue(r.value);i.setDisabled(r.disabled);P()},setSize:function e(t,a){var n=this;if(t===true){if(n.api.uploader)n.api.uploader.refresh();return}a=a<=0?t:a;if(!n.api.isInput)n.api.$element.addClass("ba-upload-card-parent").css({width:t,height:a});else n.$template.css({width:t,height:a});if(n.api.uploader)n.api.uploader.refresh();P()},setIcon:function e(t){this.$icon.removeAttr("class").addClass(t)},setValue:function e(t){this.api.options.value=t;this.showPreview(t)},setPlaceholder:function e(t){this.$placeholder.html(t)},setSelectFiles:function e(t){t=t||[];if(t.length<=0)return;var a=t[0];this.showPreview(a.url);this.api._triggerResult(a,false)},showPreview:function e(t){var a=this;var n=a.api;var i;t=(t||"").trim();a.$input.val(t).baTriggerEvent("input").baTriggerEvent("change");n._triggerChange(t);if(t.length===0){a.$preview.empty().hide();a.$delete.hide();return}n._previewHandler(t,function(){var e="";if(n.options.previewPlaceholder===true)e='data-avatar="true"';else if(n.options.previewPlaceholder)e='data-placeholder="'+n.options.previewPlaceholder+'"';a.$preview.html(i=S('<img src="'+t+'" data-title="false" '+e+' class="cursor-zoom-in"/>')).show();i.baImageViewer()},function(){a.$preview.html(i=S('<video><source src="'+t+'"/></video>')).show();i.baVideoViewer({previewSize:false})});if(i)i.css("object-fit",n.options.objectFit);a.$delete.show()},setDisabled:function e(t){this.api._changeDisabled(t);this.$template.toggleClass("disabled",t)},destroy:function e(){var t=this;t.$input.off(u.validateErrorPlacement);if(t.api.isInput)t.$input.removeClass("input-hidden").insertBefore(t.$template);t.$template.remove()}};var g=function e(t){this.api=t;this.pending=null;this.init()};function t(e){return D.pluginFn(this,c,e,arguments,"module")}return g.prototype={init:function(){var i=this,r=i.api,o=r.options;o.upload=!0,o.select=!0,i.$uploadBtn=S(r.element),i.$selectBtn=null,o.useSelect&&(i.$selectBtn=S(o.useSelect)),i.$dnd=null,o.useDnd&&(i.$dnd=S(o.useDnd),o.dnd=!0),r._initUploader(i.$uploadBtn,i.$dnd,i.$selectBtn,!1),r.$element.on(u.uploadFileError,function(e,t,a,n){t.reset(),o.useError||C.dialog.tipError(n)}).on(u.uploadReset,function(){i.setDisabled(!1),i.pending&&i.pending.close()}).on(u.uploadFileQueued,function(){o.useProgress||(i.pending=C.dialog.pending("0%"))}).on(u.uploadProgress,function(e,t,a,n){i.pending&&i.pending.update((100*n).toFixed(2)+"%")}).on(u.uploadComplete,function(e,t){t.reset()}).on(u.uploadError,function(e,t,a,n){o.useError||C.dialog.tipError(n)}).on(u.uploadSuccess,function(e,t,a,n){r._triggerResult(n,!0),r._triggerChange(n.file_url)}),r.uploader.on("beforeFileQueued",function(e){return i.setDisabled(!0),!0}),i.setDisabled(o.disabled),P()},setSelectFiles:function(e){(e=e||[]).length<=0||(this.api._triggerResult(e[0],!1),this.api._triggerChange(e[0].url))},setDisabled:function(e){this.api._changeDisabled(e)},destroy:function(){}},S.fn.baUpload=t,S.fn.baUpload.Constructor=c,C.plugins.Upload=c,u.uploadInitialized=e("Initialized",I),u.uploadAsyncInit=e("init",I),u.uploadReady=e("ready",I),u.uploadFileError=e("file-error",I),u.uploadFileQueued=e("file-queued",I),u.uploadFilesQueued=e("files-queued",I),u.uploadFileDequeued=e("files-dequeued",I),u.uploadAsyncBeforeSendFile=e("async-before-send-file",I),u.uploadBeforeSend=e("before-send",I),u.uploadAsyncBeforeSend=e("async-before-send",I),u.uploadAccept=e("accept",I),u.uploadAsyncAfterSendFile=e("async-after-send-file",I),u.uploadBegin=e("begin",I),u.uploadStop=e("stop",I),u.uploadFinished=e("finished",I),u.uploadStart=e("start",I),u.uploadComplete=e("complete",I),u.uploadProgress=e("progress",I),u.uploadSuccess=e("success",I),u.uploadError=e("error",I),u.uploadReset=e("reset",I),u.uploadResult=e("result",I),u.uploadChange=e("change",I),C.autoInit(I,D.pluginAttrs(I),function(){t.call(this)}),c}),define("./ba/plug/validate",["busyAdmin","jquery"],function(u,p){"use strict";var c=u.helper,d=u.e,i="validate",e=c.pluginKey(i);d.validateErrorPlacement=u.ee("error-placement",i),d.validateInitialized=u.ee("initialized",i),d.validateInvalid=u.ee("invalid",i);var r=function e(t,a,n,i){var r=p(a);var o=r.closest(".form-group");if(o.length>0)o.toggleClass("has-error",!t)},o=function e(t,a){var n=[];t.split(a).map(function(e){e=e.trim();if(e.length)n.push(e)});return n},s=function e(t,a){var n;try{n=JSON.parse(t)}catch(e){n=o(t,a)}return p.isArray(n)?n:[]},f="validateErrorContainer",l="validateContainerBackups",h="validateRemotePending",m=function e(t){if(t.length&&!t.data(l))t.data(l,t.html())},g=function e(t,a,n){n.addClass("help-block");var i=c.scope(a.data("errorTarget"));if(i){if(typeof i==="function"&&!(i instanceof jQuery))i(n);else p(i).html(n);return}var r=".help-block",o;if(false===c.execCallback(t.api,null,a[0],[n],a,d.validateErrorPlacement,true,false)){o=n.next(r);m(o);if(o.length){a.data(f,o);o.html(n)}return}var s=a.closest(".input-group");o=s.next(r);m(o);if(s.length){if(o.length){a.data(f,o);o.html(n)}else n.insertAfter(s);return}if(a.is(":checkbox")||a.is(":radio")){var l=a.closest(".checkbox-inline,.checkbox,.radio-inline,.radio,.checkbox-group,.radio-group");if(l.length)l.parent().append(n)}else{o=a.next(r);m(o);if(o.length){a.data(f,o);o.html(n)}else n.insertAfter(a)}},v,a=function e(){if(v)return;v=true;var t=p.validator;var a=b.DEFAULTS.locale;t.messages=a;t.addMethod("regex",function(e,t,a){return this.optional(t)||new RegExp(a).test(e)},a.regex);t.addMethod("phone",function(e,t){return this.optional(t)||/^(\+?86-?)?(18|15|13|14|17|16|19)[0-9]{9}$/.test(e)},a.phone);t.addMethod("cardNo",function(e,t){return this.optional(t)||c.checkCardNo(e)},a.cardNo);t.addMethod("tel",function(e,t){return this.optional(t)||/^(010|02\d{1}|0[3-9]\d{2})-\d{7,9}(-\d+)?$/.test(e)},a.tel);t.addMethod("decimal",function(e,t){return this.optional(t)||/^\d+(\.\d+)?$/.test(e)},a.decimal);t.addMethod("zip",function(e,t){return this.optional(t)||/^\d{6}$/.test(e)},a.zip);t.addMethod("en",function(e,t){return this.optional(t)||/^[A-Za-z]+$/.test(e)},a.en);t.addMethod("enNumLine",function(e,t){return this.optional(t)||/^[A-Za-z0-9_]+$/.test(e)},a.enNumLine);t.addMethod("minArray",function(e,t,a){if(a<=0)return this.optional(t);var n=p(t).data()||{};var i=n.optArraySpace||",";return this.optional(t)||s(e,i).length>=a},a.minArray);t.addMethod("maxArray",function(e,t,a){if(a<=0)return this.optional(t);var n=p(t).data()||{};var i=n.optArraySpace||",";return this.optional(t)||s(e,i).length<=a},a.maxArray);var i=c.extends(t.prototype,{init:function e(){c.override(i,"init",this,arguments);var r=this.currentForm;p(this.currentForm).on("change.validate","input,select,textarea",function(e){var t=typeof p(this).attr("contenteditable")!=="undefined"&&p(this).attr("contenteditable")!=="false";if(!this.form&&t){this.form=p(this).closest("form")[0];this.name=p(this).attr("name")}if(r!==this.form)return;var a=p.data(this.form,"validator"),n="on"+e.type.replace(/^validate/,""),i=a.settings;if(i[n]&&!p(this).is(i.ignore))i[n].call(a,this,e)})},idOrName:function e(t){var a=p(t);var n="validateErrorId";var i=a.data(n);if(!i){i="ba-validate-error-"+b.INDEX++;a.data(n,i)}return i},startRequest:function e(t){var a=this;c.override(i,"startRequest",a,arguments);if(!a.pending[t.name])return;var n=p(t);if(n.data("optRemotePendingStatus")===false)return;a.pendingElements=a.pendingElements||{};if(!a.pendingElements[t.name])a.pendingElements[t.name]=p('<span class="ba-validate-pending"><i class="fa fa-circle-o-notch fa-spin"></i>'+(n.data("optRemotePendingMessage")||"请稍后...")+"</span>");g(a,n.data(h,true),a.pendingElements[t.name])},stopRequest:function e(t,a){var n=this;c.override(i,"stopRequest",n,arguments);n.pendingElements=n.pendingElements||{};if(n.pendingElements[t.name])n.pendingElements[t.name].remove();p(t).data(h,false)}});var n=c.extends(t.methods,{remote:function e(a,i,r,o){var s=this,l;if(s.optional(i))return"dependency-mismatch";o=typeof o==="string"&&o||"remote";var c=s.previousValue(i,o);var t=s.settings;if(!t.messages[i.name])t.messages[i.name]={};c.originalMessage=c.originalMessage||t.messages[i.name][o];t.messages[i.name][o]=c.message;r=typeof r==="string"?{url:r}:r;var n=p.param(p.extend({data:a},r.data));if(c.old===n)return c.valid;c.old=n;s.startRequest(i);s._ajaxMap=s._ajaxMap||{};s._ajaxMap[i.name]=s._ajaxMap[i.name]||{};l=s._ajaxMap[i.name];var d=function e(){var t=p(i).data();var n=s.defaultMessage(i,{method:o,parameters:a});l.task=u.request(t.optRemoteModel?u.getConfig("validate").remote:r.url).addHeader("Busy-Admin-Plugin","ValidateRemote").params({field:t.optRemoteField||i.name,value:a,model:t.optRemoteModel||"",exclude_field:t.optRemoteExcludeField||"id",exclude_value:t.optRemoteExcludeValue||"",error_message:n}).pending(false).before(function(e,t){t.context=s.currentForm}).complete(function(){s.settings.messages[i.name][o]=c.originalMessage}).success(function(){var e=s.formSubmitted;s.resetInternals();s.toHide=s.errorsFor(i);s.formSubmitted=e;s.successList.push(i);s.invalid[i.name]=false;s.stopRequest(i,true);s.showErrors();c.valid=true;return false}).error(function(e,t){var a={};a[i.name]=c.message=e.message||n;s.invalid[i.name]=true;s.stopRequest(i,false);s.showErrors(a);c.valid=false;return false}).exec()};l.task&&l.task.abort();clearTimeout(l.taskTimeId);l.taskTimeId=setTimeout(d,200);return"pending"}})},b=function e(t,a){var n=this;n.element=t;n.$element=p(t);n.options=p.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n.ready(n._init)};function t(e){return c.pluginFn(this,b,e,arguments,"api")}return b.prototype={ready:function(e){var t=this;v?e.call(t):requirejs([u.lib.validate],function(){a(),e.call(t)})},_init:function(){var e,a=this,t=a.$element,n={},i=p.proxy(a.destroy,a);p(document).one(d.appRenderBefore,i),(e=t.closestBaModal())&&e.$element.one(d.modalHide,i),t.find(":input").each(function(){var e=p(this),t=e.data(),a=e.attr("placeholder")||t.placeholder,e=e.attr("name")||t.name;if(!a||!e||t.msg)return!0;n[e]={required:a}}),t.on("invalid-form",function(){a.api.errorList.length&&a.options.toast&&u.dialog.toast(a.api.errorList[0].message),c.execCallback(a,a.options.onInvalid,a.element,[a],a.$element,d.validateInvalid)}),t.validate({messages:n,errorClass:"ba-validate-error text-danger",ignoreTitle:!0,ignore:'[data-rule-ignore],[validate="false"],[data-validate="false"]',errorElement:"span",submitHandler:c.scope(a.options.onSubmit),onchange:function(e){this.checkable(e)||!(e.name in this.submitted)&&this.optional(e)||this.element(e)},highlight:function(e,t,a){return r(!1,e,t,a),p.validator.defaults.highlight.call(this,e,t,a)},unhighlight:function(e,t,a){r(!0,e,t,a);var n=p(e).data(f);return n&&!p(e).data(h)&&n.html(n.data(l)),p.validator.defaults.unhighlight.call(this,e,t,a)},errorPlacement:function(e,t){g(a.api,t,e)}}),a.api=t.data("validator"),a.api.api=a,c.triggerPluginReady(t,a,"",d.validateInitialized)},valid:function(){return!!v&&this.$element.valid()},rules:function(e,t){if(v)return this.$element.rules(e,t)},destroy:function(){var e=this.api;if(e){if(e._ajaxMap){var t,a,n=e._ajaxMap;for(a in n)(t=n[a]).task&&(t.task.abort(),t.task=null),clearTimeout(t.taskTimeId)}this.api=null}}},b.INDEX=0,b.KEY=e,b.DEFAULTS={toast:!0,locale:p.extend({required:"必选项",remote:"请检测该项",email:"请输入有效邮件",url:"请输入有效的网址",date:"请输入有效的日期",dateISO:"请输入有效的日期(ISO)",number:"请输入数字",digits:"请输入整数",equalTo:"请再次输入相同的值",maxlength:"最多允许输入{0}个字符",minlength:"至少需要输入{0}个字符",rangelength:"输入的字符长度必须在{0}~{1}个字符内",range:"输入的数字必须在{0}~{1}之间",max:"不能超过{0}",min:"不能小于{0}",step:"输入的数值必须是{0}的倍数",phone:"请输入有效的手机号",decimal:"请输入有效的数值(可包涵小数)",zip:"请输入有效的邮编",en:"只能包涵英文字母",enNumLine:"只能包涵英文、数字、下划线",tel:"请输入有效的电话号码",minArray:"至少需要{0}项",maxArray:"最多允许{0}项",cardNo:"身份证格式错误",regex:"输入的内容无效"},((u.locale||{}).plugin||{}).formVerify||{})},p.fn.baValidate=t,p.fn.baValidate.Constructor=b,u.plugins.Validate=b,u.autoInit(i,c.pluginAttrs(i),function(){t.call(this)}),b}),define("./ba/plug/videoViewer",["busyAdmin","jquery"],function(s,l){var c=s.helper,i="video-viewer",d=c.pluginKey(i);s.e.videoViewerInitialized=s.ee("initialized",i);var t=function e(t,a){var n=this;n.element=t;n.$element=l(t);n.options=l.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});n._init()};function e(e){return c.pluginFn(this,t,e,arguments,"video",function(){if(!this.options.clickHandler&&!this.isVideo)this.show()})}return t.prototype={_init:function(){var a=this,t=a.options,e=a.$element;a.sources=[];function n(e){return e.preventDefault(),a.show(),!1}var i,r;"video"===a.element.tagName.toLowerCase()?(a.isVideo=!0,e.find("source").each(function(){var e=l(this),t=e.attr("src");t&&a.sources.push({src:t,type:e.attr("type")})}),i=l('<div class="ba-video-viewer"/>'),a.options.previewSize&&i.css({width:e.outerWidth(!0),height:e.outerHeight(!0)}),e.wrap(i),a.$template=e.parent(),a.$template.append('<div class="player fa fa-play-circle fa-3x"/>'),a.$template.off("click."+d).on("click."+d,n)):a.options.clickHandler&&e.off("click."+d).on("click."+d,n),t.src=t.src||e.attr("src")||"",t.type=t.type||e.attr("type")||"",t.poster=t.poster||e.attr("poster")||"",t.src&&(r=!1,a.sources.map(function(e){e.src==t.src&&(r=!0)}),r||a.sources.push({src:t.src,type:t.type})),!t.vertical&&0<t.width&&0<t.height&&(t.vertical=t.width<t.height);var o="";a.sources.map(function(e){o+='<source src="'+e.src+'" type="'+(e.type||"")+'"/>'}),e.baModal({show:!1,className:"ba-video-viewer-dialog"+(t.vertical?" ba--vertical":""),content:'<div class="ba--content"><video class="video-js">'+o+"</video></div>",size:t.vertical?"sm":"",padding:0,footer:!1,title:t.title||"预览视频",ok:!1,cancel:"关闭",type:"page",onReady:function(e){e.$dialogBody.find("video").baVideo(l.extend({controls:t.controls,preload:t.preload,autoplay:t.autoplay,muted:t.muted,poster:t.poster,loop:t.loop,fluid:!1,objectFit:t.objectFit},t.options||{})).baVideo("ready",function(){a.video=this,e.resetView()})}},!0),c.triggerPluginReady(e,a,"",s.e.videoViewerInitialized)},show:function(){this.$element.baModal("show")},hide:function(){this.$element.baModal("close")},getVideo:function(){return this.video},destroy:function(){this.isVideo?(this.$template.after(this.$element),this.$template.remove()):this.options.clickHandler&&this.$element.off("click."+d),this.video=null}},t.KEY=d,t.DEFAULTS={clickHandler:!0,src:"",type:"",autoplay:!0,muted:!1,controls:!0,loop:!1,preload:"auto",poster:"",objectFit:"",options:{},title:"",vertical:!1,width:0,height:0,previewSize:!0},l.fn.baVideoViewer=e,l.fn.baVideoViewer.Constructor=t,s.plugins.VideoViewer=t,s.autoInit(i,c.pluginAttrs(i),function(){e.call(this)}),t}),define("./ba/plug/video",["busyAdmin","jquery"],function(s,l){var c=null,d=s.helper,u=s.ee,p="video",f="ready,loadstart,progress,loadedmetadata,canplaythrough,waiting,play,playing,pause,ended,error,seeking,seeked,ratechange,timeupdate,volumechange,stalled".split(","),h=l.baIsEmpty,e=d.pluginKey(p);s.e.videoInitialized=u("initialized",p),l.map(f,function(e){s.e[d.camel("video_"+e)]=u(e,p)});var i=function e(){var a=d.extends(videojs.getComponent("Player").prototype,{createEl:function e(){var t=d.override(a,"createEl",this,arguments);["data-toggle","busy-video"].map(function(e){t.removeAttribute(e)});return t}})},t=function e(t,a){var n=this;n.element=t;n.$element=l(t);n.options=l.extend(true,{},e.DEFAULTS,n.$element.baData(p)||{},a||{});n.ready(n._init)};function a(e){return d.pluginFn(this,t,e,arguments,"api")}return t.prototype={ready:function(a){var n=this;c?a.call(n):requirejs([s.lib.videojs],function(e){window.videojs=e;function t(){c=e,i(),a.call(n)}n.options.locale?requirejs(["video-js/lang/"+n.options.locale+".min"],t):t()})},_init:function(){var a=this,n=a.options,i=a.$element,e=a.element,t=l.proxy(a.destroy,a);l(document).one(s.e.appRenderBefore,t);var r=i.closestBaModal();r&&r.$element.one(s.e.modalHided,t),i.wrap('<div class="ba-video" />'),a.$wrap=i.parent(),a.sources=[],"video"===e.tagName.toLowerCase()?(a.isVideo=!0,a.$video=i,h(n.autoplay)&&(n.autoplay=!!e.hasAttribute("autoplay")||null),h(n.loop)&&(n.loop=!!e.hasAttribute("loop")||null),h(n.muted)&&(n.muted=!!e.hasAttribute("muted")||null),h(n.preload)&&(n.preload=e.getAttribute("preload")),h(n.controls)&&(n.controls=!!e.hasAttribute("controls")||null)):(a.$video=l("<video />"),a.$wrap.append(a.$video)),n.src=n.src||i.attr("src")||"",n.type=n.type||i.attr("type")||"",n.poster=n.poster||i.attr("poster")||"",n.width=n.width||i.attr("width")||"",n.height=n.height||i.attr("height")||"",n.preload=n.preload||"auto";var o,e="boolean";_typeof(n.loop)!==e&&(n.loop=!1),_typeof(n.autoplay)!==e&&(n.autoplay=!1),_typeof(n.muted)!==e&&(n.muted=!1),_typeof(n.controls)!==e&&(n.controls=!0),_typeof(n.fluid)!==e&&(n.fluid=!(n.width||n.height)),n.src&&(o=!1,n.sources.map(function(e){e.src==n.src&&(o=!0)}),o||n.sources.push({src:n.src,poster:n.poster,type:n.type}));e="";n.objectFit&&(e="object-fit: "+n.objectFit),a.$video.addClass("video-js").attr({style:e,"x-webkit-airplay":"allow","webkit-playsinlin":"true","x5-playsinline":"true",playsinline:"true"}),a.api=c(a.$video[0],l.extend({src:n.src,controls:n.controls,poster:n.poster,preload:n.preload,autoplay:n.autoplay,loop:n.loop,fluid:n.fluid,muted:n.muted,sources:n.sources,width:n.width,height:n.height,aspectRatio:n.aspectRatio,playbackRates:n.playbackRates},n.options||{}),function(){n.autoplay&&setTimeout(function(){a.api.play()})}),a.api.on(f,function(e){var t=e.type;"play"===t?a.playing=!0:"pause"===t&&(a.playing=!1);e=Array.prototype.slice.call(arguments);e.shift(),e.unshift(a.api),d.execCallback(a,n[d.camel("on_"+t)],a.element,e,i,u(t,p))}),d.triggerPluginReady(i,a,"",s.e.videoInitialized)},getApi:function(){return this.api},isPlaying:function(){return this.playing},destroy:function(){var e=this,t=e.api;t&&(t.isInPictureInPicture()&&t.exitPictureInPicture(),e.playing&&t.pause(),t.isDisposed_||t.dispose(),e.api=null),e.playing=!1,e.isVideo&&(e.isVideo=!1,e.$element.removeClass("video-js")),e.$wrap.after(e.$element),e.$wrap.remove()}},t.KEY=e,t.DEFAULTS={src:"",type:"",autoplay:null,muted:null,controls:null,loop:null,preload:null,fluid:null,poster:"",objectFit:"",width:0,height:0,sources:[],aspectRatio:void 0,playbackRates:[.5,1,1.25,1.5,2],options:{},locale:"zh-CN"},l.fn.baVideo=a,l.fn.baVideo.Constructor=t,s.plugins.Video=t,s.autoInit(p,d.pluginAttrs(p),function(){a.call(this)}),t}),define("./ba/plug/vue",["busyAdmin","jquery"],function(e,o){var s=e.helper,l=e.e,t=e.ee,i="vue",a=s.pluginKey(i),c="data,watch,computed,template,methods,beforeCreate,created,beforeMount,mounted,beforeUpdate,updated,activated,deactivated,beforeDestroy,destroyed,errorCaptured,directives,filters,components,mixins,parent,extends,provide,inject".split(","),d="methods,computed,template,directives,filters,components,parent,mixins,provide".split(",");l.vueInitialized=t("initialized",i);var u=function e(t,a){var n=this;n.element=t;n.$element=o(t);n.options=o.extend(true,{},e.DEFAULTS,n.$element.baData(i)||{},a||{});e.ready(o.proxy(n._init,n))};function n(e){return s.pluginFn(this,u,e,arguments,"api")}return u.prototype={_init:function(){var e=this,a=e.options,t=e.$element,n=e.element,i={};c.forEach(function(e){var t=s.scope(a[e]);o.baIsEmpty(t)||(-1<d.indexOf(e)&&"function"==typeof t&&(t=t()),i[e]=t)}),i.el=n,i.data=i.data||{};var r=i.mounted;i.mounted=function(){e.$element=o(this.$el).data(u.KEY,e),e.element=this.$el;try{"function"==typeof r&&r.call(this)}catch(e){console.error(e)}s.triggerPluginReady(t,e,"",l.vueInitialized)},e.vueOptions=i,e.api=new u.Vue(i)},getApi:function(){return this.api},destroy:function(){this.api&&this.api.$destroy()}},u.Vue=null,u.ready=function(t){window._BaVue&&(u.Vue=window._BaVue),u.Vue?t():e.require([e.lib.vue],function(e){u.Vue=e,t()})},u.KEY=a,u.DEFAULTS={data:{},element:!0},o.fn.baVue=n,o.fn.baVue.Constructor=u,e.plugins.Vue=u,e.autoInit("vue",s.pluginAttrs("vue"),function(){this.each(function(){this.__vue__||n.call(o(this))})}),u}),define("./ba/plug/appWatermark",["busyAdmin","jquery"],function(i,n){var r,o,e=i.helper,s=e.int,l=e.float,a=function e(){return i.getConfig("watermark",{})},c=function e(){var t=this;t.options=a();t.ready(t.init)};function t(e){e=e||{};var t=i.app;if(t.isLogin()&&e.status){if(!t.watermark)t.watermark=new c;t.watermark.ready(function(){this.create(e)})}else if(t.watermark)t.watermark.ready(function(){this.cancel()})}c.prototype={ready:function e(a){var n=this;if(r&&o)a.call(n);else requirejs([i.lib.gwm,i.lib.moment],function(e,t){r=e;o=t;a.call(n)})},init:function e(){},create:function e(t){var a=n.extend({},this.options,t||{});a.txt=(a.txt||"").replace(/\{username\}/g,i.app.getUsername());a.txt=a.txt.replace(/\{time\}/g,o().format(a.timeFormat||"YYYY-MM-DD HH:ii:ss"));r.creation({mode:"svg",watch:true,fontSize:a.fontSize,color:a.color,font:a.font||"sans-serif",alpha:l(a.alpha||0),angle:s(a.angle||0),imageWidth:s(a.imageWidth||0),imageHeight:s(a.imageHeight||0),imageX:s(a.imageX||0),imageY:s(a.imageY||0),image:a.image||"",width:s(a.width||0),height:s(a.height||0),x:s(a.x||0),y:s(a.y||0),txt:a.txt})},cancel:function e(){r.cancel()}},c.create=t,i.plugins.AppWatermark=c,n(document).on(i.e.appReadies,function(){t(a())}).on(i.e.appReqSuccess,function(){t(a())})});